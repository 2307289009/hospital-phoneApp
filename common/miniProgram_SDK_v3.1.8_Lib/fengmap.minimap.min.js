// /**Released Version v3.1.8,BUILD 219,Time 1732862066436. Fengmap Mini SDK  es6, see: https://www.fengmap.com for details**/
Object.defineProperty(exports,"t",{value:!0});for(var c={VERSION:"v3.1.8",BUILD:219},d=[],t=0;t<256;t++)d[t]=(t<16?"0":"")+t.toString(16);var Et={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(d[255&t]+d[t>>8&255]+d[t>>16&255]+d[t>>24&255]+"-"+d[255&e]+d[e>>8&255]+"-"+d[e>>16&15|64]+d[e>>24&255]+"-"+d[63&i|128]+d[i>>8&255]+"-"+d[i>>16&255]+d[i>>24&255]+d[255&r]+d[r>>8&255]+d[r>>16&255]+d[r>>24&255]).toUpperCase()},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Et.DEG2RAD},radToDeg:function(t){return t*Et.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,r,n){var s=Math.cos,o=Math.sin,a=s(i/2),i=o(i/2),h=s((e+r)/2),l=o((e+r)/2),u=s((e-r)/2),c=o((e-r)/2),s=s((r-e)/2),o=o((r-e)/2);"XYX"===n?t.set(a*l,i*u,i*c,a*h):"YZY"===n?t.set(i*c,a*l,i*u,a*h):"ZXZ"===n?t.set(i*u,i*c,a*l,a*h):"XZX"===n?t.set(a*l,i*o,i*s,a*h):"YXY"===n?t.set(i*s,a*l,i*o,a*h):"ZYZ"===n?t.set(i*o,i*s,a*l,a*h):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function at(t,e,i,r){this.o=t||0,this.u=e||0,this.v=i||0,this.p=void 0!==r?r:1}Object.assign(at,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,n,s,o){var a,h,l,u=i[r+0],c=i[r+1],f=i[r+2],i=i[r+3],r=n[s+0],d=n[s+1],v=n[s+2],n=n[s+3];i===n&&u===r&&c===d&&f===v||(s=1-o,a=0<=(h=u*r+c*d+f*v+i*n)?1:-1,(l=1-h*h)>Number.EPSILON&&(l=Math.sqrt(l),h=Math.atan2(l,h*a),s=Math.sin(s*h)/l,o=Math.sin(o*h)/l),u=u*s+r*(h=o*a),c=c*s+d*h,f=f*s+v*h,i=i*s+n*h,s===1-o&&(u*=l=1/Math.sqrt(u*u+c*c+f*f+i*i),c*=l,f*=l,i*=l)),t[e]=u,t[e+1]=c,t[e+2]=f,t[e+3]=i}}),Object.defineProperties(at.prototype,{x:{get:function(){return this.o},set:function(t){this.o=t,this._()}},y:{get:function(){return this.u},set:function(t){this.u=t,this._()}},z:{get:function(){return this.v},set:function(t){this.v=t,this._()}},w:{get:function(){return this.p},set:function(t){this.p=t,this._()}}}),Object.assign(at.prototype,{isQuaternion:!0,set:function(t,e,i,r){return this.o=t,this.u=e,this.v=i,this.p=r,this._(),this},clone:function(){return new this.constructor(this.o,this.u,this.v,this.p)},copy:function(t){return this.o=t.x,this.u=t.y,this.v=t.z,this.p=t.w,this._(),this},setFromEuler:function(t,e){var i,r,n,s,o,a,h;if(t&&t.isEuler)return o=t.o,a=t.u,i=t.v,t=t.order,s=Math.cos,h=Math.sin,r=s(o/2),n=s(a/2),s=s(i/2),o=h(o/2),a=h(a/2),h=h(i/2),"XYZ"===t?(this.o=o*n*s+r*a*h,this.u=r*a*s-o*n*h,this.v=r*n*h+o*a*s,this.p=r*n*s-o*a*h):"YXZ"===t?(this.o=o*n*s+r*a*h,this.u=r*a*s-o*n*h,this.v=r*n*h-o*a*s,this.p=r*n*s+o*a*h):"ZXY"===t?(this.o=o*n*s-r*a*h,this.u=r*a*s+o*n*h,this.v=r*n*h+o*a*s,this.p=r*n*s-o*a*h):"ZYX"===t?(this.o=o*n*s-r*a*h,this.u=r*a*s+o*n*h,this.v=r*n*h-o*a*s,this.p=r*n*s+o*a*h):"YZX"===t?(this.o=o*n*s+r*a*h,this.u=r*a*s+o*n*h,this.v=r*n*h-o*a*s,this.p=r*n*s-o*a*h):"XZY"===t&&(this.o=o*n*s-r*a*h,this.u=r*a*s-o*n*h,this.v=r*n*h+o*a*s,this.p=r*n*s+o*a*h),!1!==e&&this._(),this;throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")},setFromAxisAngle:function(t,e){var e=e/2,i=Math.sin(e);return this.o=t.x*i,this.u=t.y*i,this.v=t.z*i,this.p=Math.cos(e),this._(),this},setFromRotationMatrix:function(t){var e,t=t.elements,i=t[0],r=t[4],n=t[8],s=t[1],o=t[5],a=t[9],h=t[2],l=t[6],t=t[10],u=i+o+t;return 0<u?(e=.5/Math.sqrt(u+1),this.p=.25/e,this.o=(l-a)*e,this.u=(n-h)*e,this.v=(s-r)*e):o<i&&t<i?(e=2*Math.sqrt(1+i-o-t),this.p=(l-a)/e,this.o=.25*e,this.u=(r+s)/e,this.v=(n+h)/e):t<o?(e=2*Math.sqrt(1+o-i-t),this.p=(n-h)/e,this.o=(r+s)/e,this.u=.25*e,this.v=(a+l)/e):(e=2*Math.sqrt(1+t-i-o),this.p=(s-r)/e,this.o=(n+h)/e,this.u=(a+l)/e,this.v=.25*e),this._(),this},setFromUnitVectors:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this.o=-t.y,this.u=t.x,this.v=0):(this.o=0,this.u=-t.z,this.v=t.y)):(this.o=t.y*e.z-t.z*e.y,this.u=t.z*e.x-t.x*e.z,this.v=t.x*e.y-t.y*e.x),this.p=i,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Et.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var i=this.angleTo(t);return 0!==i&&(e=Math.min(1,e/i),this.slerp(t,e)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this.o*=-1,this.u*=-1,this.v*=-1,this._(),this},dot:function(t){return this.o*t.o+this.u*t.u+this.v*t.v+this.p*t.p},lengthSq:function(){return this.o*this.o+this.u*this.u+this.v*this.v+this.p*this.p},length:function(){return Math.sqrt(this.o*this.o+this.u*this.u+this.v*this.v+this.p*this.p)},normalize:function(){var t=this.length();return 0===t?(this.o=0,this.u=0,this.v=0,this.p=1):(this.o=this.o*(t=1/t),this.u=this.u*t,this.v=this.v*t,this.p=this.p*t),this._(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t.o,r=t.u,n=t.v,t=t.p,s=e.o,o=e.u,a=e.v,e=e.p;return this.o=i*e+t*s+r*a-n*o,this.u=r*e+t*o+n*s-i*a,this.v=n*e+t*a+i*o-r*s,this.p=t*e-i*s-r*o-n*a,this._(),this},slerp:function(t,e){if(0!==e){if(1===e)return this.copy(t);var i,r=this.o,n=this.u,s=this.v,o=this.p,a=o*t.p+r*t.o+n*t.u+s*t.v;a<0?(this.p=-t.p,this.o=-t.o,this.u=-t.u,this.v=-t.v,a=-a):this.copy(t),1<=a?(this.p=o,this.o=r,this.u=n,this.v=s):((t=1-a*a)<=Number.EPSILON?(this.p=(i=1-e)*o+e*this.p,this.o=i*r+e*this.o,this.u=i*n+e*this.u,this.v=i*s+e*this.v,this.normalize()):(i=Math.sqrt(t),t=Math.atan2(i,a),a=Math.sin((1-e)*t)/i,e=Math.sin(e*t)/i,this.p=o*a+this.p*e,this.o=r*a+this.o*e,this.u=n*a+this.u*e,this.v=s*a+this.v*e),this._())}return this},equals:function(t){return t.o===this.o&&t.u===this.u&&t.v===this.v&&t.p===this.p},fromArray:function(t,e){return this.o=t[e=void 0===e?0:e],this.u=t[e+1],this.v=t[e+2],this.p=t[e+3],this._(),this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.o,t[e+1]=this.u,t[e+2]=this.v,t[e+3]=this.p,t},fromBufferAttribute:function(t,e){return this.o=t.getX(e),this.u=t.getY(e),this.v=t.getZ(e),this.p=t.getW(e),this},onChange:function(t){return this._=t,this},_:function(){}});var e=new Lt,i=new at;function Lt(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}Object.assign(Lt.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(i.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(i.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,t=t.elements;return this.x=t[0]*e+t[3]*i+t[6]*r,this.y=t[1]*e+t[4]*i+t[7]*r,this.z=t[2]*e+t[5]*i+t[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,t=t.elements,n=1/(t[3]*e+t[7]*i+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*i+t[8]*r+t[12])*n,this.y=(t[1]*e+t[5]*i+t[9]*r+t[13])*n,this.z=(t[2]*e+t[6]*i+t[10]*r+t[14])*n,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,o=t.z,t=t.w,a=t*e+s*r-o*i,h=t*i+o*e-n*r,l=t*r+n*i-s*e,e=-n*e-s*i-o*r;return this.x=a*t+e*-n+h*-o-l*-s,this.y=h*t+e*-s+l*-n-a*-o,this.z=l*t+e*-o+a*-s-h*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,i=this.y,r=this.z,t=t.elements;return this.x=t[0]*e+t[4]*i+t[8]*r,this.y=t[1]*e+t[5]*i+t[9]*r,this.z=t[2]*e+t[6]*i+t[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,r=t.y,t=t.z,n=e.x,s=e.y,e=e.z;return this.x=r*e-t*s,this.y=t*n-i*e,this.z=i*s-r*n,this},projectOnVector:function(t){var e=t.lengthSq();return 0===e?this.set(0,0,0):(e=t.dot(this)/e,this.copy(t).multiplyScalar(e))},projectOnPlane:function(t){return e.copy(this).projectOnVector(t),this.sub(e)},reflect:function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e?Math.PI/2:(t=this.dot(t)/e,Math.acos(Et.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,t=this.z-t.z;return e*e+i*i+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,i){var r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=t,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var v=new Lt,y=new Tt,w=new Lt(0,0,0),M=new Lt(1,1,1),E=new Lt,L=new Lt,T=new Lt;function Tt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function S(){}Object.assign(Tt.prototype,{isMatrix4:!0,set:function(t,e,i,r,n,s,o,a,h,l,u,c,f,d,v,p){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=o,m[13]=a,m[2]=h,m[6]=l,m[10]=u,m[14]=c,m[3]=f,m[7]=d,m[11]=v,m[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Tt).fromArray(this.elements)},copy:function(t){var e=this.elements,t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},copyPosition:function(t){var e=this.elements,t=t.elements;return e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,i=t.elements,r=1/v.setFromMatrixColumn(t,0).length(),n=1/v.setFromMatrixColumn(t,1).length(),t=1/v.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e,i,r,n,s,o,a,h,l,u,c,f,d=this.elements,v=t.x,p=t.y,m=t.z,g=Math.cos(v),v=Math.sin(v),_=Math.cos(p),p=Math.sin(p),b=Math.cos(m),m=Math.sin(m);return"XYZ"===t.order?(s=g*b,o=g*m,a=v*b,h=v*m,d[0]=_*b,d[4]=-_*m,d[8]=p,d[1]=o+a*p,d[5]=s-h*p,d[9]=-v*_,d[2]=h-s*p,d[6]=a+o*p,d[10]=g*_):"YXZ"===t.order?(i=_*m,r=p*b,d[0]=(e=_*b)+(n=p*m)*v,d[4]=r*v-i,d[8]=g*p,d[1]=g*m,d[5]=g*b,d[9]=-v,d[2]=i*v-r,d[6]=n+e*v,d[10]=g*_):"ZXY"===t.order?(i=_*m,r=p*b,d[0]=(e=_*b)-(n=p*m)*v,d[4]=-g*m,d[8]=r+i*v,d[1]=i+r*v,d[5]=g*b,d[9]=n-e*v,d[2]=-g*p,d[6]=v,d[10]=g*_):"ZYX"===t.order?(s=g*b,o=g*m,a=v*b,h=v*m,d[0]=_*b,d[4]=a*p-o,d[8]=s*p+h,d[1]=_*m,d[5]=h*p+s,d[9]=o*p-a,d[2]=-p,d[6]=v*_,d[10]=g*_):"YZX"===t.order?(l=g*_,u=g*p,c=v*_,f=v*p,d[0]=_*b,d[4]=f-l*m,d[8]=c*m+u,d[1]=m,d[5]=g*b,d[9]=-v*b,d[2]=-p*b,d[6]=u*m+c,d[10]=l-f*m):"XZY"===t.order&&(l=g*_,u=g*p,c=v*_,f=v*p,d[0]=_*b,d[4]=-m,d[8]=p*b,d[1]=l*m+f,d[5]=g*b,d[9]=u*m-c,d[2]=c*m-u,d[6]=v*b,d[10]=f*m+l),d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(w,t,M)},lookAt:function(t,e,i){var r=this.elements;return T.subVectors(t,e),0===T.lengthSq()&&(T.z=1),T.normalize(),E.crossVectors(i,T),0===E.lengthSq()&&(1===Math.abs(i.z)?T.x+=1e-4:T.z+=1e-4,T.normalize(),E.crossVectors(i,T)),E.normalize(),L.crossVectors(T,E),r[0]=E.x,r[4]=L.x,r[8]=T.x,r[1]=E.y,r[5]=L.y,r[9]=T.y,r[2]=E.z,r[6]=L.z,r[10]=T.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var t=t.elements,e=e.elements,i=this.elements,r=t[0],n=t[4],s=t[8],o=t[12],a=t[1],h=t[5],l=t[9],u=t[13],c=t[2],f=t[6],d=t[10],v=t[14],p=t[3],m=t[7],g=t[11],t=t[15],_=e[0],b=e[4],y=e[8],w=e[12],x=e[1],M=e[5],E=e[9],L=e[13],T=e[2],S=e[6],A=e[10],O=e[14],C=e[3],R=e[7],N=e[11],e=e[15];return i[0]=r*_+n*x+s*T+o*C,i[4]=r*b+n*M+s*S+o*R,i[8]=r*y+n*E+s*A+o*N,i[12]=r*w+n*L+s*O+o*e,i[1]=a*_+h*x+l*T+u*C,i[5]=a*b+h*M+l*S+u*R,i[9]=a*y+h*E+l*A+u*N,i[13]=a*w+h*L+l*O+u*e,i[2]=c*_+f*x+d*T+v*C,i[6]=c*b+f*M+d*S+v*R,i[10]=c*y+f*E+d*A+v*N,i[14]=c*w+f*L+d*O+v*e,i[3]=p*_+m*x+g*T+t*C,i[7]=p*b+m*M+g*S+t*R,i[11]=p*y+m*E+g*A+t*N,i[15]=p*w+m*L+g*O+t*e,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],o=t[5],a=t[9],h=t[13],l=t[2],u=t[6],c=t[10],f=t[14];return t[3]*(+n*a*u-r*h*u-n*o*c+i*h*c+r*o*f-i*a*f)+t[7]*(+e*a*f-e*h*c+n*s*c-r*s*f+r*h*l-n*a*l)+t[11]*(+e*h*u-e*o*f-n*s*u+i*s*f+n*o*l-i*h*l)+t[15]*(-r*o*l-e*a*u+e*o*c+r*s*u-i*s*c+i*a*l)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,i){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var e=this.elements,t=t.elements,i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],h=t[6],l=t[7],u=t[8],c=t[9],f=t[10],d=t[11],v=t[12],p=t[13],m=t[14],t=t[15],g=c*m*l-p*f*l+p*h*d-a*m*d-c*h*t+a*f*t,_=v*f*l-u*m*l-v*h*d+o*m*d+u*h*t-o*f*t,b=u*p*l-v*c*l+v*a*d-o*p*d-u*a*t+o*c*t,y=v*c*h-u*p*h-v*a*f+o*p*f+u*a*m-o*c*m,w=i*g+r*_+n*b+s*y;return 0==w?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(e[0]=g*(g=1/w),e[1]=(p*f*s-c*m*s-p*n*d+r*m*d+c*n*t-r*f*t)*g,e[2]=(a*m*s-p*h*s+p*n*l-r*m*l-a*n*t+r*h*t)*g,e[3]=(c*h*s-a*f*s-c*n*l+r*f*l+a*n*d-r*h*d)*g,e[4]=_*g,e[5]=(u*m*s-v*f*s+v*n*d-i*m*d-u*n*t+i*f*t)*g,e[6]=(v*h*s-o*m*s-v*n*l+i*m*l+o*n*t-i*h*t)*g,e[7]=(o*f*s-u*h*s+u*n*l-i*f*l-o*n*d+i*h*d)*g,e[8]=b*g,e[9]=(v*c*s-u*p*s-v*r*d+i*p*d+u*r*t-i*c*t)*g,e[10]=(o*p*s-v*a*s+v*r*l-i*p*l-o*r*t+i*a*t)*g,e[11]=(u*a*s-o*c*s-u*r*l+i*c*l+o*r*d-i*a*d)*g,e[12]=y*g,e[13]=(u*p*n-v*c*n+v*r*f-i*p*f-u*r*m+i*c*m)*g,e[14]=(v*a*n-o*p*n-v*r*h+i*p*h+o*r*m-i*a*m)*g,e[15]=(o*c*n-u*a*n+u*r*h-i*c*h-o*r*f+i*a*f)*g,this)},invert:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],f=t[11],d=t[12],v=t[13],p=t[14],m=t[15],g=u*p*h-v*c*h+v*a*f-o*p*f-u*a*m+o*c*m,_=d*c*h-l*p*h-d*a*f+s*p*f+l*a*m-s*c*m,b=l*v*h-d*u*h+d*o*f-s*v*f-l*o*m+s*u*m,y=d*u*a-l*v*a-d*o*c+s*v*c+l*o*p-s*u*p,w=e*g+i*_+r*b+n*y;return 0==w?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(t[0]=g*(g=1/w),t[1]=(v*c*n-u*p*n-v*r*f+i*p*f+u*r*m-i*c*m)*g,t[2]=(o*p*n-v*a*n+v*r*h-i*p*h-o*r*m+i*a*m)*g,t[3]=(u*a*n-o*c*n-u*r*h+i*c*h+o*r*f-i*a*f)*g,t[4]=_*g,t[5]=(l*p*n-d*c*n+d*r*f-e*p*f-l*r*m+e*c*m)*g,t[6]=(d*a*n-s*p*n-d*r*h+e*p*h+s*r*m-e*a*m)*g,t[7]=(s*c*n-l*a*n+l*r*h-e*c*h-s*r*f+e*a*f)*g,t[8]=b*g,t[9]=(d*u*n-l*v*n-d*i*f+e*v*f+l*i*m-e*u*m)*g,t[10]=(s*v*n-d*o*n+d*i*h-e*v*h-s*i*m+e*o*m)*g,t[11]=(l*o*n-s*u*n-l*i*h+e*u*h+s*i*f-e*o*f)*g,t[12]=y*g,t[13]=(l*v*r-d*u*r+d*i*c-e*v*c-l*i*p+e*u*p)*g,t[14]=(d*o*r-s*v*r-d*i*a+e*v*a+s*i*p-e*o*p)*g,t[15]=(s*u*r-l*o*r+l*i*a-e*u*a-s*i*c+e*o*c)*g,this)},scale:function(t){var e=this.elements,i=t.x,r=t.y,t=t.z;return e[0]*=i,e[4]*=r,e[8]*=t,e[1]*=i,e[5]*=r,e[9]*=t,e[2]*=i,e[6]*=r,e[10]*=t,e[3]*=i,e[7]*=r,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];return Math.sqrt(Math.max(e,t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),e=Math.sin(e),r=1-i,n=t.x,s=t.y,t=t.z,o=r*n,a=r*s;return this.set(o*n+i,o*s-e*t,o*t+e*s,0,o*s+e*t,a*s+i,a*t-e*n,0,o*t-e*s,a*t+e*n,r*t*t+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){var r=this.elements,n=e.o,s=e.u,o=e.v,e=e.p,a=n+n,h=s+s,l=o+o,u=n*a,c=n*h,n=n*l,f=s*h,s=s*l,o=o*l,a=e*a,h=e*h,e=e*l,l=i.x,d=i.y,i=i.z;return r[0]=(1-(f+o))*l,r[1]=(c+e)*l,r[2]=(n-h)*l,r[3]=0,r[4]=(c-e)*d,r[5]=(1-(u+o))*d,r[6]=(s+a)*d,r[7]=0,r[8]=(n+h)*i,r[9]=(s-a)*i,r[10]=(1-(u+f))*i,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,i){var r=this.elements,n=v.set(r[0],r[1],r[2]).length(),s=v.set(r[4],r[5],r[6]).length(),o=v.set(r[8],r[9],r[10]).length(),t=(this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],y.copy(this),1/n),r=1/s,a=1/o;return y.elements[0]*=t,y.elements[1]*=t,y.elements[2]*=t,y.elements[4]*=r,y.elements[5]*=r,y.elements[6]*=r,y.elements[8]*=a,y.elements[9]*=a,y.elements[10]*=a,e.setFromRotationMatrix(y),i.x=n,i.y=s,i.z=o,this},makePerspective:function(t,e,i,r,n,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*n/(i-r),h=(e+t)/(e-t),i=(i+r)/(i-r),r=-(s+n)/(s-n),s=-2*s*n/(s-n);return o[0]=2*n/(e-t),o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=a,o[9]=i,o[13]=0,o[2]=0,o[6]=0,o[10]=r,o[14]=s,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,i,r,n,s){var o=this.elements,a=1/(e-t),h=1/(i-r),l=1/(s-n),e=(e+t)*a,t=(i+r)*h,i=(s+n)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-e,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-t,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-i,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){var i=this.elements;return(t=void 0===t?[]:t)[e=void 0===e?0:e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),Object.assign(S.prototype,{addEventListener:function(t,e){void 0===this.M&&(this.M={});var i=this.M;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){var i;return void 0!==this.M&&void 0!==(i=this.M)[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){var i;void 0!==this.M&&void 0!==(t=this.M[t])&&-1!==(i=t.indexOf(e))&&t.splice(i,1)},dispatchEvent:function(t){if(void 0!==this.M){var e=this.M[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,t)}}}});var A=new Tt,O=new at;function C(t,e,i,r){this.o=t||0,this.u=e||0,this.v=i||0,this.L=r||C.DefaultOrder}function R(){this.mask=1}function N(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}C.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],C.DefaultOrder="XYZ",Object.defineProperties(C.prototype,{x:{get:function(){return this.o},set:function(t){this.o=t,this._()}},y:{get:function(){return this.u},set:function(t){this.u=t,this._()}},z:{get:function(){return this.v},set:function(t){this.v=t,this._()}},order:{get:function(){return this.L},set:function(t){this.L=t,this._()}}}),Object.assign(C.prototype,{isEuler:!0,set:function(t,e,i,r){return this.o=t,this.u=e,this.v=i,this.L=r||this.L,this._(),this},clone:function(){return new this.constructor(this.o,this.u,this.v,this.L)},copy:function(t){return this.o=t.o,this.u=t.u,this.v=t.v,this.L=t.L,this._(),this},setFromRotationMatrix:function(t,e,i){var r=Et.clamp,t=t.elements,n=t[0],s=t[4],o=t[8],a=t[1],h=t[5],l=t[9],u=t[2],c=t[6],t=t[10];return"XYZ"===(e=e||this.L)?(this.u=Math.asin(r(o,-1,1)),Math.abs(o)<.9999999?(this.o=Math.atan2(-l,t),this.v=Math.atan2(-s,n)):(this.o=Math.atan2(c,h),this.v=0)):"YXZ"===e?(this.o=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this.u=Math.atan2(o,t),this.v=Math.atan2(a,h)):(this.u=Math.atan2(-u,n),this.v=0)):"ZXY"===e?(this.o=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this.u=Math.atan2(-u,t),this.v=Math.atan2(-s,h)):(this.u=0,this.v=Math.atan2(a,n))):"ZYX"===e?(this.u=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this.o=Math.atan2(c,t),this.v=Math.atan2(a,n)):(this.o=0,this.v=Math.atan2(-s,h))):"YZX"===e?(this.v=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this.o=Math.atan2(-l,h),this.u=Math.atan2(-u,n)):(this.o=0,this.u=Math.atan2(o,t))):"XZY"===e?(this.v=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this.o=Math.atan2(c,h),this.u=Math.atan2(o,n)):(this.o=Math.atan2(-l,t),this.u=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this.L=e,!1!==i&&this._(),this},setFromQuaternion:function(t,e,i){return A.makeRotationFromQuaternion(t),this.setFromRotationMatrix(A,e,i)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this.L)},reorder:function(t){return O.setFromEuler(this),this.setFromQuaternion(O,t)},equals:function(t){return t.o===this.o&&t.u===this.u&&t.v===this.v&&t.L===this.L},fromArray:function(t){return this.o=t[0],this.u=t[1],this.v=t[2],void 0!==t[3]&&(this.L=t[3]),this._(),this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.o,t[e+1]=this.u,t[e+2]=this.v,t[e+3]=this.L,t},toVector3:function(t){return t?t.set(this.o,this.u,this.v):new Lt(this.o,this.u,this.v)},onChange:function(t){return this._=t,this},_:function(){}}),Object.assign(R.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(N.prototype,{isMatrix3:!0,set:function(t,e,i,r,n,s,o,a,h){var l=this.elements;return l[0]=t,l[1]=r,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=i,l[7]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},extractBasis:function(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var t=t.elements,e=e.elements,i=this.elements,r=t[0],n=t[3],s=t[6],o=t[1],a=t[4],h=t[7],l=t[2],u=t[5],t=t[8],c=e[0],f=e[3],d=e[6],v=e[1],p=e[4],m=e[7],g=e[2],_=e[5],e=e[8];return i[0]=r*c+n*v+s*g,i[3]=r*f+n*p+s*_,i[6]=r*d+n*m+s*e,i[1]=o*c+a*v+h*g,i[4]=o*f+a*p+h*_,i[7]=o*d+a*m+h*e,i[2]=l*c+u*v+t*g,i[5]=l*f+u*p+t*_,i[8]=l*d+u*m+t*e,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],t=t[8];return e*s*t-e*o*h-i*n*t+i*o*a+r*n*h-r*s*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var e=t.elements,t=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],e=e[8],u=e*o-a*l,c=a*h-e*s,f=l*s-o*h,d=i*u+r*c+n*f;return 0==d?this.set(0,0,0,0,0,0,0,0,0):(t[0]=u*(u=1/d),t[1]=(n*l-e*r)*u,t[2]=(a*r-n*o)*u,t[3]=c*u,t[4]=(e*i-n*h)*u,t[5]=(n*s-a*i)*u,t[6]=f*u,t[7]=(r*h-l*i)*u,t[8]=(o*i-r*s)*u,this)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,r,n,s,o){var a=Math.cos(n),n=Math.sin(n);this.set(i*a,i*n,-i*(a*s+n*o)+s+t,-r*n,r*a,-r*(-n*s+a*o)+o+e,0,0,1)},scale:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t),t=Math.sin(t),i=this.elements,r=i[0],n=i[3],s=i[6],o=i[1],a=i[4],h=i[7];return i[0]=e*r+t*o,i[3]=e*n+t*a,i[6]=e*s+t*h,i[1]=-t*r+e*o,i[4]=-t*n+e*a,i[7]=-t*s+e*h,this},translate:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){var i=this.elements;return(t=void 0===t?[]:t)[e=void 0===e?0:e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}});var D=0,k=new Lt,H=new at,B=new Tt,z=new Lt,V=new Lt,W=new Lt,Y=new at,X=new Lt(1,0,0),$=new Lt(0,1,0),tt=new Lt(0,0,1),it={type:"added"},rt={type:"removed"};function Z(){Object.defineProperty(this,"id",{value:D++}),this.uuid=Et.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Z.DefaultUp.clone();var t=new Lt,e=new C,i=new at,r=new Lt(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Tt},normalMatrix:{value:new N}}),this.matrix=new Tt,this.matrixWorld=new Tt,this.matrixAutoUpdate=Z.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new R,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function nt(){Z.call(this),this.type="Camera",this.matrixWorldInverse=new Tt,this.projectionMatrix=new Tt,this.projectionMatrixInverse=new Tt}function ht(t,e,i,r){nt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function lt(t,e,i,r,n,s){nt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()}Z.DefaultUp=new Lt(0,1,0),Z.DefaultMatrixAutoUpdate=!0,Z.prototype=Object.assign(Object.create(S.prototype),{constructor:Z,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return H.setFromAxisAngle(t,e),this.quaternion.multiply(H),this},rotateOnWorldAxis:function(t,e){return H.setFromAxisAngle(t,e),this.quaternion.premultiply(H),this},rotateX:function(t){return this.rotateOnAxis(X,t)},rotateY:function(t){return this.rotateOnAxis($,t)},rotateZ:function(t){return this.rotateOnAxis(tt,t)},translateOnAxis:function(t,e){return k.copy(t).applyQuaternion(this.quaternion),this.position.add(k.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(X,t)},translateY:function(t){return this.translateOnAxis($,t)},translateZ:function(t){return this.translateOnAxis(tt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(B.getInverse(this.matrixWorld))},lookAt:function(t,e,i){t.isVector3?z.copy(t):z.set(t,e,i);t=this.parent;this.updateWorldMatrix(!0,!1),V.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?B.lookAt(V,z,this.up):B.lookAt(z,V,this.up),this.quaternion.setFromRotationMatrix(B),t&&(B.extractRotation(t.matrixWorld),H.setFromRotationMatrix(B),this.quaternion.premultiply(H.inverse()))},add:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.add(arguments[e]);else t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(it)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);else{var i=this.children.indexOf(t);-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(rt))}return this},attach:function(t){return this.updateWorldMatrix(!0,!1),B.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),B.multiply(t.parent.matrixWorld)),t.applyMatrix4(B),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Lt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new at),this.updateMatrixWorld(!0),this.matrixWorld.decompose(V,t,W),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Lt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(V,Y,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Lt),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var r=this.children,n=0,s=r.length;n<s;n++)r[n].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var r=t.children[i];this.add(r.clone())}return this}}),nt.prototype=Object.assign(Object.create(Z.prototype),{constructor:nt,isCamera:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Lt),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Z.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){Z.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ht.prototype=Object.assign(Object.create(nt.prototype),{constructor:ht,isPerspectiveCamera:!0,copy:function(t,e){return nt.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t;this.fov=2*Et.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Et.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Et.RAD2DEG*Math.atan(Math.tan(.5*Et.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,r,n,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t,e=this.near,i=e*Math.tan(.5*Et.DEG2RAD*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n,o=this.view,a=(null!==this.view&&this.view.enabled&&(a=o.fullWidth,t=o.fullHeight,s+=o.offsetX*n/a,i-=o.offsetY*r/t,n*=o.width/a,r*=o.height/t),this.filmOffset);0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),lt.prototype=Object.assign(Object.create(nt.prototype),{constructor:lt,isOrthographicCamera:!0,copy:function(t,e){return nt.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,r,n,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t,e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,s=r-e,r=r+e,e=n+i,n=n-i;null!==this.view&&this.view.enabled&&(i=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,r=(s+=i*this.view.offsetX)+i*this.view.width,n=(e-=t*this.view.offsetY)-t*this.view.height),this.projectionMatrix.makeOrthographic(s,r,e,n,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}});var ut=[new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt],ct=new Lt,dt=new Ct,vt=new Lt,pt=new Lt,mt=new Lt,gt=new Lt,_t=new Lt,bt=new Lt,yt=new Lt,wt=new Lt,xt=new Lt,Mt=new Lt;function Ct(t,e){this.min=void 0!==t?t:new Lt(1/0,1/0,1/0),this.max=void 0!==e?e:new Lt(-1/0,-1/0,-1/0)}function Rt(t,e,i,r,n){for(var s=0,o=t.length-3;s<=o;s+=3){Mt.fromArray(t,s);var a=n.x*Math.abs(Mt.x)+n.y*Math.abs(Mt.y)+n.z*Math.abs(Mt.z),h=e.dot(Mt),l=i.dot(Mt),u=r.dot(Mt);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>a)return!1}return!0}Object.assign(Ct.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0,a=0,h=t.length;a<h;a+=3){var l=t[a],u=t[a+1],c=t[a+2];l<e&&(e=l),u<i&&(i=u),c<r&&(r=c),n<l&&(n=l),s<u&&(s=u),o<c&&(o=c)}return this.min.set(e,i,r),this.max.set(n,s,o),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0,a=0,h=t.count;a<h;a++){var l=t.getX(a),u=t.getY(a),c=t.getZ(a);l<e&&(e=l),u<i&&(i=u),c<r&&(r=c),n<l&&(n=l),s<u&&(s=u),o<c&&(o=c)}return this.min.set(e,i,r),this.max.set(n,s,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){e=ct.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Lt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Lt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);for(var e=t.geometry,i=(void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),dt.copy(e.boundingBox),dt.applyMatrix4(t.matrixWorld),this.union(dt)),t.children),r=0,n=i.length;r<n;r++)this.expandByObject(i[r]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Lt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,ct),ct.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,i=0<t.normal.x?(e=t.normal.x*this.min.x,t.normal.x*this.max.x):(e=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(yt),wt.subVectors(this.max,yt),vt.subVectors(t.a,yt),pt.subVectors(t.b,yt),mt.subVectors(t.c,yt),gt.subVectors(pt,vt),_t.subVectors(mt,pt),bt.subVectors(vt,mt),!!Rt([0,-gt.z,gt.y,0,-_t.z,_t.y,0,-bt.z,bt.y,gt.z,0,-gt.x,_t.z,0,-_t.x,bt.z,0,-bt.x,-gt.y,gt.x,0,-_t.y,_t.x,0,-bt.y,bt.x,0],vt,pt,mt,wt))&&!!Rt([1,0,0,0,1,0,0,0,1],vt,pt,mt,wt)&&(xt.crossVectors(gt,_t),Rt([xt.x,xt.y,xt.z],vt,pt,mt,wt))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Lt),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return ct.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(ct).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(ut[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ut[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ut[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ut[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ut[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ut[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ut[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ut[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ut)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Nt=new Ct;function Dt(t,e){this.center=void 0!==t?t:new Lt,this.radius=void 0!==e?e:0}Object.assign(Dt.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){for(var i=this.center,r=(void 0!==e?i.copy(e):Nt.setFromPoints(t).getCenter(i),0),n=0,s=t.length;n<s;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Lt),e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ct),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var kt=new Lt,Pt=new Lt,It=new N;function Ft(t,e){this.normal=void 0!==t?t:new Lt(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Ft.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,i){i=kt.subVectors(i,e).cross(Pt.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Lt),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Lt);var i=t.delta(kt),r=this.normal.dot(i);return 0===r?0===this.distanceToPoint(t.start)?e.copy(t.start):void 0:(r=-(t.start.dot(this.normal)+this.constant)/r)<0||1<r?void 0:e.copy(i).multiplyScalar(r).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return e<0&&0<t||t<0&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Lt),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){e=e||It.getNormalMatrix(t),t=this.coplanarPoint(kt).applyMatrix4(t),e=this.normal.applyMatrix3(e).normalize();return this.constant=-t.dot(e),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var jt=new Dt,Gt=new Lt;function Ut(t,e,i,r,n,s){this.planes=[void 0!==t?t:new Ft,void 0!==e?e:new Ft,void 0!==i?i:new Ft,void 0!==r?r:new Ft,void 0!==n?n:new Ft,void 0!==s?s:new Ft]}Object.assign(Ut.prototype,{set:function(t,e,i,r,n,s){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromProjectionMatrix:function(t){var e=this.planes,t=t.elements,i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],h=t[6],l=t[7],u=t[8],c=t[9],f=t[10],d=t[11],v=t[12],p=t[13],m=t[14],t=t[15];return e[0].setComponents(s-i,l-o,d-u,t-v).normalize(),e[1].setComponents(s+i,l+o,d+u,t+v).normalize(),e[2].setComponents(s+r,l+a,d+c,t+p).normalize(),e[3].setComponents(s-r,l-a,d-c,t-p).normalize(),e[4].setComponents(s-n,l-h,d-f,t-m).normalize(),e[5].setComponents(s+n,l+h,d+f,t+m).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),jt.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(jt)},intersectsSprite:function(t){return jt.center.set(0,0,0),jt.radius=.7071067811865476,jt.applyMatrix4(t.matrixWorld),this.intersectsSphere(jt)},intersectsSphere:function(t){for(var e=this.planes,i=t.center,r=-t.radius,n=0;n<6;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,i=0;i<6;i++){var r=e[i];if(Gt.x=(0<r.normal.x?t.max:t.min).x,Gt.y=(0<r.normal.y?t.max:t.min).y,Gt.z=(0<r.normal.z?t.max:t.min).z,r.distanceToPoint(Gt)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}});var Ht={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2,NONE:3},Bt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},zt=0,Vt=1,Wt=2,Yt=1,Xt=2,Zt=3,qt=0,Jt=1,Kt=2,Qt=1,$t=0,te=1,ee=2,ie=3,re=4,ne=5,se=100,oe=101,ae=102,he=103,le=104,ue=200,ce=201,fe=202,de=203,ve=204,pe=205,me=206,ge=207,_e=208,be=209,ye=210,we=0,xe=1,Me=2,Ee=3,Le=4,Te=5,Se=6,Ae=7,Oe=0,Ce=1,Re=2,Ne=0,De=1,ke=2,Pe=3,Ie=4,Fe=5,je=300,Ge=301,Ue=302,He=303,Be=304,ze=305,Ve=306,We=307,Ye=1e3,Xe=1001,Ze=1002,qe=1003,Je=1004,Ke=1005,Qe=1006,$e=1007,ti=1008,ei=1008,ii=1009,ri=1010,ni=1011,si=1012,oi=1013,ai=1014,hi=1015,li=1016,ui=1017,ci=1018,fi=1019,di=1020,vi=1021,pi=1022,mi=1023,gi=1024,_i=1025,bi=1026,yi=1027,wi=1028,xi=1029,Mi=1030,Ei=1031,Li=1032,Ti=1033,Si=33776,Ai=33777,Oi=33778,Ci=33779,Ri=35840,Ni=35841,Di=35842,ki=35843,Pi=36196,Ii=37492,Fi=37496,ji=37808,Gi=37809,Ui=37810,Hi=37811,Bi=37812,zi=37813,Vi=37814,Wi=37815,Yi=37816,Xi=37817,Zi=37818,qi=37819,Ji=37820,Ki=37821,Qi=36492,$i=37840,tr=37841,er=37842,ir=37843,rr=37844,nr=37845,sr=37846,or=37847,ar=37848,hr=37849,lr=37850,ur=37851,cr=37852,fr=37853,dr=2200,vr=2201,pr=2202,mr=2300,gr=2301,_r=2302,br=2400,yr=2401,wr=2402,xr=1,Mr=2,Er=3e3,Lr=3001,Tr=3007,Sr=3002,Ar=3003,Or=3004,Cr=3005,Rr=3006,Nr=3200,Dr=3201,kr=0,Pr=1,Ir=7680,Fr=7681,jr=516,Gr=519,Ur=35044;function Hr(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function St(t,e){this.x=t||0,this.y=e||0}Object.assign(Hr.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Et.clamp(e/this.radius,-1,1))),this}}),Object.defineProperties(St.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(St.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,i=this.y,t=t.elements;return this.x=t[0]*e+t[3]*i+t[6],this.y=t[1]*e+t[4]*i+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),e=Math.sin(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*i-n*e+t.x,this.y=r*e+n*i+t.y,this}});class st{constructor(){}static coordsMapToScreen(t,e){var i=void 0!==e.height?e.height:0;let r=t.getMapOptions().buildingID;e.buildingID&&(r=e.buildingID);var n=t.getBuilding(r),s=(void 0!==e.level?e:n).level,n=void 0!==e.z?e.z:n.getFloor(s).T;return this.coordsMapToScreen_(t,{x:e.x,y:e.y,z:n+i})}static coordsScreenToMap(t,e,i){var r=(void 0!==e.buildingID?e:t.getMapOptions()).buildingID,r=t.getBuilding(r),n=t.S,s=(void 0!==e.level?e:r).level,r=void 0!==e.z?e.z:r.getFloor(s).T;let o=null,a=t.A.renderer.domElement.clientWidth,h=t.A.renderer.domElement.clientHeight,l=new Lt,u=new Lt;s=((o=i||t.C.O.object).userData?.near?o.userData:o).near,i=(o.userData?.far?o.userData:o).far;o.isPerspectiveCamera?(o.updateMatrixWorld(),l.setFromMatrixPosition(o.matrixWorld),t=e.x/a*2-1,u.set(t,-e.y/h*2+1,s).unproject(o).sub(l).normalize()):(t=e.x/a*2-1,l.set(t,-e.y/h*2+1,(s+i)/(s-i)).unproject(o),u.set(0,0,-1).transformDirection(o.matrixWorld));let c=(-l.y+r)/u.y;c<0&&(c=i);t=(new Lt).copy(l).add((new Lt).copy(u).multiplyScalar(c));return{x:t.x+n.x,y:n.y-t.z,z:r}}static coordsMapToScreen_(t,e){var i=t.C.O.object,r=(i.userData?.near?i.userData:i).near,n=(i.userData?.far?i.userData:i).far,s=i.near,o=i.far,r=(i.near=r,i.far=n,i.updateProjectionMatrix(),t.S),n=new Lt(e.x-r.x,e.z,-e.y+r.y).project(i),e=t.A.renderer.domElement.clientWidth,r=t.A.renderer.domElement.clientHeight;return i.near=s,i.far=o,i.updateProjectionMatrix(),n.z<-1||1<n.z?null:{x:Math.round(e/2*n.x+e/2),y:Math.round(-r/2*n.y+r/2)}}static exportToImage(t,e,i,r,n){}static screenshot(t,e,i,r,n,s,o,a){}}let q={BROWSER:0,WX:1},ot=(Object.freeze(q),{document:"undefined"!=typeof document?document:{},window:"undefined"!=typeof window?window:{},environment:q.BROWSER,XMLHttpRequest:"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:{}});var Br=function(I,t,F){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=I,this.isScreenLock=!1,this.domElement=t,this.R=F,this.enabled=!0,this.useRange=!1,this.target=new Lt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.isDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.zoomSpeedParam=1,this.enableRotate=!0,this.enableRotateLeft=!0,this.enableRotateUp=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Ht.ROTATE,MIDDLE:Ht.DOLLY,RIGHT:Ht.PAN},this.touches={ONE:Bt.ROTATE,TWO:Bt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.rotateLeftStart=new St,this.rotateLeftEnd=new St,this.mapStateArray=[],this.timelone=null,this.N=()=>{this.isDamping&&(v.theta>f||v.phi>f||m.length()>f?(this.update(),this.R.enableUpdateRender()):(this.isDamping=!1,this.update()))},this.N=this.N.bind(this),this.R.on("beforeRender",this.N),this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.panAdd=function(t){m.add(t)},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.resetState=function(){c=u.NONE},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(G),h.update(),c=u.NONE},this.updateCheck=function(){if(this.R.C&&this.R.C.enableDragRange)if(this.R.C.D())this.saveMapState();else{let t=this.mapStateArray.length-1;for(;0<=t;){var e=this.mapStateArray[t];if(e.viewMode=this.R.getViewMode(),this.updateState(e),this.R.C.D())break;t--}var i;t<0&&(i=(i=this.R.getBuilding(this.R.C.P.k)).getFloor(i.level),this.R.setCenter({x:i.x,y:i.y}))}},this.updateState=function(t){this.R.C.pauseDamping(),this.R.setCenter({animate:!1,x:t.center.x,y:t.center.y,finish:()=>{this.R.setRotation({animate:!1,rotation:t.rotation,finish:()=>{this.R.setTilt({animate:!1,tilt:t.tiltAngle,finish:()=>{this.R.setZoom({animate:!1,zoom:t.zoom})}})}})}})},this.saveMapState=function(){var t=this.R.getState();(t=>{let e=!0;for(var i in t)if(""+i=="center"){var r=t[i];if(isNaN(parseFloat(""+r.x))||isNaN(parseFloat(""+r.y))){e=!1;break}}else if(("rotation"===i||"tiltAngle"===i)&&isNaN(parseFloat(""+t[i]))){e=!1;break}return e})(t)&&(200<=this.mapStateArray.length&&this.mapStateArray.splice(0,1),this.mapStateArray.push(t))},this.getTarget=function(t,e){var i,r;return 0===this.R.I.length?t:(i=this.R.getMapOptions().screenLockCoords,r={x:this.R.getContainer().clientWidth/2,y:this.R.getContainer().clientHeight/2},i={x:this.R.getContainer().clientWidth*i.x,y:this.R.getContainer().clientHeight*i.y},(r=st.coordsScreenToMap(this.R,r,e)).x=r.x-this.R.x,r.y=-r.y+this.R.y,(i=st.coordsScreenToMap(this.R,i,e)).x=i.x-this.R.x,i.y=-i.y+this.R.y,e=i.x-r.x,i=i.y-r.y,r=t.clone(),isNaN(e)||isNaN(i)||1e3<Math.abs(i)||1e3<Math.abs(e)||(r.x=r.x-e,r.z=r.z-i),r)},this.update=(r=new Lt,n=(new at).setFromUnitVectors(I.up,new Lt(0,1,0)),j=n.clone().inverse(),s=new Lt,o=new at,a=0,function(t){t=t||{};var e,i=h.object.position;return r.copy(i).sub(h.target),r.applyQuaternion(n),d.setFromVector3(r),h.autoRotate&&c===u.NONE&&S(2*Math.PI/60/60*h.autoRotateSpeed),h.enableDamping&&h.isDamping?(d.theta+=v.theta*h.dampingFactor,d.phi+=v.phi*h.dampingFactor):(d.theta+=v.theta,d.phi+=v.phi),d.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,d.theta)),t&&void 0!==t.theta&&(d.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,t.theta))),d.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,d.phi)),t&&void 0!==t.phi&&(d.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,t.phi))),d.makeSafe(),d.radius*=p,d.radius=Math.max(h.minDistance,Math.min(h.maxDistance,d.radius)),this.useRange?((e=(new Lt).setFromMatrixPosition(h.object.matrixWorld)).add(m),e=(new Tt).copy(h.object.matrixWorld).setPosition(e),e=(new Tt).getInverse(e),(new Ut).setFromProjectionMatrix((new Tt).multiplyMatrices(h.object.projectionMatrix,e)).intersectsSphere(h.viewSphere)&&h.target.add(m)):h.enableDamping&&h.isDamping?h.target.addScaledVector(m,h.dampingFactor):h.target.add(m),r.setFromSpherical(d),r.applyQuaternion(j),t&&t.offset&&r.add(t.offset),this.useRange&&((e=(new Lt).setFromMatrixPosition(h.object.matrixWorld)).add(r),t=(new Tt).copy(h.object.matrixWorld).setPosition(e),e=(new Tt).getInverse(t),!(new Ut).setFromProjectionMatrix((new Tt).multiplyMatrices(h.object.projectionMatrix,e)).intersectsSphere(h.viewSphere))||i.copy(h.target).add(r),h.isScreenLock&&void 0!==this.R.getMapOptions().screenLockCoords?((t=h.object.clone()).lookAt(h.target),h.object.lookAt(this.getTarget(h.target,t)),h.object.rotation.z=t.rotation.z):h.object.lookAt(h.target),h.enableDamping&&h.isDamping?(v.theta*=1-h.dampingFactor,v.phi*=1-h.dampingFactor,m.multiplyScalar(1-h.dampingFactor)):(v.set(0,0,0),m.set(0,0,0)),p=1,!(!(g||s.distanceToSquared(h.object.position)>f||8*(1-o.dot(h.object.quaternion))>f||a!==h.object.zoom)||(h.dispatchEvent(G),s.copy(h.object.position),o.copy(h.object.quaternion),a=h.object.zoom,g=!1))}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",nt,!1),h.domElement.removeEventListener("mousedown",Q,!1),h.domElement.removeEventListener("wheel",$,!1),h.domElement.removeEventListener("touchstart",et,!1),h.domElement.removeEventListener("touchend",rt,!1),h.domElement.removeEventListener("touchmove",it,!1),ot.document.removeEventListener("mousemove",k,!1),ot.document.removeEventListener("mouseup",P,!1),h.domElement.removeEventListener("keydown",tt,!1)};var r,n,j,s,o,a,h=this,G={type:"change"},i={type:"start"},l={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=u.NONE,f=1e-6,d=new Hr,v=new Hr,p=1,m=new Lt,g=!1,_=new St,b=new St,y=new St,w=new St,x=new St,M=new St,E=new St,L=new St,T=new St,U=null;function H(){return Math.pow(.95,h.zoomSpeed)}function S(t){h.enableRotateLeft&&(v.theta-=t)}function B(t){h.enableRotateUp&&(v.phi-=t)}A=new Lt;var A,O,C,z=function(t,e){A.setFromMatrixColumn(e,0),A.multiplyScalar(-t),m.add(A)},V=(O=new Lt,function(t,e){!0===h.screenSpacePanning?O.setFromMatrixColumn(e,1):(O.setFromMatrixColumn(e,0),O.crossVectors(h.object.up,O)),O.multiplyScalar(t),m.add(O)}),R=(this.panUp=t=>{var e=new Lt(0,1,0);e.multiplyScalar(t),m.add(e)},C=new Lt,function(t,e){var i,r=h.domElement;h.object.isPerspectiveCamera?(i=h.object.position,C.copy(i).sub(h.target),i=C.length(),i*=Math.tan(h.object.fov/2*Math.PI/180),z(2*t*i/r.clientHeight,h.object.matrix),V(2*e*i/r.clientHeight,h.object.matrix)):h.object.isOrthographicCamera?(z(t*(h.object.right-h.object.left)/h.object.zoom/r.clientWidth,h.object.matrix),V(e*(h.object.top-h.object.bottom)/h.object.zoom/r.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)});function N(t){h.object.isPerspectiveCamera?p/=t:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*t)),h.object.updateProjectionMatrix(),p/=t,g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function D(t){h.object.isPerspectiveCamera?p*=t:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/t)),h.object.updateProjectionMatrix(),p*=t,g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function e(t){_.set(t.clientX,t.clientY)}function W(t){w.set(t.clientX,t.clientY)}function Y(t){var e,i;1==t.touches.length?_.set(t.touches[0].pageX,t.touches[0].pageY):(e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY),_.set(e,i),e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,h.rotateLeftStart.set(e,i))}function X(t){var e;1==t.touches.length?w.set(t.touches[0].pageX,t.touches[0].pageY):(e=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),w.set(e,t))}function Z(t){var e=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,e=Math.sqrt(e*e+t*t);E.set(0,e)}function q(t){1==t.touches.length?b.set(t.touches[0].pageX,t.touches[0].pageY):(i=.5*(t.touches[0].pageX+t.touches[1].pageX),e=.5*(t.touches[0].pageY+t.touches[1].pageY),b.set(i,e),i=t.touches[0].pageX-t.touches[1].pageX,e=t.touches[0].pageY-t.touches[1].pageY,h.rotateLeftEnd.set(i,e),t=h.rotateLeftStart.angle(),S((-h.rotateLeftEnd.angle()+t)*h.rotateSpeed),h.rotateLeftStart.copy(h.rotateLeftEnd)),y.subVectors(b,_).multiplyScalar(h.rotateSpeed);var e,i=h.domElement;B(2*Math.PI*y.y/i.clientHeight),_.copy(b)}function J(t){var e;1==t.touches.length?(x.set(t.touches[0].pageX,t.touches[0].pageY),x.x<0&&x.copy(w)):(e=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),x.set(e,t)),M.subVectors(x,w).multiplyScalar(h.panSpeed),R(M.x,M.y),w.copy(x)}function K(t){var e;t.touches[0]&&t.touches[1]&&(e=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,e=Math.sqrt(e*e+t*t),L.set(0,e),T.set(0,Math.pow(L.y/E.y,h.zoomSpeed)),N(T.y),E.copy(L))}function Q(t){if(!1!==h.enabled){switch(h.activeing=!0,t.preventDefault(),(h.domElement.focus?h.domElement:window).focus(),t.button){case 0:switch(h.mouseButtons.LEFT){case Ht.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===h.enablePan)return;W(t),c=u.PAN}else{if(!1===h.enableRotate)return;e(t),c=u.ROTATE}break;case Ht.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===h.enableRotate)return;e(t),c=u.ROTATE}else{if(!1===h.enablePan)return;W(t),c=u.PAN}break;default:c=u.NONE}break;case 1:switch(h.mouseButtons.MIDDLE){case Ht.DOLLY:if(!1===h.enableZoom)return;E.set(t.clientX,t.clientY),c=u.DOLLY;break;case Ht.ROTATE:if(!1===h.enableRotate)return;e(t),c=u.ROTATE;break;default:c=u.NONE}break;case 2:switch(h.mouseButtons.RIGHT){case Ht.ROTATE:if(!1===h.enableRotate)return;e(t),c=u.ROTATE;break;case Ht.PAN:if(!1===h.enablePan)return;W(t),c=u.PAN;break;default:c=u.NONE}}c!==u.NONE&&(ot.document.addEventListener("mousemove",k,!1),ot.document.addEventListener("mouseup",P,!1),h.dispatchEvent(i))}}function k(t){var e;if(!1!==h.enabled)switch(t.preventDefault(),c){case u.ROTATE:!1!==h.enableRotate&&(e=t,b.set(e.clientX,e.clientY),y.subVectors(b,_).multiplyScalar(h.rotateSpeed),e=h.domElement,S(2*Math.PI*y.x/e.clientHeight),B(2*Math.PI*y.y/e.clientHeight),_.copy(b),h.isDamping=!0,h.update(),h.updateCheck());break;case u.DOLLY:!1!==h.enableZoom&&(L.set(t.clientX,t.clientY),T.subVectors(L,E),0<T.y?N(H()):T.y<0&&D(H()),E.copy(L),h.isDamping=!0,h.update(),h.updateCheck());break;case u.PAN:!1!==h.enablePan&&(x.set(t.clientX,t.clientY),M.subVectors(x,w).multiplyScalar(h.panSpeed),R(M.x,M.y),w.copy(x),h.isDamping=!0,h.update(),h.updateCheck())}}function P(t){!1!==h.enabled&&(h.activeing=!1,ot.document.removeEventListener("mousemove",k,!1),ot.document.removeEventListener("mouseup",P,!1),h.dispatchEvent(l),c=u.NONE)}function $(t){var e;!1===h.enabled||!1===h.enableZoom||c!==u.NONE&&c!==u.ROTATE||(h.activeing=!0,void 0!==h.wheelTimer&&clearTimeout(h.wheelTimer),h.wheelTimer=setTimeout(()=>{h.activeing=!1},100),t.preventDefault(),t.stopPropagation(),h.dispatchEvent(i),t=t,e=Math.pow(.95,h.zoomSpeed*h.zoomSpeedParam),t.deltaY<0?D(e):0<t.deltaY&&N(e),h.isDamping=!0,h.update(),h.updateCheck(),h.dispatchEvent(l))}function tt(t){if(!1!==h.enabled&&!1!==h.enableKeys&&!1!==h.enablePan){var e=!1;switch(t.keyCode){case h.keys.UP:R(0,h.keyPanSpeed),e=!0;break;case h.keys.BOTTOM:R(0,-h.keyPanSpeed),e=!0;break;case h.keys.LEFT:R(h.keyPanSpeed,0),e=!0;break;case h.keys.RIGHT:R(-h.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),h.isDamping=!0,h.update(),h.updateCheck())}}function et(t){if(!1!==h.enabled){switch(h.activeing=!0,t.preventDefault(),t.touches.length){case 1:switch(h.touches.ONE){case Bt.ROTATE:if(!1===h.enableRotate)return;Y(t),c=u.TOUCH_ROTATE;break;case Bt.PAN:if(!1===h.enablePan)return;X(t),c=u.TOUCH_PAN;break;default:c=u.NONE}break;case 2:switch(U=t.touches[0].identifier,h.touches.TWO){case Bt.DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;e=t,h.enableZoom&&Z(e),h.enablePan&&X(e),c=u.TOUCH_DOLLY_PAN;break;case Bt.DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;e=t,h.enableZoom&&Z(e),h.enableRotate&&Y(e),c=u.TOUCH_DOLLY_ROTATE;break;default:c=u.NONE}break;default:c=u.NONE}var e;c!==u.NONE&&h.dispatchEvent(i)}}function it(t){var e,i;if(!1!==h.enabled)switch(h.activeing=!0,2===t.touches.length&&t.touches[1].identifier===U&&(e=t.touches[0],t.touches[0]=t.touches[1],t.touches[1]=e),t.preventDefault(),t.stopPropagation(),c){case u.TOUCH_ROTATE:!1!==h.enableRotate&&(q(t),h.isDamping=!0,h.update(),h.updateCheck());break;case u.TOUCH_PAN:!1!==h.enablePan&&(J(t),h.isDamping=!0,h.update(),h.updateCheck());break;case u.TOUCH_DOLLY_PAN:!1===h.enableZoom&&!1===h.enablePan||(i=t,h.enableZoom&&K(i),h.enablePan&&J(i),h.isDamping=!0,h.update(),h.updateCheck());break;case u.TOUCH_DOLLY_ROTATE:!1===h.enableZoom&&!1===h.enableRotate||(i=t,h.enableZoom&&K(i),h.enableRotate&&q(i),h.isDamping=!0,h.update(),h.updateCheck());break;default:c=u.NONE}}function rt(t){!1!==h.enabled&&(h.activeing=!1,h.dispatchEvent(l),c=u.NONE)}function nt(t){!1!==h.enabled&&t.preventDefault()}this.dollyIn=t=>N(t),this.dollyOut=t=>D(t),h.domElement.addEventListener("contextmenu",nt,!1),h.domElement.addEventListener("mousedown",Q,!1),h.domElement.addEventListener("wheel",$,!1),h.domElement.addEventListener("touchstart",et,!1),h.domElement.addEventListener("touchend",rt,!1),h.domElement.addEventListener("touchmove",it,!1),h.domElement.addEventListener("keydown",tt,!1),-1===h.domElement.tabIndex&&(h.domElement.tabIndex=0),h.isDamping=!0,this.update(),this.updateCheck(),this.removeEvent=function(){h.domElement.removeEventListener("contextmenu",nt,!1),h.domElement.removeEventListener("mousedown",Q,!1),h.domElement.removeEventListener("wheel",$,!1),h.domElement.removeEventListener("touchstart",et,!1),h.domElement.removeEventListener("touchend",rt,!1),h.domElement.removeEventListener("touchmove",it,!1),h.domElement.removeEventListener("keydown",tt,!1),ot.document.removeEventListener("mousemove",k,!1),ot.document.removeEventListener("mouseup",P,!1)}},zr=(Br.prototype=Object.create(S.prototype),Br.prototype.constructor=Br,function(t,e,i){Br.call(this,t,e,i),this.mouseButtons.LEFT=Ht.PAN,this.mouseButtons.RIGHT=Ht.ROTATE,this.touches.ONE=Bt.PAN,this.touches.TWO=Bt.DOLLY_ROTATE,this.F=null});zr.prototype=Object.create(S.prototype),zr.prototype.constructor=zr,Object.assign(zr.prototype,{setMouseMiddleButtonRotation(){this.mouseButtons.RIGHT=Ht.NONE,this.mouseButtons.MIDDLE=Ht.ROTATE},dispose(){this.removeEvent(),this.object=null,this.domElement=null,this.R.off("beforeRender",this.R.N),this.R=null},pauseDamping(){this.F={dampingFactor:this.dampingFactor,enableDamping:this.enableDamping},this.enableDamping=!1,this.dampingFactor=1},resumeDamping(){this.F&&(this.enableDamping=this.F.enableDamping,this.dampingFactor=this.F.dampingFactor)}});let l={FOV:35,CAMERA_NEAR:1,CAMERA_FAR:1e5,ZOOM_UPPER_BOUND:30,TILT_UPPER_BOUND:90,THOUSAND:1e3,DEG2RAD:.0174532,RAD2DEG:57.2957795,DRAW_TIME:500,EPS:.001},Vr=(Object.freeze(l),{MODE_3D:2,MODE_2D:4}),p=(Object.freeze(Vr),{NONE:0,EXTRUDE_MARKER:2,FM3DTILE_LAYER:4,IMAGE_MARKER:8,LOCATION_MARKER:16,POLYGON_MARKER:32,TEXT_MARKER:64,LINE_MARKER:128,LINE3D_MARKER:256,HEAT_MAP_MARKER:512,EXTENT:1024,EXTERNAL_MODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,DYNAMIC_MODEL_MARKER:32768,DOM_MARKER:65536,SPHERE_MARKER:1<<17,CAD_LAYER:1<<18,EXTENT_LAYER:1<<20,EXTERNAL_MODEL_LAYER:1<<21,MODEL_LAYER:1<<22,FACILITY_LAYER:1<<23,LABEL_LAYER:1<<24,MARKER_GROUP:1<<25,FLOW_LINE_LAYER:1<<27,FLOW_LINE_MARKER:1<<27,FIRE_MARKER:1<<28,WALL_MARKER:1<<29,TUBE_MARKER:1<<30}),Wr=(p.LAYER_NODE_TYPE=new Map,p.LAYER_NODE_TYPE.set(p.EXTENT_LAYER,p.EXTENT),p.LAYER_NODE_TYPE.set(p.EXTERNAL_MODEL_LAYER,p.EXTERNAL_MODEL),p.LAYER_NODE_TYPE.set(p.MODEL_LAYER,p.MODEL),p.LAYER_NODE_TYPE.set(p.FACILITY_LAYER,p.FACILITY),p.LAYER_NODE_TYPE.set(p.LABEL_LAYER,p.LABEL),p.LAYER_NODE_TYPE.set(p.DOM_MARKER,p.DOM_MARKER),p.LAYER_NODE_TYPE.set(p.DYNAMIC_MODEL_MARKER,p.DYNAMIC_MODEL_MARKER),p.LAYER_NODE_TYPE.set(p.EXTRUDE_MARKER,p.EXTRUDE_MARKER),p.LAYER_NODE_TYPE.set(p.HEAT_MAP_MARKER,p.HEAT_MAP_MARKER),p.LAYER_NODE_TYPE.set(p.LINE_MARKER,p.LINE_MARKER),p.LAYER_NODE_TYPE.set(p.LOCATION_MARKER,p.LOCATION_MARKER),p.LAYER_NODE_TYPE.set(p.POLYGON_MARKER,p.POLYGON_MARKER),p.LAYER_NODE_TYPE.set(p.TEXT_MARKER,p.TEXT_MARKER),p.LAYER_NODE_TYPE.set(p.IMAGE_MARKER,p.IMAGE_MARKER),p.LAYER_NODE_TYPE.set(p.FLOW_LINE_LAYER,p.FLOW_LINE_MARKER),p.LAYER_NODE_TYPE.set(p.FIRE_MARKER,p.FIRE_MARKER),p.LAYER_NODE_TYPE.set(p.WALL_MARKER,p.WALL_MARKER),p.LAYER_NODE_TYPE.set(p.TUBE_MARKER,p.TUBE_MARKER),p.LAYER_NODE_TYPE.set(p.LINE3D_MARKER,p.LINE3D_MARKER),p.LAYER_NODE_TYPE.set(p.SPHERE_MARKER,p.SPHERE_MARKER),p.LAYER_NODE_TYPE.set(p.CAD_LAYER,p.CAD_LAYER),{NAME_KEY_ERROR:0,MAP_ID_URL_ERROR:2,THEME_ID_URL_ERROR:4,LICENSE_ERROR:8,PATH_ERROR:404,INFO:32,DEFAULT_LEVEL_ERROR:64}),Yr={RIGHT:2,LEFT:4,BOTTOM:8,TOP:16,RIGHT_BOTTOM:32,LEFT_BOTTOM:64,RIGHT_TOP:128,LEFT_TOP:256,CENTER:512};function At(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==r?r:1}Object.freeze(Yr),Object.defineProperties(At.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(At.prototype,{isVector4:!0,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=this.w,t=t.elements;return this.x=t[0]*e+t[4]*i+t[8]*r+t[12]*n,this.y=t[1]*e+t[5]*i+t[9]*r+t[13]*n,this.z=t[2]*e+t[6]*i+t[10]*r+t[14]*n,this.w=t[3]*e+t[7]*i+t[11]*r+t[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,r,n,s,o,a,h,l,u,t=t.elements,c=t[0],f=t[4],d=t[8],v=t[1],p=t[5],m=t[9],g=t[2],_=t[6],t=t[10];return Math.abs(f-v)<.01&&Math.abs(d-g)<.01&&Math.abs(m-_)<.01?Math.abs(f+v)<.1&&Math.abs(d+g)<.1&&Math.abs(m+_)<.1&&Math.abs(c+p+t-3)<.1?this.set(1,0,0,0):(n=Math.PI,o=(t+1)/2,a=(f+v)/4,h=(d+g)/4,l=(m+_)/4,(s=(p+1)/2)<(u=(c+1)/2)&&o<u?r=u<.01?(e=0,i=.707106781):(i=a/(e=Math.sqrt(u)),h/e):o<s?r=s<.01?(i=0,e=.707106781):(e=a/(i=Math.sqrt(s)),l/i):o<.01?(i=e=.707106781,r=0):(e=h/(r=Math.sqrt(o)),i=l/r),this.set(e,i,r,n)):(u=Math.sqrt((_-m)*(_-m)+(d-g)*(d-g)+(v-f)*(v-f)),Math.abs(u)<.001&&(u=1),this.x=(_-m)/u,this.y=(d-g)/u,this.z=(v-f)/u,this.w=Math.acos((c+p+t-1)/2)),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});class Xr{constructor(){}static convertPointCoordsByCenter(t,e){return t.x=t.x-e.x,t.y=t.y-e.y,void 0!==t.z&&void 0!==e.z&&(t.z=t.z-e.z),t}static convertPointsCoordsByCenter(e,i){for(let t=0;t<e.length;t++)this.convertPointCoordsByCenter(e[t],i);return e}static getMapScaleInfo(){if(!Xr.scaleInfo){let t;if(ot.environment===q.WX)return 96/2.54;var e;window.screen.deviceXDPI?t=window.screen.deviceXDPI:((e=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(e),t=parseInt(e.offsetWidth),e.parentNode.removeChild(e)),Xr.scaleInfo=t/2.54}return Xr.scaleInfo}static getCenterByAnchor(t){var e=new St(.5,.5);switch(t){case Yr.LEFT:e.setX(0);break;case Yr.RIGHT:e.setX(1);break;case Yr.TOP:e.setY(1);break;case Yr.BOTTOM:e.setY(0);break;case Yr.LEFT_TOP:e.set(0,1);break;case Yr.RIGHT_TOP:e.set(1,1);break;case Yr.LEFT_BOTTOM:e.set(0,0);break;case Yr.RIGHT_BOTTOM:e.set(1,0)}return e}static uniqWithArrayOne(t){let e=[];return t.forEach(t=>{e.includes(t)||e.push(t)}),e}static uniqWithArrayTwo(i){if(i.length<1)return[];i=JSON.parse(JSON.stringify(i));let r=[];for(let e=0;e<i.length;e++){let t=this.uniqWithArrayOne(i[e]);t=t.filter(t=>!r.includes(t)),i[e]=t,r=r.concat(t)}return i.filter(t=>0<t.length)}static compareArrays(e,i){if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++){var r,n=e[t],s=i[t];if(Object.keys(n).length!==Object.keys(s).length)return!1;for(r in n)if(n[r]&&s[r]&&n[r]!==s[r])return!1}return!0}}var Zr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qr={h:0,s:0,l:0},Jr={h:0,s:0,l:0};function ft(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}function Kr(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Qr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function $r(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}Object.assign(ft.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(t,e,i){return t=Et.euclideanModulo(t,1),e=Et.clamp(e,0,1),i=Et.clamp(i,0,1),0===e?this.r=this.g=this.b=i:(this.r=Kr(e=2*i-(i=i<=.5?i*(1+e):i+e-i*e),i,t+1/3),this.g=Kr(e,i,t),this.b=Kr(e,i,t-1/3)),this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(h=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r,n,s,o=h[1],a=h[2];switch(o){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return r=parseFloat(i[1])/360,n=parseInt(i[2],10)/100,s=parseInt(i[3],10)/100,t(i[5]),this.setHSL(r,n,s)}}else if(h=/^\#([A-Fa-f0-9]+)$/.exec(e)){var o=h[1],h=o.length;if(3===h)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this},setColorName:function(t){var e=Zr[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){e=0<(e=void 0===e?2:e)?1/e:1;return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Qr(t.r),this.g=Qr(t.g),this.b=Qr(t.b),this},copyLinearToSRGB:function(t){return this.r=$r(t.r),this.g=$r(t.g),this.b=$r(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,i=this.r,r=this.g,n=this.b,s=Math.max(i,r,n),o=Math.min(i,r,n),a=(o+s)/2;if(o===s)l=e=0;else{var h=s-o,l=a<=.5?h/(s+o):h/(2-s-o);switch(s){case i:e=(r-n)/h+(r<n?6:0);break;case r:e=(n-i)/h+2;break;case n:e=(i-r)/h+4}e/=6}return t.h=e,t.s=l,t.l=a,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){return this.getHSL(qr),qr.h+=t,qr.s+=e,qr.l+=i,this.setHSL(qr.h,qr.s,qr.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(qr),t.getHSL(Jr);var t=Et.lerp(qr.h,Jr.h,e),i=Et.lerp(qr.s,Jr.s,e),e=Et.lerp(qr.l,Jr.l,e);return this.setHSL(t,i,e),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return this.r=t[e=void 0===e?0:e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}),ft.NAMES=Zr;class tn{constructor(){}static round(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}static generateUUID(){var e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,t=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255];return e.length=0,t.toUpperCase()}static findNearNthPowerOfTwo(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}static rgbToArray(t){var e=new ft;return e.setStyle(t),[e.r,e.g,e.b]}static toRgba(t){var e;return void 0===t?t:"number"!=typeof t?3<=(e=t.split(",")).length?"rgba("+parseInt(e[0])+","+parseInt(e[1])+","+parseInt(e[2])+",1)":t:"rgba("+parseInt(255*new ft(t).r)+","+parseInt(255*new ft(t).g)+","+parseInt(255*new ft(t).b)+",1)"}static toColor(t){var e;return"number"==typeof t?t:3<=(e=t.split(",")).length?parseInt(e[0])<<16|parseInt(e[1])<<8|parseInt(e[2]):(console.error("color format error",t),0)}static cov(n){var t=[],e=[0,0],s=[];for(let t=0;t<n.length;t++)e[0]+=n[t].x,e[1]+=n[t].y;e[0]=e[0]/n.length,e[1]=e[1]/n.length;for(let t=0;t<n.length;t++)s.push([n[t].x-e[0],n[t].y-e[1]]);var o=[];for(let e=0;e<s[0].length;e++){var i=[];for(let t=0;t<s.length;t++)i.push(s[t][e]);o.push(i)}for(let r=0;r<o.length;r++){var a=[];for(let i=0;i<s[0].length;i++){let e=0;for(let t=0;t<o[r].length;t++)e+=o[r][t]*s[t][i];e/=n.length-1,a.push(e)}t.push(a)}return t}static eig(t){var e=(t[0][0]+t[1][1])/2,i=t[0][0]*t[1][1]-t[1][0]*t[0][1],r=e+Math.sqrt(e*e-i),e=e-Math.sqrt(e*e-i);return 0==t[0][1]&&0==t[1][0]?{eigValue:[r,e],eigVect:[[1,0],[0,1]]}:(i=(r-t[0][0])/t[0][1],t=(e-t[0][0])/t[0][1],{eigValue:[r,e],eigVect:[[1/Math.sqrt(1+i*i),i/Math.sqrt(1+i*i)],[1/Math.sqrt(1+t*t),t/Math.sqrt(1+t*t)]]})}}class en{constructor(t){this.j=(t=t||{}).src,this.G=t.dest,this.U=null,this.H=[],this.B=0,this.V=0,this.W=0,this.Y=l.THOUSAND,this.X=!1,this.Z=!1,this.J=!0,this.K=null,this.$=null,this.tt=tn.generateUUID()}play(){return this.et()}pause(){return this.Z=!0,this}resume(){return this.Z=!1,this.B+=this.W,this.W=0,this}stop(){return this.J=!0,this}finish(){return this.J=!0,this.$&&this.$(),this.H=[],this}}function rn(t){Object.assign(t.prototype,{it(t){let e=this.R.getZoom()*t,i=new en({src:[this.R.getZoom()],dest:[e]});e>this.P.rt[1]||e<this.P.rt[0]||(i.ot(.5).st(t=>this.R.setZoom({animate:!1,zoom:t.destination[0]})).nt(()=>this.R.lt.ht(i)),this.R.lt.ut(i.et()))},ct(){var t=this.R.ft.isPerspectiveCamera?this.dt():this.vt();return this.gt(t)},_t(t,e){this.R.lt.ht(e),this.bt({zoom:t.zoom,animate:!1,finish:t.finish})},bt(i){this.P.zoom=i.zoom;var t=Number.isFinite(i.duration)?i.duration:.5,r=this.yt(this.P.zoom),e=this.wt(r);let n=this.O.object.position.distanceTo(this.O.target),s=(new Lt).copy(this.O.object.position).sub(this.O.target).normalize(),o=(new Lt).copy(s).multiplyScalar(e-n);if(this.R.ft.isPerspectiveCamera)if("animate"in i&&!i.animate)this.O.update({offset:o}),i.finish&&i.finish();else{let e=new en({src:[0,0,0],dest:[o.x,o.y,o.z]});e.ot(t).st(t=>{"PerspectiveCamera"===this.R.ft.type?this.O.update({offset:new Lt(t.delta[0],t.delta[1],t.delta[2])}):this._t(i,e)}).nt(()=>{this.R.lt.ht(e),i.finish&&i.finish()}),this.R.lt.ut(e.et())}else if("animate"in i&&!i.animate){e=this.xt(r);this.R.ft.zoom=1/e,this.R.ft.updateProjectionMatrix(),this.R.A.Mt(),this.O.update({offset:o}),i.finish&&i.finish()}else{let e=new en({src:[this.vt()],dest:[r]});e.ot(t).st(t=>{"OrthographicCamera"===this.R.ft.type?(t=this.xt(t.destination[0]),this.R.ft.zoom=1/t,this.R.ft.updateProjectionMatrix(),this.R.A.Mt(),this.R.enableUpdateRender(),this.R.Et()):this._t(i,e)}).nt(()=>{this.O.update({offset:o}),this.R.lt.ht(e),i.finish&&i.finish()}),this.R.lt.ut(e.et())}},Lt(t){this.P.rt=t,this.Tt(),this.O.update()},Tt(){var t=this.yt(this.P.rt[0]),e=this.yt(this.P.rt[1]);this.O.maxDistance=this.wt(t),this.O.minDistance=this.wt(e),this.O.minZoom=1/this.xt(t),this.O.maxZoom=1/this.xt(e)},yt(t){var e=this.St.length-1,i=(--t,t=Math.max(0,Math.min(t,e)),Math.floor(t)),t=t-i,r=Math.max(0,Math.min(i,e)),e=Math.max(0,Math.min(i+1,e)),r=this.St[r]-this.St[e];return this.St[i]-r*t},gt(e){let i=0,r=.1,n=!1;for(let t=0;t<this.St.length-1;t++)if(e<=this.St[t]&&e>this.St[t+1]){i=t,r=(this.St[t]-e)/(this.St[t]-this.St[t+1]),n=!0;break}let t=null;var s;return t=n?parseFloat((i+1+r).toFixed(2)):(s=this.St.length-1,e<=this.St[s]?1+s:1)},wt(t){return t/100*(this.R.A.renderer.domElement.clientHeight/Xr.getMapScaleInfo())/2/Math.tan(l.FOV/2*l.DEG2RAD)},dt(){return(new Lt).copy(this.O.object.position).sub(this.O.target).length()*(100*Math.tan(l.FOV/2*l.DEG2RAD)*2/(this.R.A.renderer.domElement.clientHeight/Xr.getMapScaleInfo()))},vt(){var t=this.R.ft.top,e=this.R.ft.bottom;return Math.abs(t-e)*Xr.getMapScaleInfo()*100/this.R.A.renderer.domElement.clientHeight/this.R.ft.zoom},xt(t){var e=this.R.At.top,i=this.R.At.bottom;return t/(Math.abs(e-i)*Xr.getMapScaleInfo()*100/this.R.A.renderer.domElement.clientHeight)}})}function nn(t){Object.assign(t.prototype,{Ot(t){let e=this.O,i=t.finish;var r;"animate"in t&&!t.animate?(e.update({phi:(l.TILT_UPPER_BOUND-t.tilt)*l.DEG2RAD}),e.update(),i&&i()):(null===this.Ct&&(this.Ct=new en),r=Number.isFinite(t.duration)?t.duration:.5,this.Ct.Nt([this.R.getTilt()]).Rt([t.tilt]).ot(r).st(t=>{e.update({phi:(l.TILT_UPPER_BOUND-t.destination[0])*l.DEG2RAD})}).nt(()=>{e.update({phi:(l.TILT_UPPER_BOUND-t.tilt)*l.DEG2RAD}),e.update(),this.R.lt.ht(this.Ct),i&&i()}),this.R.lt.ut(this.Ct.et()))},Dt(){let t=tn.round(-this.O.getAzimuthalAngle()*l.RAD2DEG);return 360<(t=t<0?360+t:t)&&(t%=360),t},kt(t,e){let i=-t%360*l.DEG2RAD,r=(i=!1===e?-t*l.DEG2RAD:i)-this.O.getAzimuthalAngle();return r=0!==r&&e?Math.sin(r)/Math.abs(Math.sin(r))*Math.acos(Math.cos(r)):r},Pt(i){let r=void 0!==i.loop&&i.loop;var t=void 0!==i.direction?i.direction:0,e=void 0===i.minimumAngleTransformation||i.minimumAngleTransformation,n=this.O.getAzimuthalAngle();let s;if(s=r?0===t?n-2*Math.PI:2*Math.PI+n:n+this.kt(i.rotation,e),!("animate"in i)||i.animate){let t=i&&i.duration&&Number.isFinite(i.duration)?i.duration:.5,e=new en({src:[n],dest:[s]});return e.ot(t).It(r).st(t=>{this.O.update({theta:t.destination[0]})}).nt(()=>{r||this.R.lt.ht(e),i.finish&&i.finish()}),this.R.lt.ut(e.et()),e}this.O.update({theta:s}),i.finish&&i.finish()}})}function sn(t){Object.assign(t.prototype,{Ft(){var t=this.O.target,e=this.R.I[0];return{x:parseFloat((e.x+t.x).toFixed(4)),y:parseFloat((e.y-t.z).toFixed(4))}},jt(i){let r=this.O,t=this.R.I[0],n=i.x-t.x,s=-i.y+t.y,o=r.target.x,a=r.target.z,e=i.height,h=!!e&&Number.isFinite(e),l,u;if(h?(u=r.target.y,l=e):u=l=0,"animate"in i&&i.animate){let t=Number.isFinite(i.duration)?i.duration:.5,e=new en({src:[o,u,a],dest:[n,l,s]});e.ot(t).st(t=>{r.panAdd({x:t.delta[0],y:t.delta[1],z:t.delta[2]}),r.update(),this.R.A.Mt()}).nt(()=>{this.R.lt.ht(e),this.R.A.Mt(),i.finish&&i.finish()}),this.R.lt.ut(e.et())}else r.panAdd({x:n-o,y:l-u,z:s-a}),r.update(),i.finish&&i.finish(),this.R.A.Mt()},Gt(e,i){let r=this.O,t=()=>{this.P.Ut(e.Ht).level=i.level,this.R.A.Bt(),this.R.Vt.zt();var t={type:"levelChanged",level:i.level};e!==this.R.S&&(t.buildingID=e.Ht),this.R.Yt.Wt(t),this.enableDragRange&&r.saveState(),this.R.A.Mt(),this.R.Xt(),i.finish&&i.finish(i.level)};e===this.R.S||this.R.Zt?this.qt(e,{level:i.level,animate:i.animate,duration:i.duration,callback:i.callback,finish:()=>{t()}}):t()},qt(t,e){var i=void 0!==e.duration?e.duration:.5,r=void 0===e.animate||e.animate;let n=this.O;var s=n.target.y;let o=t.getFloor(e.level).T;r?(null===this.Jt&&(this.Jt=new en),this.Jt.Nt([s]).Rt([o]).ot(i).st(t=>{n.panUp(t.delta[0]),n.update()}).nt(()=>{n.panUp(o-n.target.y),n.update(),e.finish&&e.finish()}),this.R.lt.ut(this.Jt.et()),e.callback&&e.callback(this.Jt)):(n.panUp(o-s),n.update(),e.callback&&e.callback(null),e.finish&&e.finish())}})}Object.assign(en.prototype,{Kt(){for(var t in this)this[""+t]=null,delete this[""+t]},Nt(t){return this.j=t,this},Rt(t){return this.G=t,this},ot(t){return this.Y=t*l.THOUSAND,this},Qt(t){return this.V=t*l.THOUSAND,this},st(t){return this.K=t,this},nt(t){return this.$=t,this},It(t){return this.X=t,this},et(){return this.J=!1,this.U&&(this.B=this.U.$t),this},te(){var t=new this.constructor({src:this.j,dest:this.G});return t.B=this.B,t.V=this.V,t.Y=this.Y,t.X=this.X,t.K=this.K,t.$=this.$,t},ee(){var t=this.G.concat(),e=this.j.concat();return this.j=t,this.G=e,this}});class on{constructor(t,e){this.start=t??0,this.stop=e??0}}function an(t){return null!=t}class hn{constructor(t=null,e=null){this.center=t?.clone(),this.radius=e}get valid(){return null!==this.center&&null!==this.radius}reset(){this.center=null,this.radius=null}static computePlaneDistances(t,e,i,r){an(r)||(r=new on);var n=new Lt,e=(n.subVectors(t.center,e),i.dot(n));return r.start=e-t.radius,r.stop=e+t.radius,r}static clone(t,e){if(an(t))return an(e)?(e.center=t.center.clone(),e.radius=t.radius,e):new hn(t.center,t.radius)}static expand(t,e,i){i=hn.clone(t,i);t=e.distance(i.center);return t>i.radius&&(i.radius=t),i}static union(t,e,i){an(i)||(i=new hn);var r=t.center,n=t.radius,s=e.center,o=e.radius,a=new Lt,s=(a.subVectors(s,r),a.length());return s+o<=n?hn.clone(t,i):s+n<=o?hn.clone(e,i):(t=.5*(n+s+o),(e=a.clone()).multiplyScalar((t-n)/s),e.add(r),i.center=e.clone(),i.radius=t),i}static equals(t,e){return t===e||an(t)&&an(e)&&t.equals(e.center)&&t.radius===e.radius}}class ln{constructor(t){this.O=t,this.ie=new on,this.re=new hn}static getMeshBoudinggSphere(t){var t=(new Ct).setFromObject(t),e=new Lt,i=(t.getCenter(e),new Lt),t=(t.getSize(i),.5*i.length());return new hn(e,t)}static getSceneBoudingSphere(t,i){t.traverse(t=>{let e;"Mesh"===t.type||"SkinnedMesh"===t.type?e=ln.getMeshBoudinggSphere(t):"Scene"!==t.type&&"Group"!==t.type&&"DirectionalLight"!==t.type&&"AmbientLight"!==t.type&&(e=new hn(t.position,0)),!e||isNaN(e.radius)||isNaN(e.center.x)||isNaN(e.center.y)||isNaN(e.center.z)||(i.valid||hn.clone(e,i),hn.union(e,i,i))})}reset(){this.ne()}update(t){this.se(t)}}Object.assign(ln.prototype,{oe(){var t,e,i;!this.re.valid||this.re.radius<=0||({target:i,object:t}=this.O,(t.far>l.CAMERA_FAR||void 0===t.userData.far)&&(t.userData.far=Math.max(t.far,t.userData.far??0)),void 0===t.userData.near&&(t.userData.near=t.near),e=t.position,i=i.clone().sub(e).normalize(),hn.computePlaneDistances(this.re,e,i,this.ie),this.ie.start>=this.ie.stop)||(t.near=Math.max(this.ie.start,t.userData.near),t.far=this.ie.stop,t.updateProjectionMatrix())},ne(){this.re.reset()},se(t){t.forEach(t=>{t&&ln.getSceneBoudingSphere(t,this.re)}),this.oe()}});class un{constructor(t,e){this.ae=t,this.he=e}}Object.assign(un.prototype,{le(t){return!1},ue(t,e){}});let cn={NONE:0,POINT:1,LINE:2,POLYGON:4,MULTIPOINT:8,MULTILINE:16,MULTIPOLYGON:32,GROUP:64,EXTENT:1024,EXTERNALMODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,EXTENTGROUP:1<<20,EXTERNALMODELGROUP:1<<21,MODELGROUP:1<<22,FACILITYGROUP:1<<23,LABELGROUP:1<<24},fn=(Object.freeze(cn),{triangulate:function(a,h,l){l=l||2;var u=h&&h.length,c=u?h[0]*l:a.length;let f=dn(a,0,c,l,!0);var d=[];if(f&&f.next!==f.prev){let e,i,r,n,s,o,t;if(u&&(f=yn(a,h,f,l)),a.length>80*l){e=r=a[0],i=n=a[1];for(let t=l;t<c;t+=l)s=a[t],o=a[t+1],s<e&&(e=s),o<i&&(i=o),s>r&&(r=s),o>n&&(n=o);t=0!==(t=Math.max(r-e,n-i))?1/t:0}pn(f,d,l,e,i,t)}return d}});function dn(t,e,i,r,n){let s,o;if(n===0<Bn(t,e,i,r))for(s=e;s<i;s+=r)o=Gn(s,t[s],t[s+1],o);else for(s=i-r;s>=e;s-=r)o=Gn(s,t[s],t[s+1],o);return o&&Rn(o,o.next)&&(Un(o),o=o.next),o}function vn(t,e){if(!t)return t;e=e||t;let i=t,r;do{if(r=!1,i.steiner||!Rn(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(Un(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function pn(r,n,s,o,a,h,l){if(r){!l&&h&&Ln(r,o,a,h);let t=r,e,i;for(;r.prev!==r.next;)if(e=r.prev,i=r.next,h?gn(r,o,a,h):mn(r))n.push(e.i/s),n.push(r.i/s),n.push(i.i/s),Un(r),r=i.next,t=i.next;else if((r=i)===t){l?1===l?pn(r=_n(vn(r),n,s),n,s,o,a,h,2):2===l&&bn(r,n,s,o,a,h):pn(vn(r),n,s,o,a,h,1);break}}}function mn(t){var e=t.prev,i=t,r=t.next;if(0<=m(e,i,r))return!1;let n=t.next.next;for(;n!==t.prev;){if(On(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=m(n.prev,n,n.next))return!1;n=n.next}return!0}function gn(t,e,i,r){var n=t.prev,s=t,o=t.next;if(0<=m(n,s,o))return!1;var a=(n.x<s.x?n.x<o.x?n:o:s.x<o.x?s:o).x,h=(n.y<s.y?n.y<o.y?n:o:s.y<o.y?s:o).y,l=(n.x>s.x?n.x>o.x?n:o:s.x>o.x?s:o).x,u=(n.y>s.y?n.y>o.y?n:o:s.y>o.y?s:o).y,c=Sn(a,h,e,i,r),f=Sn(l,u,e,i,r);let d=t.prevZ,v=t.nextZ;for(;d&&d.z>=c&&v&&v.z<=f;){if(d!==t.prev&&d!==t.next&&On(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=m(d.prev,d,d.next))return!1;if(d=d.prevZ,v!==t.prev&&v!==t.next&&On(n.x,n.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=m(v.prev,v,v.next))return!1;v=v.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&On(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=m(d.prev,d,d.next))return!1;d=d.prevZ}for(;v&&v.z<=f;){if(v!==t.prev&&v!==t.next&&On(n.x,n.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=m(v.prev,v,v.next))return!1;v=v.nextZ}return!0}function _n(t,e,i){let r=t;do{var n=r.prev,s=r.next.next;!Rn(n,s)&&Nn(n,r,r.next,s)&&In(n,s)&&In(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),Un(r),Un(r.next),r=t=s),r=r.next}while(r!==t);return vn(r)}function bn(t,e,i,r,n,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){var a;if(o.i!==t.i&&Cn(o,t))return a=jn(o,t),o=vn(o,o.next),a=vn(a,a.next),pn(o,e,i,r,n,s),void pn(a,e,i,r,n,s);t=t.next}}while((o=o.next)!==t)}function yn(t,e,i,r){var n=[];let s,o,a,h,l;for(s=0,o=e.length;s<o;s++)a=e[s]*r,h=s<o-1?e[s+1]*r:t.length,(l=dn(t,a,h,r,!1))===l.next&&(l.steiner=!0),n.push(An(l));for(n.sort(wn),s=0;s<n.length;s++)xn(n[s],i),i=vn(i,i.next);return i}function wn(t,e){return t.x-e.x}function xn(t,e){(e=Mn(t,e))&&(t=jn(e,t),vn(e,e.next),vn(t,t.next))}function Mn(i,t){let r=t;var n=i.x,s=i.y;let o=-1/0,a;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var e=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>o){if((o=e)===n){if(s===r.y)return r;if(s===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}}while((r=r.next)!==t);if(!a)return null;if(n!==o){var h=a,l=a.x,u=a.y;let t=1/0,e;for(r=a;n>=r.x&&r.x>=l&&n!==r.x&&On(s<u?n:o,s,l,u,s<u?o:n,s,r.x,r.y)&&(e=Math.abs(s-r.y)/(n-r.x),In(r,i))&&(e<t||e===t&&(r.x>a.x||r.x===a.x&&En(a,r)))&&(a=r,t=e),(r=r.next)!==h;);}return a}function En(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function Ln(t,e,i,r){let n=t;for(;null===n.z&&(n.z=Sn(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==t;);n.prevZ.nextZ=null,n.prevZ=null,Tn(n)}function Tn(t){let e,i,r,n,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,r=i,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(h=l;0<a||0<h&&r;)0!==a&&(0===h||!r||i.z<=r.z)?(i=(n=i).nextZ,a--):(r=(n=r).nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}}while(s.nextZ=null,l*=2,1<o);return t}function Sn(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function An(t){let e=t,i=t;for(;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),(e=e.next)!==t;);return i}function On(t,e,i,r,n,s,o,a){return 0<=(n-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(r-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(n-o)*(r-a)}function Cn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Pn(t,e)&&(In(t,e)&&In(e,t)&&Fn(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||Rn(t,e)&&0<m(t.prev,t,t.next)&&0<m(e.prev,e,e.next))}function m(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Rn(t,e){return t.x===e.x&&t.y===e.y}function Nn(t,e,i,r){var n=kn(m(t,e,i)),s=kn(m(t,e,r)),o=kn(m(i,r,t)),a=kn(m(i,r,e));return n!==s&&o!==a||!!(0===n&&Dn(t,i,e)||0===s&&Dn(t,r,e)||0===o&&Dn(i,t,r)||0===a&&Dn(i,e,r))}function Dn(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function kn(t){return 0<t?1:t<0?-1:0}function Pn(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Nn(i,i.next,t,e))return!0}while((i=i.next)!==t);return!1}function In(t,e){return m(t.prev,t,t.next)<0?0<=m(t,e,t.next)&&0<=m(t,t.prev,e):m(t,e,t.prev)<0||m(t,t.next,e)<0}function Fn(t,e){let i=t,r=!1;for(var n=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r}function jn(t,e){var i=new Hn(t.i,t.x,t.y),r=new Hn(e.i,e.x,e.y),n=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=n).prev=i,(r.next=i).prev=r,(s.next=r).prev=s,r}function Gn(t,e,i,r){t=new Hn(t,e,i);return r?(t.next=r.next,(t.prev=r).next.prev=t,r.next=t):(t.prev=t).next=t,t}function Un(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hn(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bn(i,r,n,s){let o=0;for(let t=r,e=n-s;t<n;t+=s)o+=(i[e]-i[t])*(i[t+1]+i[e+1]),e=t;return o}let zn={area:function(i){var r=i.length;let n=0;for(let t=r-1,e=0;e<r;t=e++)n+=i[t].x*i[e].y-i[e].x*i[t].y;return.5*n},isClockWise:function(t){return zn.area(t)<0},triangulateShape:function(t,e){var i=[],r=[],n=[];Wn(t),Yn(i,t);let s=t.length;e.forEach(Wn);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,Yn(i,e[t]);var o=fn.triangulate(i,r);for(let t=0;t<o.length;t+=3)n.push(o.slice(t,t+3));return n},triangulate:function(e){let t=[];t.push(...e[0]);var i=[];for(let t=1;t<e.length;t++){var r=[];r.push(...e[t]),i.push(r)}if(!zn.isClockWise(t)){t=t.reverse();for(let t=0,e=i.length;t<e;t++){var n=i[t];zn.isClockWise(n)&&(i[t]=n.reverse())}}return zn.triangulateShape(t,i)}};function Vn(t,e){return t.x===e.x&&t.y===e.y}function Wn(t){var e=t.length;2<e&&Vn(t[e-1],t[0])&&t.pop()}function Yn(e,i){for(let t=0;t<i.length;t++)e.push(i[t].x),e.push(i[t].y)}let Xn=1e-5,Zn=1e-5,qn=.001,Jn=Math.PI/180,Kn=180/Math.PI;class Qn{constructor(){}}Object.assign(Qn.prototype,{ce(){return Xn},fe(){return Jn},de(){return Kn},ve(t){return t<Xn&&t>-Xn},pe(t){return t>Xn},me(t){return t<-Xn},ge(t,e,i){e=(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y);return Math.abs(e)<Xn?0:e},distanceOfTwoPoints(t,e){return t&&e?Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)):Number.NaN},distance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},isPolygonContainPoint(r,n){let s=0;for(let i=0;i<r.length;i++){var o=r[i].x,a=r[i].y;let t=0,e=0;if(e=(i<r.length-1?(t=r[i+1].x,r[i+1]):(t=r[0].x,r[0])).y,o===n.x&&a===n.y||t===n.x&&e===n.y)return!0;if(e!==a){var h=o+(n.y-a)*(t-o)/(e-a);if(h===n.x)return!0;o!==t?h<=Math.max(o,t)&&h>=Math.min(o,t)&&h>n.x&&h!==o&&(h===t&&0<(a-n.y)*(e-n.y)?s+=2:s++):h<=Math.max(o,t)&&h>=Math.min(o,t)&&h>n.x&&(h===t&&0<(a-n.y)*(e-n.y)?s+=2:s++)}}return 0<s%2},isPolygonContainPoint2(e,i){var r=e.length;if(r<3)return!1;let n=r-1,s=!1,o=0;for(let t=0;t<r;t++){var a=e[t],h=e[n];a.y>i.y!=h.y>i.y&&i.x<(h.x-a.x)*(i.y-a.y)/(h.y-a.y)+a.x&&(s=!s,a.y>h.y?o++:o--),n=t}return 0!=o},isPolygonInPolygon(t,e){var i=Object.assign([],t),r=Object.assign([],e);i.push(i[0]),r.push(r[0]);for(let t=0;t<i.length-1;t++){var n=i[t];if(!this.isPolygonContainPoint(r,n)&&!this.isPolygonContainPoint2(r,n))return!1}for(let e=0;e<i.length-1;e++)for(let t=0;t<r.length-1;t++)if(this._e(i[e],i[e+1],r[t],r[t+1]).isintersect&&!this.be(r[t],r[t+1],i[e])&&!this.be(r[t],r[t+1],i[e+1]))return!1;return!0},ye(t,e,i,r){return!(Math.max(t.x,e.x)<Math.min(i.x,r.x)||Math.max(t.y,e.y)<Math.min(i.y,r.y)||Math.max(i.x,r.x)<Math.min(t.x,e.x)||Math.max(i.y,r.y)<Math.min(t.y,e.y))},we(t,e,i,r){return!(Math.max(t.x,e.x)<Math.min(i.x,r.x)||Math.max(t.y,e.y)<Math.min(i.y,r.y)||Math.max(i.x,r.x)<Math.min(t.x,e.x)||Math.max(i.y,r.y)<Math.min(t.y,e.y)||0===this.ge(i,e,t)&&0===this.ge(e,r,t)||this.ge(i,e,t)*this.ge(e,r,t)<0||this.ge(t,r,i)*this.ge(r,e,i)<0)},xe(t,e,i){return!(t.x<e.x||t.y<e.y||t.x>i.x||i.y<t.y)},Me(t,e,i){var r=Math.min(e.x,i.x),n=Math.max(e.x,i.x),s=Math.min(e.y,i.y),e=Math.max(e.y,i.y);return!(t.x<r||t.x>n||t.y<s||t.y>e)},Ee(t,e,i){var r=Math.min(i.x,e.x),n=Math.max(i.x,e.x),s=Math.min(i.y,e.y),i=Math.max(i.y,e.y);return!(t.x<r||t.x>n||t.y<s||t.y>i)},Le(e,i,r){let n=!1;var s,o;for(let t=0;t<r;t++)s=i[t],o=i[(t+1)%r],(s.y<e.y&&o.y>=e.y||o.y<e.y&&s.y>=e.y)&&(s.x<=e.x||o.x<=e.x)&&s.x+(e.y-s.y)/(o.y-s.y)*(o.x-s.x)<e.x&&(n=!n);return n},Te(t,e,i){return(t.x-e.x)*(i.y-e.y)==(i.x-e.x)*(t.y-e.y)&&Math.min(e.x,i.x)<=t.x&&t.x<=Math.max(e.x,i.x)&&Math.min(e.y,i.y)<=t.y&&t.y<=Math.max(e.y,i.y)},Se(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},Ae(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},Oe(t,e,i){let r;var n=e.x,e=e.y,s=i.x,i=i.y,o=t.x,t=t.y,a=s-n,h=i-e,l=a*a+h*h,u=o-n,c=t-e,f=u*u+c*c;return this.ve(l)?r=this.ve(f)?0:f:(h=(l=a/(a=Math.sqrt(l)))*u+(u=h/a)*c,r=this.pe(h)?this.me(h-a)?(c=o-(n+h*l))*c+(a=t-(e+h*u))*a:(n=o-s)*n+(l=t-i)*l:f,this.ve(r)?0:r)},Ce(t,e,i,r){let n;var s=e.x,o=e.y,a=i.x,h=i.y,l=t.x,t=t.y,u=a-s,c=h-o,f=Math.sqrt(u*u+c*c),d=l-s,v=t-o,p=Math.sqrt(d*d+v*v);return n=!this.ve(f)&&(c=(u=u/f)*d+(d=c/f)*v,this.pe(c))?this.me(c-f)?(f=l-(v=s+c*u),u=t-(s=o+c*d),o=Math.sqrt(f*f+u*u),r.x=v,r.y=s,o):(c=l-a,d=t-h,f=Math.sqrt(c*c+d*d),r.x=i.x,r.y=i.y,f):(r.x=e.x,r.y=e.y,p),this.ve(n)?0:n},Re(e,i){let r=0,n=0,s=0;for(let t=0;t<i;t++){var o=e[t],a=e[(t+1)%i],h=(o.x*a.y-o.y*a.x)/2;r+=h,n+=h*(o.x+a.x)/3,s+=h*(o.y+a.y)/3}return n/=r,s/=r,{x:n,y:s}},Ne(e){var i=zn.triangulate([e]);let r=0,n=0,s=0;for(let t=0;t<i.length;t++){var o=e[i[t][0]],a=e[i[t][1]],h=e[i[t][2]],l={x:a.x-o.x,y:a.y-o.y},u={x:h.x-o.x,y:h.y-o.y},u=(l.x*u.y-u.x*l.y)/2,l=(r+=u,(o.x+a.x+h.x)/3);n+=l*u,s+=(o.y+a.y+h.y)/3*u}return{x:n/r,y:s/r}},De(e,i){if(i<3)return 0;let r=0;for(let t=0;t<i;++t){var n=e[t],s=e[(t+1)%i];r+=n.x*s.y-n.y*s.x}return Math.abs(r/2)},ke(t,e,i,r,n){var s;return this.we(t,e,i,r)?(s=(r.x-i.x)*(t.y-e.y)-(e.x-t.x)*(i.y-r.y),n.x=((t.y-i.y)*(e.x-t.x)*(r.x-i.x)+i.x*(r.y-i.y)*(e.x-t.x)-t.x*(e.y-t.y)*(r.x-i.x))/s,n.y=(e.y*(t.x-e.x)*(r.y-i.y)+(r.x-e.x)*(r.y-i.y)*(t.y-e.y)-r.y*(i.x-r.x)*(e.y-t.y))/(s=(t.x-e.x)*(r.y-i.y)-(e.y-t.y)*(i.x-r.x)),1):0},Pe(t,e,i,r,n){var s=Math.min(i.x,r.x),o=Math.max(i.x,r.x),a=Math.min(i.y,r.y),h=Math.max(i.y,r.y),l=t.x,u=t.y,c=i.x,f=i.y,d=r.x,v=r.y;if(90==e)return!(t.x<s||t.x>o||(o-s<qn?t.y>=f&&t.y<=v||t.y>=v&&t.y<=f?(n.x=t.x,n.y=t.y,0):f<v&&t.x<f?(n.x=c,n.y=f,0):!(v<f&&t.x<v)||(n.x=d,n.y=v,0):(n.y=p=(v-f)/(d-c)*(l-c)+f,n.x=l,p<u||!this.Ee(n,i,r))));if(270==e)return!(t.x<s||t.x>o||(Math.abs(o-s<qn)?t.y>=f&&t.y<=v||t.y>=v&&t.y<=f?(n.x=t.x,n.y=t.y,0):f<v&&t.y>v?(n.x=d,n.y=v,0):!(v<f&&t.y>f)||(n.x=c,n.y=f,0):(n.y=p=(v-f)/(d-c)*(l-c)+f,n.x=l,u<p||!this.Ee(n,i,r))));if(270!=e&&90!=e&&Math.abs(o-s<qn)){var t=s,p=Math.tan(e/180*Math.PI)*(t-l)+u;if(n.y=p,n.x=t,this.Ee(n,i,r))return o=p-u,0<(s=t-l)/Math.sqrt(s*s+o*o)*Math.cos(e/180*Math.PI)}return Math.abs(h-a<=qn)?(p=a,t=1/Math.tan(e/180*Math.PI)*(p-u)+l,n.x=t,n.y=p,!!this.Ee(n,i,r)&&(s=p-u,0<(o=t-l)/Math.sqrt(o*o+s*s)*Math.cos(e/180*Math.PI))):(t=u+(h=Math.tan(e/180*Math.PI))*((p=(f-u-((a=(v-f)/(d-c))*c-h*l))/(h-a))-l),n.x=p,n.y=t,!!this.Ee(n,i,r)&&(o=p-l,s=t-u,Math.abs(o)<=qn&&Math.abs(s)<=qn||0<o/Math.sqrt(o*o+s*s)*Math.cos(e/180*Math.PI)))},Ie(t,e){return Math.abs(t.x-e.x)<Xn&&Math.abs(t.y-e.y)<Xn},Fe(t,e,i,r){var n,s,o,a,h=t.x,l=t.y,u=e.x,c=e.y,f=i.x,d=i.y;return this.Ie(t,e)||this.Ie(t,i)?(r.x=h,r.y=l,!0):(o=Math.min(e.x,i.x),a=Math.max(e.x,i.x),n=Math.min(e.y,i.y),s=Math.max(e.y,i.y),Math.abs(u-f)<Zn?(r.x=u,n<=(r.y=l)&&l<=s):Math.abs(c-d)<Zn?(r.x=h,r.y=c,o<=h&&h<=a):(a=l+(n=-1/((d-c)/(f-u)))*((o=(c-l-((s=(d-c)/(f-u))*u-n*h))/(n-s))-h),r.x=o,r.y=a,!!this.Ee(r,e,i)||!(!this.Ie(t,e)&&!this.Ie(t,i))))},je(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},Ge(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},Ue(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},He(t,e){return t.x*e.x+t.y*e.y},Be(t,e){return t.x*e.y-t.y*e.x},ze(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Ve(t,e){var i,r;return 0==t.x&&0==t.y||0==e.x&&0==e.y?0:(i={x:e.x,y:e.y,z:0},i=this.je({x:t.x,y:t.y,z:0},i),r=this.He(t,e),r=Math.acos(r/(this.ze(t)*this.ze(e))),0<i.z?r/Math.PI*180:360-r/Math.PI*180)},We(e,i,r,n){for(let t=0;t<r.length;t++){var s=r[t],o=r[(t+1)%r.length];if(1==this.ke(e,i,s,o,n))return!0}return!1},Ye(t,e,i,r,n){var s=Math.min(t.x,i.x,r.x),o=Math.max(t.x,i.x,r.x),a=Math.min(t.y,i.y,r.y),h=Math.max(t.y,i.y,r.y),o=Math.sqrt((o-s)*(o-s)+(h-a)*(h-a)),s=e/180*Math.PI,h=o*Math.cos(s)+t.x,a=o*Math.sin(s)+t.y;return 1==this.ke(t,{x:h,y:a},i,r,n)},Xe(e){var t={x:null,y:null};let i=0,r=0,n=e.length;1<e.length&&e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y&&n--;for(let t=0;t<n;t++)i+=e[t].x,r+=e[t].y;return t.x=i/e.length,t.y=r/e.length,t},Ze(t,e,i,r){var n=[],s=t.x-e,o=t.x+e,a=t.y-e,h=t.y+e,l=Math.min(i.x,r.x),u=Math.max(i.x,r.x),c=Math.min(i.y,r.y),f=Math.max(i.y,r.y);return u<s||o<l||f<a||h<c||(o=(t=((s=r.x-i.x)*(o=t.x-i.x)+(a=r.y-i.y)*(h=t.y-i.y))/(r=s*s+a*a))*t-(o*o+h*h-e*e)/r)<0||(h=Math.sqrt(o),r={x:i.x-s*(e=-t+h),y:i.y-a*e},s={x:i.x-s*(o=-t-h),y:i.y-a*o},e!==o&&(l<=r.x&&r.x<=u&&c<=r.y&&r.y<=f&&n.push(r),l<=s.x)&&s.x<=u&&c<=s.y&&s.y<=f&&n.push(s)),n},qe(t,e){return Math.abs(t.x-e.x)<=Xn&&Math.abs(t.y-e.y)<=Xn},Je(t,e,i){var r,n={};if(t.x!=e.x)return r=e=(e.y-t.y)/(e.x-t.x),n.x=(+i.x- -1*r*i.y-r*(e=t.y-e*t.x))/(r*r+1),n.y=(r*r*i.y- -1*r*i.x- -1*e)/(r*r+1),n;n.x=t.x,n.y=i.y},_e(t,e,i,r){var n,s,o,a,h={point:null,isintersect:!1};return this.distanceOfTwoPoints(t,i)<.001||this.distanceOfTwoPoints(t,r)<.001?(h.isintersect=!0,h.point=t):this.distanceOfTwoPoints(e,i)<.001||this.distanceOfTwoPoints(e,r)<.001?(h.isintersect=!0,h.point=e):(n={x:e.x-t.x,y:e.y-t.y},s={x:r.x-i.x,y:r.y-i.y},r={x:r.x-t.x,y:r.y-t.y},e={x:e.x-i.x,y:e.y-i.y},o={x:-(i={x:i.x-t.x,y:i.y-t.y}).x,y:-i.y},a=this.Be(s,n),Math.abs(a)<=1e-5||this.Be(i,n)*this.Be(r,n)<=-5e-4&&this.Be(o,s)*this.Be(e,s)<-5e-4&&(r=this.Be(s,i)/a,h.point={x:t.x+n.x*r,y:t.y+n.y*r},h.isintersect=!0)),h},Ke(t,e,i){return t.x===e.x&&(e.x=e.x+1),t.y===e.y&&(e.y=e.y+1),e.x===i.x&&(i.x=i.x+1),e.y===i.y&&(i.y=i.y+1),!(0<(e.x-t.x)*(i.y-e.y)-(e.y-t.y)*(i.x-e.x))},getAngle(t){var e=t.p1,t=t.p2,i=t.x-e.x,t=t.y-e.y,e=Math.sqrt(i*i+t*t),e=Math.asin(Math.abs(t)/e);return 0<i&&0<t?e:i<0&&0<t?Math.PI-e:i<0&&t<0?Math.PI+e:0<i&&t<0?2*Math.PI-e:0==i&&0<t?e:0==i&&t<0?3*Math.PI/2:0<i&&0==t?e:i<0&&0==t?Math.PI:null},Qe(t){var e=this.distanceOfTwoPoints(t[0],t[1]),i=this.distanceOfTwoPoints(t[1],t[2]),t=this.distanceOfTwoPoints(t[0],t[2]),r=(e+i+t)/2;return Math.sqrt(r*(r-e)*(r-i)*(r-t))},$e(t,e){var i,r,n,s,o;return this.Ce(t,e[0],e[1],{})<1e-4||this.Ce(t,e[0],e[2],{})<1e-4||this.Ce(t,e[1],e[2],{})<1e-4||(s={x:e[1].x-e[0].x,y:e[1].y-e[0].y},i={x:e[0].x-e[2].x,y:e[0].y-e[2].y},r={x:e[2].x-e[1].x,y:e[2].y-e[1].y},o={x:t.x-e[0].x,y:t.y-e[0].y},n={x:t.x-e[1].x,y:t.y-e[1].y},t={x:t.x-e[2].x,y:t.y-e[2].y},e=this.Be(s,o),s=this.Be(r,n),o=this.Be(i,t),e*s>Xn&&s*o>Xn)},ti(r,n,s){var o=s.length,a={isintersect:!1,start:null,end:null,type:0,outer:null},h=[];if(this.$e(r,s)&&(a.start=r),this.$e(n,s)&&(a.end=n),null!=a.start&&null!=a.end)a.isintersect=!0,a.type=1;else{let e=(s[1].x+s[2].x)/2,i=(s[1].y+s[2].y)/2;for(let t=1;t<o;t++){var l,u=this._e(r,n,s[t-1],s[t]);if(u.isintersect){if(null!=a.start)return a.end=u.point,a.isintersect=!0,a.outer="end",l=this.Ve({x:e-s[0].x,y:i-s[0].y},{x:n.x-s[0].x,y:n.y-s[0].y}),a.type=0<(l=l<180?l:l-360)?2:3,a;if(null!=a.end)return a.start=u.point,a.isintersect=!0,a.outer="start",l=this.Ve({x:e-s[0].x,y:i-s[0].y},{x:r.x-s[0].x,y:r.y-s[0].y}),a.type=0<(l=l<180?l:l-360)?2:3,a;h.push(u)}}var t,c=this._e(r,n,s[0],s[o-1]);if(c.isintersect){if(null!=a.start)return a.end=c.point,a.isintersect=!0,a.outer="end",t=this.Ve({x:e-s[0].x,y:i-s[0].y},{x:n.x-s[0].x,y:n.y-s[0].y}),a.type=0<(t=t<180?t:t-360)?2:3,a;if(null!=a.end)return a.start=c.point,a.isintersect=!0,a.outer="start",t=this.Ve({x:e-s[0].x,y:i-s[0].y},{x:r.x-s[0].x,y:r.y-s[0].y}),a.type=0<(t=t<180?t:t-360)?2:3,a;h.push(c)}2!=h.length||this.distanceOfTwoPoints(h[0].point,h[1].point)<.01||(this.distanceOfTwoPoints(h[0].point,r)<=this.distanceOfTwoPoints(h[0].point,n)?(a.start=h[0].point,a.end=h[1].point):(a.start=h[1].point,a.end=h[0].point),a.isintersect=!0,a.type=4)}return a},ei(e,i,r){var n=r.length,s={isintersect:!1,start:null,end:null},o=[];if(this.$e(e,r)&&(s.start=e),this.$e(i,r)&&(s.end=i),null!=s.start&&null!=s.end)s.isintersect=!0;else{for(let t=1;t<n;t++){var a=this._e(e,i,r[t-1],r[t]);if(a.isintersect){if(null!=s.start)return s.end=a.point,s.isintersect=!0,s;if(null!=s.end)return s.start=e,s.isintersect=!0,s;o.push(a)}}var t=this._e(e,i,r[0],r[n-1]);if(t.isintersect){if(null!=s.start)return s.end=t.point,s.isintersect=!0,s;if(null!=s.end)return s.start=e,s.isintersect=!0,s;o.push(t)}2==o.length&&(s.start=(this.distanceOfTwoPoints(o[0].point,e)<=this.distanceOfTwoPoints(o[0].point,i)?o[0]:o[1]).point,s.end=(this.distanceOfTwoPoints(o[0].point,e)>this.distanceOfTwoPoints(o[0].point,i)?o[0]:o[1]).point,s.isintersect=!0)}return s},ii(n,t){if(0==t.length)return[n];var e,i,r=this.ri(t),s=[];r.sort(function(t,e){var i=(t.ni.x-n.ni.x)*(t.ni.x-n.ni.x)+(t.ni.y-n.ni.y)*(t.ni.y-n.ni.y),r=(e.ni.x-n.ni.x)*(e.ni.x-n.ni.x)+(e.ni.y-n.ni.y)*(e.ni.y-n.ni.y),t=(t.si.x-n.ni.x)*(t.si.x-n.ni.x)+(t.si.y-n.ni.y)*(t.si.y-n.ni.y),e=(e.si.x-n.ni.x)*(e.si.x-n.ni.x)+(e.si.y-n.ni.y)*(e.si.y-n.ni.y);return(i<t?i:t)<(r<e?r:e)});let o=0;for(o=0;o<r.length;o++)this.distanceOfTwoPoints(r[o].ni,r[o].si)<.01||(e=this.distanceOfTwoPoints(r[o].ni,n.ni),i=this.distanceOfTwoPoints(r[o].si,n.ni),e<.01?n.ni=r[o].si:i<.01?n.ni=r[o].ni:e<i?.1<this.distanceOfTwoPoints(n.ni,r[o].ni)&&(s.push({oi:n.oi,ni:n.ni,si:r[o].ni,Se:n.Se,ai:n.ai}),n.ni=r[o].si):.1<this.distanceOfTwoPoints(n.ni,r[o].si)&&(s.push({oi:n.oi,ni:n.ni,si:r[o].si,Se:n.Se,ai:n.ai}),n.ni=r[o].ni),r.splice(o,1));return.1<this.distanceOfTwoPoints(n.ni,n.si)&&s.push(n),s},ri(t){var e=[];if(1==t.length)return t;let i=t[0],r=1;for(;0<t.length;){if(r>=t.length){if(e.push(i),t.splice(0,1),t.length<1)break;i=t[0],r=1}if(1===t.length){e.push(i);break}this.be(i.ni,i.si,t[r].ni)?(this.be(i.ni,i.si,t[r].si)||(i.si=t[r].si),t.splice(r,1)):this.be(i.ni,i.si,t[r].si)?(i.ni=t[r].ni,t.splice(r,1)):this.be(t[r].ni,t[r].si,i.ni)?(i=(this.be(t[r].ni,t[r].si,i.si)||(t[r].si=i.si),t[r]),t.splice(r,1)):this.be(t[r].ni,t[r].si,i.si)?(t[r].ni=i.ni,i=t[r],t.splice(r,1)):r++}return e},be(t,e,i){let r=t.x-i.x,n=t.y-i.y,s=e.x-i.x,o=e.y-i.y;var a=this.distanceOfTwoPoints(t,i),i=this.distanceOfTwoPoints(e,i),t=this.distanceOfTwoPoints(t,e);return r*o-n*s<1e-5&&a+i-t<.001},li(t,e,i){let r=e.x-t.x,n=e.y-t.y;t=Math.sqrt(r*r+n*n);return{x:e.x+r/t*i,y:e.y+n/t*i}},ui(e){let i=null,r=0,t=0,n=0;for(let t=0;t<e.length;t++)(null===i||e[t].x>i)&&(i=e[t].x,r=t);var s=new Lt(e[r].x,e[r].y,0),o=(t=0===r?e.length-1:r-1,n=r===e.length-1?0:r+1,new Lt(e[t].x,e[t].y,0)),a=new Lt(e[n].x,e[n].y,0),o=(new Lt).copy(s).sub(o),a=(new Lt).copy(a).sub(s);return 0<o.cross(a).z}});let U=new Qn;class $n{constructor(){this.ci={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.fi={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}get min(){return this.ci}get max(){return this.fi}get center(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=(this.min.x+this.max.x)/2,t.y=(this.min.y+this.max.y)/2),t}get size(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=this.max.x-this.min.x,t.y=this.max.y-this.min.y),t}copy(t){return this.fi.x=t.max.x,this.fi.y=t.max.y,this.ci.x=t.min.x,this.ci.y=t.min.y,this}clone(){return(new $n).copy(this)}reset(){this.ci={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.fi={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}toObject(){return{min:this.min,max:this.max,center:this.center,size:this.size}}expand(t){this.di(t)}expandByCoords(t){this.vi(t)}valid(){return this.pi()}isCross(t){let e=!0;return t.max.x<this.min.x&&(e=!1),t.min.x>this.max.x&&(e=!1),t.max.y<this.min.y&&(e=!1),e=t.min.y>this.max.y?!1:e}}Object.assign($n.prototype,{pi(){return!(this.min.x>this.max.x||this.min.y>this.max.y)},di(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y)&&(this.max.y=t.max.y)},vi(t){t&&0!=t.length&&t.forEach(t=>{t.x<this.min.x&&(this.min.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.x>this.max.x&&(this.max.x=t.x),t.y>this.max.y&&(this.max.y=t.y)})}});class ts extends un{constructor(t,e){super(t,e),this.mi=new $n,this.gi=null}}Object.assign(ts.prototype,{le(t){return t.getType()!=cn.MODEL?this._i(t):this.bi(t)},bi(t){return!0},yi(t){t=t.getBound();return!!U.ye(this.mi.ci,this.mi.fi,t.min,t.max)},ue(t,e){var n=t.getCoordinates();if(t.getType()!==cn.MODEL)e.Se=Math.sqrt(U.Ae(n[0],this.wi));else{let r=Number.MAX_VALUE;for(let i=0,t=n.length;i<t;i++)for(let t=1,e=n[i].length;t<e;t++){var s=n[i][t-1],o=n[i][t],s=U.Oe(this.wi,s,o);r>s&&(r=s)}e.Se=Math.sqrt(r)}},_i(t){t=t.getCoordinates()[0];return!!U.xe(t,this.mi.ci,this.mi.fi)&&("circle"===this.gi?U.Ae(t,this.wi)<this._radiusSquare:U.Le(t,this.xi,this.xi.length-1))}});class es extends ts{constructor(t,e){super(t,e),this.gi="polygon",this.xi=this.he,this.Mi=this.xi.length-1,this.wi=U.Ne(this.xi),this.mi.vi(this.xi)}}Object.assign(es.prototype,{bi(t){if(this.yi(t)){var s=t.getCoordinates();for(let i=0,t=s.length;i<t;i++)for(let t=0,e=s[i].length-1;t<e;t++)if(U.Le(s[i][t],this.xi,this.xi.length))return!0;for(let r=0;r<this.Mi;r++){let i=!1;for(let t=0,e=s.length;t<e;t++)U.Le(this.xi[r],s[t],s[t].length-1)&&(i=0==t);if(i)return!0}for(let t=0;t<=this.Mi;t++){let r=null,n=null;n=t===this.Mi?(r=this.xi[0],this.xi[t]):(r=this.xi[t],this.xi[t+1]);for(let i=0,t=s.length;i<t;i++)for(let t=0,e=s[i].length-1;t<e;t++){var o=s[i][t],a=s[i][t+1];if(U.we(r,n,o,a))return!0}}}return!1}});var is="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function rs(t){return t&&t.t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ns={exports:{}},ss=(ns.exports,(()=>{function e(t){return 180*t/Math.PI}function c(t){return e(Math.atan2(t[1][1]-t[0][1],t[1][0]-t[0][0]))}function f(t,e){return(t=>{if(Array.isArray(t))return t})(t)||((t,e)=>{var i=[],r=!0,n=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,s=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}return i})(t,e)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance")})()}function r(t){return(t=>{if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}})(t)||(t=>{if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)})(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance")})()}function d(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=f(t,2),i=f(t[0],2),r=i[0],n=i[1],i=f(t[1],2),s=i[0],o=i[1];return function(t){t=e?t<0?0:1<t?1:t:t;return[(s-r)*t+r,(o-n)*t+n]}}function v(t){return Math.sqrt(Math.pow(t[1][0]-t[0][0],2)+Math.pow(t[1][1]-t[0][1],2))}function n(t){return[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]}function s(t){return t/180*Math.PI}function o(t,e,i){e=s(e||0);return!i||0===i[0]&&0===i[1]?a(t,e):a(t.map(function(t,e){return t-i[e]}),e).map(function(t,e){return t+i[e]})}function a(t,e){return[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[0]*Math.sin(e)+t[1]*Math.cos(e)]}function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,e=s(e);return[t[0]+i*Math.cos(e),t[1]+i*Math.sin(e)]}function l(t){for(var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=0,r=0,n=t.length;r<n;r++)var s=t[r],o=t[r===n-1?0:r+1],i=(i+=s[0]*o[1])-o[0]*s[1];return e?i/2:Math.abs(i/2)}function m(t){if(t.length<3)return null;for(var e=1/0,i=-1/0,r=1/0,n=-1/0,s=!1,o=0,a=t.length;o<a;o++){var h=t[o],l=h[0],h=h[1];null!=l&&isFinite(l)&&null!=h&&isFinite(h)&&(s=!0,l<e&&(e=l),i<l&&(i=l),h<r&&(r=h),n<h)&&(n=h)}return s?[[e,r],[i,n]]:null}function u(t){for(var e=0,i=0,r=0,n=t.length,s=0;s<n;s++){var o=t[s],a=t[s===n-1?0:s+1],h=o[0]*a[1]-a[0]*o[1];e+=h,i+=(o[0]+a[0])*h,r+=(o[1]+a[1])*h}var l=3*e;return[i/l,r/l]}function h(t,e,i){return(t[0]-i[0])*(e[1]-i[1])-(t[1]-i[1])*(e[0]-i[0])}function g(t){return i=(e=t)[0],e=e[e.length-1],i[0]===e[0]&&i[1]===e[1]?t:[].concat(r(t),[t[0]]);var e,i}function _(t){if(0===t.length)return 0;for(var e,i,r=-1,n=t.length,s=t[n-1],o=s[0],a=s[1],h=0;++r<n;)e=o,i=a,e-=o=(s=t[r])[0],i-=a=s[1],h+=Math.sqrt(e*e+i*i);return h}function b(t,e,i){i=i||u(t);for(var r=[],n=0,s=t.length;n<s;n++){var o=t[n],a=v([i,o]),o=c([i,o]);r[n]=p(i,o,a*Math.sqrt(e))}return r}function y(t,e,i){for(var r=[],n=0,s=t.length;n<s;n++)r[n]=p(t[n],e,i);return r}function w(t,e,i){for(var r=e,n=e,s=[],o=1;o<t.length-1;o++){var a=t[o];.5<Math.random()?(s.push(a-r),r=a):(s.push(n-a),n=a)}return s.push(i-r),s.push(n-i),s}function i(t){return t[1][1]>t[0][1]?t:[t[1],t[0]]}function x(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=v(e);return M(t,e,i)&&v([e[0],t])<=r&&v([e[1],t])<=r}function M(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Math.abs(h(t,e[0],e[1]))<=i}function E(t,e){var i=f(t,2),r=f(i[0],2),n=r[0],r=r[1],i=f(i[1],2),s=i[0],i=i[1],o=f(e,2),a=f(o[0],2),h=a[0],a=a[1],o=f(o[1],2),l=o[0],o=o[1];return n===h&&r===a||s===l&&i===o||!!(x(t[0],e)||x(t[1],e)||x(e[0],t)||x(e[1],t))||0!=(e=(o-a)*(s-n)-(l-h)*(i-r))&&(i=((s-n)*(t=r-a)-(i-r)*(s=n-h))/e,0<(r=((l-h)*t-(o-a)*s)/e))&&r<1&&0<i&&i<1}function L(t,e){for(var i=!1,r=g(e),n=0,s=r.length-1;n<s;n++){var o=r[n],a=r[n+1];if(E(t,[o,a])||x(o,t)&&x(a,t)){i=!0;break}}return i}function T(t,e){for(var i=t[0],r=t[1],n=!1,s=0,o=e.length-1;s<e.length;o=s++){var a=e[s][0],h=e[s][1],l=e[o][0],u=e[o][1];r<h!=r<u&&i<(l-a)*(r-h)/(u-h)+a&&(n=!n)}return n}function S(t,e){for(var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=!1,n=g(e),s=0,o=n.length-1;s<o;s++)if(x(t,[n[s],n[s+1]],i)){r=!0;break}return r}var t;(t=ns.exports).lineAngle=c,t.lineInterpolate=d,t.lineLength=v,t.lineMidpoint=n,t.lineRotate=function(e,i,r){return e.map(function(t){return o(t,i,r||n(e))})},t.lineTranslate=function(t,e,i){return t.map(function(t){return p(t,e,i)})},t.pointRotate=o,t.pointTranslate=p,t.polygonArea=l,t.polygonBounds=m,t.polygonCentroid=u,t.polygonHull=function(t){if(t.length<3)return null;for(var e=t.slice().sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),i=[],r=0;r<e.length;r++){for(;2<=i.length&&h(i[i.length-2],i[i.length-1],e[r])<=0;)i.pop();i.push(e[r])}for(var n=[],s=e.length-1;0<=s;s--){for(;2<=n.length&&h(n[n.length-2],n[n.length-1],e[s])<=0;)n.pop();n.push(e[s])}return n.pop(),i.pop(),i.concat(n)},t.polygonInterpolate=function(u){return function(t){if(t<=0)return u[0];var e=g(u);if(1<=t)return e[e.length-1];for(var i=_(e)*t,r=[],n=0,s=0;s<e.length-1;s++){var o=[e[s],e[s+1]],a=v(o),h=c(o),l=i-(n+=a);if(l<0){r=p(o[0],h,a+l);break}s===u.length-2&&(r=p(o[0],h,l))}return r}},t.polygonLength=_,t.polygonMean=function(t){for(var e=0,i=0,r=t.length,n=0;n<r;n++){var s=t[n];e+=s[0],i+=s[1]}return[e/r,i/r]},t.polygonRandom=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0,0],r=Math.sqrt(e/Math.PI),n=Array.from({length:t},function(){return 2*r*Math.random()}),t=Array.from({length:t},function(){return 2*r*Math.random()}),n=(n.sort(function(t,e){return t-e}),t.sort(function(t,e){return t-e}),w(n,n[0],n[n.length-1])),s=w(t,t[0],t[t.length-1]),o=((t=>{for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),r=[t[i],t[e]];t[e]=r[0],t[i]=r[1]}})(s),[]),a=0,h=0,t=(n.map(function(t,e){return[t,s[e]]}).sort(function(t,e){return Math.atan2(e[1],e[0])-Math.atan2(t[1],t[0])}).forEach(function(t){a+=+t[0],h+=+t[1],o.push([a,h])}),u(o));return y(b(o,e/l(o)),c([t,i]),v([t,i]))},t.polygonReflectX=function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=f(m(t),2),r=f(i[0],2),n=r[0],r=f(i[1],2),s=r[0],o=[],a=0,h=t.length;a<h;a++){var l=f(t[a],2),u=l[0],l=l[1],c=[n+s-u,l];0===e?o[a]=[u,l]:1===e?o[a]=c:(u=d([[u,l],c]),o[a]=u(Math.max(Math.min(e,1),0)))}return o},t.polygonReflectY=function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=f(m(t),2),r=f(i[0],2),n=(r[0],r[1]),r=f(i[1],2),s=(r[0],r[1]),o=[],a=0,h=t.length;a<h;a++){var l=f(t[a],2),u=l[0],l=l[1],c=[u,n+s-l];0===e?o[a]=[u,l]:1===e?o[a]=c:(u=d([[u,l],c]),o[a]=u(Math.max(Math.min(e,1),0)))}return o},t.polygonRegular=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=2<arguments.length?arguments[2]:void 0,r=[],n=[0,0],s=[0,0],o=0,a=0;a<t;a++)r[a]=n,s[0]+=n[0],s[1]+=n[1],n=p(n,o,Math.sqrt(4*e*Math.tan(Math.PI/t)/t)),o-=360/t;i&&(r=y(r,c(i=[[s[0]/t,s[1]/t],i]),v(i)));return r},t.polygonRotate=function(t,e,i){for(var r=[],n=0,s=t.length;n<s;n++)r[n]=o(t[n],e,i);return r},t.polygonScale=function(t,e,i){i=i||u(t);for(var r=[],n=0,s=t.length;n<s;n++){var o=t[n],a=v([i,o]),o=c([i,o]);r[n]=p(i,o,a*e)}return r},t.polygonScaleArea=b,t.polygonScaleX=function(t,e,i){i=i||u(t);for(var r=[],n=0,s=t.length;n<s;n++){var o=t[n],a=v([i,o]),h=c([i,o]),h=p(i,h,a*e);r[n]=[h[0],o[1]]}return r},t.polygonScaleY=function(t,e,i){i=i||u(t);for(var r=[],n=0,s=t.length;n<s;n++){var o=t[n],a=v([i,o]),h=c([i,o]),h=p(i,h,a*e);r[n]=[o[0],h[1]]}return r},t.polygonTranslate=y,t.polygonWind=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"ccw";if(t.length<3)return null;var i=t.slice().reverse(),r=0<l(t,!0);return"cw"===e||"clockwise"===e?r?t:i:r?i:t},t.lineIntersectsLine=E,t.lineIntersectsPolygon=L,t.pointInPolygon=T,t.pointOnPolygon=S,t.pointLeftofLine=function(t,e){e=i(e);return h(t,e[1],e[0])<0},t.pointRightofLine=function(t,e){e=i(e);return 0<h(t,e[1],e[0])},t.pointOnLine=x,t.pointWithLine=M,t.polygonInPolygon=function(t,e){for(var i=!0,r=g(t),n=0,s=r.length-1;n<s;n++){var o=r[n];if(!T(o,e)){i=!1;break}if(L([o,r[n+1]],e)){i=!1;break}}return i},t.polygonIntersectsPolygon=function(t,e){for(var i=!1,r=0,n=g(t),s=0,o=n.length-1;s<o;s++){var a=n[s],h=n[s+1];if(L([a,h],e)){i=!0;break}if(S(a,e)&&++r,2===r){i=!0;break}}return i},t.angleReflect=function(t,e){e=2*e-t;return 360<=e?e-360:e<0?360+e:e},t.angleToDegrees=e,t.angleToRadians=s,Object.defineProperty(t,"t",{value:!0})})(),ns.exports);let os={STOP:0,PASS:1,PUSH:2};Object.freeze(os);class as{constructor(){this.Ht=-1,this.Ei=cn.NONE,this.Li=null,this.mi=null}getType(){return this.Ei}getCoordinates(){return this.Li}getBound(){return this.mi||this.Ti(),this.mi}}Object.assign(as.prototype,{Kt(){},Si(t){t._support(this)==os.PUSH&&t._result.push(this)}});class hs extends as{constructor(t){super(),this.Ht=t.eid,this.Ei=cn.POLYGON,Object.assign(this,t)}getCenter(){return this.wi}}Object.assign(hs.prototype,{Ti(){this.mi=new $n,this.Li&&this.Li.forEach(t=>{this.mi.vi(t)})},Si(t){t._support(this)==os.PUSH&&t._result.push(this)}});let ls={NO_RIGHT_CLICK:2,NORMAL:4};Object.freeze(ls);class us{constructor(t,e,i){this.R=t,this.P=i,this.St=[295829355.45,147914677.73,73957338.86,36978669.43,18489334.72,9244667.36,4622333.68,2311166.84,1155583.42,577791.71,288895.85,144447.93,72223.96,36111.98,18056,9028,4514,2257,1128,564,282,141,70,35,17,8,4,2,1],this.I=[],this.Ai=new Map,this.Jt=null,this.Oi=this.P.Ci,this.Ct=null,this.O=new zr(this.R.ft,e,this.R),this.O.enableDamping=this.R.Ri.enableDamping,this.O.dampingFactor=.08,this.R.Ri.mouseMode===ls.NO_RIGHT_CLICK&&this.O.setMouseMiddleButtonRotation(),this.Ni=null,this.O.addEventListener("change",()=>{this.$(),this.R.Yt.Wt({type:"viewChanged"}),this.R.A.Di=1,null!==this.Ni&&clearTimeout(this.Ni),this.Ni=setTimeout(()=>{this.R.A.Di=0,this.R.enableUpdateRender()},10)}),this.ki=new ln(this.O,this.R.Pi,this.R.At);t=!this.R.Ri.lock;this.O.enableZoom=t,this.O.enablePan=t,this.O.enableRotate=t,this.O.enableRotateLeft=t,this.O.enableRotateUp=t,this.Ii=t,this.Fi=t,this.ji=t,this.Gi=t,this.Ui=this.O.useRange,this.Hi={},this.Bi=this.Bi.bind(this)}get enableZoom(){return this.Ii}set enableZoom(t){this.Ii=t,this.O.enableZoom=t}get enableDragRange(){return this.Ui}set enableDragRange(t){this.Ui=t}get enableDrag(){return this.Fi}set enableDrag(t){this.Fi=t,this.O.enablePan=t}get enableRotate(){return this.ji}set enableRotate(t){this.ji=t,this.O.enableRotateLeft=t}get enableTilt(){return this.Gi}set enableTilt(t){this.Gi=t,this.O.enableRotateUp=t}get enableDamping(){return this.O.enableDamping}set enableDamping(t){this.O.enableDamping=t}get controls(){return this.O}set controls(t){this.O=t}get autoCameraNearFar(){return this.ki}get mouseMode(){return this.R.Ri.mouseMode}set zoomSpeed(t){this.O.zoomSpeedParam=t}get zoomSpeed(){return this.O.zoomSpeedParam}copyControls(t){t=new zr(t,this.O.domElement,this.R);return t.target=(new Lt).copy(this.O.target),t.maxDistance=this.O.maxDistance,t.minDistance=this.O.minDistance,t.minZoom=this.O.minZoom,t.maxZoom=this.O.maxZoom,t.minPolarAngle=this.O.minPolarAngle,t.maxPolarAngle=this.O.maxPolarAngle,t.update({theta:this.O.getAzimuthalAngle()}),t}pauseDamping(){this.O&&this.O.pauseDamping()}resumeDamping(){this.O&&this.O.pauseDamping()}}Object.assign(us.prototype,{Kt(){for(var t in clearTimeout(this.Ni),this.O.dispose(),this)this[""+t]=null,delete this[""+t]},zi(){var t,e=this.yt(this.P.zoom),i=this.wt(e),r=this.P.wi,n=this.R.Vt.Vi(this.R.S.Ht,this.R.S.level);n?(r.y=n.T,this.O.target=(new Lt).copy(r),this.O.object.lookAt(r),this.Tt(),this.P.Ci===Vr.MODE_3D?(n=(l.TILT_UPPER_BOUND-this.P.Wi)*l.DEG2RAD,t=i*Math.cos(n),n=i*Math.sin(n),this.O.object.position.set(r.x,r.y+t,r.z+n),this.O.minPolarAngle=(l.TILT_UPPER_BOUND-this.R.Ri.maxTiltAngle)*l.DEG2RAD,this.O.maxPolarAngle=(l.TILT_UPPER_BOUND-this.R.Ri.minTiltAngle)*l.DEG2RAD):(t=this.xt(e),this.O.minPolarAngle=0,this.O.maxPolarAngle=0,this.O.object.position.set(r.x,r.y+i,r.z),this.O.object.zoom=1/t,this.O.object.updateProjectionMatrix()),n=this.kt(this.P.Yi),this.O.update({theta:this.O.getAzimuthalAngle()+n})):(e={type:"info",InfoMode:Wr.DEFAULT_LEVEL_ERROR},this.R.Xi.error.push(e),this.R.Yt.Wt(e))},Zi(t){this.O.target=t,this.O.update()},qi(r){if(this.Oi===r.mode)r.mode===this.R.getViewMode()&&r.finish&&r.finish();else{this.Oi=r.mode;let i=this.O,t=r.duration;var e,n;void 0===t&&(t=1),this.Ct&&!1===this.Ct.J&&this.Ct.finish(),r.mode===Vr.MODE_2D?(i.minPolarAngle=-90*l.DEG2RAD,this.P.Wi=this.R.getTilt(),this.Ot({animate:void 0===r.animate||r.animate,duration:t,tilt:90,finish:()=>{i.maxPolarAngle=0;var t=this.R.At,e=this.dt(),e=this.xt(e);t.quaternion.copy(i.object.quaternion),t.position.copy(i.object.position),t.zoom=1/e,t.updateProjectionMatrix(),i.object=t,i.update(),this.R.ft=t,this.R.A.Mt(),this.R.Yt.Wt({type:"viewModeChanged"}),r.finish&&r.finish()}})):r.mode===Vr.MODE_3D&&(i.maxPolarAngle=(l.TILT_UPPER_BOUND-this.R.Ri.minTiltAngle)*l.DEG2RAD,e=this.R.Pi,n=this.vt(),n=this.wt(n),e.quaternion.copy(i.object.quaternion),e.position.copy(i.object.position),e.position.setY(i.target.y+n),e.updateMatrix(),i.object=e,i.update(),this.R.ft=e,this.R.A.Mt(),this.Ot({animate:void 0===r.animate||r.animate,duration:t,tilt:this.P.Wi,finish:r.finish}),this.R.Yt.Wt({type:"viewModeChanged"}))}},ut(t){this.I.push(...t)},$(){for(let t=0;t<this.I.length;t++)this.I[t].call(this.R.A)},D(){try{let e=!1;var t=this.R.camera,i=this.R.getBuilding(this.P.k),r=i.getFloor(i.level),n=r.getLayers(p.EXTENT_LAYER)[0];if(this.R.Ri.panRangeValue){var s,o,a,h,l=new Ut;l.setFromProjectionMatrix((new Tt).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse));let e=null;for(let t=0;t<n.I.length;t++)n.I[t].Ji&&(e=n.I[t].Ji);return null===e?!1:(s=e.geometry.boundingSphere,(o=new Dt).copy(s).applyMatrix4(e.matrixWorld),h=new Dt(new Lt((a=this.R.Ri.panRangeValue).center.x-this.R.x,o.center.y,this.R.y-a.center.y),a.radius),l.intersectsSphere(h))}var u=[],c=this.R.Ri.container.clientWidth,f=this.R.Ri.container.clientHeight,d=(u.push(st.coordsScreenToMap(this.R,{x:0,y:0,level:r.level,buildingID:i.Ht})),u.push(st.coordsScreenToMap(this.R,{x:c,y:0,level:r.level,buildingID:i.Ht})),u.push(st.coordsScreenToMap(this.R,{x:c,y:f,level:r.level,buildingID:i.Ht})),u.push(st.coordsScreenToMap(this.R,{x:0,y:f,level:r.level,buildingID:i.Ht})),new es("polygon",u));for(let t=0;t<n.I.length;t++){var v=(e=>{var i=[];for(let t=0;t<e.length;t++)i.push([e[t].x,e[t].y]);var r=ss.polygonScale(i,.9),n=[];for(let t=0;t<r.length;t++)n.push({x:r[t][0],y:r[t][1]});return new hs({eid:"1",Li:[n]})})(n.I[t].Ki.Li[0]);if(d.bi(v)){e=!0;break}}return e}catch(t){return!0}},Bi(){if(this.Hi.counter<this.Hi.num){var e=(new Date).getTime();let t=e-this.Hi.frameTime;this.Hi.counter+t>this.Hi.num&&(t=this.Hi.num-this.Hi.counter);var i=this.Hi.num-this.Hi.counter,r=(this.Hi.targetX-this.O.target.x)/i,n=(this.Hi.targetZ-this.O.target.z)/i,s=this.yt(this.Hi.state.zoom),o=this.wt(s),a=this.O.object.position.distanceTo(this.O.target),h=(new Lt).copy(this.O.object.position).sub(this.O.target).normalize(),h=(new Lt).copy(h).multiplyScalar(o-a),o=(this.O.panAdd({x:r*t,y:0,z:n*t}),this.O.getAzimuthalAngle()),a=(l.TILT_UPPER_BOUND-(this.Hi.tilt+t*this.Hi.perTilt))*l.DEG2RAD;this.Hi.tilt=this.Hi.tilt+t*this.Hi.perTilt,"OrthographicCamera"===this.R.ft.type&&(n=(r=this.vt())+(s-r)/i*t,s=this.xt(n),this.R.ft.zoom=1/s,this.R.ft.updateProjectionMatrix(),this.R.Et()),this.O.update({offset:new Lt(h.x/i*t,h.y/i*t,h.z/i*t)}),this.O.update({theta:o+this.Hi.disRotation*t}),this.O.update({phi:a}),this.R.A.Mt(),this.Hi.counter=this.Hi.counter+t,this.Hi.frameTime=e}else this.R.lt.Qi(this.Bi),"2d"===this.Hi.modeUpdateType&&this.R.setViewMode({mode:this.Hi.state.viewMode,animate:!1}),this.R.setVisibleLevels(this.Hi.state.visibleLevels,()=>{let e=this.Hi.state.focusBuildingState;if(null===e&&this.R.setLevel({level:this.Hi.state.level,animate:!0,finish:()=>{this.Hi.options.finish&&this.Hi.options.finish()}}),this.R.Zt=this.R.getMapOptions().followFocus,null!==e){let t=this.R.getBuilding(e.buildingID);e.buildingID===this.Hi.state.viewBuildingID&&this.Hi.state.viewBuildingID!==this.R.P.k?t.setVisibleLevels(e.visibleLevels,()=>{t.setLevel({level:e.level,animate:!1,finish:()=>{this.R.enterBuilding({buildingID:this.Hi.state.viewBuildingID,noCenter:!0,finish:()=>{this.Hi.options.finish&&this.Hi.options.finish()}})}})}):t.setVisibleLevels(e.visibleLevels,()=>{t.setLevel({level:e.level,animate:!0,finish:()=>{this.Hi.options.finish&&this.Hi.options.finish()}})})}}),this.resumeDamping()},$i(t,e,i){this.R.lt.Qi(this.Bi),this.pauseDamping(),null!==t.focusBuildingState?this.R.P.k!==this.R.getMapOptions().mapID&&this.R.exitBuilding({buildingID:this.R.P.k,noCenter:!0,finish:()=>{this.R.setLevel({level:t.level,animate:!1})}}):this.R.P.k!==this.R.getMapOptions().mapID?this.R.exitBuilding({buildingID:this.R.P.k,noCenter:!0,finish:()=>{this.R.setLevel({level:t.level,animate:!1})}}):null!==i.focusBuildingState&&this.R.exitBuilding({buildingID:i.focusBuildingState.buildingID,noCenter:!0,finish:()=>{this.R.setLevel({level:t.level,animate:!1})}}),this.R.Zt=!1,this.Hi={},this.Hi.options=e,this.Hi.targetX=t.center.x-this.R.x,this.Hi.targetZ=-t.center.y+this.R.y,this.Hi.num=1e3*e.duration,this.Hi.counter=0;var r,i=this.kt(t.rotation,!0),e=(this.Hi.disRotation=i/this.Hi.num,t.tiltAngle=Et.clamp(t.tiltAngle,this.R.Ri.minTiltAngle,this.R.Ri.maxTiltAngle),this.Hi.state=t,this.R.getTilt()),i=(t.tiltAngle-e)/this.Hi.num;this.Hi.tilt=e,this.Hi.perTilt=i;let n="no";this.R.getViewMode()!==t.viewMode&&(t.viewMode===Vr.MODE_3D?(n="3d",this.O.maxPolarAngle=(l.TILT_UPPER_BOUND-this.R.Ri.minTiltAngle)*l.DEG2RAD,i=this.R.Pi,r=this.vt(),r=this.wt(r),i.quaternion.copy(this.O.object.quaternion),i.position.copy(this.O.object.position),i.position.setY(this.O.target.y+r),i.updateMatrix(),this.O.object=i,this.O.update(),this.R.ft=i,this.Oi=Vr.MODE_3D):(n="2d",this.Hi.perTilt=(90-e)/this.Hi.num)),this.Hi.frameTime=(new Date).getTime(),this.Hi.modeUpdateType=n,this.R.getFloorSpace()!==t.floorSpace&&this.R.setFloorSpace(t.floorSpace),this.R.lt.tr(this.Bi)}}),rn(us),nn(us),sn(us);var cs=new Lt,fs=new Lt,ds=new Lt,vs=new Lt,ps=new Lt,ms=new Lt,gs=new Lt;function _s(t,e){this.origin=void 0!==t?t:new Lt,this.direction=void 0!==e?e:new Lt(0,0,-1)}function bs(t,e,i,r){this.ray=new _s(t,e),this.near=i||0,this.far=r||1/0,this.camera=null,this.layers=new R,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ys(t,e){return t.distance-e.distance}function ws(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===r)for(var n=t.children,s=0,o=n.length;s<o;s++)ws(n[s],e,i,!0)}Object.assign(_s.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Lt),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,cs)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Lt),e.subVectors(t,this.origin);t=e.dot(this.direction);return t<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=cs.subVectors(t,this.origin).dot(this.direction);return(e<0?this.origin:(cs.copy(this.direction).multiplyScalar(e).add(this.origin),cs)).distanceToSquared(t)},distanceSqToSegment:function(t,e,i,r){fs.copy(t).add(e).multiplyScalar(.5),ds.copy(e).sub(t).normalize(),vs.copy(this.origin).sub(fs);var n,s,o,t=.5*t.distanceTo(e),e=-this.direction.dot(ds),a=vs.dot(this.direction),h=-vs.dot(ds),l=vs.lengthSq(),u=Math.abs(1-e*e);return u=0<u?(s=e*a-h,o=t*u,0<=(n=e*h-a)?-o<=s?s<=o?(n*=u=1/u)*(n+e*(s*=u)+2*a)+s*(e*n+s+2*h)+l:(s=t,-(n=Math.max(0,-(e*s+a)))*n+s*(s+2*h)+l):(s=-t,-(n=Math.max(0,-(e*s+a)))*n+s*(s+2*h)+l):s<=-o?-(n=Math.max(0,-(-e*t+a)))*n+(s=0<n?-t:Math.min(Math.max(-t,-h),t))*(s+2*h)+l:s<=o?(n=0,(s=Math.min(Math.max(-t,-h),t))*(s+2*h)+l):-(n=Math.max(0,-(e*t+a)))*n+(s=0<n?t:Math.min(Math.max(-t,-h),t))*(s+2*h)+l):(s=0<e?-t:t,-(n=Math.max(0,-(e*s+a)))*n+s*(s+2*h)+l),i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(ds).multiplyScalar(s).add(fs),u},intersectSphere:function(t,e){cs.subVectors(t.center,this.origin);var i=cs.dot(this.direction),r=cs.dot(cs)-i*i,t=t.radius*t.radius;return t<r||(r=i+(t=Math.sqrt(t-r)),(i=i-t)<0&&r<0)?null:i<0?this.at(r,e):this.at(i,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0===e?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/e)?t:null},intersectPlane:function(t,e){t=this.distanceToPlane(t);return null===t?null:this.at(t,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,r,n,s=1/this.direction.x,o=1/this.direction.y,a=1/this.direction.z,h=this.origin,s=0<=s?(i=(t.min.x-h.x)*s,(t.max.x-h.x)*s):(i=(t.max.x-h.x)*s,(t.min.x-h.x)*s),o=0<=o?(n=(t.min.y-h.y)*o,(t.max.y-h.y)*o):(n=(t.max.y-h.y)*o,(t.min.y-h.y)*o);return o<i||s<n||((i<n||i!=i)&&(i=n),(o<s||s!=s)&&(s=o),(n=0<=a?(r=(t.min.z-h.z)*a,(t.max.z-h.z)*a):(r=(t.max.z-h.z)*a,(t.min.z-h.z)*a))<i)||s<r||((i<r||i!=i)&&(i=r),(s=n<s||s!=s?n:s)<0)?null:this.at(0<=i?i:s,e)},intersectsBox:function(t){return null!==this.intersectBox(t,cs)},intersectTriangle:function(t,e,i,r,n){ps.subVectors(e,t),ms.subVectors(i,t),gs.crossVectors(ps,ms);var s,e=this.direction.dot(gs);if(0<e){if(r)return null;s=1}else{if(!(e<0))return null;s=-1,e=-e}vs.subVectors(this.origin,t);i=s*this.direction.dot(ms.crossVectors(vs,ms));return i<0||(r=s*this.direction.dot(ps.cross(vs)))<0||e<i+r||(t=-s*vs.dot(gs))<0?null:this.at(t/e,n)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(bs.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,i){i=i||[];return ws(t,this,i,e),i.sort(ys),i},intersectObjects:function(t,e,i){var r=i||[];if(!1===Array.isArray(t))console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");else{for(var n=0,s=t.length;n<s;n++)ws(t[n],this,r,e);r.sort(ys)}return r}});let xs={CLASSIC:2,REAL:4};Object.freeze(xs);class Ms{constructor(){this.Ht=-1,this.Ei=p.NONE,this.er=!0,this.U=null,this.I=[],this.mi=new $n,this.ir=!0}get type(){return this.Ei}get visible(){return this.er}get children(){return this.I}set visible(t){this.er=t}get parent(){return this.U}set parent(t){this.U=t}get needUpdateBound(){return this.ir}set needUpdateBound(t){!0===(this.ir=t)&&null!==this.parent&&(this.parent.needUpdateBound=t)}get isLayer(){return!1}setType(t){this.Ei=t}traverse(e){if(this.I)for(let t=this.I.length-1;0<=t;t--)e(this.I[t])}remove(t){var e=this.I.indexOf(t);-1<e&&this.I.splice(e,1),t.parent=null,this.needUpdateBound=!0}dispose(){for(var t in this.traverse(t=>{this.remove(t),t.dispose()}),this.parent&&this.parent.remove(this),this)this[""+t]&&this[""+t].Kt&&this[""+t].Kt(),this[""+t]&&this[""+t].dispose&&this[""+t].dispose(),this[""+t]=null,delete this[""+t]}}Object.assign(Ms.prototype,{rr(t){let e=this;for(;e;){if(e instanceof t)return e;e=e.U}return null}});class Es extends Ms{constructor(t){super(),this.Ht=t.bid,this.nr=t.bcode,this.sr=t.mid,this.ar=t.name,this.hr=t.ename,this.lr=t.alias,this.o=t.x,this.u=t.y,this.ur=t.levels,this.cr=[],this.dr=!0}get type(){return this.Ei}get x(){return this.o}get y(){return this.u}get bound(){return!0===this.needUpdateBound&&(this.mi.reset(),void 0!==this.vr&&this.mi.copy(this.vr),this.I.forEach(t=>{this.mi.expand(t.bound)}),this.needUpdateBound=!1),this.mi.clone()}get buildingID(){return this.Ht}get bcode(){return this.nr}get name(){return this.ar}get eName(){return this.hr}get alias(){return this.lr}get floorSpace(){return this.U.P.Ut(this.Ht).floorSpace}set floorSpace(t){this.U.P.Ut(this.Ht).floorSpace=t,this.traverse(t=>{t.pr({animate:!1})}),this.U.C.qt(this,{level:this.level,animate:!1,finish:()=>{this.dr&&(this.parent.A.Mt(),this.parent.A.Bt(),this.parent.A.render())}})}get level(){return this.U.P.Ut(this.Ht).level}get visibleLevels(){return this.U.P.Ut(this.Ht).visibleLevels}getFloor(e){let i=null;return this.traverse(t=>{t.mr===e&&(i=t)}),i}getFloorInfos(){return this.gr()}setLevel(t){this.U.Vt._r(this,t)}setVisibleLevels(t,e){this.U.Vt.br({levels:t,building:this},e)}getVisibleLevels(){return this.visibleLevels}setFloorSpace(e){if(!("animate"in e)||e.animate){this.yr||(this.yr=new en);var i=Number.isFinite(e.duration)?e.duration:.5;let t=e.finish;return this.dr=!1,this.yr.Nt([this.floorSpace]).Rt([e.floorSpace]).ot(i).st(t=>{this.floorSpace=t.destination[0]}).nt(()=>{this.dr=!0,this.U.lt.ht(this.yr),t&&t()}),this.U.lt.ut(this.yr.et()),this.yr}this.floorSpace=e.floorSpace}getFloorSpace(){return this.floorSpace}}Object.assign(Es.prototype,{gr(){0===this.cr.length&&(t=this.U.Mr.wr.get(this.sr))&&(this.cr=[],t.I.forEach(t=>{this.cr.push(t)}));var t,i={alias:"alias",floorId:"floorID",gid:"level",gname:"name"},r=Object.keys(i),n=[];for(let e=0;e<this.cr.length;e++){var s=this.cr[e];n[e]={};for(let t=0;t<r.length;t++){var o=r[t],a=i[o];s[o]?n[e][a]=s[o]:n[e][a]=null}}return n}});class Ls{constructor(t,e,i){this.R=t,this.P=i,this.Ri=e,this.Er=[],this.Lr=null,this.Tr=tn.generateUUID(),this.Sr=new bs,this.Ar=new Lt,this.Or=0,this.Cr=0,this.$=this.$.bind(this),this.B=0,this.R.A.renderer.domElement.addEventListener("mousedown",this.$,!1),this.R.A.renderer.domElement.addEventListener("mouseup",this.$,!1),this.R.A.renderer.domElement.addEventListener("mousemove",this.$,!1),this.R.A.renderer.domElement.addEventListener("touchstart",this.$,!1),this.R.A.renderer.domElement.addEventListener("touchend",this.$,!1),this.R.A.renderer.domElement.addEventListener("touchmove",this.$,!1)}}Object.assign(Ls.prototype,{Kt(){for(var t in this.R.A.renderer.domElement.removeEventListener("mousedown",this.$,!1),this.R.A.renderer.domElement.removeEventListener("mouseup",this.$,!1),this.R.A.renderer.domElement.removeEventListener("touchstart",this.$,!1),this.R.A.renderer.domElement.removeEventListener("mousemove",this.$,!1),this.R.A.renderer.domElement.removeEventListener("touchmove",this.$,!1),this.R.A.renderer.domElement.removeEventListener("touchend",this.$,!1),delete this.R,delete this.P,delete this.Ri,this)this[""+t]&&this[""+t].Kt&&this[""+t].Kt(),this[""+t]=null,delete this[""+t]},ut(t){this.Er.push(...t)},$(i){if((ot.environment!==q.WX||"touchmove"!==i.type)&&(!this.P||"mousemove"!==i.type||this.P.Rr))if("mousedown"===i.type||"touchstart"===i.type)this.B=(new Date).getTime(),"touchstart"===i.type&&(this.Or=i.changedTouches[0].clientX,this.Cr=i.changedTouches[0].clientY);else{if("mouseup"===i.type||"touchend"===i.type){if(200<(new Date).getTime()-this.B)return;if("touchend"===i.type&&Math.pow(i.changedTouches[0].clientX-this.Or,2)+Math.pow(i.changedTouches[0].clientY-this.Cr,2)>Math.pow(i.changedTouches[0].radiusX,2))return;this.B=(new Date).getTime()}var r=this.Nr(i);for(let t=0;t<this.Er.length;t++)this.Er[t](r);var n=this.Dr(r);let t=null,e=null;n[0]&&n[0].type!==p.FM3DTILE_LAYER&&(s=n[0].rr(Es))&&(t=n[0].level,s!==this.R.S)&&(e=s.Ht);var s=this.kr(r);if(null!==t)null!==e?s.height=s.height-this.R.getBuilding(e).getFloor(t).height:s.height=s.height-this.R.getFloor(t).height;else{var o=this.R.getLevel();if(void 0===o)return;s.height=s.height-this.R.getFloor(o).height}o="mousemove"===i.type||"touchmove"===i.type?"hover":"click",s={type:o,targets:n,coords:s,mouseEvent:i,level:t,buildingID:e};-1<this.Ri.Pr.indexOf(o)&&this.Ir(n),this.R.Yt.Wt(s)}},Ir(o){var t=[p.MODEL,p.EXTERNAL_MODEL];for(let s=0;s<o.length;s++)if(-1<t.indexOf(o[s].Ei)){if(o[s]===this.Lr)return;if(o[s].Ji){this.Ai&&(this.Ai.stop(),this.R.lt.ht(this.Ai)),n(this.Lr),this.Lr=o[s],this.Lr.Fr=this.P.highlightColor;let i=o[s].Ji;if(o[s].Ei===p.MODEL){i.userData.sourceMaterial=i.material,i.material=i.material.clone();var e=i.material.color;let t=new ft(this.P.highlightColor);this.Ai?(this.Ai.Nt([e.r,e.g,e.b]),this.Ai.Rt([t.r,t.g,t.b])):this.Ai=new en({src:[e.r,e.g,e.b],dest:[t.r,t.g,t.b]}),this.Ai.ot(.5).st(t=>{t=new ft(t.destination[0],t.destination[1],t.destination[2]);i&&i.material&&(i.material.color=t),this.R.enableUpdateRender()}).nt(()=>{this.Ai.stop(),this.R.lt.ht(this.Ai),i&&i.material&&(i.material.color=t),this.R.enableUpdateRender()}),this.R.lt.ut(this.Ai.et())}else if(o[s].Ei===p.EXTERNAL_MODEL)if("Mesh"===i.type)if(i.userData.sourceMaterial||(i.userData.sourceMaterial=i.material),Array.isArray(i.material)){var r=[];let e=!0;for(let t=0;t<i.material.length;t++)"MeshLambertMaterial"!==i.material[t].type?e=!1:(r[t]=i.material[t].clone(),r[t].color=new ft(this.P.highlightColor));e&&(i.material=r)}else"MeshLambertMaterial"===i.material.type&&(i.material=i.material.clone(),i.material.color=new ft(this.P.highlightColor));else"Scene"===i.type&&i.traverse(e=>{if("Mesh"===e.type)if(e.userData.sourceMaterial||(e.userData.sourceMaterial=e.material),Array.isArray(e.material)){var i,r=[];for(let t=0;t<e.material.length;t++)e.material.isBasic?r.push(e.material):(i=this.jr(e.material[t]),r.push(i));e.material=r}else{var t,n;e.material.isBasic||(t=this.jr(e.material),o[s].Gr&&this.R.getMapOptions().materialMode!==xs.CLASSIC?((n=o[s].Ur(t)).uniforms.diffuse.value=t.uniforms.diffuse.value,n.uniforms.isMask.value=!0,n.uniforms.maskType.value=o[s].Hr,n.uniforms.maskTexture.value=o[s].Br,void 0!==o[s].zr&&void 0!==o[s].Vr&&(n.uniforms.maskHeight.value=o[s].zr,n.uniforms.maskExtrudeHeight.value=o[s].Vr),n.uniforms.boundCenter.value=o[s].Wr,n.uniforms.boundSize.value=o[s].Yr,n.uniformsNeedUpdate=!0,n.userData=t.userData,e.material=n):e.material=t)}});return void this.R.enableUpdateRender()}break}function n(t){var e,i;t&&(t.Fr=null,e=t.Ji)&&(t.Ei===p.MODEL?e.userData.sourceMaterial&&!1!==e.userData.sourceMaterial.canDispose&&(i=e.material,e.material=e.userData.sourceMaterial,i.dispose(),delete e.userData.sourceMaterial):t.Ei===p.EXTERNAL_MODEL&&("Mesh"===e.type?(e.material=e.userData.sourceMaterial,delete e.userData.sourceMaterial):"Scene"===e.type&&e.parent&&e.traverse(t=>{"Mesh"===t.type&&t.userData.sourceMaterial&&(t.material=t.userData.sourceMaterial,delete t.userData.sourceMaterial)})))}this.Ai&&(this.Ai.stop(),this.R.lt.ht(this.Ai)),n(this.Lr),this.Lr=null,this.R.enableUpdateRender()},jr(t){var e=this.Xr(t);e.color=this.P.highlightColor;let i;return(i=this.R.getMapOptions().materialMode===xs.REAL?this.R.Vt.qr.Zr(e):this.R.Vt.qr.Jr(t,e)).userData=t.userData,i},Xr(t){let e={};return(e=this.R.Ri.materialMode!==xs.REAL||t.isBasic?e:{alphaTest:t.alphaTest,USE_EMISSIVEMAP:t.defines.USE_EMISSIVEMAP,USE_MAP:t.defines.USE_MAP,USE_AOMAP:t.defines.USE_AOMAP,USE_METALNESSMAP:t.defines.USE_METALNESSMAP,USE_NORMALMAP:t.defines.USE_NORMALMAP,TANGENTSPACE_NORMALMAP:t.defines.TANGENTSPACE_NORMALMAP,USE_ROUGHNESSMAP:t.defines.USE_ROUGHNESSMAP,aoMap:t.uniforms.aoMap.value,map:t.uniforms.map.value,color:t.uniforms.diffuse.value.getHex(),emissive:t.uniforms.emissive.value.getHex(),emissiveMap:t.uniforms.emissiveMap.value,metalness:t.uniforms.metalness.value,metalnessMap:t.uniforms.metalnessMap.value,roughness:t.uniforms.roughness.value,roughnessMap:t.uniforms.roughnessMap.value,normalScale:t.uniforms.normalScale.value,normalMap:t.uniforms.normalMap.value,vertexColors:t.vertexColors,side:t.side}).opacity=t.opacity,e.transparent=t.transparent,e},Dr(e){var r=[];for(let t=0;t<e.length;t++)if(void 0!==e[t].type&&e[t].type===p.FM3DTILE_LAYER)r.push({type:p.FM3DTILE_LAYER,object:e[t].object});else{let i=e[t].object;if("LineSegments"!==i.type&&!(i.isNoPickup||i.parent&&i.parent.mapNode&&i.parent.mapNode.Kr&&i===i.parent.mapNode.Kr.top)){for(;!i.mapNode;)i=i.parent;let e=!0;for(let t=0;t<r.length;t++)if(r[t].Ji&&r[t].Ji.uuid===i.uuid){e=!1;break}var n=this.R.pickFilterFunction({type:i.mapNode.Ei,data:i.mapNode.Ki});i.mapNode.visible&&!i.mapNode.Qr&&n&&e&&i.visible&&r.push(i.mapNode)}}return r},kr(e){let i=null;for(let t=0;t<e.length;t++)if("LineSegments"!==e[t].object.type){i=e[t];break}var t;return e.length<1||!i?{x:NaN,y:NaN,z:NaN,height:NaN}:(t=i.point.clone(),{x:this.R.x+t.x,y:this.R.y-t.z,z:i.point.y,height:i.point.y})},Nr(e){var i=[];if(e.touches){let t=e.touches[0];"touchend"===e.type&&(t=e.changedTouches[0]);var r=this.R.A.renderer.domElement.getBoundingClientRect(),n=t.clientX-r.left,s=t.clientY-r.top;this.Ar.x=n/r.width*2-1,this.Ar.y=-s/r.height*2+1}else{n=e;this.Ar.x=n.offsetX/this.R.A.renderer.domElement.clientWidth*2-1,this.Ar.y=2*-(n.offsetY/this.R.A.renderer.domElement.clientHeight)+1}this.Ar.z=.5,this.Sr.setFromCamera(this.Ar,this.R.ft);let o=new Map,a=[];if(this.R.A.$r.forEach((t,e)=>{e=e.split("%A%B%C%D")[0];let i=o.get(e);if(i||(i=[],o.set(e,i),a.unshift(e)),t.visible){var r=this.Sr.intersectObject(t,!0);for(let t=0;t<r.length;t++)r[t].object.visible&&!r[t].object.isNoPick&&i.push(r[t])}}),0<this.R.A.tn.length){let i=o.get("other1");i||(i=[],o.set("other1",i),a.push("other1"));var t=this.R.A.tn;for(let e=0;e<t.length;e++)if(t[e].visible){var h=this.Sr.intersectObject(t[e],!0);for(let t=0;t<h.length;t++)h[e].type=p.FM3DTILE_LAYER,i.push(h[e])}}if(this.R.A.en){let e=o.get("other2");e||(e=[],o.set("other2",e),a.push("other2"));var l=this.Sr.intersectObject(this.R.A.en,!0);for(let t=0;t<l.length;t++)l[t].object.visible&&(l[t].object.isNoPickup=!0,e.push(l[t]))}for(let t=0;t<a.length;t++)for(var u=o.get(a[t]),c=0;c<u.length;c++)i.push(u[c]);return i.sort(function(t,e){return t.distance-e.distance}),i}});var Ts=0;function f(t,e,i,r,n,s,o,a,h,l){Object.defineProperty(this,"id",{value:Ts++}),this.uuid=Et.generateUUID(),this.name="",this.image=void 0!==t?t:f.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:f.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:Xe,this.wrapT=void 0!==r?r:Xe,this.magFilter=void 0!==n?n:Qe,this.minFilter=void 0!==s?s:ti,this.anisotropy=void 0!==h?h:1,this.format=void 0!==o?o:mi,this.internalFormat=null,this.type=void 0!==a?a:ii,this.offset=new St(0,0),this.repeat=new St(1,1),this.center=new St(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new N,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Er,this.version=0,this.onUpdate=null}function Ss(t,e,i,r,n,s,o,a,h,l,u,c){f.call(this,null,s,o,a,h,l,r,n,u,c),this.image={data:t||null,width:e||1,height:i||1},this.magFilter=void 0!==h?h:qe,this.minFilter=void 0!==l?l:qe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}f.DEFAULT_IMAGE=void 0,f.DEFAULT_MAPPING=je,f.prototype=Object.assign(Object.create(S.prototype),{constructor:f,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===je){if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case Ye:t.x=t.x-Math.floor(t.x);break;case Xe:t.x=t.x<0?0:1;break;case Ze:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case Ye:t.y=t.y-Math.floor(t.y);break;case Xe:t.y=t.y<0?0:1;break;case Ze:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}return t}}),Object.defineProperty(f.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Ss.prototype=Object.create(f.prototype),Ss.prototype.constructor=Ss,Ss.prototype.isDataTexture=!0;var Ot={common:{diffuse:{value:new ft(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new N},uv2Transform:{value:new N},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new St(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ft(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ft(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new N}},sprite:{diffuse:{value:new ft(15658734)},opacity:{value:1},center:{value:new St(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new N}}};function As(){Z.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Os(){var i=null,r=!1,n=null;function s(t,e){!1!==r&&(n(t,e),i.requestAnimationFrame(s))}return{start:function(){!0!==r&&null!==n&&(i.requestAnimationFrame(s),r=!0)},stop:function(){r=!1},setAnimationLoop:function(t){n=t},setContext:function(t){i=t}}}function Cs(h,t){var l=t.isWebGL2,u=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),u.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=u.get(t);e&&(h.deleteBuffer(e.buffer),u.delete(t))},update:function(t,e){t.isInterleavedBufferAttribute&&(t=t.data);var i,r,n,s,o,a=u.get(t);void 0===a?u.set(t,(r=e,n=(i=t).array,s=i.usage,o=h.createBuffer(),h.bindBuffer(r,o),h.bufferData(r,n,s),i.onUploadCallback(),r=h.FLOAT,n instanceof Float32Array?r=h.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?r=h.UNSIGNED_SHORT:n instanceof Int16Array?r=h.SHORT:n instanceof Uint32Array?r=h.UNSIGNED_INT:n instanceof Int32Array?r=h.INT:n instanceof Int8Array?r=h.BYTE:n instanceof Uint8Array&&(r=h.UNSIGNED_BYTE),{buffer:o,type:r,bytesPerElement:n.BYTES_PER_ELEMENT,version:i.version})):a.version<t.version&&(s=a.buffer,o=e,n=(r=t).array,r=r.updateRange,h.bindBuffer(o,s),-1===r.count?h.bufferSubData(o,0,n):(l?h.bufferSubData(o,r.offset*n.BYTES_PER_ELEMENT,n,r.offset,r.count):h.bufferSubData(o,r.offset*n.BYTES_PER_ELEMENT,n.subarray(r.offset,r.offset+r.count)),r.count=-1),a.version=t.version)}}}function Rs(t,e,i,r,n,s){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new Lt,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new ft,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==s?s:0}As.prototype=Object.assign(Object.create(Z.prototype),{constructor:As,isScene:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(Rs.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var Ns=0,Ds=new Tt,ks=new Z,Ps=new Lt;function Is(){Object.defineProperty(this,"id",{value:Ns+=2}),this.uuid=Et.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Is.prototype=Object.assign(Object.create(S.prototype),{constructor:Is,isGeometry:!0,applyMatrix4:function(t){for(var e=(new N).getNormalMatrix(t),i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(e).normalize();for(var s=0,o=n.vertexNormals.length;s<o;s++)n.vertexNormals[s].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Ds.makeRotationX(t),this.applyMatrix4(Ds),this},rotateY:function(t){return Ds.makeRotationY(t),this.applyMatrix4(Ds),this},rotateZ:function(t){return Ds.makeRotationZ(t),this.applyMatrix4(Ds),this},translate:function(t,e,i){return Ds.makeTranslation(t,e,i),this.applyMatrix4(Ds),this},scale:function(t,e,i){return Ds.makeScale(t,e,i),this.applyMatrix4(Ds),this},lookAt:function(t){return ks.lookAt(t),ks.updateMatrix(),this.applyMatrix4(ks.matrix),this},fromBufferGeometry:function(t){var s=this,e=null!==t.index?t.index.array:void 0,i=t.attributes;if(void 0===i.position)console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.");else{var r=i.position.array,o=void 0!==i.normal?i.normal.array:void 0,a=void 0!==i.color?i.color.array:void 0,h=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var n=0;n<r.length;n+=3)s.vertices.push((new Lt).fromArray(r,n)),void 0!==a&&s.colors.push((new ft).fromArray(a,n));var u=t.groups;if(0<u.length)for(n=0;n<u.length;n++)for(var c=u[n],f=c.start,d=f,v=f+c.count;d<v;d+=3)void 0!==e?p(e[d],e[d+1],e[d+2],c.materialIndex):p(d,d+1,d+2,c.materialIndex);else if(void 0!==e)for(n=0;n<e.length;n+=3)p(e[n],e[n+1],e[n+2]);else for(n=0;n<r.length/3;n+=3)p(n,n+1,n+2);this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone())}return this;function p(t,e,i,r){var n=void 0===a?[]:[s.colors[t].clone(),s.colors[e].clone(),s.colors[i].clone()],n=new Rs(t,e,i,void 0===o?[]:[(new Lt).fromArray(o,3*t),(new Lt).fromArray(o,3*e),(new Lt).fromArray(o,3*i)],n,r);s.faces.push(n),void 0!==h&&s.faceVertexUvs[0].push([(new St).fromArray(h,2*t),(new St).fromArray(h,2*e),(new St).fromArray(h,2*i)]),void 0!==l&&s.faceVertexUvs[1].push([(new St).fromArray(l,2*t),(new St).fromArray(l,2*e),(new St).fromArray(l,2*i)])}},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ps).negate(),this.translate(Ps.x,Ps.y,Ps.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,e=0===e?1:1/e,i=new Tt;return i.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var t=new Lt,e=new Lt,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],s=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c];t.subVectors(a,o),e.subVectors(s,o),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){var e,i,r;for(void 0===t&&(t=!0),r=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)r[e]=new Lt;if(t)for(var n,s,o,a=new Lt,h=new Lt,l=0,u=this.faces.length;l<u;l++)c=this.faces[l],n=this.vertices[c.a],s=this.vertices[c.b],o=this.vertices[c.c],a.subVectors(o,s),h.subVectors(n,s),a.cross(h),r[c.a].add(a),r[c.b].add(a),r[c.c].add(a);else for(this.computeFaceNormals(),l=0,u=this.faces.length;l<u;l++)r[(c=this.faces[l]).a].add(c.normal),r[c.b].add(c.normal),r[c.c].add(c.normal);for(e=0,i=this.vertices.length;e<i;e++)r[e].normalize();for(l=0,u=this.faces.length;l<u;l++){var c,f=(c=this.faces[l]).vertexNormals;3===f.length?(f[0].copy(r[c.a]),f[1].copy(r[c.b]),f[2].copy(r[c.c])):(f[0]=r[c.a].clone(),f[1]=r[c.b].clone(),f[2]=r[c.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var i,r=(i=this.faces[t]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i;for(o=0,a=this.faces.length;o<a;o++)for((i=this.faces[o]).rn?i.rn.copy(i.normal):i.rn=i.normal.clone(),i.nn||(i.nn=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.nn[t]?i.nn[t].copy(i.vertexNormals[t]):i.nn[t]=i.vertexNormals[t].clone();var r=new Is;for(r.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];for(var n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals,o=0,a=this.faces.length;o<a;o++)h=new Lt,l={a:new Lt,b:new Lt,c:new Lt},n.push(h),s.push(l)}var h,l,u=this.morphNormals[t];for(r.vertices=this.morphTargets[t].vertices,r.computeFaceNormals(),r.computeVertexNormals(),o=0,a=this.faces.length;o<a;o++)i=this.faces[o],h=u.faceNormals[o],l=u.vertexNormals[o],h.copy(i.normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(o=0,a=this.faces.length;o<a;o++)(i=this.faces[o]).normal=i.rn,i.vertexNormals=i.nn},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ct),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Dt),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){for(var t,e,i,r,n={},s=[],o=[],a=Math.pow(10,4),h=0,l=this.vertices.length;h<l;h++)t=this.vertices[h],void 0===n[t=Math.round(t.x*a)+"_"+Math.round(t.y*a)+"_"+Math.round(t.z*a)]?(n[t]=h,s.push(this.vertices[h]),o[h]=s.length-1):o[h]=o[n[t]];var u=[];for(h=0,l=this.faces.length;h<l;h++){(e=this.faces[h]).a=o[e.a],e.b=o[e.b],e.c=o[e.c];for(var c=[e.a,e.b,e.c],f=0;f<3;f++)if(c[f]===c[(f+1)%3]){u.push(h);break}}for(h=u.length-1;0<=h;h--){var d=u[h];for(this.faces.splice(d,1),i=0,r=this.faceVertexUvs.length;i<r;i++)this.faceVertexUvs[i].splice(d,1)}var v=this.vertices.length-s.length;return this.vertices=s,v},setFromPoints:function(t){this.vertices=[];for(var e=0,i=t.length;e<i;e++){var r=t[e];this.vertices.push(new Lt(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i].Ht=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var r,n,s=this.faceVertexUvs[0],o=this.faceVertexUvs[1];s&&s.length===e&&(r=[]),o&&o.length===e&&(n=[]);for(i=0;i<e;i++){var a=t[i].Ht;r&&r.push(s[a]),n&&n.push(o[a])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},dispose:function(){this.dispatchEvent({type:"dispose"})}});var r=new Lt;function J(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=Ur,this.updateRange={offset:0,count:-1},this.version=0}function Fs(t,e,i){J.call(this,new Int8Array(t),e,i)}function js(t,e,i){J.call(this,new Uint8Array(t),e,i)}function Gs(t,e,i){J.call(this,new Uint8ClampedArray(t),e,i)}function Us(t,e,i){J.call(this,new Int16Array(t),e,i)}function Hs(t,e,i){J.call(this,new Uint16Array(t),e,i)}function Bs(t,e,i){J.call(this,new Int32Array(t),e,i)}function zs(t,e,i){J.call(this,new Uint32Array(t),e,i)}function x(t,e,i){J.call(this,new Float32Array(t),e,i)}function Vs(t,e,i){J.call(this,new Float64Array(t),e,i)}function Ws(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ys(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,r=t.length;i<r;++i)t[i]>e&&(e=t[i]);return e}Object.defineProperty(J.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(J.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new ft),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new St),e[i++]=s.x,e[i++]=s.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new Lt),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new At),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this},applyMatrix3:function(t){for(var e=0,i=this.count;e<i;e++)r.x=this.getX(e),r.y=this.getY(e),r.z=this.getZ(e),r.applyMatrix3(t),this.setXYZ(e,r.x,r.y,r.z);return this},applyMatrix4:function(t){for(var e=0,i=this.count;e<i;e++)r.x=this.getX(e),r.y=this.getY(e),r.z=this.getZ(e),r.applyMatrix4(t),this.setXYZ(e,r.x,r.y,r.z);return this},applyNormalMatrix:function(t){for(var e=0,i=this.count;e<i;e++)r.x=this.getX(e),r.y=this.getY(e),r.z=this.getZ(e),r.applyNormalMatrix(t),this.setXYZ(e,r.x,r.y,r.z);return this},transformDirection:function(t){for(var e=0,i=this.count;e<i;e++)r.x=this.getX(e),r.y=this.getY(e),r.z=this.getZ(e),r.transformDirection(t),this.setXYZ(e,r.x,r.y,r.z);return this},set:function(t,e){return this.array.set(t,e=void 0===e?0:e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Fs.prototype=Object.create(J.prototype),Fs.prototype.constructor=Fs,js.prototype=Object.create(J.prototype),js.prototype.constructor=js,Gs.prototype=Object.create(J.prototype),Gs.prototype.constructor=Gs,Us.prototype=Object.create(J.prototype),Us.prototype.constructor=Us,Hs.prototype=Object.create(J.prototype),Hs.prototype.constructor=Hs,Bs.prototype=Object.create(J.prototype),Bs.prototype.constructor=Bs,zs.prototype=Object.create(J.prototype),zs.prototype.constructor=zs,x.prototype=Object.create(J.prototype),x.prototype.constructor=x,Vs.prototype=Object.create(J.prototype),Vs.prototype.constructor=Vs,Object.assign(Ws.prototype,{computeGroups:function(t){for(var e,i=[],r=void 0,n=t.faces,s=0;s<n.length;s++){var o=n[s];o.materialIndex!==r&&(r=o.materialIndex,void 0!==e&&(e.count=3*s-e.start,i.push(e)),e={start:3*s,materialIndex:r})}void 0!==e&&(e.count=3*s-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e=t.faces,i=t.vertices,r=t.faceVertexUvs,n=r[0]&&0<r[0].length,s=r[1]&&0<r[1].length,o=t.morphTargets,a=o.length;if(0<a){for(var h=[],l=0;l<a;l++)h[l]={name:o[l].name,data:[]};this.morphTargets.position=h}var u=t.morphNormals,c=u.length;if(0<c){for(var f=[],l=0;l<c;l++)f[l]={name:u[l].name,data:[]};this.morphTargets.normal=f}var d=t.skinIndices,v=t.skinWeights,p=d.length===i.length,m=v.length===i.length;0<i.length&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(l=0;l<e.length;l++){var g,_=e[l],b=(this.vertices.push(i[_.a],i[_.b],i[_.c]),_.vertexNormals),b=(3===b.length?this.normals.push(b[0],b[1],b[2]):(b=_.normal,this.normals.push(b,b,b)),_.vertexColors);3===b.length?this.colors.push(b[0],b[1],b[2]):(b=_.color,this.colors.push(b,b,b)),!0===n&&(void 0!==(g=r[0][l])?this.uvs.push(g[0],g[1],g[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new St,new St,new St))),!0===s&&(void 0!==(g=r[1][l])?this.uvs2.push(g[0],g[1],g[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new St,new St,new St)));for(var y=0;y<a;y++){var w=o[y].vertices;h[y].data.push(w[_.a],w[_.b],w[_.c])}for(y=0;y<c;y++){var x=u[y].vertexNormals[l];f[y].data.push(x.a,x.b,x.c)}p&&this.skinIndices.push(d[_.a],d[_.b],d[_.c]),m&&this.skinWeights.push(v[_.a],v[_.b],v[_.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var Xs=1,Zs=new Tt,qs=new Z,Js=new Lt,Ks=new Ct,Qs=new Ct,$s=new Lt;function et(){Object.defineProperty(this,"id",{value:Xs+=2}),this.uuid=Et.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}et.prototype=Object.assign(Object.create(S.prototype),{constructor:et,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<Ys(t)?zs:Hs)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position,e=(void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0),this.attributes.normal),i=(void 0!==e&&(i=(new N).getNormalMatrix(t),e.applyNormalMatrix(i),e.needsUpdate=!0),this.attributes.tangent);return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Zs.makeRotationX(t),this.applyMatrix4(Zs),this},rotateY:function(t){return Zs.makeRotationY(t),this.applyMatrix4(Zs),this},rotateZ:function(t){return Zs.makeRotationZ(t),this.applyMatrix4(Zs),this},translate:function(t,e,i){return Zs.makeTranslation(t,e,i),this.applyMatrix4(Zs),this},scale:function(t,e,i){return Zs.makeScale(t,e,i),this.applyMatrix4(Zs),this},lookAt:function(t){return qs.lookAt(t),qs.updateMatrix(),this.applyMatrix4(qs.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Js).negate(),this.translate(Js.x,Js.y,Js.z),this},setFromObject:function(t){var e,i,r=t.geometry;return t.isPoints||t.isLine?(i=new x(3*r.vertices.length,3),e=new x(3*r.colors.length,3),this.setAttribute("position",i.copyVector3sArray(r.vertices)),this.setAttribute("color",e.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length&&(i=new x(r.lineDistances.length,1),this.setAttribute("lineDistance",i.copyArray(r.lineDistances))),null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone())):t.isMesh&&r&&r.isGeometry&&this.fromGeometry(r),this},setFromPoints:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new x(e,3)),this},updateFromObject:function(t){var e,i=t.geometry;if(t.isMesh){var r=i.sn;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(i.vertices),e.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(i.normals),e.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(i.colors),e.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(i.uvs),e.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(i.lineDistances),e.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.sn=(new Ws).fromGeometry(t),this.fromDirectGeometry(t.sn)},fromDirectGeometry:function(t){var e,i=new Float32Array(3*t.vertices.length);for(e in this.setAttribute("position",new J(i,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(i=new Float32Array(3*t.normals.length),this.setAttribute("normal",new J(i,3).copyVector3sArray(t.normals))),0<t.colors.length&&(i=new Float32Array(3*t.colors.length),this.setAttribute("color",new J(i,3).copyColorsArray(t.colors))),0<t.uvs.length&&(i=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new J(i,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(i=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new J(i,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var r=[],n=t.morphTargets[e],s=0,o=n.length;s<o;s++){var a=n[s],h=new x(3*a.data.length,3);h.name=a.name,r.push(h.copyVector3sArray(a.data))}this.morphAttributes[e]=r}return 0<t.skinIndices.length&&(i=new x(4*t.skinIndices.length,4),this.setAttribute("skinIndex",i.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(i=new x(4*t.skinWeights.length,4),this.setAttribute("skinWeight",i.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ct);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var i=0,r=e.length;i<r;i++){var n=e[i];Ks.setFromBufferAttribute(n),this.morphTargetsRelative?($s.addVectors(this.boundingBox.min,Ks.min),this.boundingBox.expandByPoint($s),$s.addVectors(this.boundingBox.max,Ks.max),this.boundingBox.expandByPoint($s)):(this.boundingBox.expandByPoint(Ks.min),this.boundingBox.expandByPoint(Ks.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Dt);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var i=this.boundingSphere.center;if(Ks.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++){var s=e[r];Qs.setFromBufferAttribute(s),this.morphTargetsRelative?($s.addVectors(Ks.min,Qs.min),Ks.expandByPoint($s),$s.addVectors(Ks.max,Qs.max),Ks.expandByPoint($s)):(Ks.expandByPoint(Qs.min),Ks.expandByPoint(Qs.max))}Ks.getCenter(i);for(var o=0,r=0,n=t.count;r<n;r++)$s.fromBufferAttribute(t,r),o=Math.max(o,i.distanceToSquared($s));if(e)for(r=0,n=e.length;r<n;r++)for(var s=e[r],a=this.morphTargetsRelative,h=0,l=s.count;h<l;h++)$s.fromBufferAttribute(s,h),a&&(Js.fromBufferAttribute(t,h),$s.add(Js)),o=Math.max(o,i.distanceToSquared($s));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var i=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new J(new Float32Array(i.length),3));else for(var r=e.normal.array,n=0,s=r.length;n<s;n++)r[n]=0;var o,a,h,l=e.normal.array,u=new Lt,c=new Lt,f=new Lt,d=new Lt,v=new Lt;if(t)for(var p=t.array,n=0,s=t.count;n<s;n+=3)o=3*p[n+0],a=3*p[n+1],h=3*p[n+2],u.fromArray(i,o),c.fromArray(i,a),f.fromArray(i,h),d.subVectors(f,c),v.subVectors(u,c),d.cross(v),l[o]+=d.x,l[1+o]+=d.y,l[2+o]+=d.z,l[a]+=d.x,l[1+a]+=d.y,l[2+a]+=d.z,l[h]+=d.x,l[1+h]+=d.y,l[2+h]+=d.z;else for(n=0,s=i.length;n<s;n+=9)u.fromArray(i,n),c.fromArray(i,n+3),f.fromArray(i,n+6),d.subVectors(f,c),v.subVectors(u,c),d.cross(v),l[n]=d.x,l[n+1]=d.y,l[n+2]=d.z,l[n+3]=d.x,l[n+4]=d.y,l[n+5]=d.z,l[n+6]=d.x,l[n+7]=d.y,l[n+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,i=t.count;e<i;e++)$s.x=t.getX(e),$s.y=t.getY(e),$s.z=t.getZ(e),$s.normalize(),t.setXYZ(e,$s.x,$s.y,$s.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}});class to extends et{constructor(t,e,i,r,n,s){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};var A=this,O=(t=t||1,e=e||1,i=i||1,r=Math.floor(r)||1,n=Math.floor(n)||1,s=Math.floor(s)||1,[]),C=[],R=[],N=[],D=0,k=0;function o(t,e,i,r,n,s,o,a,h,l,u){for(var c=s/h,f=o/l,d=s/2,v=o/2,p=a/2,m=h+1,g=l+1,_=0,b=0,y=new Lt,w=0;w<g;w++)for(var x=w*f-v,M=0;M<m;M++)y[t]=(M*c-d)*r,y[e]=x*n,y[i]=p,C.push(y.x,y.y,y.z),y[t]=0,y[e]=0,y[i]=0<a?1:-1,R.push(y.x,y.y,y.z),N.push(M/h),N.push(1-w/l),_+=1;for(w=0;w<l;w++)for(M=0;M<h;M++){var E=D+M+m*w,L=D+M+m*(w+1),T=D+(M+1)+m*(w+1),S=D+(M+1)+m*w;O.push(E,L,S),O.push(L,T,S),b+=6}A.addGroup(k,b,u),k+=b,D+=_}o("z","y","x",-1,-1,i,e,t,s,n,0),o("z","y","x",1,-1,i,e,-t,s,n,1),o("x","z","y",1,1,t,i,e,r,s,2),o("x","z","y",1,-1,t,i,-e,r,s,3),o("x","y","z",1,-1,t,e,i,r,n,4),o("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(O),this.setAttribute("position",new x(C,3)),this.setAttribute("normal",new x(R,3)),this.setAttribute("uv",new x(N,2))}}function eo(t,e,i,r){et.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};for(var n=(t=t||1)/2,s=(e=e||1)/2,o=Math.floor(i)||1,a=Math.floor(r)||1,h=o+1,l=a+1,u=t/o,c=e/a,f=[],d=[],v=[],p=[],m=0;m<l;m++)for(var g=m*c-s,_=0;_<h;_++)d.push(_*u-n,-g,0),v.push(0,0,1),p.push(_/o),p.push(1-m/a);for(m=0;m<a;m++)for(_=0;_<o;_++){var b=_+h*(m+1),y=_+1+h*(m+1),w=_+1+h*m;f.push(_+h*m,b,w),f.push(b,y,w)}this.setIndex(f),this.setAttribute("position",new x(d,3)),this.setAttribute("normal",new x(v,3)),this.setAttribute("uv",new x(p,2))}eo.prototype=Object.create(et.prototype),eo.prototype.constructor=eo;let io={alphaTest:.001};var ro=0;function K(){Object.defineProperty(this,"id",{value:ro++}),this.uuid=Et.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=te,this.side=qt,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ve,this.blendDst=pe,this.blendEquation=se,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ee,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ir,this.stencilZFail=Ir,this.stencilZPass=Ir,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=io.alphaTest,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function no(t){var e,i={};for(e in t)for(var r in i[e]={},t[e]){var n=t[e][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?i[e][r]=n.clone():Array.isArray(n)?i[e][r]=n.slice():i[e][r]=n}return i}function so(t){for(var e={},i=0;i<t.length;i++){var r,n=no(t[i]);for(r in n)e[r]=n[r]}return e}K.prototype=Object.assign(Object.create(S.prototype),{constructor:K,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i,r=t[e];void 0===r?console.warn("THREE.Material: '"+e+"' parameter is undefined."):"shading"===e?(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===Qt):void 0===(i=this[e])?console.warn("THREE."+this.type+": '"+e+"' is not a property of this material."):i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[e]=r}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,i=null;if(null!==e)for(var r=e.length,i=new Array(r),n=0;n!==r;++n)i[n]=e[n].clone();return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(K.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});var oo={clone:no,merge:so},ao=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,ho=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;function g(t){K.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=ao,this.fragmentShader=ho,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}g.prototype=Object.create(K.prototype),g.prototype.constructor=g,g.prototype.isShaderMaterial=!0,g.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=no(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this};var lo=new Lt,uo=new Lt,co=new Lt,fo=new Lt,vo=new Lt,po=new Lt,mo=new Lt,go=new Lt,_o=new Lt,bo=new Lt;function yo(t,e,i){this.a=void 0!==t?t:new Lt,this.b=void 0!==e?e:new Lt,this.c=void 0!==i?i:new Lt}function wo(t){K.call(this),this.type="MeshBasicMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Object.assign(yo,{getNormal:function(t,e,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Lt),r.subVectors(i,e),lo.subVectors(t,e),r.cross(lo);i=r.lengthSq();return 0<i?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(t,e,i,r,n){lo.subVectors(r,e),uo.subVectors(i,e),co.subVectors(t,e);var r=lo.dot(lo),i=lo.dot(uo),t=lo.dot(co),e=uo.dot(uo),s=uo.dot(co),o=r*e-i*i;return void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new Lt),0==o?n.set(-2,-1,-1):n.set(1-(e=(e*t-i*s)*(n=1/o))-(o=(r*s-i*t)*n),o,e)},containsPoint:function(t,e,i,r){return yo.getBarycoord(t,e,i,r,fo),0<=fo.x&&0<=fo.y&&fo.x+fo.y<=1},getUV:function(t,e,i,r,n,s,o,a){return this.getBarycoord(t,e,i,r,fo),a.set(0,0),a.addScaledVector(n,fo.x),a.addScaledVector(s,fo.y),a.addScaledVector(o,fo.z),a},isFrontFacing:function(t,e,i,r){return lo.subVectors(i,e),uo.subVectors(t,e),lo.cross(uo).dot(r)<0}}),Object.assign(yo.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return lo.subVectors(this.c,this.b),uo.subVectors(this.a,this.b),.5*lo.cross(uo).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Lt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return yo.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ft),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return yo.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,i,r,n){return yo.getUV(t,this.a,this.b,this.c,e,i,r,n)},containsPoint:function(t){return yo.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return yo.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Lt);var i=this.a,r=this.b,n=this.c,s=(vo.subVectors(r,i),po.subVectors(n,i),go.subVectors(t,i),vo.dot(go)),o=po.dot(go);if(s<=0&&o<=0)return e.copy(i);_o.subVectors(t,r);var a=vo.dot(_o),h=po.dot(_o);if(0<=a&&h<=a)return e.copy(r);var l=s*h-a*o;if(l<=0&&0<=s&&a<=0)return u=s/(s-a),e.copy(i).addScaledVector(vo,u);bo.subVectors(t,n);var u,c,t=vo.dot(bo),f=po.dot(bo);return 0<=f&&t<=f?e.copy(n):(s=t*o-s*f)<=0&&0<=o&&f<=0?(c=o/(o-f),e.copy(i).addScaledVector(po,c)):(o=a*f-t*h)<=0&&0<=h-a&&0<=t-f?(mo.subVectors(n,r),c=(h-a)/(h-a+(t-f)),e.copy(r).addScaledVector(mo,c)):(u=s*(n=1/(o+s+l)),c=l*n,e.copy(i).addScaledVector(vo,u).addScaledVector(po,c))},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),wo.prototype=Object.create(K.prototype),wo.prototype.constructor=wo,wo.prototype.isMeshBasicMaterial=!0,wo.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var xo=new Tt,Mo=new _s,Eo=new Dt,Lo=new Lt,To=new Lt,So=new Lt,Ao=new Lt,Oo=new Lt,Co=new Lt,Ro=new Lt,No=new Lt,Do=new Lt,ko=new St,Po=new St,Io=new St,Fo=new Lt,jo=new Lt;function Q(t,e){Z.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new et,this.material=void 0!==e?e:new wo,this.updateMorphTargets()}function Go(t,e,i,r,n,s,o,a){r=e.side===Jt?r.intersectTriangle(o,s,n,!0,a):r.intersectTriangle(n,s,o,e.side!==Kt,a);if(null===r)return null;jo.copy(a),jo.applyMatrix4(t.matrixWorld);n=i.ray.origin.distanceTo(jo);return n<i.near||n>i.far?null:{distance:n,point:jo.clone(),object:t}}function Uo(t,e,i,r,n,s,o,a,h,l,u,c){Lo.fromBufferAttribute(n,l),To.fromBufferAttribute(n,u),So.fromBufferAttribute(n,c);var f=t.morphTargetInfluences;if(e.morphTargets&&s&&f){Ro.set(0,0,0),No.set(0,0,0),Do.set(0,0,0);for(var d=0,v=s.length;d<v;d++){var p=f[d],m=s[d];0!==p&&(Ao.fromBufferAttribute(m,l),Oo.fromBufferAttribute(m,u),Co.fromBufferAttribute(m,c),o?(Ro.addScaledVector(Ao,p),No.addScaledVector(Oo,p),Do.addScaledVector(Co,p)):(Ro.addScaledVector(Ao.sub(Lo),p),No.addScaledVector(Oo.sub(To),p),Do.addScaledVector(Co.sub(So),p)))}Lo.add(Ro),To.add(No),So.add(Do)}n=Go(t,e,i,r,Lo,To,So,Fo);return n&&(a&&(ko.fromBufferAttribute(a,l),Po.fromBufferAttribute(a,u),Io.fromBufferAttribute(a,c),n.uv=yo.getUV(Fo,Lo,To,So,ko,Po,Io,new St)),h&&(ko.fromBufferAttribute(h,l),Po.fromBufferAttribute(h,u),Io.fromBufferAttribute(h,c),n.uv2=yo.getUV(Fo,Lo,To,So,ko,Po,Io,new St)),t=new Rs(l,u,c),yo.getNormal(Lo,To,So,t.normal),n.face=t),n}Q.prototype=Object.assign(Object.create(Z.prototype),{constructor:Q,isMesh:!0,copy:function(t){return Z.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,s=Object.keys(n);if(0<s.length){var o=n[s[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)i=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{n=r.morphTargets;void 0!==n&&0<n.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var i=this.geometry,r=this.material,n=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),Eo.copy(i.boundingSphere),Eo.applyMatrix4(n),!1!==t.ray.intersectsSphere(Eo)&&(xo.getInverse(n),Mo.copy(t.ray).applyMatrix4(xo),null===i.boundingBox||!1!==Mo.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var s,o,a,h,l,u,c,f,d,v=i.index,p=i.attributes.position,m=i.morphAttributes.position,g=i.morphTargetsRelative,_=i.attributes.uv,b=i.attributes.uv2,y=i.groups,w=i.drawRange;if(null!==v)if(Array.isArray(r))for(h=0,u=y.length;h<u;h++)for(d=r[(f=y[h]).materialIndex],l=Math.max(f.start,w.start),c=Math.min(f.start+f.count,w.start+w.count);l<c;l+=3)s=v.getX(l),o=v.getX(l+1),a=v.getX(l+2),(R=Uo(this,d,t,Mo,p,m,g,_,b,s,o,a))&&(R.faceIndex=Math.floor(l/3),R.face.materialIndex=f.materialIndex,e.push(R));else for(h=Math.max(0,w.start),u=Math.min(v.count,w.start+w.count);h<u;h+=3)s=v.getX(h),o=v.getX(h+1),a=v.getX(h+2),(R=Uo(this,r,t,Mo,p,m,g,_,b,s,o,a))&&(R.faceIndex=Math.floor(h/3),e.push(R));else if(void 0!==p)if(Array.isArray(r))for(h=0,u=y.length;h<u;h++)for(d=r[(f=y[h]).materialIndex],l=Math.max(f.start,w.start),c=Math.min(f.start+f.count,w.start+w.count);l<c;l+=3)(R=Uo(this,d,t,Mo,p,m,g,_,b,s=l,o=l+1,a=l+2))&&(R.faceIndex=Math.floor(l/3),R.face.materialIndex=f.materialIndex,e.push(R));else for(h=Math.max(0,w.start),u=Math.min(p.count,w.start+w.count);h<u;h+=3)(R=Uo(this,r,t,Mo,p,m,g,_,b,s=h,o=h+1,a=h+2))&&(R.faceIndex=Math.floor(h/3),e.push(R))}else if(i.isGeometry){var x,M=Array.isArray(r),E=i.vertices,L=i.faces,n=i.faceVertexUvs[0];0<n.length&&(x=n);for(var T=0,S=L.length;T<S;T++){var A,O,C,R,N=L[T],D=M?r[N.materialIndex]:r;void 0!==D&&(A=E[N.a],O=E[N.b],C=E[N.c],R=Go(this,D,t,Mo,A,O,C,Fo))&&(x&&x[T]&&(D=x[T],ko.copy(D[0]),Po.copy(D[1]),Io.copy(D[2]),R.uv=yo.getUV(Fo,A,O,C,ko,Po,Io,new St)),R.face=N,R.faceIndex=T,e.push(R))}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ho=`
#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, vUv ).g;

#endif
`,Bo=`
#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`,zo=`
#ifdef ALPHATEST

	if ( diffuseColor.a < ALPHATEST ) discard;

#endif
`,Vo=`
#ifdef USE_AOMAP

	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );

	#endif

#endif
`,Wo=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif
`,Yo=`
vec3 transformed = vec3( position );
`,Xo=`
vec3 objectNormal = vec3( normal );

#ifdef USE_TANGENT

	vec3 objectTangent = vec3( tangent.xyz );

#endif
`,Zo=`

vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );

	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );

	vec4 r = roughness * c0 + c1;

	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;

	return vec2( -1.04, 1.04 ) * a004 + r.zw;

}

float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

#if defined ( PHYSICALLY_CORRECT_LIGHTS )

	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );

	if( cutoffDistance > 0.0 ) {

		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

	}

	return distanceFalloff;

#else

	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {

		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );

	}

	return 1.0;

#endif

}

vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {

	return RECIPROCAL_PI * diffuseColor;

} // validated

vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {

	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );

	return ( 1.0 - specularColor ) * fresnel + specularColor;

} // validated

vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {

	// See F_Schlick
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;

	return Fr * fresnel + F0;

}


float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {

	float a2 = pow2( alpha );

	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );

	return 1.0 / ( gl * gv );

} // validated

float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {

	float a2 = pow2( alpha );

	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );

	return 0.5 / max( gv + gl, EPSILON );

}

float D_GGX( const in float alpha, const in float dotNH ) {

	float a2 = pow2( alpha );

	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1

	return RECIPROCAL_PI * a2 / pow2( denom );

}

vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {

	float alpha = pow2( roughness ); // UE4's roughness

	vec3 halfDir = normalize( incidentLight.direction + viewDir );

	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );

	vec3 F = F_Schlick( specularColor, dotLH );

	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );

	float D = D_GGX( alpha, dotNH );

	return F * ( G * D );

} // validated

vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {

	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;

	float dotNV = saturate( dot( N, V ) );

	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );

	uv = uv * LUT_SCALE + LUT_BIAS;

	return uv;

}

float LTC_ClippedSphereFormFactor( const in vec3 f ) {

	float l = length( f );

	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );

}

vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {

	float x = dot( v1, v2 );

	float y = abs( x );

	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;

	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;

	return cross( v1, v2 ) * theta_sintheta;

}

vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {

	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );

	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );

	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );

	// compute transform
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );

	// transform rect
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );

	// project rect onto sphere
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );

	// calculate vector form factor
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );

	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );

	return vec3( result );

}

vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {

	float dotNV = saturate( dot( normal, viewDir ) );

	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );

	return specularColor * brdf.x + brdf.y;

} // validated

void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {

	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );

	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;

	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;

	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21
	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );

	singleScatter += FssEss;
	multiScatter += Fms * Ems;

}

float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {

	// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)
	return 0.25;

}

float D_BlinnPhong( const in float shininess, const in float dotNH ) {

	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );

}

vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {

	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );

	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );

	vec3 F = F_Schlick( specularColor, dotLH );

	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );

	float D = D_BlinnPhong( shininess, dotNH );

	return F * ( G * D );

} // validated

float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}

float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}

#if defined( USE_SHEEN )

float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16
	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}

float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}

vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {

	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;

	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );

	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );

}

#endif
`,qo=`
#ifdef USE_BUMPMAP

	uniform sampler2D bumpMap;
	uniform float bumpScale;

	vec2 dHdxy_fwd() {

		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );

		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;

		return vec2( dBx, dBy );

	}

	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {

		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;		// normalized

		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );

		float fDet = dot( vSigmaX, R1 );

		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );

		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );

	}

#endif
`,Jo=`
#if NUM_CLIPPING_PLANES > 0

	vec4 plane;

	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {

		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;

	}
	#pragma unroll_loop_end

	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES

		bool clipped = true;

		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {

			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;

		}
		#pragma unroll_loop_end

		if ( clipped ) discard;

	#endif

#endif
`,Ko=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];

#endif
`,Qo=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

#endif
`,$o=`
#if NUM_CLIPPING_PLANES > 0

	vClipPosition = - mvPosition.xyz;

#endif
`,ta=`
#ifdef USE_COLOR

	diffuseColor.rgb *= vColor;

#endif
`,ea=`
#ifdef USE_COLOR

	varying vec3 vColor;

#endif
`,ia=`
#ifdef USE_COLOR

	varying vec3 vColor;

#endif
`,ra=`
#ifdef USE_COLOR

	vColor.xyz = color.xyz;

#endif
`,na=`
#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6

#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}

#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif

struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};

struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};

struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};

vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

}

vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {

	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );

}

vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {

	float distance = dot( planeNormal, point - pointOnPlane );

	return - distance * planeNormal + point;

}

float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {

	return sign( dot( point - pointOnPlane, planeNormal ) );

}

vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {

	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;

}

mat3 transposeMat3( const in mat3 m ) {

	mat3 tmp;

	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );

	return tmp;

}

float linearToRelativeLuminance( const in vec3 color ) {

	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );

	return dot( weights, color.rgb );

}

bool isPerspectiveMatrix( mat4 m ) {

  return m[ 2 ][ 3 ] == - 1.0;

}
`,sa=`
#ifdef ENVMAP_TYPE_CUBE_UV

#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0

float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}

vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}

vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);

  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);

  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;

  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}

// These defines must match with PMREMGenerator

#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0

float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
  }
  return mip;
}

vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);

  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif
`,oa=`
vec3 transformedNormal = objectNormal;

#ifdef USE_INSTANCING

	mat3 m = mat3( instanceMatrix );

	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );

	transformedNormal = m * transformedNormal;

#endif

transformedNormal = normalMatrix * transformedNormal;

#ifdef FLIP_SIDED

	transformedNormal = - transformedNormal;

#endif

#ifdef USE_TANGENT

	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#ifdef FLIP_SIDED

		transformedTangent = - transformedTangent;

	#endif

#endif
`,aa=`
#ifdef USE_DISPLACEMENTMAP

	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;

#endif
`,ha=`
#ifdef USE_DISPLACEMENTMAP

	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );

#endif
`,la=`
#ifdef USE_EMISSIVEMAP

	vec4 emissiveColor = texture2D( emissiveMap, vUv );

	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;

	totalEmissiveRadiance *= emissiveColor.rgb;

#endif
`,ua=`
#ifdef USE_EMISSIVEMAP

	uniform sampler2D emissiveMap;

#endif
`,ca=`
gl_FragColor = linearToOutputTexel( gl_FragColor );
`,fa=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}

vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}

vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}

vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}

vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}

vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}

vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}

vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}

vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}

vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}

vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}

const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}

const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}
`,da=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vec3 cameraToFrag;

		if ( isOrthographic ) {

			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		}  else {

			cameraToFrag = normalize( vWorldPosition - cameraPosition );

		}

		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vec3 reflectVec = reflect( cameraToFrag, worldNormal );

		#else

			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );

		#endif

	#else

		vec3 reflectVec = vReflect;

	#endif

	#ifdef ENVMAP_TYPE_CUBE

		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#elif defined( ENVMAP_TYPE_CUBE_UV )

		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );

	#elif defined( ENVMAP_TYPE_EQUIREC )

		vec2 sampleUV;

		reflectVec = normalize( reflectVec );

		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;

		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;

		vec4 envColor = texture2D( envMap, sampleUV );

	#elif defined( ENVMAP_TYPE_SPHERE )

		reflectVec = normalize( reflectVec );

		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );

		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );

	#else

		vec4 envColor = vec4( 0.0 );

	#endif

	#ifndef ENVMAP_TYPE_CUBE_UV

		envColor = envMapTexelToLinear( envColor );

	#endif

	#ifdef ENVMAP_BLENDING_MULTIPLY

		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_MIX )

		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_ADD )

		outgoingLight += envColor.xyz * specularStrength * reflectivity;

	#endif

#endif
`,va=`
#ifdef USE_ENVMAP

	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;

	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif
`,pa=`
#ifdef USE_ENVMAP

	uniform float reflectivity;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS

		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif

#endif
`,ma=`
#ifdef USE_ENVMAP

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;

	#else

		varying vec3 vReflect;
		uniform float refractionRatio;

	#endif

#endif
`,ga=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vWorldPosition = worldPosition.xyz;

	#else

		vec3 cameraToVertex;

		if ( isOrthographic ) { 

			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );

		}

		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vReflect = reflect( cameraToVertex, worldNormal );

		#else

			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );

		#endif

	#endif

#endif
`,_a=`
#ifdef USE_FOG

	fogDepth = -mvPosition.z;

#endif
`,ba=`
#ifdef USE_FOG

	varying float fogDepth;

#endif
`,ya=`
#ifdef USE_FOG

	#ifdef FOG_EXP2

		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );

	#else

		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );

	#endif

	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );

#endif
`,wa=`
#ifdef USE_FOG

	uniform vec3 fogColor;
	varying float fogDepth;

	#ifdef FOG_EXP2

		uniform float fogDensity;

	#else

		uniform float fogNear;
		uniform float fogFar;

	#endif

#endif
`,xa=`

#ifdef USE_GRADIENTMAP

	uniform sampler2D gradientMap;

#endif

vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {

	// dotNL will be from -1.0 to 1.0
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );

	#ifdef USE_GRADIENTMAP

		return texture2D( gradientMap, coord ).rgb;

	#else

		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );

	#endif

}

`,Ma=`
#ifdef USE_LIGHTMAP

	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;

#endif
`,Ea=`
#ifdef USE_LIGHTMAP

	uniform sampler2D lightMap;
	uniform float lightMapIntensity;

#endif
`,La=`
vec3 diffuse = vec3( 1.0 );

GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );

GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;

vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );

#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif

IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;

#if NUM_POINT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_SPOT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;

		#endif
	}
	#pragma unroll_loop_end

#endif

/*
#if NUM_RECT_AREA_LIGHTS > 0

	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		// TODO (abelnation): implement

	}

#endif
*/

#if NUM_DIR_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_HEMI_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );

		#ifdef DOUBLE_SIDED

			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );

		#endif

	}
	#pragma unroll_loop_end

#endif
`,Ta=`
uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];

vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

	// normal is assumed to have unit length

	float x = normal.x, y = normal.y, z = normal.z;

	// band 0
	vec3 result = shCoefficients[ 0 ] * 0.886227;

	// band 1
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

	// band 2
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );

	return result;

}

vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {

	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );

	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );

	return irradiance;

}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {

	vec3 irradiance = ambientLightColor;

	#ifndef PHYSICALLY_CORRECT_LIGHTS

		irradiance *= PI;

	#endif

	return irradiance;

}

#if NUM_DIR_LIGHTS > 0

	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};

	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];

	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif


	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {

		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;

	}

#endif


#if NUM_POINT_LIGHTS > 0

	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};

	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];

	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0

		struct PointLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {

		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );

		float lightDistance = length( lVector );

		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );

	}

#endif


#if NUM_SPOT_LIGHTS > 0

	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};

	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0

		struct SpotLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {

		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );

		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );

		if ( angleCos > spotLight.coneCos ) {

			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );

			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;

		} else {

			directLight.color = vec3( 0.0 );
			directLight.visible = false;

		}
	}

#endif


#if NUM_RECT_AREA_LIGHTS > 0

	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};

	uniform sampler2D ltc_1; // RGBA Float
	uniform sampler2D ltc_2; // RGBA Float

	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];

#endif


#if NUM_HEMI_LIGHTS > 0

	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};

	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];

	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {

		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;

		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );

		#ifndef PHYSICALLY_CORRECT_LIGHTS

			irradiance *= PI;

		#endif

		return irradiance;

	}

#endif
`,Sa=`
#if defined( USE_ENVMAP )

	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif

	vec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {

		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );

		#ifdef ENVMAP_TYPE_CUBE

			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );

			#ifdef TEXTURE_LOD_EXT

				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );

			#else

				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );

			#endif

			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;

		#elif defined( ENVMAP_TYPE_CUBE_UV )

			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );

		#else

			vec4 envMapColor = vec4( 0.0 );

		#endif

		return PI * envMapColor.rgb * envMapIntensity;

	}

	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {

		float maxMIPLevelScalar = float( maxMIPLevel );

		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );

		// clamp to allowable LOD ranges.
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );

	}

	vec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {

		#ifdef ENVMAP_MODE_REFLECTION

		  vec3 reflectVec = reflect( -viewDir, normal );

		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );

		#else

		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );

		#endif

		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );

		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );

		#ifdef ENVMAP_TYPE_CUBE

			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );

			#ifdef TEXTURE_LOD_EXT

				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );

			#else

				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );

			#endif

			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;

		#elif defined( ENVMAP_TYPE_CUBE_UV )

			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );

		#elif defined( ENVMAP_TYPE_EQUIREC )

			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;

			#ifdef TEXTURE_LOD_EXT

				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );

			#else

				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );

			#endif

			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;

		#elif defined( ENVMAP_TYPE_SPHERE )

			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );

			#ifdef TEXTURE_LOD_EXT

				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );

			#else

				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );

			#endif

			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;

		#endif

		return envMapColor.rgb * envMapIntensity;

	}

#endif
`,Aa=`
ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`,Oa=`
varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif


struct ToonMaterial {

	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;

};

void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	#ifndef PHYSICALLY_CORRECT_LIGHTS

		irradiance *= PI; // punctual light

	#endif

	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon

#define Material_LightProbeLOD( material )	(0)
`,Ca=`
BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`,Ra=`
varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif


struct BlinnPhongMaterial {

	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;

	#ifndef PHYSICALLY_CORRECT_LIGHTS

		irradiance *= PI; // punctual light

	#endif

	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong

#define Material_LightProbeLOD( material )	(0)
`,Na=`
PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );

vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );

material.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.
material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );

#ifdef REFLECTIVITY

	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );

#else

	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );

#endif

#ifdef CLEARCOAT

	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;

	#ifdef USE_CLEARCOATMAP

		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;

	#endif

	#ifdef USE_CLEARCOAT_ROUGHNESSMAP

		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;

	#endif

	material.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model
	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );

#endif

#ifdef USE_SHEEN

	material.sheenColor = sheen;

#endif
`,Da=`
struct PhysicalMaterial {

	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;

#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif

};

#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04

float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {

	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );

}

#if NUM_RECT_AREA_LIGHTS > 0

	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;

		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction
		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;

		vec2 uv = LTC_Uv( normal, viewDir, roughness );

		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );

		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);

		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );

		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );

		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );

	}

#endif

void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );

	vec3 irradiance = dotNL * directLight.color;

	#ifndef PHYSICALLY_CORRECT_LIGHTS

		irradiance *= PI; // punctual light

	#endif

	#ifdef CLEARCOAT

		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );

		vec3 ccIrradiance = ccDotNL * directLight.color;

		#ifndef PHYSICALLY_CORRECT_LIGHTS

			ccIrradiance *= PI; // punctual light

		#endif

		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );

		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );

	#else

		float clearcoatDHR = 0.0;

	#endif

	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif

	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}

void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );

}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {

	#ifdef CLEARCOAT

		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );

		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );

		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );

	#else

		float clearcoatDHR = 0.0;

	#endif

	float clearcoatInv = 1.0 - clearcoatDHR;

	// Both indirect specular and indirect diffuse light accumulate here

	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;

	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );

	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );

	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;

	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;

}

#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical

float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}
`,ka=`
/**
 * This is a template that can be used to light a material, it uses pluggable
 * RenderEquations (RE)for specific lighting scenarios.
 *
 * Instructions for use:
 * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined
 * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???
 * - Create a material parameter that is to be passed as the third parameter to your lighting functions.
 *
 * TODO:
 * - Add area light support.
 * - Add sphere light support.
 * - Add diffuse light probe (irradiance cubemap) support.
 */

GeometricContext geometry;

geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

#ifdef CLEARCOAT

	geometry.clearcoatNormal = clearcoatNormal;

#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointDirectLightIrradiance( pointLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotDirectLightIrradiance( spotLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	irradiance += getLightProbeIrradiance( lightProbe, geometry );

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,Pa=`
#if defined( RE_IndirectDiffuse )

	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;

		#ifndef PHYSICALLY_CORRECT_LIGHTS

			lightMapIrradiance *= PI;

		#endif

		irradiance += lightMapIrradiance;

	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )

		iblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );

	#endif

#endif

#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )

	radiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );

	#ifdef CLEARCOAT

		clearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );

	#endif

#endif
`,Ia=`
#if defined( RE_IndirectDiffuse )

	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );

#endif

#if defined( RE_IndirectSpecular )

	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );

#endif
`,Fa=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;

#endif
`,ja=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;

#endif
`,Ga=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		varying float vFragDepth;
		varying float vIsPerspective;

	#else

		uniform float logDepthBufFC;

	#endif

#endif
`,Ua=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );

	#else

		if ( isPerspectiveMatrix( projectionMatrix ) ) {

			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;

			gl_Position.z *= gl_Position.w;

		}

	#endif

#endif
`,Ha=`
#ifdef USE_MAP

	vec4 texelColor = texture2D( map, vUv );

	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;

#endif
`,Ba=`
#ifdef USE_MAP

	vec4 texelColor = texture2D( map, vUv );

	texelColor = mapTexelToLinear( texelColor );
	
	if(mapMixColor){
	    diffuseColor = texelColor*texelColor.a + diffuseColor*(1.0-texelColor.a);
	}else {
	    diffuseColor *= texelColor;
	}

#endif
`,za=`
#ifdef USE_MAP

	uniform sampler2D map;

#endif
`,Va=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;

#endif

#ifdef USE_MAP

	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );

#endif

#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, uv ).g;

#endif
`,Wa=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	uniform mat3 uvTransform;

#endif

#ifdef USE_MAP

	uniform sampler2D map;

#endif

#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`,Ya=`
float metalnessFactor = metalness;

#ifdef USE_METALNESSMAP

	vec4 texelMetalness = texture2D( metalnessMap, vUv );

	metalnessFactor *= texelMetalness.b;

#endif
`,Xa=`
#ifdef USE_METALNESSMAP

	uniform sampler2D metalnessMap;

#endif
`,Za=`
#ifdef USE_MORPHNORMALS

	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];

#endif
`,qa=`
#ifdef USE_MORPHTARGETS

	uniform float morphTargetBaseInfluence;

	#ifndef USE_MORPHNORMALS

	uniform float morphTargetInfluences[ 8 ];

	#else

	uniform float morphTargetInfluences[ 4 ];

	#endif

#endif
`,Ja=`
#ifdef USE_MORPHTARGETS

	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];

	#ifndef USE_MORPHNORMALS

	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];

	#endif

#endif
`,Ka=`
#ifdef FLAT_SHADED

	// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...

	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );

#else

	vec3 normal = normalize( vNormal );

	#ifdef DOUBLE_SIDED

		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );

	#endif

	#ifdef USE_TANGENT

		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );

		#ifdef DOUBLE_SIDED

			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );

		#endif

		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )

			mat3 vTBN = mat3( tangent, bitangent, normal );

		#endif

	#endif

#endif

// non perturbed normal for clearcoat among others

vec3 geometryNormal = normal;

`,Qa=`

#ifdef OBJECTSPACE_NORMALMAP

	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

	#ifdef FLIP_SIDED

		normal = - normal;

	#endif

	#ifdef DOUBLE_SIDED

		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );

	#endif

	normal = normalize( normalMatrix * normal );

#elif defined( TANGENTSPACE_NORMALMAP )

	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;

	#ifdef USE_TANGENT

		normal = normalize( vTBN * mapN );

	#else

		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );

	#endif

#elif defined( USE_BUMPMAP )

	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );

#endif
`,$a=`
#ifdef USE_NORMALMAP

	uniform sampler2D normalMap;
	uniform vec2 normalScale;

#endif

#ifdef OBJECTSPACE_NORMALMAP

	uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )

	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );

		float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude

		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );

		mat3 tsn = mat3( S, T, N );

		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );

		return normalize( tsn * mapN );

	}

#endif
`,th=`
#ifdef CLEARCOAT

	vec3 clearcoatNormal = geometryNormal;

#endif
`,eh=`
#ifdef USE_CLEARCOAT_NORMALMAP

	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;

	#ifdef USE_TANGENT

		clearcoatNormal = normalize( vTBN * clearcoatMapN );

	#else

		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );

	#endif

#endif
`,ih=`

#ifdef USE_CLEARCOATMAP

	uniform sampler2D clearcoatMap;

#endif

#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform sampler2D clearcoatRoughnessMap;

#endif

#ifdef USE_CLEARCOAT_NORMALMAP

	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;

#endif
`,rh=`
vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}

vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}

const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)

const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

const float ShiftRight8 = 1. / 256.;

vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8; // tidy overflow
	return r * PackUpscale;
}

float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}

vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}

// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions

float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}

float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`,nh=`
#ifdef PREMULTIPLIED_ALPHA

	gl_FragColor.rgb *= gl_FragColor.a;

#endif
`,sh=`
vec4 mvPosition = vec4( transformed, 1.0 );

#ifdef USE_INSTANCING

	mvPosition = instanceMatrix * mvPosition;

#endif

mvPosition = modelViewMatrix * mvPosition;

gl_Position = projectionMatrix * mvPosition;
`,oh=`
#ifdef DITHERING

	gl_FragColor.rgb = dithering( gl_FragColor.rgb );

#endif
`,ah=`
#ifdef DITHERING

	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );

		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );

		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );

		return color + dither_shift_RGB;
	}

#endif
`,hh=`
float roughnessFactor = roughness;

#ifdef USE_ROUGHNESSMAP

	vec4 texelRoughness = texture2D( roughnessMap, vUv );

	roughnessFactor *= texelRoughness.g;

#endif
`,lh=`
#ifdef USE_ROUGHNESSMAP

	uniform sampler2D roughnessMap;

#endif
`,uh=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): create uniforms for area light shadows

	#endif
	*/

	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

	}

	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

		return unpackRGBATo2Half( texture2D( shadow, uv ) );

	}

	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

		float occlusion = 1.0;

		vec2 distribution = texture2DDistribution( shadow, uv );

		float hard_shadow = step( compare , distribution.x ); // Hard Shadow

		if (hard_shadow != 1.0 ) {

			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

		}
		return occlusion;

	}

	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

		float shadow = 1.0;

		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;

		// if ( something && something ) breaks ATI OpenGL shader compiler
		// if ( all( something, something ) ) using this instead

		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );

		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

		bool frustumTest = all( frustumTestVec );

		if ( frustumTest ) {

		#if defined( SHADOWMAP_TYPE_PCF )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;

			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;

			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );

		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;

			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;

			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );

		#elif defined( SHADOWMAP_TYPE_VSM )

			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

		#else // no percentage-closer filtering:

			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

		#endif

		}

		return shadow;

	}

	vec2 cubeToUV( vec3 v, float texelSizeY ) {

		// Number of texels to avoid at the edge of each square

		vec3 absV = abs( v );

		// Intersect unit cube

		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;

		// Apply scale to avoid seams

		// two texels less per square (one texel will do for NEAREST)
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );


		vec2 planar = v.xy;

		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;

		if ( absV.z >= almostOne ) {

			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;

		} else if ( absV.x >= almostOne ) {

			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;

		} else if ( absV.y >= almostOne ) {

			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;

		}

		// Transform to UV space

		// scale := 0.5 / dim
		// translate := ( center + 0.5 ) / dim
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

	}

	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

		vec3 lightToPosition = shadowCoord.xyz;

		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
		dp += shadowBias;

		vec3 bd3D = normalize( lightToPosition );

		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )

			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;

			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );

		#else // no percentage-closer filtering

			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );

		#endif

	}

#endif
`,ch=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): uniforms for area light shadows

	#endif
	*/

#endif
`,fh=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update vAreaShadowCoord with area light info

	#endif
	*/

#endif
`,dh=`
float getShadowMask() {

	float shadow = 1.0;

	#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

	DirectionalLightShadow directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	SpotLightShadow spotLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	PointLightShadow pointLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update shadow for Area light

	#endif
	*/

	#endif

	return shadow;

}
`,vh=`
#ifdef USE_SKINNING

	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );

#endif
`,ph=`
#ifdef USE_SKINNING

	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;

	#ifdef BONE_TEXTURE

		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;

		mat4 getBoneMatrix( const in float i ) {

			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );

			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );

			y = dy * ( y + 0.5 );

			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );

			mat4 bone = mat4( v1, v2, v3, v4 );

			return bone;

		}

	#else

		uniform mat4 boneMatrices[ MAX_BONES ];

		mat4 getBoneMatrix( const in float i ) {

			mat4 bone = boneMatrices[ int(i) ];
			return bone;

		}

	#endif

#endif
`,mh=`
#ifdef USE_SKINNING

	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );

	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;

	transformed = ( bindMatrixInverse * skinned ).xyz;

#endif
`,gh=`
#ifdef USE_SKINNING

	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;

	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;

	#ifdef USE_TANGENT

		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#endif

#endif
`,_h=`
float specularStrength;

#ifdef USE_SPECULARMAP

	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;

#else

	specularStrength = 1.0;

#endif
`,bh=`
#ifdef USE_SPECULARMAP

	uniform sampler2D specularMap;

#endif
`,yh=`
#if defined( TONE_MAPPING )

	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );

#endif
`,wh=`
#ifndef saturate
// <common> may have defined saturate() already
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif

uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;

vec3 LinearToneMapping( vec3 color ) {

	return toneMappingExposure * color;

}

vec3 ReinhardToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );

}

#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );

}

vec3 OptimizedCineonToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );

}

vec3 ACESFilmicToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );

}
`,xh=`
#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )

	varying vec2 vUv;

#endif
`,Mh=`
#ifdef USE_UV

	#ifdef UVS_VERTEX_ONLY

		vec2 vUv;

	#else

		varying vec2 vUv;

	#endif

	uniform mat3 uvTransform;

#endif
`,Eh=`
#ifdef USE_UV

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

#endif
`,Lh=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	varying vec2 vUv2;

#endif
`,Th=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	attribute vec2 uv2;
	varying vec2 vUv2;

	uniform mat3 uv2Transform;

#endif
`,Sh=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;

#endif
`,Ah=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )

	vec4 worldPosition = vec4( transformed, 1.0 );

	#ifdef USE_INSTANCING

		worldPosition = instanceMatrix * worldPosition;

	#endif

	worldPosition = modelMatrix * worldPosition;

#endif
`,Oh=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

	vec4 texColor = texture2D( t2D, vUv );

	gl_FragColor = mapTexelToLinear( texColor );

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`,Ch=`
varying vec2 vUv;
uniform mat3 uvTransform;

void main() {

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

	gl_Position = vec4( position.xy, 1.0, 1.0 );

}
`,Rh=`

#include <envmap_common_pars_fragment>
uniform float opacity;

varying vec3 vWorldDirection;

#include <cube_uv_reflection_fragment>

void main() {

	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>

	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`,Nh=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

	gl_Position.z = gl_Position.w; // set z to camera.far

}
`,Dh=`
#if DEPTH_PACKING == 3200

	uniform float opacity;

#endif

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec2 vHighPrecisionZW;

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#if DEPTH_PACKING == 3200

		diffuseColor.a = opacity;

	#endif

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	#include <logdepthbuf_fragment>

	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;

	#if DEPTH_PACKING == 3200

		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );

	#elif DEPTH_PACKING == 3201

		gl_FragColor = packDepthToRGBA( fragCoordZ );

	#endif

}
`,kh=`
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

varying vec2 vHighPrecisionZW;

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vHighPrecisionZW = gl_Position.zw;

}
`,Ph=`
#define DISTANCE

uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>

void main () {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist ); // clamp to [ 0, 1 ]

	gl_FragColor = packDepthToRGBA( dist );

}
`,Ih=`
#define DISTANCE

varying vec3 vWorldPosition;

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>

	vWorldPosition = worldPosition.xyz;

}
`,Fh=`
uniform sampler2D tEquirect;

varying vec3 vWorldDirection;

#include <common>

void main() {

	vec3 direction = normalize( vWorldDirection );

	vec2 sampleUV;

	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;

	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;

	vec4 texColor = texture2D( tEquirect, sampleUV );

	gl_FragColor = mapTexelToLinear( texColor );

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`,jh=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

}
`,Gh=`
uniform vec3 diffuse;
uniform float opacity;

uniform float dashSize;
uniform float totalSize;

varying float vLineDistance;

#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	if ( mod( vLineDistance, totalSize ) > dashSize ) {

		discard;

	}

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <color_fragment>

	outgoingLight = diffuseColor.rgb; // simple shader

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,Uh=`
uniform float scale;
attribute float lineDistance;

varying float vLineDistance;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	vLineDistance = scale * lineDistance;

	#include <color_vertex>
	#include <begin_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,Hh=`
uniform vec3 diffuse;
uniform float opacity;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	// accumulation (baked indirect lighting only)
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;

	#else

		reflectedLight.indirectDiffuse += vec3( 1.0 );

	#endif

	// modulation
	#include <aomap_fragment>

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

	#include <envmap_fragment>

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,Bh=`
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>

	#ifdef USE_ENVMAP

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>

	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>

}
`,zh=`
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif


#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>

	// accumulation
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );

	#ifdef DOUBLE_SIDED

		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

	#else

		reflectedLight.indirectDiffuse += vIndirectFront;

	#endif

	#include <lightmap_fragment>

	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );

	#ifdef DOUBLE_SIDED

		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

	#else

		reflectedLight.directDiffuse = vLightFront;

	#endif

	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <envmap_fragment>

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`,Vh=`
#define LAMBERT

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,Wh=`
#define MATCAP

uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>

#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks

	#ifdef USE_MATCAP

		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );

	#else

		vec4 matcapColor = vec4( 1.0 );

	#endif

	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,Yh=`
#define MATCAP

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

		vNormal = normalize( transformedNormal );

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

	vViewPosition = - mvPosition.xyz;

}
`,Xh=`
#define TOON

uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,Zh=`
#define TOON

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,qh=`
#define PHONG

uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	#include <envmap_fragment>

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,Jh=`
#define PHONG

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,Kh=`
#define STANDARD

#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef TRANSPARENCY
	uniform float transparency;
#endif

#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif

#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif

#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	// this is a stub for the transparency model
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,Qh=`
#define STANDARD

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

	#ifdef USE_TANGENT

		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );

	#endif

#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,$h=`
#define NORMAL

uniform float opacity;

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif

#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );

}
`,tl=`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

	#ifdef USE_TANGENT

		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );

	#endif

#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	vViewPosition = - mvPosition.xyz;

#endif

}
`,el=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,il=`
uniform float size;
uniform float scale;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>

	gl_PointSize = size;

	#ifdef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );

	#endif

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>

}
`,rl=`
uniform vec3 color;
uniform float opacity;

#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>

void main() {

	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`,nl=`
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>

void main() {

	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,sl=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`,ol=`
uniform float rotation;
uniform vec2 center;

#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	#ifndef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) scale *= - mvPosition.z;

	#endif

	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,b={alphamap_fragment:Ho,alphamap_pars_fragment:Bo,alphatest_fragment:zo,aomap_fragment:Vo,aomap_pars_fragment:Wo,begin_vertex:Yo,beginnormal_vertex:Xo,bsdfs:Zo,bumpmap_pars_fragment:qo,clipping_planes_fragment:Jo,clipping_planes_pars_fragment:Ko,clipping_planes_pars_vertex:Qo,clipping_planes_vertex:$o,color_fragment:ta,color_pars_fragment:ea,color_pars_vertex:ia,color_vertex:ra,common:na,cube_uv_reflection_fragment:sa,defaultnormal_vertex:oa,displacementmap_pars_vertex:aa,displacementmap_vertex:ha,emissivemap_fragment:la,emissivemap_pars_fragment:ua,encodings_fragment:ca,encodings_pars_fragment:fa,envmap_fragment:da,envmap_common_pars_fragment:va,envmap_pars_fragment:pa,envmap_pars_vertex:ma,envmap_physical_pars_fragment:Sa,envmap_vertex:ga,fog_vertex:_a,fog_pars_vertex:ba,fog_fragment:ya,fog_pars_fragment:wa,gradientmap_pars_fragment:xa,lightmap_fragment:Ma,lightmap_pars_fragment:Ea,lights_lambert_vertex:La,lights_pars_begin:Ta,lights_toon_fragment:Aa,lights_toon_pars_fragment:Oa,lights_phong_fragment:Ca,lights_phong_pars_fragment:Ra,lights_physical_fragment:Na,lights_physical_pars_fragment:Da,lights_fragment_begin:ka,lights_fragment_maps:Pa,lights_fragment_end:Ia,logdepthbuf_fragment:Fa,logdepthbuf_pars_fragment:ja,logdepthbuf_pars_vertex:Ga,logdepthbuf_vertex:Ua,map_fragment:Ha,map_fragment_1:Ba,map_pars_fragment:za,map_particle_fragment:Va,map_particle_pars_fragment:Wa,metalnessmap_fragment:Ya,metalnessmap_pars_fragment:Xa,morphnormal_vertex:Za,morphtarget_pars_vertex:qa,morphtarget_vertex:Ja,normal_fragment_begin:Ka,normal_fragment_maps:Qa,normalmap_pars_fragment:$a,clearcoat_normal_fragment_begin:th,clearcoat_normal_fragment_maps:eh,clearcoat_pars_fragment:ih,packing:rh,premultiplied_alpha_fragment:nh,project_vertex:sh,dithering_fragment:oh,dithering_pars_fragment:ah,roughnessmap_fragment:hh,roughnessmap_pars_fragment:lh,shadowmap_pars_fragment:uh,shadowmap_pars_vertex:ch,shadowmap_vertex:fh,shadowmask_pars_fragment:dh,skinbase_vertex:vh,skinning_pars_vertex:ph,skinning_vertex:mh,skinnormal_vertex:gh,specularmap_fragment:_h,specularmap_pars_fragment:bh,tonemapping_fragment:yh,tonemapping_pars_fragment:wh,uv_pars_fragment:xh,uv_pars_vertex:Mh,uv_vertex:Eh,uv2_pars_fragment:Lh,uv2_pars_vertex:Th,uv2_vertex:Sh,worldpos_vertex:Ah,background_frag:Oh,background_vert:Ch,cube_frag:Rh,cube_vert:Nh,depth_frag:Dh,depth_vert:kh,distanceRGBA_frag:Ph,distanceRGBA_vert:Ih,equirect_frag:Fh,equirect_vert:jh,linedashed_frag:Gh,linedashed_vert:Uh,meshbasic_frag:Hh,meshbasic_vert:Bh,meshlambert_frag:zh,meshlambert_vert:Vh,meshmatcap_frag:Wh,meshmatcap_vert:Yh,meshtoon_frag:Xh,meshtoon_vert:Zh,meshphong_frag:qh,meshphong_vert:Jh,meshphysical_frag:Kh,meshphysical_vert:Qh,normal_frag:$h,normal_vert:tl,points_frag:el,points_vert:il,shadow_frag:rl,shadow_vert:nl,sprite_frag:sl,sprite_vert:ol},al={basic:{uniforms:so([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:b.meshbasic_vert,fragmentShader:b.meshbasic_frag},lambert:{uniforms:so([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.fog,Ot.lights,{emissive:{value:new ft(0)}}]),vertexShader:b.meshlambert_vert,fragmentShader:b.meshlambert_frag},phong:{uniforms:so([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new ft(0)},specular:{value:new ft(1118481)},shininess:{value:30}}]),vertexShader:b.meshphong_vert,fragmentShader:b.meshphong_frag},standard:{uniforms:so([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new ft(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:b.meshphysical_vert,fragmentShader:b.meshphysical_frag},toon:{uniforms:so([Ot.common,Ot.specularmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new ft(0)},specular:{value:new ft(1118481)},shininess:{value:30}}]),vertexShader:b.meshtoon_vert,fragmentShader:b.meshtoon_frag},matcap:{uniforms:so([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:b.meshmatcap_vert,fragmentShader:b.meshmatcap_frag},points:{uniforms:so([Ot.points,Ot.fog]),vertexShader:b.points_vert,fragmentShader:b.points_frag},dashed:{uniforms:so([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:b.linedashed_vert,fragmentShader:b.linedashed_frag},depth:{uniforms:so([Ot.common,Ot.displacementmap]),vertexShader:b.depth_vert,fragmentShader:b.depth_frag},normal:{uniforms:so([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:b.normal_vert,fragmentShader:b.normal_frag},sprite:{uniforms:so([Ot.sprite,Ot.fog]),vertexShader:b.sprite_vert,fragmentShader:b.sprite_frag},background:{uniforms:{uvTransform:{value:new N},t2D:{value:null}},vertexShader:b.background_vert,fragmentShader:b.background_frag},cube:{uniforms:so([Ot.envmap,{opacity:{value:1}}]),vertexShader:b.cube_vert,fragmentShader:b.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:b.equirect_vert,fragmentShader:b.equirect_frag},distanceRGBA:{uniforms:so([Ot.common,Ot.displacementmap,{referencePosition:{value:new Lt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:b.distanceRGBA_vert,fragmentShader:b.distanceRGBA_frag},shadow:{uniforms:so([Ot.lights,Ot.fog,{color:{value:new ft(0)},opacity:{value:1}}]),vertexShader:b.shadow_vert,fragmentShader:b.shadow_frag}};function hl(s,i,o,r){var a,h,l=new ft(0),u=0,c=null,f=0,d=null;function v(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return l},setClearColor:function(t,e){l.set(t),v(l,u=void 0!==e?e:1)},getClearAlpha:function(){return u},setClearAlpha:function(t){v(l,u=t)},render:function(t,e,i,r){var e=e.background,n=(n=s.xr).getSession&&n.getSession();null===(e=n&&"additive"===n.environmentBlendMode?null:e)?v(l,u):e&&e.isColor&&(v(e,1),r=!0),(s.autoClear||r)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),e&&(e.isCubeTexture||e.isWebGLCubeRenderTarget||e.mapping===Ve)?(void 0===h&&((h=new Q(new to(1,1,1),new g({type:"BackgroundCubeMaterial",uniforms:no(al.cube.uniforms),vertexShader:al.cube.vertexShader,fragmentShader:al.cube.fragmentShader,side:Jt,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(h)),n=e.isWebGLCubeRenderTarget?e.texture:e,h.material.uniforms.envMap.value=n,h.material.uniforms.flipEnvMap.value=n.isCubeTexture?-1:1,c===e&&f===n.version&&d===s.toneMapping||(h.material.needsUpdate=!0,c=e,f=n.version,d=s.toneMapping),t.unshift(h,h.geometry,h.material,0,0,null)):e&&e.isTexture&&(void 0===a&&((a=new Q(new eo(2,2),new g({type:"BackgroundMaterial",uniforms:no(al.background.uniforms),vertexShader:al.background.vertexShader,fragmentShader:al.background.fragmentShader,side:qt,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(a)),!0===(a.material.uniforms.t2D.value=e).matrixAutoUpdate&&e.updateMatrix(),a.material.uniforms.uvTransform.value.copy(e.matrix),c===e&&f===e.version&&d===s.toneMapping||(a.material.needsUpdate=!0,f=(c=e).version,d=s.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null))}}}function ll(o,a,h,t){var l,u=t.isWebGL2;this.setMode=function(t){l=t},this.render=function(t,e){o.drawArrays(l,t,e),h.update(e,l)},this.renderInstances=function(t,e,i,r){if(0!==r){var n,s;if(u)n=o,s="drawArraysInstanced";else if(s="drawArraysInstancedANGLE",null===(n=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[s](l,e,i,r),h.update(i,l,r)}}}function ul(e,i,t){var r;function n(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==t.precision?t.precision:"highp",a=n(o),a=(a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a),!0===t.logarithmicDepthBuffer),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),c=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),d=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),p=0<h,m=s||!!i.get("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:function(){var t;return void 0===r&&(t=i.get("EXT_texture_filter_anisotropic"),r=null!==t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0),r},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:a,maxTextures:t,maxVertexTextures:h,maxTextureSize:l,maxCubemapSize:u,maxAttributes:c,maxVertexUniforms:f,maxVaryings:d,maxFragmentUniforms:v,vertexTextures:p,floatFragmentTextures:m,floatVertexTextures:p&&m,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function cl(){var l=this,u=null,c=0,f=!1,d=!1,v=new Ft,p=new N,m={value:null,needsUpdate:!1};function g(){m.value!==u&&(m.value=u,m.needsUpdate=0<c),l.numPlanes=c,l.numIntersection=0}function _(t,e,i,r){var n=null!==t?t.length:0,s=null;if(0!==n){if(s=m.value,!0!==r||null===s){var r=i+4*n,o=e.matrixWorldInverse;p.getNormalMatrix(o),(null===s||s.length<r)&&(s=new Float32Array(r));for(var a=0,h=i;a!==n;++a,h+=4)v.copy(t[a]).applyMatrix4(o,p),v.normal.toArray(s,h),s[h+3]=v.constant}m.value=s,m.needsUpdate=!0}return l.numPlanes=n,l.numIntersection=0,s}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,i){var r=0!==t.length||e||0!==c||f;return f=e,u=_(t,i,0),c=t.length,r},this.beginShadows=function(){d=!0,_(null)},this.endShadows=function(){d=!1,g()},this.setState=function(t,e,i,r,n,s){if(!f||null===t||0===t.length||d&&!i)d?_(null):g();else{var i=d?0:c,o=4*i,a=n.clippingState||null;m.value=a;for(var a=_(t,r,o,s),h=0;h!==o;++h)a[h]=u[h];n.clippingState=a,this.numIntersection=e?this.numPlanes:0,this.numPlanes+=i}}}function fl(i){var r={};return{get:function(t){if(void 0!==r[t])return r[t];var e;switch(t){case"WEBGL_depth_texture":e=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=i.getExtension(t)}return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),r[t]=e}}}function dl(c,f,r){var n=new WeakMap,d=new WeakMap;function s(t){var e,t=t.target,i=n.get(t);for(e in null!==i.index&&f.remove(i.index),i.attributes)f.remove(i.attributes[e]);t.removeEventListener("dispose",s),n.delete(t);t=d.get(i);t&&(f.remove(t),d.delete(i)),r.memory.geometries--}function o(t){var e=[],i=t.index,r=t.attributes.position,n=0;if(null!==i)for(var s=i.array,n=i.version,o=0,a=s.length;o<a;o+=3){var h=s[o+0],l=s[o+1],u=s[o+2];e.push(h,l,l,u,u,h)}else{s=r.array;n=r.version;for(o=0,a=s.length/3-1;o<a;o+=3){h=o+0,l=o+1,u=o+2;e.push(h,l,l,u,u,h)}}i=new(65535<Ys(e)?zs:Hs)(e,1),i.version=n,f.update(i,c.ELEMENT_ARRAY_BUFFER),r=d.get(t);r&&f.remove(r),d.set(t,i)}return{get:function(t,e){var i=n.get(e);return i||(e.addEventListener("dispose",s),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e.an&&(e.an=(new et).setFromObject(t)),i=e.an),n.set(e,i),r.memory.geometries++),i},update:function(t){var e=t.index,i=t.attributes;for(r in null!==e&&f.update(e,c.ELEMENT_ARRAY_BUFFER),i)f.update(i[r],c.ARRAY_BUFFER);var r,n=t.morphAttributes;for(r in n)for(var s=n[r],o=0,a=s.length;o<a;o++)f.update(s[o],c.ARRAY_BUFFER)},getWireframeAttribute:function(t){var e,i=d.get(t);return(!i||null!==(e=t.index)&&i.version<e.version)&&o(t),d.get(t)}}}function vl(o,a,h,t){var l,u,c,f=t.isWebGL2;this.setMode=function(t){l=t},this.setIndex=function(t){u=t.type,c=t.bytesPerElement},this.render=function(t,e){o.drawElements(l,e,u,t*c),h.update(e,l)},this.renderInstances=function(t,e,i,r){if(0!==r){var n,s;if(f)n=o,s="drawElementsInstanced";else if(s="drawElementsInstancedANGLE",null===(n=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[s](l,i,u,e*c,r),h.update(i,l,r)}}}function pl(r){var n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function(t,e,i){switch(i=i||1,n.calls++,e){case r.TRIANGLES:n.triangles+=i*(t/3);break;case r.LINES:n.lines+=i*(t/2);break;case r.LINE_STRIP:n.lines+=i*(t-1);break;case r.LINE_LOOP:n.lines+=i*t;break;case r.POINTS:n.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e)}}}}function ml(t,e){return Math.abs(e[1])-Math.abs(t[1])}function gl(v){var p={},m=new Float32Array(8);return{update:function(t,e,i,r){var n=t.morphTargetInfluences,s=void 0===n?0:n.length;if(void 0===(o=p[e.id])){for(var o=[],a=0;a<s;a++)o[a]=[a,0];p[e.id]=o}for(var h=i.morphTargets&&e.morphAttributes.position,l=i.morphNormals&&e.morphAttributes.normal,a=0;a<s;a++)0!==(u=o[a])[1]&&(h&&e.deleteAttribute("morphTarget"+a),l)&&e.deleteAttribute("morphNormal"+a);for(a=0;a<s;a++)(u=o[a])[0]=a,u[1]=n[a];o.sort(ml);for(var u,c=0,a=0;a<8;a++){if(u=o[a]){var f=u[0],d=u[1];if(d){h&&e.setAttribute("morphTarget"+a,h[f]),l&&e.setAttribute("morphNormal"+a,l[f]),c+=m[a]=d;continue}}m[a]=0}t=e.morphTargetsRelative?1:1-c,r.getUniforms().setValue(v,"morphTargetBaseInfluence",t),r.getUniforms().setValue(v,"morphTargetInfluences",m)}}}function _l(n,s,o,a){var h=new WeakMap;return{update:function(t){var e=a.render.frame,i=t.geometry,r=s.get(t,i);return h.get(r)!==e&&(i.isGeometry&&r.updateFromObject(t),s.update(r),h.set(r,e)),t.isInstancedMesh&&o.update(t.instanceMatrix,n.ARRAY_BUFFER),r},dispose:function(){h=new WeakMap}}}function bl(t,e,i,r,n,s,o,a,h,l){f.call(this,t=void 0!==t?t:[],e=void 0!==e?e:Ge,i,r,n,s,o=void 0!==o?o:pi,a,h,l),this.flipY=!1}function yl(t,e,i,r){f.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:r||1},this.magFilter=qe,this.minFilter=qe,this.wrapR=Xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function wl(t,e,i,r){f.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:r||1},this.magFilter=qe,this.minFilter=qe,this.wrapR=Xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}al.physical={uniforms:so([al.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new St(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ft(0)},transparency:{value:0}}]),vertexShader:b.meshphysical_vert,fragmentShader:b.meshphysical_frag},bl.prototype=Object.create(f.prototype),bl.prototype.constructor=bl,bl.prototype.isCubeTexture=!0,Object.defineProperty(bl.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),yl.prototype=Object.create(f.prototype),yl.prototype.constructor=yl,yl.prototype.isDataTexture2DArray=!0,wl.prototype=Object.create(f.prototype),wl.prototype.constructor=wl,wl.prototype.isDataTexture3D=!0;var xl=new f,Ml=new yl,El=new wl,Ll=new bl,Tl=[],Sl=[],Al=new Float32Array(16),Ol=new Float32Array(9),Cl=new Float32Array(4);function Rl(t,e,i){var r=t[0];if(r<=0||0<r)return t;var n=e*i,s=Tl[n];if(void 0===s&&(s=new Float32Array(n),Tl[n]=s),0!==e){r.toArray(s,0);for(var o=1,a=0;o!==e;++o)t[o].toArray(s,a+=i)}return s}function Nl(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function Dl(t,e){for(var i=0,r=e.length;i<r;i++)t[i]=e[i]}function kl(t,e){var i=Sl[e];void 0===i&&(i=new Int32Array(e),Sl[e]=i);for(var r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function Pl(t,e){var i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Il(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):Nl(i,e)||(t.uniform2fv(this.addr,e),Dl(i,e))}function Fl(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):void 0!==e.r?i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b):Nl(i,e)||(t.uniform3fv(this.addr,e),Dl(i,e))}function jl(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):Nl(i,e)||(t.uniform4fv(this.addr,e),Dl(i,e))}function Gl(t,e){var i=this.cache,r=e.elements;void 0===r?Nl(i,e)||(t.uniformMatrix2fv(this.addr,!1,e),Dl(i,e)):Nl(i,r)||(Cl.set(r),t.uniformMatrix2fv(this.addr,!1,Cl),Dl(i,r))}function Ul(t,e){var i=this.cache,r=e.elements;void 0===r?Nl(i,e)||(t.uniformMatrix3fv(this.addr,!1,e),Dl(i,e)):Nl(i,r)||(Ol.set(r),t.uniformMatrix3fv(this.addr,!1,Ol),Dl(i,r))}function Hl(t,e){var i=this.cache,r=e.elements;void 0===r?Nl(i,e)||(t.uniformMatrix4fv(this.addr,!1,e),Dl(i,e)):Nl(i,r)||(Al.set(r),t.uniformMatrix4fv(this.addr,!1,Al),Dl(i,r))}function Bl(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(e||xl,n)}function zl(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||Ml,n)}function Vl(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||El,n)}function Wl(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(e||Ll,n)}function Yl(t,e){var i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Xl(t,e){var i=this.cache;Nl(i,e)||(t.uniform2iv(this.addr,e),Dl(i,e))}function Zl(t,e){var i=this.cache;Nl(i,e)||(t.uniform3iv(this.addr,e),Dl(i,e))}function ql(t,e){var i=this.cache;Nl(i,e)||(t.uniform4iv(this.addr,e),Dl(i,e))}function Jl(t,e){var i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Kl(t){switch(t){case 5126:return Pl;case 35664:return Il;case 35665:return Fl;case 35666:return jl;case 35674:return Gl;case 35675:return Ul;case 35676:return Hl;case 5124:case 35670:return Yl;case 35667:case 35671:return Xl;case 35668:case 35672:return Zl;case 35669:case 35673:return ql;case 5125:return Jl;case 35678:case 36198:case 36298:case 36306:case 35682:return Bl;case 35679:case 36299:case 36307:return Vl;case 35680:case 36300:case 36308:case 36293:return Wl;case 36289:case 36303:case 36311:case 36292:return zl}}function Ql(t,e){t.uniform1fv(this.addr,e)}function $l(t,e){t.uniform1iv(this.addr,e)}function tu(t,e){t.uniform2iv(this.addr,e)}function eu(t,e){t.uniform3iv(this.addr,e)}function iu(t,e){t.uniform4iv(this.addr,e)}function ru(t,e){e=Rl(e,this.size,2);t.uniform2fv(this.addr,e)}function nu(t,e){e=Rl(e,this.size,3);t.uniform3fv(this.addr,e)}function su(t,e){e=Rl(e,this.size,4);t.uniform4fv(this.addr,e)}function ou(t,e){e=Rl(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,e)}function au(t,e){e=Rl(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,e)}function hu(t,e){e=Rl(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,e)}function lu(t,e,i){var r=e.length,n=kl(i,r);t.uniform1iv(this.addr,n);for(var s=0;s!==r;++s)i.safeSetTexture2D(e[s]||xl,n[s])}function uu(t,e,i){var r=e.length,n=kl(i,r);t.uniform1iv(this.addr,n);for(var s=0;s!==r;++s)i.safeSetTextureCube(e[s]||Ll,n[s])}function cu(t){switch(t){case 5126:return Ql;case 35664:return ru;case 35665:return nu;case 35666:return su;case 35674:return ou;case 35675:return au;case 35676:return hu;case 5124:case 35670:return $l;case 35667:case 35671:return tu;case 35668:case 35672:return eu;case 35669:case 35673:return iu;case 35678:case 36198:case 36298:case 36306:case 35682:return lu;case 35680:case 36300:case 36308:case 36293:return uu}}function fu(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=Kl(e.type)}function du(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=cu(e.type)}function vu(t){this.id=t,this.seq=[],this.map={}}du.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Dl(e,t)},vu.prototype.setValue=function(t,e,i){for(var r=this.seq,n=0,s=r.length;n!==s;++n){var o=r[n];o.setValue(t,e[o.id],i)}};var pu=/([\w\d_]+)(\])?(\[|\.)?/g;function mu(t,e){t.seq.push(e),t.map[e.id]=e}function gu(t,e,i){var r=t.name,n=r.length;for(pu.lastIndex=0;;){var s=pu.exec(r),o=pu.lastIndex,a=s[1],h=s[3];if("]"===s[2]&&(a|=0),void 0===h||"["===h&&o+2===n){mu(i,new(void 0===h?fu:du)(a,t,e));break}s=i.map[a];void 0===s&&mu(i,s=new vu(a)),i=s}}function _u(t,e){this.seq=[],this.map={};for(var i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=t.getActiveUniform(e,r);gu(n,t.getUniformLocation(e,n.name),this)}}function bu(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),e}_u.prototype.setValue=function(t,e,i,r){e=this.map[e];void 0!==e&&e.setValue(t,i,r)},_u.prototype.setOptional=function(t,e,i){e=e[i];void 0!==e&&this.setValue(t,i,e)},_u.upload=function(t,e,i,r){for(var n=0,s=e.length;n!==s;++n){var o=e[n],a=i[o.id];!1!==a.needsUpdate&&o.setValue(t,a.value,r)}},_u.seqWithValue=function(t,e){for(var i=[],r=0,n=t.length;r!==n;++r){var s=t[r];s.id in e&&i.push(s)}return i};var yu=0;function wu(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}function xu(t){switch(t){case Er:return["Linear","( value )"];case Lr:return["sRGB","( value )"];case Sr:return["RGBE","( value )"];case Or:return["RGBM","( value, 7.0 )"];case Cr:return["RGBM","( value, 16.0 )"];case Rr:return["RGBD","( value, 256.0 )"];case Tr:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Ar:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function Mu(t,e,i){var r=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();return r&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+wu(t.getShaderSource(e))}function Eu(t,e){e=xu(e);return"vec4 "+t+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function Lu(t,e){e=xu(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function Tu(t,e){var i;switch(e){case De:i="Linear";break;case ke:i="Reinhard";break;case Pe:i="Uncharted2";break;case Ie:i="OptimizedCineon";break;case Fe:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Su(t){var e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return"FMMeshStandardMaterial"===t.shaderName&&e.push("#extension GL_OES_standard_derivatives : enable"),e.filter(Cu).join("\n")}function Au(t){var e,i=[];for(e in t){var r=t[e];!1!==r&&i.push("#define "+e+" "+r)}return i.join("\n")}function Ou(t,e){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var s=t.getActiveAttrib(e,n).name;i[s]=t.getAttribLocation(e,s)}return i}function Cu(t){return""!==t}function Ru(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Nu(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Du=/^[ \t]*#include +<([\w\d./]+)>/gm;function ku(t){return t.replace(Du,Pu)}function Pu(t,e){var i=b[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return ku(i)}var Iu=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Fu=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function ju(t){return t.replace(Fu,Uu).replace(Iu,Gu)}function Gu(t,e,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Uu(t,e,i,r)}function Uu(t,e,i,r){for(var n="",s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[ i \]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function Hu(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Bu(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===Yt?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===Xt?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Zt&&(e="SHADOWMAP_TYPE_VSM"),e}function zu(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Ge:case Ue:e="ENVMAP_TYPE_CUBE";break;case Ve:case We:e="ENVMAP_TYPE_CUBE_UV";break;case He:case Be:e="ENVMAP_TYPE_EQUIREC";break;case ze:e="ENVMAP_TYPE_SPHERE"}return e}function Vu(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Ue:case Be:e="ENVMAP_MODE_REFRACTION"}return e}function Wu(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Oe:e="ENVMAP_BLENDING_MULTIPLY";break;case Ce:e="ENVMAP_BLENDING_MIX";break;case Re:e="ENVMAP_BLENDING_ADD"}return e}function Yu(t,e,i){var r,n,s,o,a,h=t.getContext(),l=i.defines,u=i.vertexShader,c=i.fragmentShader,f=Bu(i),d=zu(i),v=Vu(i),p=Wu(i),m=0<t.gammaFactor?t.gammaFactor:1,g=i.isWebGL2?"":Su(i),l=Au(l),_=h.createProgram(),m=(i.isRawShaderMaterial?(0<(r=[l].filter(Cu).join("\n")).length&&(r+="\n"),0<(n=[g,l].filter(Cu).join("\n")).length&&(n+="\n")):(r=[Hu(i),"#define SHADER_NAME "+i.shaderName,l,i.instancing?"#define USE_INSTANCING":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+v:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Cu).join("\n"),n=[g,Hu(i),"#define SHADER_NAME "+i.shaderName,l,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+v:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Ne?"#define TONE_MAPPING":"",i.toneMapping!==Ne?b.tonemapping_pars_fragment:"",i.toneMapping!==Ne?Tu("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.outputEncoding||i.mapEncoding||i.matcapEncoding||i.envMapEncoding||i.emissiveMapEncoding||i.lightMapEncoding?b.encodings_pars_fragment:"",i.mapEncoding?Eu("mapTexelToLinear",i.mapEncoding):"",i.matcapEncoding?Eu("matcapTexelToLinear",i.matcapEncoding):"",i.envMapEncoding?Eu("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMapEncoding?Eu("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMapEncoding?Eu("lightMapTexelToLinear",i.lightMapEncoding):"",i.outputEncoding?Lu("linearToOutputTexel",i.outputEncoding):"",i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Cu).join("\n")),u=Nu(u=Ru(u=ku(u),i),i),c=Nu(c=Ru(c=ku(c),i),i),u=ju(u),c=ju(c),i.isWebGL2&&!i.isRawShaderMaterial&&(g=!1,l=/^\s*#version\s+300\s+es\s*\n/,i.isShaderMaterial&&null!==u.match(l)&&null!==c.match(l)&&(g=!0,u=u.replace(l,""),c=c.replace(l,"")),r=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,n=["#version 300 es\n","#define varying in",g?"":"out highp vec4 pc_fragColor;",g?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+n),r+u),d=n+c,v=bu(h,h.VERTEX_SHADER,m),p=bu(h,h.FRAGMENT_SHADER,d);return h.attachShader(_,v),h.attachShader(_,p),void 0!==i.index0AttributeName?h.bindAttribLocation(_,0,i.index0AttributeName):!0===i.morphTargets&&h.bindAttribLocation(_,0,"position"),h.linkProgram(_),t.debug.checkShaderErrors&&(f=h.getProgramInfoLog(_).trim(),l=h.getShaderInfoLog(v).trim(),g=h.getShaderInfoLog(p).trim(),!(c=u=!0)===h.getProgramParameter(_,h.LINK_STATUS)?(u=!1,t=Mu(h,v,"vertex"),s=Mu(h,p,"fragment"),console.error("THREE.WebGLProgram: shader error: ",h.getError(),"gl.VALIDATE_STATUS",h.getProgramParameter(_,h.VALIDATE_STATUS),"gl.getProgramInfoLog",f,t,s)):""!==f?(console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f),ot.environment===q.WX&&(""!==l&&(console.error("vertexLog",l),console.error("vertexGlsl",m)),""!==g)&&(console.error("fragmentLog",g),console.error("fragmentGlsl",d))):""!==l&&""!==g||(c=!1),c)&&(this.diagnostics={runnable:u,programLog:f,vertexShader:{log:l,prefix:r},fragmentShader:{log:g,prefix:n}}),h.detachShader(_,v),h.detachShader(_,p),h.deleteShader(v),h.deleteShader(p),this.getUniforms=function(){return o=void 0===o?new _u(h,_):o},this.getAttributes=function(){return a=void 0===a?Ou(h,_):a},this.destroy=function(){h.deleteProgram(_),this.program=void 0},this.name=i.shaderName,this.id=yu++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=v,this.fragmentShader=p,this}function Xu(d,v,p){var o=[],m=p.isWebGL2,g=p.logarithmicDepthBuffer,_=p.floatVertexTextures,b=p.precision,y=p.maxVertexUniforms,w=p.vertexTextures,x={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},n=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function M(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Er,e}this.getParameters=function(t,e,i,r,n,s,o){var a,h=r.fog,r=t.isMeshStandardMaterial?r.environment:null,r=t.envMap||r,l=x[t.type],u=o.isSkinnedMesh?(u=(u=o).skeleton.bones,_?1024:(a=Math.floor((y-20)/4),(a=Math.min(a,u.length))<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+a+"."),0):a)):0,c=(null!==t.precision&&(b=p.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",b,"instead."),a=t,(c=l)?(c=al[c],{name:a.type,uniforms:oo.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}):{name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),f=(t.onBeforeCompile(c,d),d.getRenderTarget());return{isWebGL2:m,shaderID:l,shaderName:c.name,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:t.defines,isRawShaderMaterial:t.isRawShaderMaterial,isShaderMaterial:t.isShaderMaterial,precision:b,instancing:!0===o.isInstancedMesh,supportsVertexTextures:w,outputEncoding:null!==f?M(f.texture):d.outputEncoding,map:!!t.map,mapEncoding:M(t.map),matcap:!!t.matcap,matcapEncoding:M(t.matcap),envMap:!!r,envMapMode:r&&r.mapping,envMapEncoding:M(r),envMapCubeUV:!!r&&(r.mapping===Ve||r.mapping===We),lightMap:!!t.lightMap,lightMapEncoding:M(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:M(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Pr,tangentSpaceNormalMap:t.normalMapType===kr,clearcoatMap:!!t.clearcoatMap,clearcoatRoughnessMap:!!t.clearcoatRoughnessMap,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatMap||t.clearcoatRoughnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!h,useFog:t.fog,fogExp2:h&&h.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:g,skinning:t.skinning&&0<u,maxBones:u,useVertexTexture:_,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:d.maxMorphTargets,maxMorphNormals:d.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numDirLightShadows:e.directionalShadowMap.length,numPointLightShadows:e.pointShadowMap.length,numSpotLightShadows:e.spotShadowMap.length,numClippingPlanes:n,numClipIntersection:s,dithering:t.dithering,shadowMapEnabled:d.shadowMap.enabled&&0<i.length,shadowMapType:d.shadowMap.type,toneMapping:t.toneMapped?d.toneMapping:Ne,physicallyCorrectLights:d.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===Kt,flipSided:t.side===Jt,depthPacking:void 0!==t.depthPacking&&t.depthPacking,index0AttributeName:t.index0AttributeName,extensionDerivatives:t.extensions&&t.extensions.derivatives,extensionFragDepth:t.extensions&&t.extensions.fragDepth,extensionDrawBuffers:t.extensions&&t.extensions.drawBuffers,extensionShaderTextureLOD:t.extensions&&t.extensions.shaderTextureLOD,rendererExtensionFragDepth:m||null!==v.get("EXT_frag_depth"),rendererExtensionDrawBuffers:m||null!==v.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:m||null!==v.get("EXT_shader_texture_lod"),onBeforeCompile:t.onBeforeCompile}},this.getProgramCacheKey=function(t){var e=[];if(t.shaderID?e.push(t.shaderID):(e.push(t.fragmentShader),e.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)e.push(i),e.push(t.defines[i]);if(void 0===t.isRawShaderMaterial){for(var r=0;r<n.length;r++)e.push(t[n[r]]);e.push(d.outputEncoding),e.push(d.gammaFactor)}return e.push(t.onBeforeCompile.toString()),e.join()},this.acquireProgram=function(t,e){for(var i,r=0,n=o.length;r<n;r++){var s=o[r];if(s.cacheKey===e){++(i=s).usedTimes;break}}return void 0===i&&(i=new Yu(d,e,t),o.push(i)),i},this.releaseProgram=function(t){var e;0==--t.usedTimes&&(e=o.indexOf(t),o[e]=o[o.length-1],o.pop(),t.destroy())},this.programs=o}function Zu(){var r=new WeakMap;return{get:function(t){var e=r.get(t);return void 0===e&&r.set(t,e={}),e},remove:function(t){r.delete(t)},update:function(t,e,i){r.get(t)[e]=i},dispose:function(){r=new WeakMap}}}function qu(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ju(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ku(){var a=[],h=0,o=[],l=[],u={id:-1};function c(t,e,i,r,n,s){var o=a[h];return void 0===o?(o={id:t.id,object:t,geometry:e,material:i,program:i.program||u,groupOrder:r,renderOrder:t.renderOrder,z:n,group:s},a[h]=o):(o.id=t.id,o.object=t,o.geometry=e,o.material=i,o.program=i.program||u,o.groupOrder=r,o.renderOrder=t.renderOrder,o.z=n,o.group=s),h++,o}return{opaque:o,transparent:l,init:function(){h=0,l.length=o.length=0},push:function(t,e,i,r,n,s){e=c(t,e,i,r,n,s),(!1!==t.userData.transparent&&!0===i.transparent?l:o).push(e)},unshift:function(t,e,i,r,n,s){e=c(t,e,i,r,n,s),!1===t.userData.transparent?o.push(e):(!0===i.transparent?l:o).unshift(e)},finish:function(){for(var t=h,e=a.length;t<e;t++){var i=a[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){1<o.length&&o.sort(t||qu),1<l.length&&l.sort(e||Ju)}}}function Qu(){var n=new WeakMap;function s(t){t=t.target;t.removeEventListener("dispose",s),n.delete(t)}return{get:function(t,e){var i,r=n.get(t);return void 0===r?(i=new Ku,n.set(t,new WeakMap),n.get(t).set(e,i),t.addEventListener("dispose",s)):void 0===(i=r.get(e))&&(i=new Ku,r.set(e,i)),i},dispose:function(){n=new WeakMap}}}function $u(){var i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];var e;switch(t.type){case"DirectionalLight":e={direction:new Lt,color:new ft};break;case"SpotLight":e={position:new Lt,direction:new Lt,color:new ft,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new Lt,color:new ft,distance:0,decay:0};break;case"HemisphereLight":e={direction:new Lt,skyColor:new ft,groundColor:new ft};break;case"RectAreaLight":e={color:new ft,position:new Lt,halfWidth:new Lt,halfHeight:new Lt}}return i[t.id]=e}}}function tc(){var i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];var e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowRadius:1,shadowMapSize:new St};break;case"PointLight":e={shadowBias:0,shadowRadius:1,shadowMapSize:new St,shadowCameraNear:1,shadowCameraFar:1e3}}return i[t.id]=e}}}var ec=0;function ic(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function rc(){for(var T=new $u,S=tc(),A={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},t=0;t<9;t++)A.probe.push(new Lt);var O=new Lt,C=new Tt,R=new Tt;return{setup:function(t,e,i){for(var r=0,n=0,s=0,o=0;o<9;o++)A.probe[o].set(0,0,0);var a=0,h=0,l=0,u=0,c=0,f=0,d=0,v=0,p=i.matrixWorldInverse;t.sort(ic);for(var o=0,m=t.length;o<m;o++){var g,_,b,y=t[o],w=y.color,x=y.intensity,M=y.distance,E=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)r+=w.r*x,n+=w.g*x,s+=w.b*x;else if(y.isLightProbe)for(var L=0;L<9;L++)A.probe[L].addScaledVector(y.sh.coefficients[L],x);else y.isDirectionalLight?((b=T.get(y)).color.copy(y.color).multiplyScalar(y.intensity),b.direction.setFromMatrixPosition(y.matrixWorld),O.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(O),b.direction.transformDirection(p),y.castShadow&&(g=y.shadow,(_=S.get(y)).shadowBias=g.bias,_.shadowRadius=g.radius,_.shadowMapSize=g.mapSize,A.directionalShadow[a]=_,A.directionalShadowMap[a]=E,A.directionalShadowMatrix[a]=y.shadow.matrix,f++),A.directional[a]=b,a++):y.isSpotLight?((b=T.get(y)).position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(p),b.color.copy(w).multiplyScalar(x),b.distance=M,b.direction.setFromMatrixPosition(y.matrixWorld),O.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(O),b.direction.transformDirection(p),b.coneCos=Math.cos(y.angle),b.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),b.decay=y.decay,y.castShadow&&(g=y.shadow,(_=S.get(y)).shadowBias=g.bias,_.shadowRadius=g.radius,_.shadowMapSize=g.mapSize,A.spotShadow[l]=_,A.spotShadowMap[l]=E,A.spotShadowMatrix[l]=y.shadow.matrix,v++),A.spot[l]=b,l++):y.isRectAreaLight?((b=T.get(y)).color.copy(w).multiplyScalar(x),b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(p),R.identity(),C.copy(y.matrixWorld),C.premultiply(p),R.extractRotation(C),b.halfWidth.set(.5*y.width,0,0),b.halfHeight.set(0,.5*y.height,0),b.halfWidth.applyMatrix4(R),b.halfHeight.applyMatrix4(R),A.rectArea[u]=b,u++):y.isPointLight?((b=T.get(y)).position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(p),b.color.copy(y.color).multiplyScalar(y.intensity),b.distance=y.distance,b.decay=y.decay,y.castShadow&&(g=y.shadow,(_=S.get(y)).shadowBias=g.bias,_.shadowRadius=g.radius,_.shadowMapSize=g.mapSize,_.shadowCameraNear=g.camera.near,_.shadowCameraFar=g.camera.far,A.pointShadow[h]=_,A.pointShadowMap[h]=E,A.pointShadowMatrix[h]=y.shadow.matrix,d++),A.point[h]=b,h++):y.isHemisphereLight&&((b=T.get(y)).direction.setFromMatrixPosition(y.matrixWorld),b.direction.transformDirection(p),b.direction.normalize(),b.skyColor.copy(y.color).multiplyScalar(x),b.groundColor.copy(y.groundColor).multiplyScalar(x),A.hemi[c]=b,c++)}A.ambient[0]=r,A.ambient[1]=n,A.ambient[2]=s,(i=A.hash).directionalLength===a&&i.pointLength===h&&i.spotLength===l&&i.rectAreaLength===u&&i.hemiLength===c&&i.numDirectionalShadows===f&&i.numPointShadows===d&&i.numSpotShadows===v||(A.directional.length=a,A.spot.length=l,A.rectArea.length=u,A.point.length=h,A.hemi.length=c,A.directionalShadow.length=f,A.directionalShadowMap.length=f,A.pointShadow.length=d,A.pointShadowMap.length=d,A.spotShadow.length=v,A.spotShadowMap.length=v,A.directionalShadowMatrix.length=f,A.pointShadowMatrix.length=d,A.spotShadowMatrix.length=v,i.directionalLength=a,i.pointLength=h,i.spotLength=l,i.rectAreaLength=u,i.hemiLength=c,i.numDirectionalShadows=f,i.numPointShadows=d,i.numSpotShadows=v,A.version=ec++)},state:A}}function nc(){var e=new rc,i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:e},setupLights:function(t){e.setup(i,r,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function sc(){var r=new WeakMap;function n(t){t=t.target;t.removeEventListener("dispose",n),r.delete(t)}return{get:function(t,e){var i;return!1===r.has(t)?(i=new nc,r.set(t,new WeakMap),r.get(t).set(e,i),t.addEventListener("dispose",n)):!1===r.get(t).has(e)?(i=new nc,r.get(t).set(e,i)):i=r.get(t).get(e),i},dispose:function(){r=new WeakMap}}}function oc(t,e,i){this.width=t,this.height=e,this.scissor=new At(0,0,t,e),this.scissorTest=!1,this.viewport=new At(0,0,t,e),this.texture=new f(void 0,(i=i||{}).mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Qe,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function ac(t){K.call(this),this.type="MeshDepthMaterial",this.depthPacking=Nr,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function hc(t){K.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Lt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}oc.prototype=Object.assign(Object.create(S.prototype),{constructor:oc,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ac.prototype=Object.create(K.prototype),ac.prototype.constructor=ac,ac.prototype.isMeshDepthMaterial=!0,ac.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},hc.prototype=Object.create(K.prototype),hc.prototype.constructor=hc,hc.prototype.isMeshDistanceMaterial=!0,hc.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var lc=`
uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;

#include <packing>

void main() {

  float mean = 0.0;
  float squared_mean = 0.0;

	// This seems totally useless but it's a crazy work around for a Adreno compiler bug
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );

  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {

    #ifdef HORIZONAL_PASS

      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;

    #else

      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;

    #endif

  }

  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;

  float std_dev = sqrt( squared_mean - mean * mean );

  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );

}
`,uc=`

void main() {

	gl_Position = vec4( position, 1.0 );

}

`;function cc(_,b,y){var w=new Ut,x=new St,M=new St,E=new At,n=[],s=[],c={},f={0:Jt,1:qt,2:Kt},L=new g({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new St},radius:{value:4}},vertexShader:uc,fragmentShader:lc}),T=L.clone(),t=(T.defines.HORIZONAL_PASS=1,new et),S=(t.setAttribute("position",new J(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3)),new Q(t,L)),A=this;function d(t,e,i){var i=t<<0|e<<1|i<<2,r=n[i];return void 0===r&&(r=new ac({depthPacking:Dr,morphTargets:t,skinning:e}),n[i]=r),r}function v(t,e,i){var i=t<<0|e<<1|i<<2,r=s[i];return void 0===r&&(r=new hc({morphTargets:t,skinning:e}),s[i]=r),r}function O(t,e,i,r,n,s){var o,a=t.geometry,h=null,l=d,u=t.customDepthMaterial;return!0===i.isPointLight&&(l=v,u=t.customDistanceMaterial),h=void 0===u?(!(o=!1)===e.morphTargets&&(!0===a.isBufferGeometry?o=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:!0===a.isGeometry&&(o=a.morphTargets&&0<a.morphTargets.length)),!(a=!1)===t.isSkinnedMesh&&(!0===e.skinning?a=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l(o,a,!0===t.isInstancedMesh)):u,_.localClippingEnabled&&!0===e.clipShadows&&0!==e.clippingPlanes.length&&(l=h.uuid,o=e.uuid,void 0===(a=c[l])&&(c[l]=a={}),void 0===(t=a[o])&&(t=h.clone(),a[o]=t),h=t),h.visible=e.visible,h.wireframe=e.wireframe,h.side=s===Zt?null!==e.shadowSide?e.shadowSide:e.side:null!==e.shadowSide?e.shadowSide:f[e.side],h.clipShadows=e.clipShadows,h.clippingPlanes=e.clippingPlanes,h.clipIntersection=e.clipIntersection,h.wireframeLinewidth=e.wireframeLinewidth,h.linewidth=e.linewidth,!0===i.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(i.matrixWorld),h.nearDistance=r,h.farDistance=n),h}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Yt,this.render=function(t,e,i){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){var r=_.getRenderTarget(),n=_.getActiveCubeFace(),s=_.getActiveMipmapLevel(),o=_.state;o.setBlending($t),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var a,h,l=0,u=t.length;l<u;l++){var c=t[l],f=c.shadow;if(void 0===f)console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");else{x.copy(f.mapSize);for(var d,v=f.getFrameExtents(),p=(x.multiply(v),M.copy(f.mapSize),(x.x>y||x.y>y)&&(console.warn("THREE.WebGLShadowMap:",c,"has shadow exceeding max texture size, reducing"),x.x>y&&(M.x=Math.floor(y/v.x),x.x=M.x*v.x,f.mapSize.x=M.x),x.y>y)&&(M.y=Math.floor(y/v.y),x.y=M.y*v.y,f.mapSize.y=M.y),null!==f.map||f.isPointLightShadow||this.type!==Zt||(f.map=new oc(x.x,x.y,d={minFilter:Qe,magFilter:Qe,format:mi}),f.map.texture.name=c.name+".shadowMap",f.mapPass=new oc(x.x,x.y,d),f.camera.updateProjectionMatrix()),null===f.map&&(f.map=new oc(x.x,x.y,d={minFilter:qe,magFilter:qe,format:mi}),f.map.texture.name=c.name+".shadowMap",f.camera.updateProjectionMatrix()),_.setRenderTarget(f.map),_.clear(),f.getViewportCount()),m=0;m<p;m++){var g=f.getViewport(m);E.set(M.x*g.x,M.y*g.y,M.x*g.z,M.y*g.w),o.viewport(E),f.updateMatrices(c,m),w=f.getFrustum(),!function t(e,i,r,n,s){if(!1===e.visible)return;var o=e.layers.test(i.layers);if(o&&(e.isMesh||e.isLine||e.isPoints)&&(e.castShadow||e.receiveShadow&&s===Zt)&&(!e.frustumCulled||w.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);var a=b.update(e),h=e.material;if(Array.isArray(h))for(var l=a.groups,u=0,c=l.length;u<c;u++){var f,d=l[u],v=h[d.materialIndex];v&&v.visible&&(f=O(e,v,n,r.near,r.far,s),_.renderBufferDirect(r,null,a,f,e,d))}else h.visible&&(f=O(e,h,n,r.near,r.far,s),_.renderBufferDirect(r,null,a,f,e,null))}var p=e.children;for(var m=0,g=p.length;m<g;m++)t(p[m],i,r,n,s)}(e,i,f.camera,c,this.type)}f.isPointLightShadow||this.type!==Zt||(v=f,a=i,h=void 0,h=b.update(S),L.uniforms.shadow_pass.value=v.map.texture,L.uniforms.resolution.value=v.mapSize,L.uniforms.radius.value=v.radius,_.setRenderTarget(v.mapPass),_.clear(),_.renderBufferDirect(a,null,h,L,S,null),T.uniforms.shadow_pass.value=v.mapPass.texture,T.uniforms.resolution.value=v.mapSize,T.uniforms.radius.value=v.radius,_.setRenderTarget(v.map),_.clear(),_.renderBufferDirect(a,null,h,T,S,null))}}A.needsUpdate=!1,_.setRenderTarget(r,n,s)}}}function fc(u,i,t){var r=t.isWebGL2;var n=new function(){var e=!1,s=new At,i=null,o=new At(0,0,0,0);return{setMask:function(t){i===t||e||(u.colorMask(t,t,t,t),i=t)},setLocked:function(t){e=t},setClear:function(t,e,i,r,n){!0===n&&(t*=r,e*=r,i*=r),s.set(t,e,i,r),!1===o.equals(s)&&(u.clearColor(t,e,i,r),o.copy(s))},reset:function(){e=!1,i=null,o.set(-1,0,0,0)}}},s=new function(){var e=!1,i=null,r=null,n=null;return{setTest:function(t){(t?C:R)(u.DEPTH_TEST)},setMask:function(t){i===t||e||(u.depthMask(t),i=t)},setFunc:function(t){if(r!==t){if(t)switch(t){case we:u.depthFunc(u.NEVER);break;case xe:u.depthFunc(u.ALWAYS);break;case Me:u.depthFunc(u.LESS);break;case Ee:u.depthFunc(u.LEQUAL);break;case Le:u.depthFunc(u.EQUAL);break;case Te:u.depthFunc(u.GEQUAL);break;case Se:u.depthFunc(u.GREATER);break;case Ae:u.depthFunc(u.NOTEQUAL);break;default:u.depthFunc(u.LEQUAL)}else u.depthFunc(u.LEQUAL);r=t}},setLocked:function(t){e=t},setClear:function(t){n!==t&&(u.clearDepth(t),n=t)},reset:function(){e=!1,n=r=i=null}}},o=new function(){var e=!1,i=null,r=null,n=null,s=null,o=null,a=null,h=null,l=null;return{setTest:function(t){e||(t?C:R)(u.STENCIL_TEST)},setMask:function(t){i===t||e||(u.stencilMask(t),i=t)},setFunc:function(t,e,i){r===t&&n===e&&s===i||(u.stencilFunc(t,e,i),r=t,n=e,s=i)},setOp:function(t,e,i){o===t&&a===e&&h===i||(u.stencilOp(t,e,i),o=t,a=e,h=i)},setLocked:function(t){e=t},setClear:function(t){l!==t&&(u.clearStencil(t),l=t)},reset:function(){e=!1,l=h=a=o=s=n=r=i=null}}},t=u.getParameter(u.MAX_VERTEX_ATTRIBS),a=new Uint8Array(t),h=new Uint8Array(t),l=new Uint8Array(t),e={},c=null,f=null,d=null,v=null,p=null,m=null,g=null,_=null,b=null,y=!1,w=null,x=null,M=null,E=null,I=null,F=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS),L=!1,t=0,T=u.getParameter(u.VERSION),S=(-1!==T.indexOf("WebGL")?(t=parseFloat(/^WebGL\ ([0-9])/.exec(T)[1]),L=1<=t):-1!==T.indexOf("OpenGL ES")&&(t=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(T)[1]),L=2<=t),null),A={},j=new At,G=new At;function U(t,e,i){var r=new Uint8Array(4),n=u.createTexture();u.bindTexture(t,n),u.texParameteri(t,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u.NEAREST);for(var s=0;s<i;s++)u.texImage2D(e+s,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,r);return n}var O={};function H(t,e){a[t]=1,0===h[t]&&(u.enableVertexAttribArray(t),h[t]=1),l[t]!==e&&((r?u:i.get("ANGLE_instanced_arrays"))[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,e),l[t]=e)}function C(t){!0!==e[t]&&(u.enable(t),e[t]=!0)}function R(t){!1!==e[t]&&(u.disable(t),e[t]=!1)}O[u.TEXTURE_2D]=U(u.TEXTURE_2D,u.TEXTURE_2D,1),O[u.TEXTURE_CUBE_MAP]=U(u.TEXTURE_CUBE_MAP,u.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),s.setClear(1),o.setClear(0),C(u.DEPTH_TEST),s.setFunc(Ee),P(!1),B(Vt),C(u.CULL_FACE),k($t);var N={[se]:u.FUNC_ADD,[oe]:u.FUNC_SUBTRACT,[ae]:u.FUNC_REVERSE_SUBTRACT},D=(r?(N[he]=u.MIN,N[le]=u.MAX):null!==(T=i.get("EXT_blend_minmax"))&&(N[he]=T.MIN_EXT,N[le]=T.MAX_EXT),{[ue]:u.ZERO,[ce]:u.ONE,[fe]:u.SRC_COLOR,[ve]:u.SRC_ALPHA,[ye]:u.SRC_ALPHA_SATURATE,[_e]:u.DST_COLOR,[me]:u.DST_ALPHA,[de]:u.ONE_MINUS_SRC_COLOR,[pe]:u.ONE_MINUS_SRC_ALPHA,[be]:u.ONE_MINUS_DST_COLOR,[ge]:u.ONE_MINUS_DST_ALPHA});function k(t,e,i,r,n,s,o,a){if(t===$t)f&&(R(u.BLEND),f=!1);else if(f||(C(u.BLEND),f=!0),t!==ne){if(t!==d||a!==y){if(v===se&&g===se||(u.blendEquation(u.FUNC_ADD),g=v=se),a)switch(t){case te:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case ee:u.blendFunc(u.ONE,u.ONE);break;case ie:u.blendFuncSeparate(u.ZERO,u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ONE_MINUS_SRC_ALPHA);break;case re:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.warn("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case te:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case ee:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case ie:u.blendFunc(u.ZERO,u.ONE_MINUS_SRC_COLOR);break;case re:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.warn("THREE.WebGLState: Invalid blending: ",t)}b=_=m=p=null,d=t,y=a}}else n=n||e,s=s||i,o=o||r,e===v&&n===g||(u.blendEquationSeparate(N[e],N[n]),v=e,g=n),i===p&&r===m&&s===_&&o===b||(u.blendFuncSeparate(D[i],D[r],D[s],D[o]),p=i,m=r,_=s,b=o),d=t,y=null}function P(t){w!==t&&(t?u.frontFace(u.CW):u.frontFace(u.CCW),w=t)}function B(t){t!==zt?(C(u.CULL_FACE),t!==x&&(t===Vt?u.cullFace(u.BACK):t===Wt?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK))):R(u.CULL_FACE),x=t}function z(t,e,i){t?(C(u.POLYGON_OFFSET_FILL),E===e&&I===i||(u.polygonOffset(e,i),E=e,I=i)):R(u.POLYGON_OFFSET_FILL)}function V(t){void 0===t&&(t=u.TEXTURE0+F-1),S!==t&&(u.activeTexture(t),S=t)}return{buffers:{color:n,depth:s,stencil:o},initAttributes:function(){for(var t=0,e=a.length;t<e;t++)a[t]=0},enableAttribute:function(t){H(t,0)},enableAttributeAndDivisor:H,disableUnusedAttributes:function(){for(var t=0,e=h.length;t!==e;++t)h[t]!==a[t]&&(u.disableVertexAttribArray(t),h[t]=0)},enable:C,disable:R,useProgram:function(t){return c!==t&&(u.useProgram(t),c=t,!0)},setBlending:k,setMaterial:function(t,e,i){(t.side===Kt?R:C)(u.CULL_FACE);var r=t.side===Jt,e=(P(r=e?!r:r),t.blending!==te||!1!==t.transparent&&!1!==i.userData.transparent?k(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):k($t),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),n.setMask(t.colorWrite),t.stencilWrite);o.setTest(e),e&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),z(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:P,setCullFace:B,setLineWidth:function(t){t!==M&&(L&&u.lineWidth(t),M=t)},setPolygonOffset:z,setScissorTest:function(t){(t?C:R)(u.SCISSOR_TEST)},activeTexture:V,bindTexture:function(t,e){null===S&&V();var i=A[S];void 0===i&&(A[S]=i={type:void 0,texture:void 0}),i.type===t&&i.texture===e||(u.bindTexture(t,e||O[t]),i.type=t,i.texture=e)},unbindTexture:function(){var t=A[S];void 0!==t&&void 0!==t.type&&(u.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(t){console.warn("THREE.WebGLState:",t)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(t){console.warn("THREE.WebGLState:",t)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(t){console.warn("THREE.WebGLState:",t)}},scissor:function(t){!1===j.equals(t)&&(u.scissor(t.x,t.y,t.z,t.w),j.copy(t))},viewport:function(t){!1===G.equals(t)&&(u.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){for(var t=0;t<h.length;t++)1===h[t]&&(u.disableVertexAttribArray(t),h[t]=0);e={},A={},x=w=d=c=S=null,n.reset(),s.reset(),o.reset()}}}function dc(m,r,g,_,n,b,h){var s,y=n.isWebGL2,e=n.maxTextures,w=n.maxCubemapSize,F=n.maxTextureSize,j=n.maxSamples,o=new WeakMap,i=!1;try{i="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function a(t,e){return i?new OffscreenCanvas(t,e):ot.document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function x(t,e,i,r){var n=1;return(n=t.width>r||t.height>r?r/Math.max(t.width,t.height):n)<1||!0===e?"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?(e=(r=e?Et.floorPowerOfTwo:Math.floor)(n*t.width),r=r(n*t.height),void 0===s&&(s=a(e,r)),(n=i?a(e,r):s).width=e,n.height=r,n.getContext("2d").drawImage(t,0,0,e,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+e+"x"+r+")."),n):("data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t):t}function M(t){return Et.isPowerOfTwo(t.width)&&Et.isPowerOfTwo(t.height)}function E(t,e){return t.generateMipmaps&&e&&t.minFilter!==qe&&t.minFilter!==Qe}function L(t,e,i,r){m.generateMipmap(t),_.get(e).hn=Math.log(Math.max(i,r))*Math.LOG2E}function T(t,e,i){if(!1===y)return e;if(null!==t){if(void 0!==m[t])return m[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}t=e;return e===m.RED&&(i===m.FLOAT&&(t=m.R32F),i===m.HALF_FLOAT&&(t=m.R16F),i===m.UNSIGNED_BYTE)&&(t=m.R8),e===m.RGB&&(i===m.FLOAT&&(t=m.RGB32F),i===m.HALF_FLOAT&&(t=m.RGB16F),i===m.UNSIGNED_BYTE)&&(t=m.RGB8),(t=e===m.RGBA&&(i===m.FLOAT&&(t=m.RGBA32F),i===m.HALF_FLOAT&&(t=m.RGBA16F),i===m.UNSIGNED_BYTE)?m.RGBA8:t)!==m.R16F&&t!==m.R32F&&t!==m.RGBA16F&&t!==m.RGBA32F||r.get("EXT_color_buffer_float"),t}function l(t){return t===qe||t===Je||t===Ke?m.NEAREST:m.LINEAR}function u(t){var e,i,t=t.target;t.removeEventListener("dispose",u),e=t,void 0!==(i=_.get(e)).ln&&(m.deleteTexture(i.un),_.remove(e)),t.isVideoTexture&&o.delete(t),h.memory.textures--}function c(t){var t=t.target,e=(t.removeEventListener("dispose",c),_.get(t)),i=_.get(t.texture);if(t){if(void 0!==i.un&&m.deleteTexture(i.un),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var r=0;r<6;r++)m.deleteFramebuffer(e.cn[r]),e.dn&&m.deleteRenderbuffer(e.dn[r]);else m.deleteFramebuffer(e.cn),e.dn&&m.deleteRenderbuffer(e.dn),e.vn&&m.deleteFramebuffer(e.vn),e.pn&&m.deleteRenderbuffer(e.pn),e.mn&&m.deleteRenderbuffer(e.mn);_.remove(t.texture),_.remove(t)}h.memory.textures--}var f=0;function d(t,e){var i,r=_.get(t);if(t.isVideoTexture&&(i=t,n=h.render.frame,o.get(i)!==n)&&(o.set(i,n),i.update()),0<t.version&&r.gn!==t.version){var n=t.image;if(void 0===n)ot.environment===q.BROWSER&&console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void R(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_2D,r.un)}function v(t,e){if(6===t.image.length){var i=_.get(t);if(0<t.version&&i.gn!==t.version){C(i,t),g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,i.un),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var r=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),n=t.image[0]&&t.image[0].isDataTexture,s=[],o=0;o<6;o++)s[o]=r||n?n?t.image[o].image:t.image[o]:x(t.image[o],!1,!0,w);var a=s[0],h=M(a)||y,l=b.convert(t.format),u=b.convert(t.type),c=T(t.internalFormat,l,u);if(O(m.TEXTURE_CUBE_MAP,t,h),r){for(o=0;o<6;o++)for(var f=s[o].mipmaps,d=0;d<f.length;d++){var v=f[d];t.format!==mi&&t.format!==pi?null!==l?g.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,c,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,c,v.width,v.height,0,l,u,v.data)}i.hn=f.length-1}else{f=t.mipmaps;for(o=0;o<6;o++)if(n){g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,c,s[o].width,s[o].height,0,l,u,s[o].data);for(d=0;d<f.length;d++){var p=(v=f[d]).image[o].image;g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,d+1,c,p.width,p.height,0,l,u,p.data)}}else{g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,c,l,u,s[o]);for(d=0;d<f.length;d++){v=f[d];g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,d+1,c,l,u,v.image[o])}}i.hn=f.length}E(t,h)&&L(m.TEXTURE_CUBE_MAP,t,a.width,a.height),i.gn=t.version,t.onUpdate&&t.onUpdate(t)}else g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,i.un)}}function p(t,e){g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,_.get(t).un)}var S={[Ye]:m.REPEAT,[Xe]:m.CLAMP_TO_EDGE,[Ze]:m.MIRRORED_REPEAT},A={[qe]:m.NEAREST,[Je]:m.NEAREST_MIPMAP_NEAREST,[Ke]:m.NEAREST_MIPMAP_LINEAR,[Qe]:m.LINEAR,[$e]:m.LINEAR_MIPMAP_NEAREST,[ti]:m.LINEAR_MIPMAP_LINEAR};function O(t,e,i){i?(m.texParameteri(t,m.TEXTURE_WRAP_S,S[e.wrapS]),m.texParameteri(t,m.TEXTURE_WRAP_T,S[e.wrapT]),t!==m.TEXTURE_3D&&t!==m.TEXTURE_2D_ARRAY||m.texParameteri(t,m.TEXTURE_WRAP_R,S[e.wrapR]),m.texParameteri(t,m.TEXTURE_MAG_FILTER,A[e.magFilter]),m.texParameteri(t,m.TEXTURE_MIN_FILTER,A[e.minFilter])):(m.texParameteri(t,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(t,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),t!==m.TEXTURE_3D&&t!==m.TEXTURE_2D_ARRAY||m.texParameteri(t,m.TEXTURE_WRAP_R,m.CLAMP_TO_EDGE),e.wrapS===Xe&&e.wrapT===Xe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(t,m.TEXTURE_MAG_FILTER,l(e.magFilter)),m.texParameteri(t,m.TEXTURE_MIN_FILTER,l(e.minFilter)),e.minFilter!==qe&&e.minFilter!==Qe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));i=r.get("EXT_texture_filter_anisotropic");!i||e.type===hi&&null===r.get("OES_texture_float_linear")||e.type===li&&null===(y||r.get("OES_texture_half_float_linear"))||(1<e.anisotropy||_.get(e)._n)&&(m.texParameterf(t,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,n.getMaxAnisotropy())),_.get(e)._n=e.anisotropy)}function C(t,e){void 0===t.ln&&(t.ln=!0,e.addEventListener("dispose",u),t.un=m.createTexture(),h.memory.textures++)}function R(t,e,i){var r=m.TEXTURE_2D,i=(e.isDataTexture2DArray&&(r=m.TEXTURE_2D_ARRAY),e.isDataTexture3D&&(r=m.TEXTURE_3D),C(t,e),g.activeTexture(m.TEXTURE0+i),g.bindTexture(r,t.un),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,e.flipY),m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),m.pixelStorei(m.UNPACK_ALIGNMENT,e.unpackAlignment),i=e,!y&&(i.wrapS!==Xe||i.wrapT!==Xe||i.minFilter!==qe&&i.minFilter!==Qe)&&!1===M(e.image)),i=x(e.image,i,!1,F),n=M(i)||y,s=b.convert(e.format),o=b.convert(e.type),a=T(e.internalFormat,s,o);O(r,e,n);var h,l=e.mipmaps;if(e.isDepthTexture)a=m.DEPTH_COMPONENT,y?a=e.type===hi?m.DEPTH_COMPONENT32F:e.type===ai?m.DEPTH_COMPONENT24:e.type===di?m.DEPTH24_STENCIL8:m.DEPTH_COMPONENT16:e.type===hi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),e.format===bi&&a===m.DEPTH_COMPONENT&&e.type!==si&&e.type!==ai&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=si,o=b.convert(e.type)),e.format===yi&&a===m.DEPTH_COMPONENT&&(a=m.DEPTH_STENCIL,e.type!==di)&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=di,o=b.convert(e.type)),g.texImage2D(m.TEXTURE_2D,0,a,i.width,i.height,0,s,o,null);else if(e.isDataTexture)if(0<l.length&&n){for(var u=0,c=l.length;u<c;u++)h=l[u],g.texImage2D(m.TEXTURE_2D,u,a,h.width,h.height,0,s,o,h.data);e.generateMipmaps=!1,t.hn=l.length-1}else g.texImage2D(m.TEXTURE_2D,0,a,i.width,i.height,0,s,o,i.data),t.hn=0;else if(e.isCompressedTexture){for(u=0,c=l.length;u<c;u++)h=l[u],e.format!==mi&&e.format!==pi?null!==s?g.compressedTexImage2D(m.TEXTURE_2D,u,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(m.TEXTURE_2D,u,a,h.width,h.height,0,s,o,h.data);t.hn=l.length-1}else if(e.isDataTexture2DArray)g.texImage3D(m.TEXTURE_2D_ARRAY,0,a,i.width,i.height,i.depth,0,s,o,i.data),t.hn=0;else if(e.isDataTexture3D)g.texImage3D(m.TEXTURE_3D,0,a,i.width,i.height,i.depth,0,s,o,i.data),t.hn=0;else if(0<l.length&&n){for(u=0,c=l.length;u<c;u++)h=l[u],g.texImage2D(m.TEXTURE_2D,u,a,s,o,h);e.generateMipmaps=!1,t.hn=l.length-1}else g.texImage2D(m.TEXTURE_2D,0,a,s,o,i),t.hn=0;E(e,n)&&L(r,e,i.width,i.height),t.gn=e.version,e.onUpdate&&e.onUpdate(e)}function N(t,e,i,r){var n=b.convert(e.texture.format),s=b.convert(e.texture.type),o=T(e.texture.internalFormat,n,s);g.texImage2D(r,0,o,e.width,e.height,0,n,s,null),m.bindFramebuffer(m.FRAMEBUFFER,t),m.framebufferTexture2D(m.FRAMEBUFFER,i,r,_.get(e.texture).un,0),m.bindFramebuffer(m.FRAMEBUFFER,null)}function D(t,e,i){var r,n,s;m.bindRenderbuffer(m.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(n=m.DEPTH_COMPONENT16,i?((s=e.depthTexture)&&s.isDepthTexture&&(s.type===hi?n=m.DEPTH_COMPONENT32F:s.type===ai&&(n=m.DEPTH_COMPONENT24)),s=k(e),m.renderbufferStorageMultisample(m.RENDERBUFFER,s,n,e.width,e.height)):m.renderbufferStorage(m.RENDERBUFFER,n,e.width,e.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(i?(s=k(e),m.renderbufferStorageMultisample(m.RENDERBUFFER,s,m.DEPTH24_STENCIL8,e.width,e.height)):m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,e.width,e.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,t)):(t=b.convert(e.texture.format),r=b.convert(e.texture.type),n=T(e.texture.internalFormat,t,r),i?(s=k(e),m.renderbufferStorageMultisample(m.RENDERBUFFER,s,n,e.width,e.height)):m.renderbufferStorage(m.RENDERBUFFER,n,e.width,e.height)),m.bindRenderbuffer(m.RENDERBUFFER,null)}function G(t){var e=_.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");var r=e.cn,n=t;if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(m.bindFramebuffer(m.FRAMEBUFFER,r),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(_.get(n.depthTexture).un&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),d(n.depthTexture,0),r=_.get(n.depthTexture).un,n.depthTexture.format===bi)m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.TEXTURE_2D,r,0);else{if(n.depthTexture.format!==yi)throw new Error("Unknown depthTexture format");m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.TEXTURE_2D,r,0)}}else if(i){e.dn=[];for(var s=0;s<6;s++)m.bindFramebuffer(m.FRAMEBUFFER,e.cn[s]),e.dn[s]=m.createRenderbuffer(),D(e.dn[s],t,!1)}else m.bindFramebuffer(m.FRAMEBUFFER,e.cn),e.dn=m.createRenderbuffer(),D(e.dn,t,!1);m.bindFramebuffer(m.FRAMEBUFFER,null)}function k(t){return y&&t.isWebGLMultisampleRenderTarget?Math.min(j,t.samples):0}var P=!1,I=!1;this.allocateTextureUnit=function(){var t=f;return e<=t&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+e),f+=1,t},this.resetTextureUnits=function(){f=0},this.setTexture2D=d,this.setTexture2DArray=function(t,e){var i=_.get(t);0<t.version&&i.gn!==t.version?R(i,t,e):(g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_2D_ARRAY,i.un))},this.setTexture3D=function(t,e){var i=_.get(t);0<t.version&&i.gn!==t.version?R(i,t,e):(g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_3D,i.un))},this.setTextureCube=v,this.setTextureCubeDynamic=p,this.setupRenderTarget=function(t){var e,i=_.get(t),r=_.get(t.texture),n=(t.addEventListener("dispose",c),r.un=m.createTexture(),h.memory.textures++,!0===t.isWebGLCubeRenderTarget),s=!0===t.isWebGLMultisampleRenderTarget,o=M(t)||y;if(!y||t.texture.format!==pi||t.texture.type!==hi&&t.texture.type!==li||(t.texture.format=mi,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),n){i.cn=[];for(var a=0;a<6;a++)i.cn[a]=m.createFramebuffer()}else i.cn=m.createFramebuffer(),s&&(y?(i.vn=m.createFramebuffer(),i.pn=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,i.pn),s=b.convert(t.texture.format),e=b.convert(t.texture.type),s=T(t.texture.internalFormat,s,e),e=k(t),m.renderbufferStorageMultisample(m.RENDERBUFFER,e,s,t.width,t.height),m.bindFramebuffer(m.FRAMEBUFFER,i.vn),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.RENDERBUFFER,i.pn),m.bindRenderbuffer(m.RENDERBUFFER,null),t.depthBuffer&&(i.mn=m.createRenderbuffer(),D(i.mn,t,!0)),m.bindFramebuffer(m.FRAMEBUFFER,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(n){g.bindTexture(m.TEXTURE_CUBE_MAP,r.un),O(m.TEXTURE_CUBE_MAP,t.texture,o);for(a=0;a<6;a++)N(i.cn[a],t,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+a);E(t.texture,o)&&L(m.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),g.bindTexture(m.TEXTURE_CUBE_MAP,null)}else g.bindTexture(m.TEXTURE_2D,r.un),O(m.TEXTURE_2D,t.texture,o),N(i.cn,t,m.COLOR_ATTACHMENT0,m.TEXTURE_2D),E(t.texture,o)&&L(m.TEXTURE_2D,t.texture,t.width,t.height),g.bindTexture(m.TEXTURE_2D,null);t.depthBuffer&&G(t)},this.updateRenderTargetMipmap=function(t){var e,i,r=t.texture;E(r,M(t)||y)&&(e=t.isWebGLCubeRenderTarget?m.TEXTURE_CUBE_MAP:m.TEXTURE_2D,i=_.get(r).un,g.bindTexture(e,i),L(e,r,t.width,t.height),g.bindTexture(e,null))},this.updateMultisampleRenderTarget=function(t){var e,i,r;t.isWebGLMultisampleRenderTarget&&(y?(e=_.get(t),m.bindFramebuffer(m.READ_FRAMEBUFFER,e.vn),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,e.cn),i=t.width,r=m.COLOR_BUFFER_BIT,t.depthBuffer&&(r|=m.DEPTH_BUFFER_BIT),t.stencilBuffer&&(r|=m.STENCIL_BUFFER_BIT),m.blitFramebuffer(0,0,i,t=t.height,0,0,i,t,r,m.NEAREST),m.bindFramebuffer(m.FRAMEBUFFER,e.vn)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."))},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===P&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),P=!0),t=t.texture),d(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),(t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?v:p)(t,e)}}function vc(i,r,t){var n=t.isWebGL2;return{convert:function(t){var e;if(t===ii)return i.UNSIGNED_BYTE;if(t===ui)return i.UNSIGNED_SHORT_4_4_4_4;if(t===ci)return i.UNSIGNED_SHORT_5_5_5_1;if(t===fi)return i.UNSIGNED_SHORT_5_6_5;if(t===ri)return i.BYTE;if(t===ni)return i.SHORT;if(t===si)return i.UNSIGNED_SHORT;if(t===oi)return i.INT;if(t===ai)return i.UNSIGNED_INT;if(t===hi)return i.FLOAT;if(t===li)return n?i.HALF_FLOAT:null!==(e=r.get("OES_texture_half_float"))?e.HALF_FLOAT_OES:null;if(t===vi)return i.ALPHA;if(t===pi)return i.RGB;if(t===mi)return i.RGBA;if(t===gi)return i.LUMINANCE;if(t===_i)return i.LUMINANCE_ALPHA;if(t===bi)return i.DEPTH_COMPONENT;if(t===yi)return i.DEPTH_STENCIL;if(t===wi)return i.RED;if(t===xi)return i.RED_INTEGER;if(t===Mi)return i.RG;if(t===Ei)return i.RG_INTEGER;if(t===Li)return i.RGB_INTEGER;if(t===Ti)return i.RGBA_INTEGER;if(t===Si||t===Ai||t===Oi||t===Ci){if(null===(e=r.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Si)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Ai)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Oi)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Ci)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Ri||t===Ni||t===Di||t===ki){if(null===(e=r.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===Ri)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Ni)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Di)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ki)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Pi)return null!==(e=r.get("WEBGL_compressed_texture_etc1"))?e.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Ii||t===Fi)&&null!==(e=r.get("WEBGL_compressed_texture_etc"))){if(t===Ii)return e.COMPRESSED_RGB8_ETC2;if(t===Fi)return e.COMPRESSED_RGBA8_ETC2_EAC}return t===ji||t===Gi||t===Ui||t===Hi||t===Bi||t===zi||t===Vi||t===Wi||t===Yi||t===Xi||t===Zi||t===qi||t===Ji||t===Ki||t===$i||t===tr||t===er||t===ir||t===rr||t===nr||t===sr||t===or||t===ar||t===hr||t===lr||t===ur||t===cr||t===fr?null!==(e=r.get("WEBGL_compressed_texture_astc"))?t:null:t===Qi?null!==(e=r.get("EXT_texture_compression_bptc"))?t:null:t===di?n?i.UNSIGNED_INT_24_8:null!==(e=r.get("WEBGL_depth_texture"))?e.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function pc(t){ht.call(this),this.cameras=t||[]}function mc(){Z.call(this),this.type="Group"}function gc(d,e){var i=this,m=null,r=1,v=null,n="local-floor",p=null,g=[],s=new Map,_=new ht,b=(_.layers.enable(1),_.viewport=new At,new ht),y=(b.layers.enable(2),b.viewport=new At,new pc([_,b])),w=(y.layers.enable(1),y.layers.enable(2),null),x=null;function o(t){var e=s.get(t.inputSource);e&&(e.targetRay&&e.targetRay.dispatchEvent({type:t.type}),e.grip)&&e.grip.dispatchEvent({type:t.type})}function a(){s.forEach(function(t,e){t.targetRay&&(t.targetRay.dispatchEvent({type:"disconnected",data:e}),t.targetRay.visible=!1),t.grip&&(t.grip.dispatchEvent({type:"disconnected",data:e}),t.grip.visible=!1)}),s.clear(),d.setFramebuffer(null),d.setRenderTarget(d.getRenderTarget()),u.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function h(t){v=t,u.setContext(m),u.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function l(t){for(var e=m.inputSources,i=0;i<g.length;i++)s.set(e[i],g[i]);for(i=0;i<t.removed.length;i++){var r=t.removed[i];(n=s.get(r))&&(n.targetRay&&n.targetRay.dispatchEvent({type:"disconnected",data:r}),n.grip&&n.grip.dispatchEvent({type:"disconnected",data:r}),s.delete(r))}for(i=0;i<t.added.length;i++){var n,r=t.added[i];(n=s.get(r))&&(n.targetRay&&n.targetRay.dispatchEvent({type:"connected",data:r}),n.grip)&&n.grip.dispatchEvent({type:"connected",data:r})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=g[t];return void 0===e&&(g[t]=e={}),void 0===e.targetRay&&(e.targetRay=new mc,e.targetRay.matrixAutoUpdate=!1,e.targetRay.visible=!1),e.targetRay},this.getControllerGrip=function(t){var e=g[t];return void 0===e&&(g[t]=e={}),void 0===e.grip&&(e.grip=new mc,e.grip.matrixAutoUpdate=!1,e.grip.visible=!1),e.grip},this.setFramebufferScaleFactor=function(t){r=t,1==i.isPresenting&&console.warn("WebXRManager: Cannot change framebuffer scale while presenting VR content")},this.setReferenceSpaceType=function(t){n=t},this.getReferenceSpace=function(){return v},this.getSession=function(){return m},this.setSession=function(t){null!==(m=t)&&(m.addEventListener("select",o),m.addEventListener("selectstart",o),m.addEventListener("selectend",o),m.addEventListener("squeeze",o),m.addEventListener("squeezestart",o),m.addEventListener("squeezeend",o),m.addEventListener("end",a),t={antialias:(t=e.getContextAttributes()).antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r},t=new XRWebGLLayer(m,e,t),m.updateRenderState({baseLayer:t}),m.requestReferenceSpace(n).then(h),m.addEventListener("inputsourceschange",l))};var M=new Lt,E=new Lt;function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){y.near=b.near=_.near=t.near,y.far=b.far=_.far=t.far,w===y.near&&x===y.far||(m.updateRenderState({depthNear:y.near,depthFar:y.far}),w=y.near,x=y.far);var e=t.parent,i=y.cameras;L(y,e);for(var r=0;r<i.length;r++)L(i[r],e);t.matrixWorld.copy(y.matrixWorld);for(var n,s,o,a,h,l,u,c,f,d,v=t.children,r=0,p=v.length;r<p;r++)v[r].updateMatrixWorld(!0);return t=y,n=_,s=b,M.setFromMatrixPosition(n.matrixWorld),E.setFromMatrixPosition(s.matrixWorld),o=M.distanceTo(E),a=n.projectionMatrix.elements,s=s.projectionMatrix.elements,h=a[14]/(a[10]-1),l=a[14]/(a[10]+1),u=(a[9]+1)/a[5],c=(a[9]-1)/a[5],a=(a[8]-1)/a[0],s=(s[8]+1)/s[0],f=h*a,d=h*s,a=(s=o/(s-a))*-a,n.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(a),t.translateZ(s),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld),n=h+s,h=l+s,t.projectionMatrix.makePerspective(f-a,o-a+d,u*l/h*n,c*l/h*n,n,h),y};var T=null;var u=new Os;u.setAnimationLoop(function(t,e){if(null!==(p=e.getViewerPose(v))){var i=p.views,r=m.renderState.baseLayer;d.setFramebuffer(r.framebuffer);for(var n=0;n<i.length;n++){var s=i[n],o=r.getViewport(s),a=y.cameras[n];a.matrix.fromArray(s.transform.matrix),a.projectionMatrix.fromArray(s.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===n&&y.matrix.copy(a.matrix)}}for(var h=m.inputSources,n=0;n<g.length;n++){var l=g[n],u=h[n],c=null,f=null;u&&(l.targetRay&&null!==(c=e.getPose(u.targetRaySpace,v))&&(l.targetRay.matrix.fromArray(c.transform.matrix),l.targetRay.matrix.decompose(l.targetRay.position,l.targetRay.rotation,l.targetRay.scale)),l.grip)&&u.gripSpace&&null!==(f=e.getPose(u.gripSpace,v))&&(l.grip.matrix.fromArray(f.transform.matrix),l.grip.matrix.decompose(l.grip.position,l.grip.rotation,l.grip.scale)),l.targetRay&&(l.targetRay.visible=null!==c),l.grip&&(l.grip.visible=null!==f)}T&&T(t,e)}),this.setAnimationLoop=function(t){T=t},this.dispose=function(){}}function _c(t){var O,C,R,N,v,m,g,D,j,p,c,s,h,o,G,U,H,f,r=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,B=void 0===t.depth||t.depth,z=void 0===t.stencil||t.stencil,V=void 0!==t.antialias&&t.antialias,W=void 0===t.premultipliedAlpha||t.premultipliedAlpha,Y=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,X=void 0!==t.powerPreference?t.powerPreference:"default",Z=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,q=void 0!==t.useWebGL2&&t.useWebGL2,_=null,b=null,y=(this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Er,this.physicallyCorrectLights=!1,this.toneMapping=De,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this),J=!1,K=null,Q=0,$=0,a=null,d=null,w=-1,k={geometry:null,program:null,wireframe:!1},x=null,tt=null,M=new At,l=new At,et=null,n=r.width,E=r.height,L=1,it=null,rt=null,u=new At(0,0,n,E),T=new At(0,0,n,E),nt=!1,st=new Ut,S=new cl,ot=!1,at=!1,A=new Tt,P=new Lt;function ht(){return null===a?L:1}try{var lt={alpha:i,depth:B,stencil:z,antialias:V,premultipliedAlpha:W,preserveDrawingBuffer:Y,powerPreference:X,failIfMajorPerformanceCaveat:Z,xrCompatible:!1};if(r.addEventListener("webglcontextlost",ft,!1),r.addEventListener("webglcontextrestored",dt,!1),null===(O=q?r.getContext("webgl2",lt):e||r.getContext("webgl",lt)||r.getContext("experimental-webgl",lt)))throw null!==r.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===O.getShaderPrecisionFormat&&(O.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ut(){C=new fl(O),!1===(R=new ul(O,C,t)).isWebGL2&&(C.get("WEBGL_depth_texture"),C.get("OES_texture_float"),C.get("OES_texture_half_float"),C.get("OES_texture_half_float_linear"),C.get("OES_standard_derivatives"),C.get("OES_element_index_uint"),C.get("ANGLE_instanced_arrays")),C.get("OES_texture_float_linear"),f=new vc(O,C,R),(N=new fc(O,C,R)).scissor(l.copy(T).multiplyScalar(L).floor()),N.viewport(M.copy(u).multiplyScalar(L).floor()),v=new pl(O),m=new Zu,g=new dc(O,C,N,m,R,f,v),D=new Cs(O,R),j=new dl(O,D,v),p=new _l(O,j,D,v),G=new gl(O),c=new Xu(y,C,R),s=new Qu,h=new sc,o=new hl(y,N,p,W),U=new ll(O,C,v,R),H=new vl(O,C,v,R),v.programs=c.programs,y.capabilities=R,y.extensions=C,y.properties=m,y.renderLists=s,y.state=N,y.info=v}ut();var I=new gc(y,O),ct=(this.xr=I,new cc(y,p,R.maxTextureSize));function ft(t){t.preventDefault(),J=!0}function dt(){J=!1,ut()}function vt(t){var t=t.target;t.removeEventListener("dispose",vt),pt(t=t),m.remove(t)}function pt(t){var e=m.get(t).program;(t.program=void 0)!==e&&c.releaseProgram(e)}this.shadowMap=ct,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){var t=C.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=C.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(n,E,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new St),t.set(n,E)},this.setSize=function(t,e,i){I.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(n=t,E=e,r.width=Math.floor(t*L),r.height=Math.floor(e*L),!1!==i&&(r.style.width=t+"px",r.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new St),t.set(n*L,E*L).floor()},this.setDrawingBufferSize=function(t,e,i){n=t,E=e,L=i,r.width=Math.floor(t*i),r.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new At),t.copy(M)},this.getViewport=function(t){return t.copy(u)},this.setViewport=function(t,e,i,r){t.isVector4?u.set(t.x,t.y,t.z,t.w):u.set(t,e,i,r),N.viewport(M.copy(u).multiplyScalar(L).floor())},this.getScissor=function(t){return t.copy(T)},this.setScissor=function(t,e,i,r){t.isVector4?T.set(t.x,t.y,t.z,t.w):T.set(t,e,i,r),N.scissor(l.copy(T).multiplyScalar(L).floor())},this.getScissorTest=function(){return nt},this.setScissorTest=function(t){N.setScissorTest(nt=t)},this.setOpaqueSort=function(t){it=t},this.setTransparentSort=function(t){rt=t},this.getClearColor=function(){return o.getClearColor()},this.setClearColor=function(){o.setClearColor.apply(o,arguments)},this.getClearAlpha=function(){return o.getClearAlpha()},this.setClearAlpha=function(){o.setClearAlpha.apply(o,arguments)},this.clear=function(t,e,i){var r=0;void 0!==t&&!t||(r|=O.COLOR_BUFFER_BIT),void 0!==e&&!e||(r|=O.DEPTH_BUFFER_BIT),void 0!==i&&!i||(r|=O.STENCIL_BUFFER_BIT),O.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",ft,!1),r.removeEventListener("webglcontextrestored",dt,!1),s.dispose(),h.dispose(),m.dispose(),p.dispose(),I.dispose(),_t.stop(),this.forceContextLoss()},this.renderBufferImmediate=function(t,e){N.initAttributes();var i=m.get(t),e=(t.hasPositions&&!i.position&&(i.position=O.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=O.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=O.createBuffer()),t.hasColors&&!i.color&&(i.color=O.createBuffer()),e.getAttributes());t.hasPositions&&(O.bindBuffer(O.ARRAY_BUFFER,i.position),O.bufferData(O.ARRAY_BUFFER,t.positionArray,O.DYNAMIC_DRAW),N.enableAttribute(e.position),O.vertexAttribPointer(e.position,3,O.FLOAT,!1,0,0)),t.hasNormals&&(O.bindBuffer(O.ARRAY_BUFFER,i.normal),O.bufferData(O.ARRAY_BUFFER,t.normalArray,O.DYNAMIC_DRAW),N.enableAttribute(e.normal),O.vertexAttribPointer(e.normal,3,O.FLOAT,!1,0,0)),t.hasUvs&&(O.bindBuffer(O.ARRAY_BUFFER,i.uv),O.bufferData(O.ARRAY_BUFFER,t.uvArray,O.DYNAMIC_DRAW),N.enableAttribute(e.uv),O.vertexAttribPointer(e.uv,2,O.FLOAT,!1,0,0)),t.hasColors&&(O.bindBuffer(O.ARRAY_BUFFER,i.color),O.bufferData(O.ARRAY_BUFFER,t.colorArray,O.DYNAMIC_DRAW),N.enableAttribute(e.color),O.vertexAttribPointer(e.color,3,O.FLOAT,!1,0,0)),N.disableUnusedAttributes(),O.drawArrays(O.TRIANGLES,0,t.count),t.count=0};var mt=new As;this.renderBufferDirect=function(t,e,i,r,n,s){null===e&&(e=mt);var o=n.isMesh&&n.matrixWorld.determinant()<0,t=xt(t,e,r,n),e=(N.setMaterial(r,o,n),!1),o=(k.geometry===i.id&&k.program===t.id&&k.wireframe===(!0===r.wireframe)||(k.geometry=i.id,k.program=t.id,k.wireframe=!0===r.wireframe,e=!0),(r.morphTargets||r.morphNormals)&&(G.update(n,i,r,t),e=!0),i.index),a=i.attributes.position;if(null===o){if(void 0===a||0===a.count)return}else if(0===o.count)return;var h=1,l=(!0===r.wireframe&&(o=j.getWireframeAttribute(i),h=2),U);if(null!==o&&(A=D.get(o),(l=H).setIndex(A)),e){var u=n,c=i,e=r;if(!1!==R.isWebGL2||!u.isInstancedMesh&&!c.isInstancedBufferGeometry||null!==C.get("ANGLE_instanced_arrays")){N.initAttributes();var f,d=c.attributes,v=t.getAttributes(),p=e.defaultAttributeValues;for(f in v){var m=v[f];if(0<=m){var g=d[f];if(void 0!==g){var _,b,y,w,x,M,E,L=g.normalized,T=g.itemSize;void 0!==(_=D.get(g))&&(b=_.buffer,y=_.type,w=_.bytesPerElement,g.isInterleavedBufferAttribute?(x=g.data,M=x.stride,E=g.offset,x&&x.isInstancedInterleavedBuffer?(N.enableAttributeAndDivisor(m,x.meshPerAttribute),void 0===c.maxInstancedCount&&(c.maxInstancedCount=x.meshPerAttribute*x.count)):N.enableAttribute(m),O.bindBuffer(O.ARRAY_BUFFER,b),O.vertexAttribPointer(m,T,y,L,M*w,E*w)):(g.isInstancedBufferAttribute?(N.enableAttributeAndDivisor(m,g.meshPerAttribute),void 0===c.maxInstancedCount&&(c.maxInstancedCount=g.meshPerAttribute*g.count)):N.enableAttribute(m),O.bindBuffer(O.ARRAY_BUFFER,b),O.vertexAttribPointer(m,T,y,L,0,0)))}else if("instanceMatrix"===f)void 0!==(_=D.get(u.instanceMatrix))&&(b=_.buffer,y=_.type,N.enableAttributeAndDivisor(m+0,1),N.enableAttributeAndDivisor(m+1,1),N.enableAttributeAndDivisor(m+2,1),N.enableAttributeAndDivisor(m+3,1),O.bindBuffer(O.ARRAY_BUFFER,b),O.vertexAttribPointer(m+0,4,y,!1,64,0),O.vertexAttribPointer(m+1,4,y,!1,64,16),O.vertexAttribPointer(m+2,4,y,!1,64,32),O.vertexAttribPointer(m+3,4,y,!1,64,48));else if(void 0!==p){var S=p[f];if(void 0!==S)switch(S.length){case 2:O.vertexAttrib2fv(m,S);break;case 3:O.vertexAttrib3fv(m,S);break;case 4:O.vertexAttrib4fv(m,S);break;default:O.vertexAttrib1fv(m,S)}}}}N.disableUnusedAttributes()}null!==o&&O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,A.buffer)}var t=(null!==o?o:a).count,e=i.drawRange.start*h,A=i.drawRange.count*h,o=null!==s?s.start*h:0,a=null!==s?s.count*h:1/0,s=Math.max(e,o),h=Math.min(t,e+A,o+a)-1,t=Math.max(0,h-s+1);0!==t&&(n.isMesh?!0===r.wireframe?(N.setLineWidth(r.wireframeLinewidth*ht()),l.setMode(O.LINES)):l.setMode(O.TRIANGLES):n.isLine?(e=r.linewidth,N.setLineWidth((e=void 0===e?1:e)*ht()),n.isLineSegments?l.setMode(O.LINES):n.isLineLoop?l.setMode(O.LINE_LOOP):l.setMode(O.LINE_STRIP)):n.isPoints?l.setMode(O.POINTS):n.isSprite&&l.setMode(O.TRIANGLES),n.isInstancedMesh?l.renderInstances(i,s,t,n.count):i.isInstancedBufferGeometry?l.renderInstances(i,s,t,i.maxInstancedCount):l.render(s,t))},this.compile=function(i,t){(b=h.get(i,t)).init(),i.traverse(function(t){t.isLight&&(b.pushLight(t),t.castShadow)&&b.pushShadow(t)}),b.setupLights(t);var r={};i.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var e=0;e<t.material.length;e++)t.material[e].uuid in r==!1&&(wt(t.material[e],i,t),r[t.material[e].uuid]=!0);else t.material.uuid in r==!1&&(wt(t.material,i,t),r[t.material.uuid]=!0)})};var gt=null;var _t=new Os;function bt(t,e,i,r){for(var n=0,s=t.length;n<s;n++){var o=t[n],a=o.object,h=o.geometry,l=void 0===r?o.material:r,u=o.group;if(i.isArrayCamera)for(var c=(tt=i).cameras,f=0,d=c.length;f<d;f++){var v=c[f];a.layers.test(v.layers)&&(N.viewport(M.copy(v.viewport)),b.setupLights(v),yt(a,e,v,h,l,u))}else tt=null,yt(a,e,i,h,l,u)}}function yt(t,e,i,r,n,s){var o,a;n&&n.opacity<.001||(t.onBeforeRender(y,e,i,r,n,s),b=h.get(e,tt||i),t.userData.resetLight&&b.setupLights(i),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject?(o=xt(i,e,n,t),N.setMaterial(n),k.geometry=null,k.program=null,k.wireframe=!1,a=o,t.render(function(t){y.renderBufferImmediate(t,a)})):y.renderBufferDirect(i,e,r,n,t,s),t.onAfterRender(y,e,i,r,n,s),b=h.get(e,tt||i))}function wt(t,e,i){var r=m.get(t),n=b.state.lights,s=b.state.shadowsArray,o=n.state.version,s=c.getParameters(t,n.state,s,e,S.numPlanes,S.numIntersection,i),i=c.getProgramCacheKey(s),a=r.program,h=!0;if(void 0===a)t.addEventListener("dispose",vt);else if(a.cacheKey!==i)pt(t);else{if(r.lightsStateVersion!==o)r.lightsStateVersion=o;else if(void 0!==s.shaderID)return;h=!1}h&&(a=c.acquireProgram(s,i),r.program=a,r.uniforms=s.uniforms,r.environment=t.isMeshStandardMaterial?e.environment:null,r.outputEncoding=y.outputEncoding,t.program=a);var l=a.getAttributes();if(t.morphTargets)for(var u=t.numSupportedMorphTargets=0;u<y.maxMorphTargets;u++)0<=l["morphTarget"+u]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(u=t.numSupportedMorphNormals=0;u<y.maxMorphNormals;u++)0<=l["morphNormal"+u]&&t.numSupportedMorphNormals++;h=r.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=S.numPlanes,r.numIntersection=S.numIntersection,h.clippingPlanes=S.uniform),r.fog=e.fog,r.needsLights=(i=t).isMeshLambertMaterial||i.isMeshToonMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isShadowMaterial||i.isShaderMaterial&&!0===i.lights,r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=n.state.ambient,h.lightProbe.value=n.state.probe,h.directionalLights.value=n.state.directional,h.directionalLightShadows.value=n.state.directionalShadow,h.spotLights.value=n.state.spot,h.spotLightShadows.value=n.state.spotShadow,h.rectAreaLights.value=n.state.rectArea,h.pointLights.value=n.state.point,h.pointLightShadows.value=n.state.pointShadow,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix),s=r.program.getUniforms(),a=_u.seqWithValue(s.seq,h);r.uniformsList=a}function xt(t,e,i,r){g.resetTextureUnits();var n,s,o,a,h=e.fog,l=i.isMeshStandardMaterial?e.environment:null,u=m.get(i),c=b.state.lights,f=(ot&&(at||t!==x)&&(f=t===x&&i.id===w,S.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,u,f)),i.version===u.gn?(void 0===u.program||i.fog&&u.fog!==h||u.environment!==l||u.needsLights&&u.lightsStateVersion!==c.state.version||void 0!==u.numClippingPlanes&&(u.numClippingPlanes!==S.numPlanes||u.numIntersection!==S.numIntersection)||u.outputEncoding!==y.outputEncoding)&&wt(i,e,r):(wt(i,e,r),u.gn=i.version),!1),c=!1,e=!1,d=u.program,v=d.getUniforms(),p=u.uniforms;return N.useProgram(d.program)&&(e=c=f=!0),i.id!==w&&(w=i.id,c=!0),(f||x!==t)&&(v.setValue(O,"projectionMatrix",t.projectionMatrix),R.logarithmicDepthBuffer&&v.setValue(O,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),x!==t&&(x=t,e=c=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap)&&void 0!==(f=v.map.cameraPosition)&&f.setValue(O,P.setFromMatrixPosition(t.matrixWorld)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&v.setValue(O,"isOrthographic",!0===t.isOrthographicCamera),i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&v.setValue(O,"viewMatrix",t.matrixWorldInverse),i.skinning&&(v.setOptional(O,r,"bindMatrix"),v.setOptional(O,r,"bindMatrixInverse"),f=r.skeleton)&&(t=f.bones,R.floatVertexTextures?(void 0===f.boneTexture&&(t=Math.sqrt(4*t.length),t=Et.ceilPowerOfTwo(t),t=Math.max(t,4),(a=new Float32Array(t*t*4)).set(f.boneMatrices),o=new Ss(a,t,t,mi,hi),f.boneMatrices=a,f.boneTexture=o,f.boneTextureSize=t),v.setValue(O,"boneTexture",f.boneTexture,g),v.setValue(O,"boneTextureSize",f.boneTextureSize)):v.setOptional(O,f,"boneMatrices")),!c&&u.receiveShadow===r.receiveShadow||(u.receiveShadow=r.receiveShadow,v.setValue(O,"receiveShadow",r.receiveShadow)),c&&(v.setValue(O,"toneMappingExposure",y.toneMappingExposure),v.setValue(O,"toneMappingWhitePoint",y.toneMappingWhitePoint),u.needsLights&&(a=e,(o=p).ambientLightColor.needsUpdate=a,o.lightProbe.needsUpdate=a,o.directionalLights.needsUpdate=a,o.directionalLightShadows.needsUpdate=a,o.pointLights.needsUpdate=a,o.pointLightShadows.needsUpdate=a,o.spotLights.needsUpdate=a,o.spotLightShadows.needsUpdate=a,o.rectAreaLights.needsUpdate=a,o.hemisphereLights.needsUpdate=a),h&&i.fog&&(t=h,(f=p).fogColor.value.copy(t.color),t.isFog?(f.fogNear.value=t.near,f.fogFar.value=t.far):t.isFogExp2&&(f.fogDensity.value=t.density)),i.isMeshBasicMaterial?F(p,i):i.isMeshLambertMaterial?(F(p,i),c=p,(e=i).emissiveMap&&(c.emissiveMap.value=e.emissiveMap)):i.isMeshToonMaterial?(F(p,i),h=i,(t=p).specular.value.copy(h.specular),t.shininess.value=Math.max(h.shininess,1e-4),h.gradientMap&&(t.gradientMap.value=h.gradientMap),h.emissiveMap&&(t.emissiveMap.value=h.emissiveMap),h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Jt)&&(t.bumpScale.value*=-1),h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Jt)&&t.normalScale.value.negate(),h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)):i.isMeshPhongMaterial?(F(p,i),c=i,(e=p).specular.value.copy(c.specular),e.shininess.value=Math.max(c.shininess,1e-4),c.emissiveMap&&(e.emissiveMap.value=c.emissiveMap),c.bumpMap&&(e.bumpMap.value=c.bumpMap,e.bumpScale.value=c.bumpScale,c.side===Jt)&&(e.bumpScale.value*=-1),c.normalMap&&(e.normalMap.value=c.normalMap,e.normalScale.value.copy(c.normalScale),c.side===Jt)&&e.normalScale.value.negate(),c.displacementMap&&(e.displacementMap.value=c.displacementMap,e.displacementScale.value=c.displacementScale,e.displacementBias.value=c.displacementBias)):i.isMeshStandardMaterial?(F(p,i,l),i.isMeshPhysicalMaterial?(Mt(t=p,h=i,l),t.reflectivity.value=h.reflectivity,t.clearcoat.value=h.clearcoat,t.clearcoatRoughness.value=h.clearcoatRoughness,h.sheen&&t.sheen.value.copy(h.sheen),h.clearcoatMap&&(t.clearcoatMap.value=h.clearcoatMap),h.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=h.clearcoatRoughnessMap),h.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),t.clearcoatNormalMap.value=h.clearcoatNormalMap,h.side===Jt)&&t.clearcoatNormalScale.value.negate(),t.transparency.value=h.transparency):Mt(p,i,l)):i.isMeshMatcapMaterial?(F(p,i),e=p,(c=i).matcap&&(e.matcap.value=c.matcap),c.bumpMap&&(e.bumpMap.value=c.bumpMap,e.bumpScale.value=c.bumpScale,c.side===Jt)&&(e.bumpScale.value*=-1),c.normalMap&&(e.normalMap.value=c.normalMap,e.normalScale.value.copy(c.normalScale),c.side===Jt)&&e.normalScale.value.negate(),c.displacementMap&&(e.displacementMap.value=c.displacementMap,e.displacementScale.value=c.displacementScale,e.displacementBias.value=c.displacementBias)):i.isMeshDepthMaterial?(F(p,i),t=p,(h=i).displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)):i.isMeshDistanceMaterial?(F(p,i),l=p,(e=i).displacementMap&&(l.displacementMap.value=e.displacementMap,l.displacementScale.value=e.displacementScale,l.displacementBias.value=e.displacementBias),l.referencePosition.value.copy(e.referencePosition),l.nearDistance.value=e.nearDistance,l.farDistance.value=e.farDistance):i.isMeshNormalMaterial?(F(p,i),c=p,(t=i).bumpMap&&(c.bumpMap.value=t.bumpMap,c.bumpScale.value=t.bumpScale,t.side===Jt)&&(c.bumpScale.value*=-1),t.normalMap&&(c.normalMap.value=t.normalMap,c.normalScale.value.copy(t.normalScale),t.side===Jt)&&c.normalScale.value.negate(),t.displacementMap&&(c.displacementMap.value=t.displacementMap,c.displacementScale.value=t.displacementScale,c.displacementBias.value=t.displacementBias)):i.isLineBasicMaterial?(h=i,(l=p).diffuse.value.copy(h.color),l.opacity.value=h.opacity,i.isLineDashedMaterial&&(e=i,(c=p).dashSize.value=e.dashSize,c.totalSize.value=e.dashSize+e.gapSize,c.scale.value=e.scale)):i.isPointsMaterial?(t=i,(l=p).diffuse.value.copy(t.color),l.opacity.value=t.opacity,l.size.value=t.size*L,l.scale.value=.5*E,t.map&&(l.map.value=t.map),t.alphaMap&&(l.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),l.uvTransform.value.copy(n.matrix))):i.isSpriteMaterial?(h=i,(c=p).diffuse.value.copy(h.color),c.opacity.value=h.opacity,c.rotation.value=h.rotation,h.map&&(c.map.value=h.map),h.alphaMap&&(c.alphaMap.value=h.alphaMap),h.map?s=h.map:h.alphaMap&&(s=h.alphaMap),void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),c.uvTransform.value.copy(s.matrix))):i.isShadowMaterial&&(p.color.value.copy(i.color),p.opacity.value=i.opacity),void 0!==p.ltc_1&&(p.ltc_1.value=Ot.LTC_1),void 0!==p.ltc_2&&(p.ltc_2.value=Ot.LTC_2),_u.upload(O,u.uniformsList,p,g),i.isShaderMaterial)&&(i.uniformsNeedUpdate=!1),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(_u.upload(O,u.uniformsList,p,g),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&v.setValue(O,"center",r.center),v.setValue(O,"modelViewMatrix",r.modelViewMatrix),v.setValue(O,"normalMatrix",r.normalMatrix),v.setValue(O,"modelMatrix",r.matrixWorld),d}function F(t,e,i){t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap);var r,n,i=e.envMap||i;i&&(t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=m.get(i).hn),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r&&(!0===(r=r.isWebGLRenderTarget?r.texture:r).matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),e.aoMap?n=e.aoMap:e.lightMap&&(n=e.lightMap),void 0!==n&&(!0===(n=n.isWebGLRenderTarget?n.texture:n).matrixAutoUpdate&&n.updateMatrix(),t.uv2Transform.value.copy(n.matrix))}function Mt(t,e,i){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Jt)&&(t.bumpScale.value*=-1),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Jt)&&t.normalScale.value.negate(),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||i)&&(t.envMapIntensity.value=e.envMapIntensity)}_t.setAnimationLoop(function(t){I.isPresenting||gt&&gt(t)}),"undefined"!=typeof window&&_t.setContext(window),this.setAnimationLoop=function(t){gt=t,I.setAnimationLoop(t),_t.start()},this.render=function(t,e){var i,r,n;void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),e&&e.isCamera?J||(k.geometry=null,k.program=null,k.wireframe=!1,w=-1,!(x=null)===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),I.enabled&&I.isPresenting&&(e=I.getCamera(e)),(b=h.get(t,e)).init(),t.onBeforeRender(y,t,e,r||a),A.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),st.setFromProjectionMatrix(A),at=this.localClippingEnabled,ot=S.init(this.clippingPlanes,at,e),(_=s.get(t,e)).init(),function t(a,h,e,i){if(!1===a.visible)return;var r=a.layers.test(h.layers);if(r)if(a.isGroup)e=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(h);else if(a.isLight)b.pushLight(a),a.castShadow&&b.pushShadow(a);else if(a.isSprite)a.frustumCulled&&!st.intersectsSprite(a)||(i&&P.setFromMatrixPosition(a.matrixWorld).applyMatrix4(A),n=p.update(a),(s=a.material).visible&&_.push(a,n,s,e,P.z,null));else if(a.isImmediateRenderObject)i&&P.setFromMatrixPosition(a.matrixWorld).applyMatrix4(A),_.push(a,null,a.material,e,P.z,null);else if((a.isMesh||a.isLine||a.isPoints)&&(a.isSkinnedMesh&&a.skeleton.frame!==v.render.frame&&(a.skeleton.update(),a.skeleton.frame=v.render.frame),!a.frustumCulled||st.intersectsObject(a))){if(i){let t=h.position.clone(),e=new Dt,i=(a.geometry.boundingBox||a.geometry.computeBoundingBox(),a.geometry.boundingSphere||a.geometry.computeBoundingSphere(),a.geometry.boundingSphere),r=(e.copy(i).applyMatrix4(a.matrixWorld),a.geometry.boundingBox),n=new Ct,s=(n.copy(r).applyMatrix4(a.matrixWorld),new _s(t,e.center.clone().sub(t).normalize())),o=new Lt;s.intersectBox(n,o),P.z=o.distanceTo(t),(isNaN(P.z)||P.z<=0)&&P.setFromMatrixPosition(a.matrixWorld).applyMatrix4(A)}var n=p.update(a),s=a.material;if(Array.isArray(s))for(var o=n.groups,l=0,u=o.length;l<u;l++){var c=o[l],f=s[c.materialIndex];f&&f.visible&&_.push(a,n,f,e,P.z,c)}else s.visible&&_.push(a,n,s,e,P.z,null)}var d=a.children;for(l=0,u=d.length;l<u;l++)t(d[l],h,e,i)}(t,e,0,y.sortObjects),_.finish(),!0===y.sortObjects&&_.sort(it,rt),ot&&S.beginShadows(),i=b.state.shadowsArray,ct.render(i,t,e),b.setupLights(e),ot&&S.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),o.render(_,t,e,n),i=_.opaque,r=_.transparent,t.overrideMaterial?(n=t.overrideMaterial,i.length&&bt(i,t,e,n),r.length&&bt(r,t,e,n)):(i.length&&bt(i,t,e),r.length&&bt(r,t,e)),t.onAfterRender(y,t,e),null!==a&&(g.updateRenderTargetMipmap(a),g.updateMultisampleRenderTarget(a)),N.buffers.depth.setTest(!0),N.buffers.depth.setMask(!0),N.buffers.color.setMask(!0),N.setPolygonOffset(!1),b=_=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){K!==t&&null===a&&O.bindFramebuffer(O.FRAMEBUFFER,t),K=t},this.getActiveCubeFace=function(){return Q},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return a},this.setRenderTarget=function(t,e,i){Q=e,$=i,(a=t)&&void 0===m.get(t).cn&&g.setupRenderTarget(t);var r,n=K,s=!1;et=t?(r=m.get(t).cn,t.isWebGLCubeRenderTarget?(n=r[e||0],s=!0):n=t.isWebGLMultisampleRenderTarget?m.get(t).vn:r,M.copy(t.viewport),l.copy(t.scissor),t.scissorTest):(M.copy(u).multiplyScalar(L).floor(),l.copy(T).multiplyScalar(L).floor(),nt),d!==n&&(O.bindFramebuffer(O.FRAMEBUFFER,n),d=n),N.viewport(M),N.scissor(l),N.setScissorTest(et),s&&(r=m.get(t.texture),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+(e||0),r.un,i||0))},this.readRenderTargetPixels=function(t,e,i,r,n,s,o){if(t&&t.isWebGLRenderTarget){var a=m.get(t).cn;if(a=t.isWebGLCubeRenderTarget&&void 0!==o?a[o]:a){o=!1;a!==d&&(O.bindFramebuffer(O.FRAMEBUFFER,a),o=!0);try{var h=t.texture,l=h.format,u=h.type;l!==mi&&f.convert(l)!==O.getParameter(O.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):u===ii||f.convert(u)===O.getParameter(O.IMPLEMENTATION_COLOR_READ_TYPE)||u===hi&&(R.isWebGL2||C.get("OES_texture_float")||C.get("WEBGL_color_buffer_float"))||u===li&&(R.isWebGL2?C.get("EXT_color_buffer_float"):C.get("EXT_color_buffer_half_float"))?O.checkFramebufferStatus(O.FRAMEBUFFER)===O.FRAMEBUFFER_COMPLETE?0<=e&&e<=t.width-r&&0<=i&&i<=t.height-n&&O.readPixels(e,i,r,n,f.convert(l),f.convert(u),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{o&&O.bindFramebuffer(O.FRAMEBUFFER,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(e.image.width*r),r=Math.floor(e.image.height*r),s=f.convert(e.format);g.setTexture2D(e,0),O.copyTexImage2D(O.TEXTURE_2D,i,s,t.x,t.y,n,r,0),N.unbindTexture()},this.copyTextureToTexture=function(t,e,i,r){var n=e.image.width,s=e.image.height,o=f.convert(i.format),a=f.convert(i.type);g.setTexture2D(i,0),e.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,r||0,t.x,t.y,n,s,o,a,e.image.data):O.texSubImage2D(O.TEXTURE_2D,r||0,t.x,t.y,o,a,e.image),N.unbindTexture()},this.initTexture=function(t){g.setTexture2D(t,0),N.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}pc.prototype=Object.assign(Object.create(ht.prototype),{constructor:pc,isArrayCamera:!0}),mc.prototype=Object.assign(Object.create(Z.prototype),{constructor:mc,isGroup:!0}),Object.assign(gc.prototype,S.prototype);let bc={};bc.vert=`
                      
                        uniform vec2 offset;
                        uniform float rotation;
                        uniform vec2 scale;
                        varying vec2 vUv;
                        void main() {
                          vUv = uv;
                  
                          
                          vec2 rotatedPosition;
                            rotatedPosition.x = cos( rotation ) * position.x - sin( rotation ) * position.y;
                            rotatedPosition.y = sin( rotation ) * position.x + cos( rotation ) * position.y;
                      
        
                            rotatedPosition.x *= scale.x * abs(projectionMatrix[0][0] / projectionMatrix[1][1]);
                            rotatedPosition.y *= scale.y;
                          
                          rotatedPosition.xy += offset;
                          gl_Position = vec4(rotatedPosition,0.0,1.0);
                        }
                        `,bc.frag=`
                    uniform vec3 diffuse;
                    uniform sampler2D mmap;
                    #include <common>
                    varying vec2 vUv;
               
                    void main() {
                
                        // vec2 muv = vec2(vUv.x , 1.0 - vUv.y);
                        vec4 diffuseColor = texture2D( mmap, vUv );
                       
                        
                        gl_FragColor = diffuseColor;
                    }
                    `;class yc extends g{constructor(t){super(t),this.uniforms.offset={value:new St},this.uniforms.rotation={value:0},this.uniforms.scale={value:new St(1,1)},this.depthTest=!1,this.vertexShader=bc.vert,this.fragmentShader=bc.frag}}function wc(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Ur,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(wc.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(wc.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this},set:function(t,e){return this.array.set(t,e=void 0===e?0:e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var xc=new Lt;function Mc(t,e,i,r){this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===r}Object.defineProperties(Mc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Mc.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,i=this.data.count;e<i;e++)xc.x=this.getX(e),xc.y=this.getY(e),xc.z=this.getZ(e),xc.applyMatrix4(t),this.setXYZ(e,xc.x,xc.y,xc.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}});class Ec extends et{constructor(){super();var t=new wc(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);this.setIndex([0,1,2,0,2,3]),this.setAttribute("position",new Mc(t,3,0,!1)),this.setAttribute("uv",new Mc(t,2,3,!1))}}function Lc(t,e,i,r,n,s,o,a,h){f.call(this,t,e,i,r,n,s,o,a,h),this.needsUpdate=!0}function Tc(t,e,i,r,n,s){var o=(t+i)/2,a=(e+r)/2,h=((t-i)*(t-i)+(e-r)*(e-r))/4,l=Math.sqrt(h),l=l*(l/Math.sqrt(n*n-h)),n=Math.PI/2,h=(i-t)/(e-r),u=(t-i)/(e-r),c=Math.sqrt(1+h*h),f=Math.sqrt(1+u*u),h={x:o+l*(1/c),y:a+l*(h/c),theta:n},c={x:o+l*(-1/f),y:a+l*(u/f),theta:n};return 0<(i-t)*(h.y-e)-(r-e)*(h.x-t)?0===s?h:c:0===s?c:h}function Sc(e,i,r,n){for(let t=0;t<e.length;t++)switch(e[t]){case"m":i.moveTo(n.x+parseFloat(e[t+1]),n.y+parseFloat(e[t+2])),r.x=n.x+parseFloat(e[t+1]),r.y=n.y+parseFloat(e[t+2]),n.x=r.x,n.y=r.y,t+=2;break;case"M":i.moveTo(parseFloat(e[t+1]),parseFloat(e[t+2])),r.x=parseFloat(e[t+1]),r.y=parseFloat(e[t+2]),n.x=r.x,n.y=r.y,t+=2;break;case"l":i.lineTo(r.x+parseFloat(e[t+1]),r.y+parseFloat(e[t+2])),r.x=r.x+parseFloat(e[t+1]),r.y=r.y+parseFloat(e[t+2]),t+=2;break;case"L":i.lineTo(parseFloat(e[t+1]),parseFloat(e[t+2])),r.x=parseFloat(e[t+1]),r.y=parseFloat(e[t+2]),t+=2;break;case"A":var s=parseFloat(e[t+1]),o=parseFloat(e[t+2]),a=(parseFloat(e[t+3]),Math.PI,parseFloat(e[t+4]),parseFloat(e[t+5])),h=r.x,l=r.y,u=parseFloat(e[t+6]),c=parseFloat(e[t+7]);s===o&&(f=Tc(h,l,u,c,s,a),i.arcTo(f.x,f.y,u,c,f.theta),r.x=u,r.y=c),t+=7;break;case"a":var f,s=parseFloat(e[t+1]),o=parseFloat(e[t+2]),a=(parseFloat(e[t+3]),Math.PI,parseFloat(e[t+4]),parseFloat(e[t+5])),h=r.x,l=r.y,u=h+parseFloat(e[t+6]),c=l+parseFloat(e[t+7]);s===o&&(f=Tc(h,l,u,c,s,a),i.arcTo(f.x,f.y,u,c,f.theta),r.x=u,r.y=c),t+=7;break;case"h":i.lineTo(r.x+parseFloat(e[t+1]),r.y),r.x=r.x+parseFloat(e[t+1]),t+=1;break;case"H":i.lineTo(parseFloat(e[t+1]),r.y),r.x=parseFloat(e[t+1]),t+=1;break;case"z":case"Z":i.lineTo(n.x,n.y)}}Lc.prototype=Object.create(f.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isCanvasTexture=!0;let Ac=["M","0","15.07","L","0.69","1.92","A","2","2","0","0","1","2.66","0","L","11.8","0","l","-0.07","1.37","H","3.09","A","1.09","1.09","0","0","0","2","2.44","l","-0.2","4.44","h","9.37","l","-0.07","1.37","H","1.72","l","-0.36","6.82","Z"],Oc=["M","13.79","11","l","-0.08","1.63","a","1","1","0","0","0","1","1.08","h","8.53","l","-0.07","1.36","h","-9","A","1.84","1.84","0","0","1","12.31","13","l","0.48","-9.16","h","8.9","a","2","2","0","0","1","2","2","L","23.53","9","A","2.11","2.11","0","0","1","21.47","11","Z","m","8.4","-2.49","l","0.08","-2.16","a","1.07","1.07","0","0","0","-1.09","-1.09","H","14.09","l","-0.22","4.33","H","21","A","1.15","1.15","0","0","0","22.19","8.51","Z"],Cc=["M","33.94","3.86","a","1.93","1.93","0","0","1","2","1.95","l","-0.47","9.27","H","34.07","l","0.45","-8.72","a","1.09","1.09","0","0","0","-1.09","-1.1","H","26.3","l","-0.51","9.82","H","24.41","L","25","3.85","Z"],Rc=["M","36.48","17.72","H","45","a","1.16","1.16","0","0","0","1.16","-1.22","l","0.07","-1.43","H","38.72","a","2","2","0","0","1","-2","-2.06","l","0.37","-7.19","a","2","2","0","0","1","2.15","-2","H","48.2","l","-0.69","13.28","a","2.09","2.09","0","0","1","-2.06","2","h","-9","Z","m","9.85","-4.05","l","0.44","-8.45","H","39.53","a","1.07","1.07","0","0","0","-1.08","1.1","l","-0.32","6.27","a","1.16","1.16","0","0","0","1.1","1.1","Z"],Nc=["M","57.43","11.59","L","63.48","0","h","1.83","l","-0.79","15.05","H","63.15","l","0.67","-12.79","L","57.67","14","h","-0.75","L","52.07","2.34","l","-0.64","12.72","H","50","L","50.83","0","H","52.6","Z"],Dc=["M","69.6","10.2","l","-2.37","4.87","h","-1.5","L","73.09","0","h","1.49","l","5.77","15.05","h","-1.5","L","77","10.2","Z","m","6.86","-1.39","L","73.74","1.73","L","70.28","8.81","Z"],kc=["M","82.95","15.07","H","81.57","L","82.35","0","h","10","a","1.94","1.94","0","0","1","1.85","2","L","93.89","7.4","a","2","2","0","0","1","-2","1.92","H","83.25","Z","m","8.43","-7.15","a","1.13","1.13","0","0","0","1.09","-1.09","l","0.35","-4.37","a","1.1","1.1","0","0","0","-1.08","-1.06","H","83.66","l","-0.34","6.53","Z"];function Pc(){var t=ot.document.createElement("canvas"),e=t.getContext("2d"),i=(t.width=500,t.height=120,t.style.width="500px",t.style.height="120px",{x:0,y:0}),r={x:0,y:0},n=(e.transform(5,0,0,5,10,10),e.createLinearGradient(5.9,15.07,5.9,0)),n=(n.addColorStop(0,"#232323"),n.addColorStop(1,"#585858"),e.fillStyle=n,e.beginPath(),Sc(Ac,e,r,i),e.closePath(),e.fill(),e.beginPath(),Sc(Oc,e,r,i),e.closePath(),e.fill(),e.beginPath(),Sc(Cc,e,r,i),e.closePath(),e.fill(),e.beginPath(),Sc(Rc,e,r,i),e.closePath(),e.fill(),e.createLinearGradient(57.68,15.07,57.68,0));n.addColorStop(0,"#77bf00"),n.addColorStop(1,"#addc0c"),e.fillStyle=n,e.beginPath(),Sc(Nc,e,r,i),e.closePath(),e.fill(),e.beginPath(),Sc(Dc,e,r,i),e.closePath(),e.fill(),e.beginPath(),Sc(kc,e,r,i),e.closePath(),e.fill();let s;return ot.environment==q.BROWSER?s=new Lc(t):(n=t.toDataURL("image/png"),e.restore(),s=new f,ot.textureHelper.createImage({url:n,onload:t=>{s.image=t,s.needsUpdate=!0}})),s}let Ic={bn:!0},Fc=t=>{var e=Pc(),i=new St(.4,.096),r=new yc,t=-1*(.5*i.x/t-1),n=-1*(1-.5*i.y);return e.minFilter=Qe,e.generateMipmaps=!1,r.transparent=!0,r.depthTest=!1,r.uniforms={scale:{value:i},offset:{value:new St(t,n)},mmap:{value:e}},r.needsUpdate=!0,new Q(new Ec,r)};class jc{constructor(t,e,i){this.yn=0,this.Di=0,this.R=t,this.Ri=e,this.P=i,this.renderer=this.wn(e.container,e.logarithmicDepthBuffer,e.preserveDrawingBuffer),this.$r=new Map;i=this.R.getMapOptions().depthPeeling;i&&ot.environment===q.BROWSER&&(this.xn=new ot.DepthPeelingRenderer({map:t,renderManager:this,mode:i.mode,layers:i.layers,type:i.types})),this.Mn=JSON.parse(JSON.stringify(e.renderOrder)),this.En=0,this.Ln=!1,this.Tn=null,this.Sn=Ic.bn,this.Sn&&(this.Tn=Fc(this.renderer.domElement.clientWidth/this.renderer.domElement.clientHeight),this.Tn.frustumCulled=!1,this.xx45f6=this.Tn),this.An=!1,this.On=!1,this.p=this.renderer.domElement.clientWidth,this.Cn=this.renderer.domElement.clientHeight,this.type="basic",this.Rn=null,this.X=!0,this.en=void 0,this.Nn=void 0,this.tn=[],this.Dn()}getRenderer(){return this.xn||this.renderer}setTileLayScene(t){this.en=t}getTileLayScene(){return this.en}setGroundLayerScene(t){this.Nn=t}getGroundLayerScene(){return this.Nn}set3DTilesLayerSceneArr(t){this.tn.push(t)}get3DTilesLayerSceneArr(){return this.tn}get needLogo(){return this.Sn}render(){let s=this;if(this.renderer&&(this.yn+=1,15e6<this.yn&&(this.yn=0),ot.environment!==q.WX||1!=this.Di||this.yn%2!=0)){this.R.C.ki.ne(),this.R.C.ki.se(this.$r),this.R.C.ki.se([this.en,this.Nn,...this.tn]),this.renderer.clear(),this.en&&this.renderer.render(this.en,this.R.ft),this.Nn&&this.renderer.render(this.Nn,this.R.ft);for(let t=0;t<this.tn.length;t++)this.renderer.render(this.tn[t],this.R.ft);this.R.getMapOptions().depthPeeling?this.xn.render():this.$r.forEach(t=>this.renderer.render(t,this.R.ft));let n={min:1/0,max:-1/0},r=(this.R.kn.I.forEach(t=>{let r=[];t.Pn.forEach(t=>{let e=t.buildingID;var i;(e=>{let i=!1,r=Array.from(s.getRenderList());for(let t=0;t<r.length;t++)if(r[t][0].split("%A%B%C%D")[0]===e){i=!0;break}return i})(e=e||this.R.getMapOptions().mapID)&&t.isCross&&(r.push(t),i=Math.min(t.levelRange[0],t.levelRange[1]),n.min>i&&(n.min=i),i=Math.max(t.levelRange[0],t.levelRange[1]),n.max<i)&&(n.max=i)}),r.forEach(t=>{this.renderer.render(t.line,this.R.ft)})}),this.Mn.indexOf(p.LINE_MARKER));this.$r.forEach((t,e)=>{var e=e.split("%A%B%C%D"),i=e[1],e=e[2];+i===n.max&&this.Mn.indexOf(p.LAYER_NODE_TYPE.get(+e))>r&&this.renderer.render(t,this.R.ft)}),this.R.kn&&this.renderer.render(this.R.kn.Fn,this.R.ft),this.Sn&&this.Tn&&this.renderer.render(this.Tn,this.R.ft)}}resize(){this.renderer&&(5<Math.abs(this.renderer.domElement.parentElement.clientHeight-this.Cn)||5<Math.abs(this.renderer.domElement.parentElement.clientWidth-this.p))&&(this.jn(this.renderer.domElement.parentElement.clientWidth,this.renderer.domElement.parentElement.clientHeight),this.p=this.renderer.domElement.clientWidth,this.Cn=this.renderer.domElement.clientHeight,this.R.Yt.Wt({type:"resize"}))}getRenderList(){return this.$r}get parent(){return this.R}getWebGLRenderer(){return _c}}Object.assign(jc.prototype,{Gn(){for(var t in this.R=null,this.Ri=null,this.P=null,this)this[""+t]=null,delete this[""+t]},Kt(){this.X=!1,this.$r.clear(),ot.window.cancelAnimationFrame(this.Un)},wn(t,e,i){var r=this.R.getMapOptions().depthPeeling,r=new _c({useWebGL2:r,antialias:!0,alpha:!0,logarithmicDepthBuffer:e,preserveDrawingBuffer:i,canvas:ot.environment==q.BROWSER?void 0:t});return r.setPixelRatio(ot.window.devicePixelRatio),ot.environment===q.BROWSER&&r.setSize(t.clientWidth,t.clientHeight),r.autoClear=!1,r.domElement.style.position="absolute",r.domElement.style.top=0,r.domElement.style.zIndex=0,r.setClearAlpha(0),ot.environment==q.BROWSER&&t.appendChild(r.domElement),r},Hn(t){this.renderer=t},Bn(t){t="3D"===t?this.R.Pi:this.R.At;return t.updateMatrixWorld(!0),(new Ut).setFromProjectionMatrix((new Tt).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))},zn(e){var i=[],r=[];for(let t=0;t<e.length;t++){var n=this.Mn.indexOf(e[t]);-1!==n&&(i.push(n),r.push(e[t]))}i.sort((t,e)=>t-e);for(let t=0;t<i.length;t++)this.Mn[i[t]]=r[t];this.Bt()},Vn(t){this.Mn=t,this.Bt()},Wn(t,e){let i,r=1;var n=this.renderer.domElement.clientHeight;i=this.R.ft.isPerspectiveCamera?e?e/(n/(2*Math.tan(this.R.Pi.fov*l.DEG2RAD/2))):t.mapNode.Yn/(n/(2*Math.tan(this.R.Pi.fov*l.DEG2RAD/2))):e?e*Math.abs(this.R.ft.top-this.R.ft.bottom)/this.R.ft.zoom/n:t.mapNode.Yn*Math.abs(this.R.ft.top-this.R.ft.bottom)/this.R.ft.zoom/n,t.material.userData.scaleRatio&&(r=t.material.userData.scaleRatio),t.scale.set(i,i/r,i)},Mt(){this.$r.forEach(e=>{switch(e.userData.type){case"label":for(let t=0;t<e.children.length;t++)e.children[t].mapNode.Xn(this.R.Vt);break;case"facility":for(let t=0;t<e.children.length;t++)this.Wn(e.children[t]);break;default:for(let t=0;t<e.children.length;t++)!e.children[t].mapNode||e.children[t].mapNode.type!==p.IMAGE_MARKER&&e.children[t].mapNode.type!==p.LOCATION_MARKER||e.children[t].mapNode.Zn()}})},jn(t,e){var i=this.R.Pi,r=this.R.At,n=new St(.4,.096),s=-1*(.5*n.x/(t/e)-1),o=-1*(1-.5*n.y);for(i.aspect=t/e,i.updateProjectionMatrix(),r.left=-t/2,r.right=t/2,r.top=e/2,r.bottom=-e/2,r.updateProjectionMatrix(),this.Tn&&(this.Tn.material.uniforms.scale={value:n},this.Tn.material.uniforms.offset={value:new St(s,o)}),this.renderer.setSize(t,e),this.Mt(),this.R.enableUpdateRender(),this.R.enableUpdateNode(),this.R.Vt.qn();0<this.R.Vt.Jn.length;)this.R.Vt.Kn()},Qn(t,e){let i;var r;i=t.ndcPos||(ot.environment===q.BROWSER&&(t.updateMatrixWorld(!0),t.parent.updateMatrixWorld(!0)),r=this.R.ft,(new Lt).setFromMatrixPosition(t.matrixWorld).applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix));let n=t.mapNode.Yn,s;if(e){if("string"==typeof t.mapNode.text){if(!t.material.map.image)return;s=t.mapNode.type===p.LABEL?(n=t.material.map.image.height/2/1.2,t.material.map.image.width/2/1.2):(r=t.mapNode.text.split("%rn%").length,(n*=r)/t.material.userData.scaleRatio)}else{var e=t.mapNode.text.length;n*=e,s=n/t.material.userData.scaleRatio}void 0!==t.material.userData.style&&(r=t.material.userData.style,e=n*t.material.userData.itHeightRatio*1.1,"limage-rtext"===r||"ltext-rimage"===r?n<e&&(n=e,s=n/t.material.userData.scaleRatio):"timage-btext"===r||"ttext-bimage"===r?(n+=e,s=n/t.material.userData.scaleRatio):"overlay-text"===r&&n<e&&(n=e,s=n/t.material.userData.scaleRatio))}else n=(s=n)/t.material.userData.scaleRatio;return n=n/this.renderer.domElement.clientHeight*2,s=s/this.renderer.domElement.clientWidth*2,{leftTop:new St(i.x-s/2,i.y+n/2),rightDown:new St(i.x+s/2,i.y-n/2)}},$n(u){return new Promise((s,t)=>{if(0===u.length)s();else{var e=[],i=new Lt;let n=[];for(let t=0;t<u.length;t++){var r=u[t].children[0]||u[t];"Sprite"===r.type&&(r.updateMatrixWorld(!0),r.parent.updateMatrixWorld(!0),r.getWorldPosition(i),e.push(i.x,i.y,i.z),n.push(r))}var o=new ArrayBuffer(8*e.length);let t=new Float64Array(o);t.set(e);var a=this.R.ft,h=new ArrayBuffer(128),l=((t=new Float64Array(h)).set(a.matrixWorldInverse.elements),new ArrayBuffer(128));(t=new Float64Array(l)).set(a.projectionMatrix.elements),this.R.Vt.ts.__addTask({type:p.LABEL,spritePositions:o,matrixWorldInverse:h,projectionMatrix:l}).then(t=>{var e=t.result.ndcPositions;let i=0;for(let t=0;t<e.length;t+=2){var r=n[i];r&&(r.ndcPos={x:e[t],y:e[t+1]}),i+=1}s()})}})},es(i,r,e,n,s){for(let t=0;t<r.length;t++){var o=r[t].mapNode.rs;if(!r[t].mapNode.er||r[t].mapNode.Qr)o?r[t].mapNode.collisionTargetShow=!1:r[t].visible=!1;else if(r[t].mapNode.Ki&&(r[t].mapNode.Ki.maxlevel<=n||r[t].mapNode.Ki.minlevel>n))o?r[t].mapNode.collisionTargetShow=!1:r[t].visible=!1;else if(!1===s)o?r[t].mapNode.collisionTargetShow=!0:r[t].visible=!0;else if(!1===r[t].mapNode.ns)o?r[t].mapNode.collisionTargetShow=!0:r[t].visible=!0;else{var a=r[t].children[0]||r[t];if("Sprite"===a.type&&a.material.map){var h=this.Qn(a,e);if(h){r[t].userData.bounds=h;let e=!0;for(let t=0;t<i.length;t++){var l=i[t].userData.bounds;if(!(e=!U.ye(h.leftTop,h.rightDown,l.leftTop,l.rightDown)))break}e?(o?r[t].mapNode.collisionTargetShow=!0:r[t].visible=!0,i.push(r[t])):o?r[t].mapNode.collisionTargetShow=!1:r[t].visible=!1}}}}for(let t=0;t<r.length;t++)r[t].mapNode.rs&&r[t].mapNode.ss()},hs(){!0!==this.P.ls&&!0!==this.P.us||(this.On=!0)},Bt(){this.An=!0},ht(t){this.$r.delete(t)},cs(){this.$r.clear()},ds(){if(this.An){this.$r.clear();let r=[];this.R.traverse(e=>{if(this.R.Vt.vs(e))for(let t=0;t<e.visibleLevels.length;t++){var i=e.getFloor(e.visibleLevels[t]);i&&r.push(i)}}),r.sort((t,e)=>t.height<e.height?-1:t.height>e.height?1:t.parent===this.R.S?-1:e.parent===this.R.S?1:0),r.forEach(t=>{let e=[];t.traverse(t=>{e.unshift(t)}),e.sort((t,e)=>{let i=this.Mn.indexOf(p.LAYER_NODE_TYPE.get(t.Ei)),r=this.Mn.indexOf(p.LAYER_NODE_TYPE.get(e.Ei));t=this.Mn.length-1;return-1===i&&(i=t),-1===r&&(r=t),i-r}),e.forEach((t,e,i)=>{var r=t.parent,r=r.parent.Ht+"%A%B%C%D"+r.level+"%A%B%C%D"+t.Ei;this.$r.set(r,t.scene)})}),this.An=!1,this.Mt(),this.hs()}},K(){this.$r&&0<this.$r.size&&!this.Ln&&(this.R.Yt.Wt({type:"firstRender"}),this.Ln=!0)},Dn(t){this.R&&this.X&&(null==this.Rn&&(this.Rn=t),this.X&&(this.Un=ot.window.requestAnimationFrame(this.Dn.bind(this))),this.R.Yt.Wt({type:"beforeRender"}),this.resize(),t={type:"update",renderType:this.P.ps?0:1},this.P.ps&&(this.render(),this.K(),this.P.ps=!1),this.R.Yt.Wt(t))}});let Gc=null;class Uc{constructor(){}static global(){if("undefined"!=typeof self&&null!==self&&0!==Object.keys(self).length)return self;if("undefined"!=typeof window&&null!==window&&0!==Object.keys(window).length)return window;if("undefined"!=typeof global&&null!==global&&0!==Object.keys(global).length)return global;var t;if("undefined"!=typeof my)return Gc||(t=my.getAppIdSync(),Gc={location:{host:t.appId+".hybrid.alipay-eco.com"}}),Gc;if(ot.environment==q.WX)return{};throw new Error("unable to locate global object")}}class Hc{constructor(t){this.gs={data:null,method:"GET",responseType:"json",...t},this._s=null}}Object.assign(Hc.prototype,{bs(t,e,i){var{data:r,method:n,url:s,responseType:o,header:a}=this.gs;let h=null;if((h=new(ot.environment===q.WX?ot.XMLHttpRequest:"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:Uc.global().fengmap.XMLHttpRequest)).responseType=o,h.open(n,s),"object"==typeof a)for(var l in a)h.setRequestHeader(l,a[l]);h.addEventListener("load",()=>{200===h.status||0===h.status||201===h.status?t&&t(h.response):e&&(404===h.status?e(Wr.PATH_ERROR):2069===h.response.error_code?e(Wr.NAME_KEY_ERROR):2063===h.response.error_code?e(Wr.MAP_ID_URL_ERROR):400===h.response.error_code?e(Wr.THEME_ID_URL_ERROR):e(h.response))}),h.addEventListener("timeout",t=>{i&&i(t)}),h.addEventListener("error",t=>{e&&e(t)}),h.send(JSON.stringify(r)),this._s=h},Kt(){this._s&&this._s.abort&&(this._s.abort(),this._s=null)}});var Bc={exports:{}},zc={},Vc={},Wc,Yc;function Xc(){return Yc||(Yc=1,Wc=function(t,e){var i=new Array(arguments.length-1),s=0,r=2,o=!0;for(;r<arguments.length;)i[s++]=arguments[r++];return new Promise(function(r,n){i[s]=function(t){if(o)if(o=!1,t)n(t);else{for(var e=new Array(arguments.length-1),i=0;i<e.length;)e[i++]=arguments[i];r.apply(null,e)}};try{t.apply(e||null,i)}catch(t){o&&(o=!1,n(t))}})}),Wc}var Zc={},qc,Jc,Kc,Qc,$c,tf,ef;function rf(){if(!qc){qc=1;for(var t=Zc,l=(t.length=function(t){var e=t.length;if(!e)return 0;for(var i=0;1<--e%4&&"="===t.charAt(e);)++i;return Math.ceil(3*t.length)/4-i},new Array(64)),h=new Array(123),e=0;e<64;)h[l[e]=e<26?e+65:e<52?e+71:e<62?e-4:e-59|43]=e++;t.encode=function(t,e,i){for(var r,n=null,s=[],o=0,a=0;e<i;){var h=t[e++];switch(a){case 0:s[o++]=l[h>>2],r=(3&h)<<4,a=1;break;case 1:s[o++]=l[r|h>>4],r=(15&h)<<2,a=2;break;case 2:s[o++]=l[r|h>>6],s[o++]=l[63&h],a=0}8191<o&&((n=n||[]).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=l[r],s[o++]=61,1===a)&&(s[o++]=61),n?(o&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var u="invalid encoding";t.decode=function(t,e,i){for(var r,n=i,s=0,o=0;o<t.length;){var a=t.charCodeAt(o++);if(61===a&&1<s)break;if(void 0===(a=h[a]))throw Error(u);switch(s){case 0:r=a,s=1;break;case 1:e[i++]=r<<2|(48&a)>>4,r=a,s=2;break;case 2:e[i++]=(15&r)<<4|(60&a)>>2,r=a,s=3;break;case 3:e[i++]=(3&r)<<6|a,s=0}}if(1===s)throw Error(u);return i-n},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}}return Zc}function nf(){return Kc||(Kc=1,(Jc=t).prototype.on=function(t,e,i){return(this.M[t]||(this.M[t]=[])).push({fn:e,ctx:i||this}),this},t.prototype.off=function(t,e){if(void 0===t)this.M={};else if(void 0===e)this.M[t]=[];else for(var i=this.M[t],r=0;r<i.length;)i[r].fn===e?i.splice(r,1):++r;return this},t.prototype.emit=function(t){var e=this.M[t];if(e){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,i)}return this}),Jc;function t(){this.M={}}}function sf(){return $c||($c=1,Qc=t(t)),Qc;function t(t){function e(t,e,i,r){var n=e<0?1:0;0===(e=n?-e:e)?t(0<1/e?0:2147483648,i,r):isNaN(e)?t(2143289344,i,r):t(34028234663852886e22<e?(n<<31|2139095040)>>>0:e<11754943508222875e-54?(n<<31|Math.round(e/1401298464324817e-60))>>>0:(n<<31|(t=Math.floor(Math.log(e)/Math.LN2))+127<<23|8388607&Math.round(e*Math.pow(2,-t)*8388608))>>>0,i,r)}function i(t,e,i){t=t(e,i),e=2*(t>>31)+1,i=t>>>23&255,t&=8388607;return 255==i?t?NaN:1/0*e:0==i?1401298464324817e-60*e*t:e*Math.pow(2,i-150)*(8388608+t)}function r(t,e,i){a[0]=t,e[i]=h[0],e[i+1]=h[1],e[i+2]=h[2],e[i+3]=h[3]}function n(t,e,i){a[0]=t,e[i]=h[3],e[i+1]=h[2],e[i+2]=h[1],e[i+3]=h[0]}function s(t,e){return h[0]=t[e],h[1]=t[e+1],h[2]=t[e+2],h[3]=t[e+3],a[0]}function o(t,e){return h[3]=t[e],h[2]=t[e+1],h[1]=t[e+2],h[0]=t[e+3],a[0]}var a,h,l,u,c;function f(t,e,i,r,n,s){var o,a,h=r<0?1:0;0===(r=h?-r:r)?(t(0,n,s+e),t(0<1/r?0:2147483648,n,s+i)):isNaN(r)?(t(0,n,s+e),t(2146959360,n,s+i)):17976931348623157e292<r?(t(0,n,s+e),t((h<<31|2146435072)>>>0,n,s+i)):r<22250738585072014e-324?(t((o=r/5e-324)>>>0,n,s+e),t((h<<31|o/4294967296)>>>0,n,s+i)):(1024===(a=Math.floor(Math.log(r)/Math.LN2))&&(a=1023),t(4503599627370496*(o=r*Math.pow(2,-a))>>>0,n,s+e),t((h<<31|a+1023<<20|1048576*o&1048575)>>>0,n,s+i))}function d(t,e,i,r,n){e=t(r,n+e),t=t(r,n+i),r=2*(t>>31)+1,n=t>>>20&2047,i=4294967296*(1048575&t)+e;return 2047==n?i?NaN:1/0*r:0==n?5e-324*r*i:r*Math.pow(2,n-1075)*(i+4503599627370496)}function v(t,e,i){l[0]=t,e[i]=u[0],e[i+1]=u[1],e[i+2]=u[2],e[i+3]=u[3],e[i+4]=u[4],e[i+5]=u[5],e[i+6]=u[6],e[i+7]=u[7]}function p(t,e,i){l[0]=t,e[i]=u[7],e[i+1]=u[6],e[i+2]=u[5],e[i+3]=u[4],e[i+4]=u[3],e[i+5]=u[2],e[i+6]=u[1],e[i+7]=u[0]}function m(t,e){return u[0]=t[e],u[1]=t[e+1],u[2]=t[e+2],u[3]=t[e+3],u[4]=t[e+4],u[5]=t[e+5],u[6]=t[e+6],u[7]=t[e+7],l[0]}function g(t,e){return u[7]=t[e],u[6]=t[e+1],u[5]=t[e+2],u[4]=t[e+3],u[3]=t[e+4],u[2]=t[e+5],u[1]=t[e+6],u[0]=t[e+7],l[0]}return"undefined"!=typeof Float32Array?(a=new Float32Array([-0]),h=new Uint8Array(a.buffer),c=128===h[3],t.writeFloatLE=c?r:n,t.writeFloatBE=c?n:r,t.readFloatLE=c?s:o,t.readFloatBE=c?o:s):(t.writeFloatLE=e.bind(null,_),t.writeFloatBE=e.bind(null,b),t.readFloatLE=i.bind(null,y),t.readFloatBE=i.bind(null,w)),"undefined"!=typeof Float64Array?(l=new Float64Array([-0]),u=new Uint8Array(l.buffer),c=128===u[7],t.writeDoubleLE=c?v:p,t.writeDoubleBE=c?p:v,t.readDoubleLE=c?m:g,t.readDoubleBE=c?g:m):(t.writeDoubleLE=f.bind(null,_,0,4),t.writeDoubleBE=f.bind(null,b,4,0),t.readDoubleLE=d.bind(null,y,0,4),t.readDoubleBE=d.bind(null,w,4,0)),t}function _(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function b(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=255&t}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function w(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}}function of(){return ef||(ef=1,tf=t),tf;function t(t){try{var e=eval("quire".replace(/^/,"re"))(t);if(e&&(e.length||Object.keys(e).length))return e}catch(t){}return null}}var af={},hf,lf,uf,cf,ff,df;function vf(){var t;return hf||(hf=1,(t=af).length=function(t){for(var e,i=0,r=0;r<t.length;++r)(e=t.charCodeAt(r))<128?i+=1:e<2048?i+=2:55296==(64512&e)&&56320==(64512&t.charCodeAt(r+1))?(++r,i+=4):i+=3;return i},t.read=function(t,e,i){if(i-e<1)return"";for(var r,n=null,s=[],o=0;e<i;)(r=t[e++])<128?s[o++]=r:191<r&&r<224?s[o++]=(31&r)<<6|63&t[e++]:239<r&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[o++]=55296+(r>>10),s[o++]=56320+(1023&r)):s[o++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],8191<o&&((n=n||[]).push(String.fromCharCode.apply(String,s)),o=0);return n?(o&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join("")):String.fromCharCode.apply(String,s.slice(0,o))},t.write=function(t,e,i){for(var r,n,s=i,o=0;o<t.length;++o)(r=t.charCodeAt(o))<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(n=t.charCodeAt(o+1)))?(++o,e[i++]=(r=65536+((1023&r)<<10)+(1023&n))>>18|240,e[i++]=r>>12&63|128):e[i++]=r>>12|224,e[i++]=r>>6&63|128),e[i++]=63&r|128);return i-s}),af}function pf(){return uf||(uf=1,lf=function(e,i,t){var r=t||8192,n=r>>>1,s=null,o=r;return function(t){if(t<1||n<t)return e(t);r<o+t&&(s=e(r),o=0);t=i.call(s,o,o+=t);return 7&o&&(o=1+(7|o)),t}}),lf}function mf(){var e,r,i;return ff||(ff=1,cf=n,e=gf(),(r=n.zero=new n(0,0)).toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1},n.zeroHash="\0\0\0\0\0\0\0\0",n.fromNumber=function(t){var e,i;return 0===t?r:(i=(t=(e=t<0)?-t:t)>>>0,t=(t-i)/4294967296>>>0,e&&(t=~t>>>0,i=~i>>>0,4294967295<++i)&&(i=0,4294967295<++t)&&(t=0),new n(i,t))},n.from=function(t){if("number"==typeof t)return n.fromNumber(t);if(e.isString(t)){if(!e.Long)return n.fromNumber(parseInt(t,10));t=e.Long.fromString(t)}return t.low||t.high?new n(t.low>>>0,t.high>>>0):r},n.prototype.toNumber=function(t){var e;return!t&&this.hi>>>31?(t=1+~this.lo>>>0,e=~this.hi>>>0,-(t+4294967296*(e=t?e:e+1>>>0))):this.lo+4294967296*this.hi},n.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}},i=String.prototype.charCodeAt,n.fromHash=function(t){return"\0\0\0\0\0\0\0\0"===t?r:new n((i.call(t,0)|i.call(t,1)<<8|i.call(t,2)<<16|i.call(t,3)<<24)>>>0,(i.call(t,4)|i.call(t,5)<<8|i.call(t,6)<<16|i.call(t,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},n.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},n.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0==i?0==e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10}),cf;function n(t,e){this.lo=t>>>0,this.hi=e>>>0}}function gf(){var r;return df||(df=1,(r=Vc).asPromise=Xc(),r.base64=rf(),r.EventEmitter=nf(),r.float=sf(),r.inquire=of(),r.utf8=vf(),r.pool=pf(),r.LongBits=mf(),r.isNode=Boolean(void 0!==is&&is&&is.process&&is.process.versions&&is.process.versions.node),r.global=r.isNode&&is||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||is,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,e){var i=t[e];return!(null==i||!t.hasOwnProperty(e))&&("object"!=typeof i||0<(Array.isArray(i)?i:Object.keys(i)).length)},r.Buffer=(()=>{try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}})(),r.ys=null,r.ws=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r.ws(t):new r.Array(t):r.Buffer?r.ys(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){t=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(t.lo,t.hi,e):t.toNumber(Boolean(e))},r.merge=n,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=t,r.ProtocolError=t("ProtocolError"),r.oneOfGetter=function(t){for(var i={},e=0;e<t.length;++e)i[t[e]]=1;return function(){for(var t=Object.keys(this),e=t.length-1;-1<e;--e)if(1===i[t[e]]&&null!=this[t[e]])return t[e]}},r.oneOfSetter=function(i){return function(t){for(var e=0;e<i.length;++e)i[e]!==t&&delete this[i[e]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r.xs=function(){var i=r.Buffer;i?(r.ys=i.from!==Uint8Array.from&&i.from||function(t,e){return new i(t,e)},r.ws=i.allocUnsafe||function(t){return new i(t)}):r.ys=r.ws=null}),Vc;function n(t,e,i){for(var r=Object.keys(e),n=0;n<r.length;++n)void 0!==t[r[n]]&&i||(t[r[n]]=e[r[n]]);return t}function t(t){function i(t,e){if(!(this instanceof i))return new i(t,e);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),e&&n(this,e)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return t}}),i.prototype.toString=function(){return this.name+": "+this.message},i}}var _f=n,bf=gf(),yf,wf=bf.LongBits,xf=bf.base64,Mf=bf.utf8;function Ef(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function Lf(){}function Tf(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function n(){this.len=0,this.head=new Ef(Lf,0,0),this.tail=this.head,this.states=null}var Sf=function(){return bf.Buffer?function(){return(n.create=function(){return new yf})()}:function(){return new n}};function Af(t,e,i){e[i]=255&t}function Of(t,e,i){for(;127<t;)e[i++]=127&t|128,t>>>=7;e[i]=t}function Cf(t,e){this.len=t,this.next=void 0,this.val=e}function Rf(t,e,i){for(;t.hi;)e[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)e[i++]=127&t.lo|128,t.lo=t.lo>>>7;e[i++]=t.lo}function Nf(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}n.create=Sf(),n.alloc=function(t){return new bf.Array(t)},bf.Array!==Array&&(n.alloc=bf.pool(n.alloc,bf.Array.prototype.subarray)),n.prototype.Ms=function(t,e,i){return this.tail=this.tail.next=new Ef(t,e,i),this.len+=e,this},Cf.prototype=Object.create(Ef.prototype),Cf.prototype.fn=Of,n.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Cf((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},n.prototype.int32=function(t){return t<0?this.Ms(Rf,10,wf.fromNumber(t)):this.uint32(t)},n.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},n.prototype.uint64=function(t){t=wf.from(t);return this.Ms(Rf,t.length(),t)},n.prototype.int64=n.prototype.uint64,n.prototype.sint64=function(t){t=wf.from(t).zzEncode();return this.Ms(Rf,t.length(),t)},n.prototype.bool=function(t){return this.Ms(Af,1,t?1:0)},n.prototype.fixed32=function(t){return this.Ms(Nf,4,t>>>0)},n.prototype.sfixed32=n.prototype.fixed32,n.prototype.fixed64=function(t){t=wf.from(t);return this.Ms(Nf,4,t.lo).Ms(Nf,4,t.hi)},n.prototype.sfixed64=n.prototype.fixed64,n.prototype.float=function(t){return this.Ms(bf.float.writeFloatLE,4,t)},n.prototype.double=function(t){return this.Ms(bf.float.writeDoubleLE,8,t)};var Df=bf.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var r=0;r<t.length;++r)e[i+r]=t[r]},kf=(n.prototype.bytes=function(t){var e,i=t.length>>>0;return i?(bf.isString(t)&&(e=n.alloc(i=xf.length(t)),xf.decode(t,e,0),t=e),this.uint32(i).Ms(Df,i,t)):this.Ms(Af,1,0)},n.prototype.string=function(t){var e=Mf.length(t);return e?this.uint32(e).Ms(Mf.write,e,t):this.Ms(Af,1,0)},n.prototype.fork=function(){return this.states=new Tf(this),this.head=this.tail=new Ef(Lf,0,0),this.len=0,this},n.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ef(Lf,0,0),this.len=0),this},n.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this},n.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e},n.xs=function(t){yf=t,n.create=Sf(),yf.xs()},Ff),Pf=_f,If=((Ff.prototype=Object.create(Pf.prototype)).constructor=Ff,gf());function Ff(){Pf.call(this)}function jf(t,e,i){t.length<40?If.utf8.write(t,e,i):e.utf8Write?e.utf8Write(t,i):e.write(t,i)}Ff.xs=function(){Ff.alloc=If.ws,Ff.writeBytesBuffer=If.Buffer&&If.Buffer.prototype instanceof Uint8Array&&"set"===If.Buffer.prototype.set.name?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var r=0;r<t.length;)e[i++]=t[r++]}},Ff.prototype.bytes=function(t){var e=(t=If.isString(t)?If.ys(t,"base64"):t).length>>>0;return this.uint32(e),e&&this.Ms(Ff.writeBytesBuffer,e,t),this},Ff.prototype.string=function(t){var e=If.Buffer.byteLength(t);return this.uint32(e),e&&this.Ms(jf,e,t),this},Ff.xs();var Gf=Wf,Uf=gf(),Hf,Bf=Uf.LongBits,zf=Uf.utf8;function Vf(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Wf(t){this.buf=t,this.pos=0,this.len=t.length}var Yf="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Wf(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Wf(t);throw Error("illegal buffer")},Xf=function(){return Uf.Buffer?function(t){return(Wf.create=function(t){return Uf.Buffer.isBuffer(t)?new Hf(t):Yf(t)})(t)}:Yf};function Zf(){var t=new Bf(0,0),e=0;if(!(4<this.len-this.pos)){for(;e<3;++e){if(this.pos>=this.len)throw Vf(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,4<this.len-this.pos){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Vf(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function qf(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function Jf(){if(this.pos+8>this.len)throw Vf(this,8);return new Bf(qf(this.buf,this.pos+=4),qf(this.buf,this.pos+=4))}Wf.create=Xf(),Wf.prototype.Es=Uf.Array.prototype.subarray||Uf.Array.prototype.slice,Wf.prototype.uint32=(()=>{var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)||!((this.pos+=5)>this.len))return t;throw this.pos=this.len,Vf(this,10)}})(),Wf.prototype.int32=function(){return 0|this.uint32()},Wf.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},Wf.prototype.bool=function(){return 0!==this.uint32()},Wf.prototype.fixed32=function(){if(this.pos+4>this.len)throw Vf(this,4);return qf(this.buf,this.pos+=4)},Wf.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Vf(this,4);return 0|qf(this.buf,this.pos+=4)},Wf.prototype.float=function(){if(this.pos+4>this.len)throw Vf(this,4);var t=Uf.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Wf.prototype.double=function(){if(this.pos+8>this.len)throw Vf(this,4);var t=Uf.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Wf.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw Vf(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,i):e===i?new this.buf.constructor(0):this.Es.call(this.buf,e,i)},Wf.prototype.string=function(){var t=this.bytes();return zf.read(t,0,t.length)},Wf.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw Vf(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw Vf(this)}while(128&this.buf[this.pos++]);return this},Wf.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Wf.xs=function(t){Hf=t,Wf.create=Xf(),Hf.xs();var e=Uf.Long?"toLong":"toNumber";Uf.merge(Wf.prototype,{int64:function(){return Zf.call(this)[e](!1)},uint64:function(){return Zf.call(this)[e](!0)},sint64:function(){return Zf.call(this).zzDecode()[e](!1)},fixed64:function(){return Jf.call(this)[e](!0)},sfixed64:function(){return Jf.call(this)[e](!1)}})};var Kf=td,Qf=Gf,$f=((td.prototype=Object.create(Qf.prototype)).constructor=td,gf());function td(t){Qf.call(this,t)}td.xs=function(){$f.Buffer&&(td.prototype.Es=$f.Buffer.prototype.slice)},td.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},td.xs();var ed={},id=nd,rd=gf();function nd(t,e,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");rd.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(i)}(nd.prototype=Object.create(rd.EventEmitter.prototype)).constructor=nd,nd.prototype.rpcCall=function t(i,e,r,n,s){if(!n)throw TypeError("request must be specified");var o=this;if(!s)return rd.asPromise(t,o,i,e,r,n);if(o.rpcImpl)try{return o.rpcImpl(i,e[o.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(t,e){if(t)return o.emit("error",t,i),s(t);if(null!==e){if(!(e instanceof r))try{e=r[o.responseDelimited?"decodeDelimited":"decode"](e)}catch(t){return o.emit("error",t,i),s(t)}return o.emit("data",e,i),s(null,e)}o.end(!0)})}catch(t){o.emit("error",t,i),setTimeout(function(){s(t)},0)}else setTimeout(function(){s(Error("already ended"))},0)},nd.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},ed.Service=id;var sd={},od=((()=>{var t=zc;function e(){t.util.xs(),t.Writer.xs(t.BufferWriter),t.Reader.xs(t.BufferReader)}t.build="minimal",t.Writer=_f,t.BufferWriter=kf,t.Reader=Gf,t.BufferReader=Kf,t.util=gf(),t.rpc=ed,t.roots=sd,t.configure=e,e()})(),{exports:{}}),ad=hd;function hd(e,i){"string"==typeof e&&(i=e,e=void 0);var h=[];function l(t){if("string"!=typeof t){var e=u();if(hd.verbose,e="return "+e,t){for(var i=Object.keys(t),r=new Array(i.length+1),n=new Array(i.length),s=0;s<i.length;)r[s]=i[s],n[s]=t[i[s++]];return r[s]=e,Function.apply(null,r).apply(null,n)}return Function(e)()}for(var o=new Array(arguments.length-1),a=0;a<o.length;)o[a]=arguments[++a];if(a=0,t=t.replace(/%([%dfijs])/g,function(t,e){var i=o[a++];switch(e){case"d":case"f":return String(Number(i));case"i":return String(Math.floor(i));case"j":return JSON.stringify(i);case"s":return String(i)}return"%"}),a!==o.length)throw Error("parameter count mismatch");return h.push(t),l}function u(t){return"function "+(t||i||"")+"("+(e&&e.join(",")||"")+"){\n  "+h.join("\n  ")+"\n}"}return l.toString=u,l}hd.verbose=!1;var ld=dd,ud=Xc(),cd=of(),fd=cd("fs");function dd(i,r,n){return r="function"==typeof r?(n=r,{}):r||{},n?!r.xhr&&fd&&fd.readFile?fd.readFile(i,function(t,e){return t&&"undefined"!=typeof XMLHttpRequest?dd.xhr(i,r,n):t?n(t):n(null,r.binary?e:e.toString("utf8"))}):dd.xhr(i,r,n):ud(dd,this,i,r)}dd.xhr=function(t,i,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(i.binary){if(!(t=n.response))for(var t=[],e=0;e<n.responseText.length;++e)t.push(255&n.responseText.charCodeAt(e));return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(t):t)}return r(null,n.responseText)}},i.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",t),n.send()};var vd={},pd=((()=>{var t=vd,n=t.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},r=t.normalize=function(t){var e=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),i=n(t),t="";i&&(t=e.shift()+"/");for(var r=0;r<e.length;)".."===e[r]?0<r&&".."!==e[r-1]?e.splice(--r,2):i?e.splice(r,1):++r:"."===e[r]?e.splice(r,1):++r;return t+e.join("/")};t.resolve=function(t,e,i){return i||(e=r(e)),!n(e)&&(t=(t=i?t:r(t)).replace(/(?:\/|^)[^/]+$/,"")).length?r(t+"/"+e):e}})(),{}),md,gd,_d,bd,yd,wd,xd,Md,Ed,Ld,Td,Sd,Ad;function Od(){var t,e,n;return md||(md=1,t=pd,e=h0(),n=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"],t.basic=i([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),t.defaults=i([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),t.long=i([0,0,0,1,1],7),t.mapKey=i([0,0,0,5,5,0,0,0,1,1,0,2],2),t.packed=i([1,5,0,0,0,5,5,0,0,0,1,1,0])),pd;function i(t,e){var i=0,r={};for(e|=0;i<t.length;)r[n[i+e]]=t[i++];return r}}function Cd(){var a,e,h,l,i,u;return _d||(_d=1,gd=o,a=l0(),((o.prototype=Object.create(a.prototype)).constructor=o).className="Field",e=u0(),h=Od(),l=h0(),u=/^required|optional|repeated$/,o.fromJSON=function(t,e){return new o(t,e.id,e.type,e.rule,e.extend,e.options,e.comment)},Object.defineProperty(o.prototype,"packed",{get:function(){return null===this.Ls&&(this.Ls=!1!==this.getOption("packed")),this.Ls}}),o.prototype.setOption=function(t,e,i){return"packed"===t&&(this.Ls=null),a.prototype.setOption.call(this,t,e,i)},o.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return l.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){var t;return this.resolved?this:(void 0===(this.typeDefault=h.defaults[this.type])&&(this.resolvedType=(this.declaringField||this).parent.lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof e)&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault]),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof e)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long?(this.typeDefault=l.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault)):this.bytes&&"string"==typeof this.typeDefault&&(l.base64.test(this.typeDefault)?l.base64.decode(this.typeDefault,t=l.newBuffer(l.base64.length(this.typeDefault)),0):l.utf8.write(this.typeDefault,t=l.newBuffer(l.utf8.length(this.typeDefault)),0),this.typeDefault=t),this.map?this.defaultValue=l.emptyObject:this.repeated?this.defaultValue=l.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),a.prototype.resolve.call(this))},o.d=function(i,r,n,s){return"function"==typeof r?r=l.decorateType(r).name:r&&"object"==typeof r&&(r=l.decorateEnum(r).name),function(t,e){l.decorateType(t.constructor).add(new o(e,i,r,n,{default:s}))}},o.xs=function(t){i=t}),gd;function o(t,e,i,r,n,s,o){if(l.isObject(r)?(o=n,s=r,r=n=void 0):l.isObject(n)&&(o=s,s=n,n=void 0),a.call(this,t,s),!l.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!l.isString(i))throw TypeError("type must be a string");if(void 0!==r&&!u.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==n&&!l.isString(n))throw TypeError("extend must be a string");this.rule=(r="proto3_optional"===r?"optional":r)&&"optional"!==r?r:void 0,this.type=i,this.id=e,this.extend=n||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!l.Long&&void 0!==h.long[i],this.bytes="bytes"===i,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.Ls=null,this.comment=o}}function Rd(){var n,i,r;return yd||(yd=1,bd=s,n=l0(),((s.prototype=Object.create(n.prototype)).constructor=s).className="OneOf",i=Cd(),r=h0(),s.fromJSON=function(t,e){return new s(t,e.oneof,e.options,e.comment)},s.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return r.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(t){if(t instanceof i)return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),o(t.partOf=this),this;throw TypeError("field must be a Field")},s.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");var e=this.fieldsArray.indexOf(t);if(e<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(e,1),-1<(e=this.oneof.indexOf(t.name))&&this.oneof.splice(e,1),t.partOf=null,this},s.prototype.onAdd=function(t){n.prototype.onAdd.call(this,t);for(var e=0;e<this.oneof.length;++e){var i=t.get(this.oneof[e]);i&&!i.partOf&&(i.partOf=this).fieldsArray.push(i)}o(this)},s.prototype.onRemove=function(t){for(var e,i=0;i<this.fieldsArray.length;++i)(e=this.fieldsArray[i]).parent&&e.parent.remove(e);n.prototype.onRemove.call(this,t)},s.d=function(){for(var i=new Array(arguments.length),t=0;t<arguments.length;)i[t]=arguments[t++];return function(t,e){r.decorateType(t.constructor).add(new s(e,i)),Object.defineProperty(t,e,{get:r.oneOfGetter(i),set:r.oneOfSetter(i)})}}),bd;function s(t,e,i,r){if(Array.isArray(e)||(i=e,e=void 0),n.call(this,t,i),void 0!==e&&!Array.isArray(e))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}function o(t){if(t.parent)for(var e=0;e<t.fieldsArray.length;++e)t.fieldsArray[e].parent||t.parent.add(t.fieldsArray[e])}}function Nd(){var i,n,s,o,a,h,l;return xd||(xd=1,wd=u,i=l0(),((u.prototype=Object.create(i.prototype)).constructor=u).className="Namespace",n=Cd(),s=Rd(),o=h0(),u.fromJSON=function(t,e){return new u(t,e.options).addJSON(e.nested)},u.arrayToJSON=e,u.isReservedId=function(t,e){if(t)for(var i=0;i<t.length;++i)if("string"!=typeof t[i]&&t[i][0]<=e&&t[i][1]>e)return!0;return!1},u.isReservedName=function(t,e){if(t)for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1},Object.defineProperty(u.prototype,"nestedArray",{get:function(){return this.Ts||(this.Ts=o.toArray(this.nested))}}),u.prototype.toJSON=function(t){return o.toObject(["options",this.options,"nested",e(this.nestedArray,t)])},u.prototype.addJSON=function(t){if(t)for(var e,i=Object.keys(t),r=0;r<i.length;++r)e=t[i[r]],this.add((void 0!==e.fields?a:void 0!==e.values?l:void 0!==e.methods?h:void 0!==e.id?n:u).fromJSON(i[r],e));return this},u.prototype.get=function(t){return this.nested&&this.nested[t]||null},u.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof l)return this.nested[t].values;throw Error("no such enum: "+t)},u.prototype.add=function(t){if(!(t instanceof n&&void 0!==t.extend||t instanceof a||t instanceof l||t instanceof h||t instanceof u||t instanceof s))throw TypeError("object must be a valid nested object");if(this.nested){var e=this.get(t.name);if(e){if(!(e instanceof u&&t instanceof u)||e instanceof a||e instanceof h)throw Error("duplicate name '"+t.name+"' in "+this);for(var i=e.nestedArray,r=0;r<i.length;++r)t.add(i[r]);this.remove(e),this.nested||(this.nested={}),t.setOptions(e.options,!0)}}else this.nested={};return(this.nested[t.name]=t).onAdd(this),c(this)},u.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0),t.onRemove(this),c(this)},u.prototype.define=function(t,e){if(o.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var i=this;0<t.length;){var r=t.shift();if(i.nested&&i.nested[r]){if(!((i=i.nested[r])instanceof u))throw Error("path conflicts with non-namespace objects")}else i.add(i=new u(r))}return e&&i.addJSON(e),i},u.prototype.resolveAll=function(){for(var t=this.nestedArray,e=0;e<t.length;)t[e]instanceof u?t[e++].resolveAll():t[e++].resolve();return this.resolve()},u.prototype.lookup=function(t,e,i){if("boolean"==typeof e?(i=e,e=void 0):e&&!Array.isArray(e)&&(e=[e]),o.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),e);var r=this.get(t[0]);if(r){if(1===t.length){if(!e||-1<e.indexOf(r.constructor))return r}else if(r instanceof u&&(r=r.lookup(t.slice(1),e,!0)))return r}else for(var n=0;n<this.nestedArray.length;++n)if(this.Ts[n]instanceof u&&(r=this.Ts[n].lookup(t,e,!0)))return r;return null===this.parent||i?null:this.parent.lookup(t,e)},u.prototype.lookupType=function(t){var e=this.lookup(t,[a]);if(e)return e;throw Error("no such type: "+t)},u.prototype.lookupEnum=function(t){var e=this.lookup(t,[l]);if(e)return e;throw Error("no such Enum '"+t+"' in "+this)},u.prototype.lookupTypeOrEnum=function(t){var e=this.lookup(t,[a,l]);if(e)return e;throw Error("no such Type or Enum '"+t+"' in "+this)},u.prototype.lookupService=function(t){var e=this.lookup(t,[h]);if(e)return e;throw Error("no such Service '"+t+"' in "+this)},u.xs=function(t,e,i){a=t,h=e,l=i}),wd;function e(t,e){if(t&&t.length){for(var i={},r=0;r<t.length;++r)i[t[r].name]=t[r].toJSON(e);return i}}function u(t,e){i.call(this,t,e),this.nested=void 0,this.Ts=null}function c(t){return t.Ts=null,t}}function Dd(){var o,t,a;return Ed||(Ed=1,Md=s,o=Cd(),((s.prototype=Object.create(o.prototype)).constructor=s).className="MapField",t=Od(),a=h0(),s.fromJSON=function(t,e){return new s(t,e.id,e.keyType,e.type,e.options,e.comment)},s.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return a.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===t.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return o.prototype.resolve.call(this)},s.d=function(i,r,n){return"function"==typeof n?n=a.decorateType(n).name:n&&"object"==typeof n&&(n=a.decorateEnum(n).name),function(t,e){a.decorateType(t.constructor).add(new s(e,i,r,n))}}),Md;function s(t,e,i,r,n,s){if(o.call(this,t,e,r,void 0,void 0,n,s),!a.isString(i))throw TypeError("keyType must be a string");this.keyType=i,this.resolvedKeyType=null,this.map=!0}}function kd(){var l,u;return Td||(Td=1,Ld=i,l=l0(),((i.prototype=Object.create(l.prototype)).constructor=i).className="Method",u=h0(),i.fromJSON=function(t,e){return new i(t,e.type,e.requestType,e.responseType,e.requestStream,e.responseStream,e.options,e.comment,e.parsedOptions)},i.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return u.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},i.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),l.prototype.resolve.call(this))}),Ld;function i(t,e,i,r,n,s,o,a,h){if(u.isObject(n)?(o=n,n=s=void 0):u.isObject(s)&&(o=s,s=void 0),void 0!==e&&!u.isString(e))throw TypeError("type must be a string");if(!u.isString(i))throw TypeError("requestType must be a string");if(!u.isString(r))throw TypeError("responseType must be a string");l.call(this,t,o),this.type=e||"rpc",this.requestType=i,this.requestStream=!!n||void 0,this.responseType=r,this.responseStream=!!s||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=h}}function Pd(){var r,s,a,h;return Ad||(Ad=1,Sd=o,r=Nd(),((o.prototype=Object.create(r.prototype)).constructor=o).className="Service",s=kd(),a=h0(),h=ed,o.fromJSON=function(t,e){var i=new o(t,e.options);if(e.methods)for(var r=Object.keys(e.methods),n=0;n<r.length;++n)i.add(s.fromJSON(r[n],e.methods[r[n]]));return e.nested&&i.addJSON(e.nested),i.comment=e.comment,i},o.prototype.toJSON=function(t){var e=r.prototype.toJSON.call(this,t),i=!!t&&Boolean(t.keepComments);return a.toObject(["options",e&&e.options||void 0,"methods",r.arrayToJSON(this.methodsArray,t)||{},"nested",e&&e.nested||void 0,"comment",i?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this.Ss||(this.Ss=a.toArray(this.methods))}}),o.prototype.get=function(t){return this.methods[t]||r.prototype.get.call(this,t)},o.prototype.resolveAll=function(){for(var t=this.methodsArray,e=0;e<t.length;++e)t[e].resolve();return r.prototype.resolve.call(this)},o.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof s?e((this.methods[t.name]=t).parent=this):r.prototype.add.call(this,t)},o.prototype.remove=function(t){if(t instanceof s){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,e(this)}return r.prototype.remove.call(this,t)},o.prototype.create=function(t,e,i){for(var r,n=new h.Service(t,e,i),s=0;s<this.methodsArray.length;++s){var o=a.lcFirst((r=this.Ss[s]).resolve().name).replace(/[^$\w_]/g,"");n[o]=a.codegen(["r","c"],a.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return n}),Sd;function o(t,e){r.call(this,t,e),this.methods={},this.Ss=null}function e(t){return t.Ss=null,t}}var Id=Bd,Fd=gf(),jd,Gd,Ud,Hd;function Bd(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)this[e[i]]=t[e[i]]}function zd(){var a,h,l;return Gd||(Gd=1,jd=function(t){var e=l.codegen(["r","l"],t.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(t.fieldsArray.filter(function(t){return t.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");t.group&&e("if((t&7)===4)")("break");e("switch(t>>>3){");for(var i=0;i<t.fieldsArray.length;++i){var r=t.As[i].resolve(),n=r.resolvedType instanceof a?"int32":r.type,s="m"+l.safeProp(r.name);e("case %i:",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),void 0!==h.defaults[r.keyType]?e("k=%j",h.defaults[r.keyType]):e("k=null"),void 0!==h.defaults[n]?e("value=%j",h.defaults[n]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),void 0===h.basic[n]?e("value=types[%i].decode(r,r.uint32())",i):e("value=r.%s()",n),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==h.long[r.keyType]?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==h.packed[n]&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,n)("}else"),void 0===h.basic[n]?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,i):e("%s.push(r.%s())",s,n)):void 0===h.basic[n]?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,i):e("%s=r.%s()",s,n),e("break")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),i=0;i<t.As.length;++i){var o=t.As[i];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})","missing required '"+o.name+"'")}return e("return m")},a=u0(),h=Od(),l=h0()),jd}function Vd(){var o,h;return Hd||(Hd=1,Ud=function(t){var e=h.codegen(["m"],t.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),i=t.oneofsArray,r={};i.length&&e("var p={}");for(var n=0;n<t.fieldsArray.length;++n){var s,o=t.As[n].resolve(),a="m"+h.safeProp(o.name);o.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,o.name),o.map?(e("if(!util.isObject(%s))",a)("return%j",l(o,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),((t,e,i)=>{switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.key32Re.test(%s))",i)("return%j",l(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.key64Re.test(%s))",i)("return%j",l(e,"integer|Long key"));break;case"bool":t("if(!util.key2Re.test(%s))",i)("return%j",l(e,"boolean key"))}})(e,o,"k[i]"),u(e,o,n,a+"[k[i]]")("}")):o.repeated?(e("if(!Array.isArray(%s))",a)("return%j",l(o,"array"))("for(var i=0;i<%s.length;++i){",a),u(e,o,n,a+"[i]")("}")):(o.partOf&&(s=h.safeProp(o.partOf.name),1===r[o.partOf.name]&&e("if(p%s===1)",s)("return%j",o.partOf.name+": multiple values"),r[o.partOf.name]=1,e("p%s=1",s)),u(e,o,n,a)),o.optional&&e("}")}return e("return null")},o=u0(),h=h0()),Ud;function l(t,e){return t.name+": "+e+(t.repeated&&"array"!==e?"[]":t.map&&"object"!==e?"{k:"+t.keyType+"}":"")+" expected"}function u(t,e,i,r){if(e.resolvedType)if(e.resolvedType instanceof o){t("switch(%s){",r)("default:")("return%j",l(e,"enum value"));for(var n=Object.keys(e.resolvedType.values),s=0;s<n.length;++s)t("case %i:",e.resolvedType.values[n[s]]);t("break")("}")}else t("{")("var e=types[%i].verify(%s);",i,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.isInteger(%s))",r)("return%j",l(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",l(e,"integer|Long"));break;case"float":case"double":t('if(typeof %s!=="number")',r)("return%j",l(e,"number"));break;case"bool":t('if(typeof %s!=="boolean")',r)("return%j",l(e,"boolean"));break;case"string":t("if(!util.isString(%s))",r)("return%j",l(e,"string"));break;case"bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",l(e,"buffer"))}return t}}Bd.create=function(t){return this.$type.create(t)},Bd.encode=function(t,e){return this.$type.encode(t,e)},Bd.encodeDelimited=function(t,e){return this.$type.encodeDelimited(t,e)},Bd.decode=function(t){return this.$type.decode(t)},Bd.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},Bd.verify=function(t){return this.$type.verify(t)},Bd.fromObject=function(t){return this.$type.fromObject(t)},Bd.toObject=function(t,e){return this.$type.toObject(t,e)},Bd.prototype.toJSON=function(){return this.$type.toObject(this,Fd.toJSONOptions)};var Wd={},Yd;function Xd(){var t,f,d;return Yd||(Yd=1,t=Wd,f=u0(),d=h0(),t.fromObject=function(t){var e=t.fieldsArray,i=d.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!e.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<e.length;++r){var n=e[r].resolve(),s=d.safeProp(n.name);n.map?(i("if(d%s){",s)('if(typeof d%s!=="object")',s)("throw TypeError(%j)",n.fullName+": object expected")("m%s={}",s)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",s),o(i,n,r,s+"[ks[i]]")("}")("}")):n.repeated?(i("if(d%s){",s)("if(!Array.isArray(d%s))",s)("throw TypeError(%j)",n.fullName+": array expected")("m%s=[]",s)("for(var i=0;i<d%s.length;++i){",s),o(i,n,r,s+"[i]")("}")("}")):(n.resolvedType instanceof f||i("if(d%s!=null){",s),o(i,n,r,s),n.resolvedType instanceof f||i("}"))}return i("return m")},t.toObject=function(t){var e=t.fieldsArray.slice().sort(d.compareFieldsById);if(!e.length)return d.codegen()("return {}");for(var i=d.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],n=[],s=[],o=0;o<e.length;++o)e[o].partOf||(e[o].resolve().repeated?r:e[o].map?n:s).push(e[o]);if(r.length){for(i("if(o.arrays||o.defaults){"),o=0;o<r.length;++o)i("d%s=[]",d.safeProp(r[o].name));i("}")}if(n.length){for(i("if(o.objects||o.defaults){"),o=0;o<n.length;++o)i("d%s={}",d.safeProp(n[o].name));i("}")}if(s.length){for(i("if(o.defaults){"),o=0;o<s.length;++o){var a,h=s[o],l=d.safeProp(h.name);h.resolvedType instanceof f?i("d%s=o.enums===String?%j:%j",l,h.resolvedType.valuesById[h.typeDefault],h.typeDefault):h.long?i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",h.typeDefault.low,h.typeDefault.high,h.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,h.typeDefault.toString(),h.typeDefault.toNumber()):h.bytes?(a="["+Array.prototype.slice.call(h.typeDefault).join(",")+"]",i("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,h.typeDefault))("else{")("d%s=%s",l,a)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")):i("d%s=%j",l,h.typeDefault)}i("}")}for(var u=!1,o=0;o<e.length;++o){var h=e[o],c=t.As.indexOf(h),l=d.safeProp(h.name);h.map?(u||(u=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),v(i,h,c,l+"[ks2[j]]")("}")):h.repeated?(i("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),v(i,h,c,l+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",l,h.name),v(i,h,c,l),h.partOf&&i("if(o.oneofs)")("d%s=%j",d.safeProp(h.partOf.name),h.name)),i("}")}return i("return d")}),Wd;function o(t,e,i,r){if(e.resolvedType)if(e.resolvedType instanceof f){t("switch(d%s){",r);for(var n=e.resolvedType.values,s=Object.keys(n),o=0;o<s.length;++o)e.repeated&&n[s[o]]===e.typeDefault&&t("default:"),t("case%j:",s[o])("case %i:",n[s[o]])("m%s=%j",r,n[s[o]])("break");t("}")}else t('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,i,r);else{var a=!1;switch(e.type){case"double":case"float":t("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":t("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":t("m%s=d%s|0",r,r);break;case"uint64":a=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,a)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,a?"true":"");break;case"bytes":t('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":t("m%s=String(d%s)",r,r);break;case"bool":t("m%s=Boolean(d%s)",r,r)}}return t}function v(t,e,i,r){if(e.resolvedType)e.resolvedType instanceof f?t("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,i,r,r):t("d%s=types[%i].toObject(m%s,o)",r,i,r);else{var n=!1;switch(e.type){case"double":case"float":t("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,n?"true":"",r);break;case"bytes":t("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:t("d%s=m%s",r,r)}}return t}}var Zd={},qd,Jd,Kd,Qd,$d,t0,e0,i0,r0,n0,s0;function o0(){var o,a,h,l,u,c,n,s,f,d,v,p,m,g,_;return Jd||(Jd=1,qd=b,o=Nd(),((b.prototype=Object.create(o.prototype)).constructor=b).className="Type",a=u0(),h=Rd(),l=Cd(),u=Dd(),c=Pd(),n=Id,s=Gf,f=_f,d=h0(),v=c0(),p=zd(),m=Vd(),g=Xd(),_=Zd,Object.defineProperties(b.prototype,{fieldsById:{get:function(){if(!this.Os){this.Os={};for(var t=Object.keys(this.fields),e=0;e<t.length;++e){var i=this.fields[t[e]],r=i.id;if(this.Os[r])throw Error("duplicate id "+r+" in "+this);this.Os[r]=i}}return this.Os}},fieldsArray:{get:function(){return this.As||(this.As=d.toArray(this.fields))}},oneofsArray:{get:function(){return this.Cs||(this.Cs=d.toArray(this.oneofs))}},ctor:{get:function(){return this.Rs||(this.ctor=b.generateConstructor(this)())},set:function(t){for(var e=t.prototype,i=(e instanceof n||((t.prototype=new n).constructor=t,d.merge(t.prototype,e)),t.$type=t.prototype.$type=this,d.merge(t,n,!0),this.Rs=t,0);i<this.fieldsArray.length;++i)this.As[i].resolve();for(var r={},i=0;i<this.oneofsArray.length;++i)r[this.Cs[i].resolve().name]={get:d.oneOfGetter(this.Cs[i].oneof),set:d.oneOfSetter(this.Cs[i].oneof)};i&&Object.defineProperties(t.prototype,r)}}}),b.generateConstructor=function(t){for(var e,i=d.codegen(["p"],t.name),r=0;r<t.fieldsArray.length;++r)(e=t.As[r]).map?i("this%s={}",d.safeProp(e.name)):e.repeated&&i("this%s=[]",d.safeProp(e.name));return i("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},b.fromJSON=function(t,e){for(var i=new b(t,e.options),r=(i.extensions=e.extensions,i.reserved=e.reserved,Object.keys(e.fields)),n=0;n<r.length;++n)i.add((void 0!==e.fields[r[n]].keyType?u:l).fromJSON(r[n],e.fields[r[n]]));if(e.oneofs)for(r=Object.keys(e.oneofs),n=0;n<r.length;++n)i.add(h.fromJSON(r[n],e.oneofs[r[n]]));if(e.nested)for(r=Object.keys(e.nested),n=0;n<r.length;++n){var s=e.nested[r[n]];i.add((void 0!==s.id?l:void 0!==s.fields?b:void 0!==s.values?a:void 0!==s.methods?c:o).fromJSON(r[n],s))}return e.extensions&&e.extensions.length&&(i.extensions=e.extensions),e.reserved&&e.reserved.length&&(i.reserved=e.reserved),e.group&&(i.group=!0),e.comment&&(i.comment=e.comment),i},b.prototype.toJSON=function(t){var e=o.prototype.toJSON.call(this,t),i=!!t&&Boolean(t.keepComments);return d.toObject(["options",e&&e.options||void 0,"oneofs",o.arrayToJSON(this.oneofsArray,t),"fields",o.arrayToJSON(this.fieldsArray.filter(function(t){return!t.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",e&&e.nested||void 0,"comment",i?this.comment:void 0])},b.prototype.resolveAll=function(){for(var t=this.fieldsArray,e=0;e<t.length;)t[e++].resolve();for(var i=this.oneofsArray,e=0;e<i.length;)i[e++].resolve();return o.prototype.resolveAll.call(this)},b.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},b.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof l&&void 0===t.extend){if((this.Os||this.fieldsById)[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),(this.fields[t.name]=t).message=this,t.onAdd(this),e(this)}return t instanceof h?(this.oneofs||(this.oneofs={}),(this.oneofs[t.name]=t).onAdd(this),e(this)):o.prototype.add.call(this,t)},b.prototype.remove=function(t){if(t instanceof l&&void 0===t.extend){if(this.fields&&this.fields[t.name]===t)return delete this.fields[t.name],t.parent=null,t.onRemove(this),e(this);throw Error(t+" is not a member of "+this)}if(t instanceof h){if(this.oneofs&&this.oneofs[t.name]===t)return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),e(this);throw Error(t+" is not a member of "+this)}return o.prototype.remove.call(this,t)},b.prototype.isReservedId=function(t){return o.isReservedId(this.reserved,t)},b.prototype.isReservedName=function(t){return o.isReservedName(this.reserved,t)},b.prototype.create=function(t){return new this.ctor(t)},b.prototype.setup=function(){for(var t=this.fullName,e=[],i=0;i<this.fieldsArray.length;++i)e.push(this.As[i].resolve().resolvedType);this.encode=v(this)({Writer:f,types:e,util:d}),this.decode=p(this)({Reader:s,types:e,util:d}),this.verify=m(this)({types:e,util:d}),this.fromObject=g.fromObject(this)({types:e,util:d}),this.toObject=g.toObject(this)({types:e,util:d});var r,t=_[t];return t&&((r=Object.create(this)).fromObject=this.fromObject,this.fromObject=t.fromObject.bind(r),r.toObject=this.toObject,this.toObject=t.toObject.bind(r)),this},b.prototype.encode=function(t,e){return this.setup().encode(t,e)},b.prototype.encodeDelimited=function(t,e){return this.encode(t,e&&e.len?e.fork():e).ldelim()},b.prototype.decode=function(t,e){return this.setup().decode(t,e)},b.prototype.decodeDelimited=function(t){return t instanceof s||(t=s.create(t)),this.decode(t,t.uint32())},b.prototype.verify=function(t){return this.setup().verify(t)},b.prototype.fromObject=function(t){return this.setup().fromObject(t)},b.prototype.toObject=function(t,e){return this.setup().toObject(t,e)},b.d=function(e){return function(t){d.decorateType(t,e)}}),qd;function b(t,e){o.call(this,t,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this.Os=null,this.As=null,this.Cs=null,this.Rs=null}function e(t){return t.Os=t.As=t.Cs=null,delete t.encode,delete t.decode,delete t.verify,t}}function a0(){var r,n,s,o,d,a,v,p,h;return Qd||(Qd=1,Kd=i,r=Nd(),((i.prototype=Object.create(r.prototype)).constructor=i).className="Root",n=Cd(),s=u0(),o=Rd(),d=h0(),i.fromJSON=function(t,e){return e=e||new i,t.options&&e.setOptions(t.options),e.addJSON(t.nested)},i.prototype.resolvePath=d.path.resolve,i.prototype.fetch=d.fetch,i.prototype.load=function t(e,s,n){"function"==typeof s&&(n=s,s=void 0);var o=this;if(!n)return d.asPromise(t,o,e,s);var a=n===m;function h(t,e){if(n){var i=n;if(n=null,a)throw t;i(t,e)}}function l(t){var e=t.lastIndexOf("google/protobuf/");if(-1<e){t=t.substring(e);if(t in p)return t}return null}function u(t,e){try{if(d.isString(e)&&"{"===e.charAt(0)&&(e=JSON.parse(e)),d.isString(e)){v.filename=t;var i,r=v(e,o,s),n=0;if(r.imports)for(;n<r.imports.length;++n)(i=l(r.imports[n])||o.resolvePath(t,r.imports[n]))&&c(i);if(r.weakImports)for(n=0;n<r.weakImports.length;++n)(i=l(r.weakImports[n])||o.resolvePath(t,r.weakImports[n]))&&c(i,!0)}else o.setOptions(e.options).addJSON(e.nested)}catch(t){h(t)}a||f||h(null,o)}function c(i,r){if(!(-1<o.files.indexOf(i)))if(o.files.push(i),i in p)a?u(i,p[i]):(++f,setTimeout(function(){--f,u(i,p[i])}));else if(a){var t;try{t=d.fs.readFileSync(i).toString("utf8")}catch(t){return void(r||h(t))}u(i,t)}else++f,o.fetch(i,function(t,e){--f,n&&(t?r?f||h(null,o):h(t):u(i,e))})}var f=0;d.isString(e)&&(e=[e]);for(var i,r=0;r<e.length;++r)(i=o.resolvePath("",e[r]))&&c(i);if(a)return o;f||h(null,o)},i.prototype.loadSync=function(t,e){if(d.isNode)return this.load(t,e,m);throw Error("not supported")},i.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return r.prototype.resolveAll.call(this)},h=/^[A-Z]/,i.prototype.Ns=function(t){if(t instanceof n)void 0===t.extend||t.extensionField||l(0,t)||this.deferred.push(t);else if(t instanceof s)h.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof o)){if(t instanceof a)for(var e=0;e<this.deferred.length;)l(0,this.deferred[e])?this.deferred.splice(e,1):++e;for(var i=0;i<t.nestedArray.length;++i)this.Ns(t.Ts[i]);h.test(t.name)&&(t.parent[t.name]=t)}},i.prototype.Ds=function(t){var e;if(t instanceof n)void 0!==t.extend&&(t.extensionField?(t.extensionField.parent.remove(t.extensionField),t.extensionField=null):-1<(e=this.deferred.indexOf(t))&&this.deferred.splice(e,1));else if(t instanceof s)h.test(t.name)&&delete t.parent[t.name];else if(t instanceof r){for(var i=0;i<t.nestedArray.length;++i)this.Ds(t.Ts[i]);h.test(t.name)&&delete t.parent[t.name]}},i.xs=function(t,e,i){a=t,v=e,p=i}),Kd;function i(t){r.call(this,"",t),this.deferred=[],this.files=[]}function m(){}function l(t,e){var i,r=e.parent.lookup(e.extend);if(r)return((i=new n(e.fullName,e.id,e.type,e.rule,void 0,e.options)).declaringField=e).extensionField=i,r.add(i),1}}function h0(){var i,t,r,n,e,s,o,a;return $d||($d=1,i=od.exports=gf(),t=sd,i.codegen=ad,i.fetch=ld,i.path=vd,i.fs=i.inquire("fs"),i.toArray=function(t){if(t){for(var e=Object.keys(t),i=new Array(e.length),r=0;r<e.length;)i[r]=t[e[r++]];return i}return[]},i.toObject=function(t){for(var e={},i=0;i<t.length;){var r=t[i++],n=t[i++];void 0!==n&&(e[r]=n)}return e},e=/\\/g,s=/"/g,i.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},i.safeProp=function(t){return!/^[$\w_]+$/.test(t)||i.isReserved(t)?'["'+t.replace(e,"\\\\").replace(s,'\\"')+'"]':"."+t},i.ucFirst=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},o=/_([a-z])/g,i.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(o,function(t,e){return e.toUpperCase()})},i.compareFieldsById=function(t,e){return t.id-e.id},i.decorateType=function(t,e){return t.$type?(e&&t.$type.name!==e&&(i.decorateRoot.remove(t.$type),t.$type.name=e,i.decorateRoot.add(t.$type)),t.$type):(e=new(r=r||o0())(e||t.name),i.decorateRoot.add(e),e.ctor=t,Object.defineProperty(t,"$type",{value:e,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:e,enumerable:!1}),e)},a=0,i.decorateEnum=function(t){var e;return t.$type||(e=new(n=n||u0())("Enum"+a++,t),i.decorateRoot.add(e),Object.defineProperty(t,"$type",{value:e,enumerable:!1}),e)},i.setProperty=function(t,e,i){if("object"!=typeof t)throw TypeError("dst must be an object");if(e)return function t(e,i,r){var n=i.shift();return"__proto__"!==n&&"prototype"!==n&&(0<i.length?e[n]=t(e[n]||{},i,r):((i=e[n])&&(r=[].concat(i).concat(r)),e[n]=r)),e}(t,e=e.split("."),i);throw TypeError("path must be specified")},Object.defineProperty(i,"decorateRoot",{get:function(){return t.decorated||(t.decorated=new(a0()))}})),od.exports}function l0(){var o,e;return e0||(e0=1,(t0=t).className="ReflectionObject",o=h0(),Object.defineProperties(t.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],e=this.parent;e;)t.unshift(e.name),e=e.parent;return t.join(".")}}}),t.prototype.toJSON=function(){throw Error()},t.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;t=t.root;t instanceof e&&t.Ns(this)},t.prototype.onRemove=function(t){t=t.root;t instanceof e&&t.Ds(this),this.parent=null,this.resolved=!1},t.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},t.prototype.getOption=function(t){if(this.options)return this.options[t]},t.prototype.setOption=function(t,e,i){return i&&this.options&&void 0!==this.options[t]||((this.options||(this.options={}))[t]=e),this},t.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var r,n,s=this.parsedOptions;return i?(r=s.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)}))?(n=r[e],o.setProperty(n,i,t)):((r={})[e]=o.setProperty({},i,t),s.push(r)):((n={})[e]=t,s.push(n)),this},t.prototype.setOptions=function(t,e){if(t)for(var i=Object.keys(t),r=0;r<i.length;++r)this.setOption(i[r],t[i[r]],e);return this},t.prototype.toString=function(){var t=this.constructor.className,e=this.fullName;return e.length?t+" "+e:t},t.xs=function(t){e=t}),t0;function t(t,e){if(!o.isString(t))throw TypeError("name must be a string");if(e&&!o.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}}function u0(){var a,e,r;return r0||(r0=1,i0=i,a=l0(),((i.prototype=Object.create(a.prototype)).constructor=i).className="Enum",e=Nd(),r=h0(),i.fromJSON=function(t,e){t=new i(t,e.values,e.options,e.comment,e.comments);return t.reserved=e.reserved,t},i.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return r.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},i.prototype.add=function(t,e,i){if(!r.isString(t))throw TypeError("name must be a string");if(!r.isInteger(e))throw TypeError("id must be an integer");if(void 0!==this.values[t])throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(e))throw Error("id "+e+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(void 0!==this.valuesById[e]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+e+" in "+this);this.values[t]=e}else this.valuesById[this.values[t]=e]=t;return this.comments[t]=i||null,this},i.prototype.remove=function(t){if(!r.isString(t))throw TypeError("name must be a string");var e=this.values[t];if(null==e)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[e],delete this.values[t],delete this.comments[t],this},i.prototype.isReservedId=function(t){return e.isReservedId(this.reserved,t)},i.prototype.isReservedName=function(t){return e.isReservedName(this.reserved,t)}),i0;function i(t,e,i,r,n){if(a.call(this,t,i),e&&"object"!=typeof e)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=n||{},this.reserved=void 0,e)for(var s=Object.keys(e),o=0;o<s.length;++o)"number"==typeof e[s[o]]&&(this.valuesById[this.values[s[o]]=e[s[o]]]=s[o])}}function c0(){var l,u,c;return s0||(s0=1,n0=function(t){for(var e,i=c.codegen(["m","w"],t.name+"$encode")("if(!w)")("w=Writer.create()"),r=t.fieldsArray.slice().sort(c.compareFieldsById),n=0;n<r.length;++n){var s=r[n].resolve(),o=t.As.indexOf(s),a=s.resolvedType instanceof l?"int32":s.type,h=u.basic[a];e="m"+c.safeProp(s.name),s.map?(i("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",e,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",e)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|u.mapKey[s.keyType],s.keyType),void 0===h?i("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,e):i(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,a,e),i("}")("}")):s.repeated?(i("if(%s!=null&&%s.length){",e,e),s.packed&&void 0!==u.packed[a]?i("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",e)("w.%s(%s[i])",a,e)("w.ldelim()"):(i("for(var i=0;i<%s.length;++i)",e),void 0===h?f(i,s,o,e+"[i]"):i("w.uint32(%i).%s(%s[i])",(s.id<<3|h)>>>0,a,e)),i("}")):(s.optional&&i("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",e,s.name),void 0===h?f(i,s,o,e):i("w.uint32(%i).%s(%s)",(s.id<<3|h)>>>0,a,e))}return i("return w")},l=u0(),u=Od(),c=h0()),n0;function f(t,e,i,r){e.resolvedType.group?t("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",i,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):t("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",i,r,(e.id<<3|2)>>>0)}}(()=>{var o=Id;Zd[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var e,i=t["@type"].substring(t["@type"].lastIndexOf("/")+1),i=this.lookup(i);if(i)return-1===(e="."===t["@type"].charAt(0)?t["@type"].substr(1):t["@type"]).indexOf("/")&&(e="/"+e),this.create({type_url:e,value:i.encode(i.fromObject(t)).finish()})}return this.fromObject(t)},toObject:function(t,e){var i,r,n="",s="";return!((t=e&&e.json&&t.type_url&&t.value&&(s=t.type_url.substring(t.type_url.lastIndexOf("/")+1),n=t.type_url.substring(0,t.type_url.lastIndexOf("/")+1),i=this.lookup(s))?i.decode(t.value):t)instanceof this.ctor)&&t instanceof o?(i=t.$type.toObject(t,e),r="."===t.$type.fullName[0]?t.$type.fullName.substr(1):t.$type.fullName,i["@type"]=s=(n=""===n?"type.googleapis.com/":n)+r,i):this.toObject(t,e)}}})();var s=Bc.exports=zc;function f0(t,e,i){return(e="function"==typeof e?(i=e,new s.Root):e||new s.Root).load(t,i)}function d0(t,e){return(e=e||new s.Root).loadSync(t)}s.build="light",s.load=f0,s.loadSync=d0,s.encoder=c0(),s.decoder=zd(),s.verifier=Vd(),s.converter=Xd(),s.ReflectionObject=l0(),s.Namespace=Nd(),s.Root=a0(),s.Enum=u0(),s.Type=o0(),s.Field=Cd(),s.OneOf=Rd(),s.MapField=Dd(),s.Service=Pd(),s.Method=kd(),s.Message=Id,s.wrappers=Zd,s.types=Od(),s.util=h0(),s.ReflectionObject.xs(s.Root),s.Namespace.xs(s.Type,s.Service,s.Enum),s.Root.xs(s.Type),s.Field.xs(s.Type);var v0=Bc.exports,p0=v0,m0=rs(p0),g0=["TmF2aVNlZ21lbg==","YWNjZXNzaWJsZQ==","Zmlk","bmZv","Rmxvb3JHZW8=","bGlmdFR5cGU=","bGVu","dmVs","ZXh0ZW50TGF5ZQ==","RXh0ZW50Qml6SQ==","cmVhZE9ubHk=","LnByb3RvYnVm","aW50MzI=","ZG9vcnR5cGU=","R0VPUE9JTlRfTQ==","TmF2aVpvbmU=","ZW50cmFuY2VGbA==","bGVuZ3Ro","ZWxCaXpJbmZv","c3RhaXJMYXllcg==","dG9CaWQ=","R2F0ZQ==","b2Zmc2V0WQ==","Zmlkcw==","aXNTZWxlY3RhYg==","ZmxhZw==","ZXh0ZXJuYWxNbw==","bGlmdEVudHJ5","VklTRUdNRU5U","SW5kZXhJbmZv","ZGF0YQ==","ZGVsQml6SW5mbw==","bWlk","cG9pTGF5ZXI=","bW9kZWxpZA==","cGFja2Vk","dGhyb3VnaA==","bmF2aVNlZ21lbg==","bGlmdExheWVy","cmVwZWF0ZWQ=","ZGVmQ2VuWQ==","b29y","bm9kZUlk","TmF2aU1vZGVs","cmFuaw==","c25vZGU=","cHRz","ZGVmR2lk","aGFzaENvZGU=","bmVzdGVk","Ymlk","cmVxdWlyZWQ=","R0VPTElORV9OQQ==","b2Zmc2V0WA==","TmF2aU5vZGU=","bHR5cGU=","T1ZFUkxBWURBVA==","ZGVmQ2VuWA==","b3B0aW9ucw==","YmFzZUxldmVs","YXJlYQ==","TGF5ZXJHcm91cA==","ZmllbGRz","cGFzcw==","Zmxvb3Jz","SUZU","Rmxvb3JOYXZp","amF2YV9vdXRlcg==","UG9seWdvbkxhYg==","ZW50cmFuY2VUeQ==","VHlwZQ==","bmF2aVpvbmVz","ZWxMYXllcg==","YWxpYXM=","d2lkdGg=","YXllcg==","ZW50cnl0eXBlcw==","TGlmdEJpekluZg==","bm9kZXR5cGVz","amF2YV9wYWNrYQ==","bmF2aVR5cGU=","ZGF0ZVZlcg==","bGlmdEZsYWc=","Z2lk","bWF4WA==","bW5hbWU=","bWluU2NhbGVMZQ==","Zmxvb3JJZA==","X2NsYXNzbmFtZQ==","TW9kZWxCaXpJbg==","Zmxvb3I=","bmFtZQ==","c2NhbGVMZXZlbA==","RXh0ZXJuYWxNbw==","cGdpZA==","ZmlsZVZlcg==","VEFJUg==","bWlubGV2ZWw=","Rmxvb3JDb25maQ==","R2VuZXJhbEdlbw==","ZHJpdmU=","Ym9vbA==","a2V5","R0VPUE9MWUdPTg==","dG9HaWQ=","ZGVmQ2VuWg==","YnR5cGU=","R0VPUE9JTlRfUw==","cC5wbGF0Zm9ybQ==","TmF2aUZsb29y","ZmxvYXQ=","bmF2aUV4dGVudA==","UE9JQml6SW5mbw==","TGFiZWxCaXpJbg==","TGF5ZXI=","cnVsZQ==","bGlk","Y29tLmZlbmdtYQ==","c2NhbGU=","c2VnbWVudElk","ZGVzYw==","ZGVsTGF5ZXI=","R0VPUE9JTlRfUA==","cm90YXRlQW5nbA==","X0xBQkVM","cG9seWdvbkxheQ==","ZmlsZURhdGU=","R0VPUE9JTlRfTA==","U3RhaXJCaXpJbg==","ZXNjYWxhdG9yTA==","bGlua1NlZw==","QnVmZmVy","TmF2aUV4dGVudA==","Z2Vv","R0VPTElORQ==","bmF2aU5vZGVz","cmVqZWN0cw==","UG9seWdvbkJpeg==","aXNWaXNpYmxl","b25zaGlw","YnVmZmVycw==","bWF4bGV2ZWw=","ZG91Ymxl","R0VPUE9JTlRfRQ==","bmF2aQ==","Rmxvb3JCaXo=","Z1Byb3RvQnVm","T0RFTA==","ZW5hbWU=","bW9kZWxMYXllcg==","a2V5cw==","ZWlk","bGF5ZXJz","QU5PUkFNQQ==","UkRFUg==","R0VPUE9JTlQ=","QnVpbGRpbmc=","bWluWA==","TWFw","aGVpZ2h0","c3RyaW5n","dHlwZQ==","ZGVmYXVsdA==","cG9seWdvbkxhYg==","TmF2aVJlbGF0aQ==","dWludDY0","aWR4cw==","SW5mbw==","X0VYVEVOVA=="];(t=>{for(var e=218;--e;)t.push(t.shift())})(g0);class _0{constructor(){this.id={nested:{protobuf:{options:{java_package:"com.fengmap.platform.protobuf",java_outer_classname:"FloorConfigProtoBuf"},nested:{Map:{fields:{mid:{rule:"required",type:"string",id:1},fileVer:{rule:"required",type:"int32",id:2},dateVer:{rule:"required",type:"uint64",id:3},mname:{rule:"required",type:"string",id:4},hashCode:{rule:"required",type:"string",id:5},key:{type:"string",id:6},fileDate:{type:"string",id:7},desc:{type:"string",id:8},readOnly:{type:"bool",id:9,options:{default:!1}},buffers:{rule:"repeated",type:"Buffer",id:10},keys:{rule:"repeated",type:"string",id:11}},nested:{Buffer:{fields:{gid:{rule:"required",type:"int32",id:1},fileVer:{rule:"required",type:"int32",id:2},btype:{rule:"required",type:"int32",id:3},len:{rule:"required",type:"uint64",id:4},data:{rule:"required",type:"bytes",id:5}}}}},Scene:{fields:{mid:{rule:"required",type:"string",id:19},fileVer:{rule:"required",type:"int32",id:20},dateVer:{rule:"required",type:"uint64",id:21},mname:{rule:"required",type:"string",id:22},hashCode:{rule:"required",type:"string",id:23},key:{type:"string",id:24},desc:{type:"string",id:25},readOnly:{type:"bool",id:26,options:{default:!1}},x:{type:"float",id:1},y:{type:"float",id:2},z:{type:"float",id:3},minX:{type:"float",id:4},minY:{type:"float",id:5},maxX:{type:"float",id:6},maxY:{type:"float",id:7},defGid:{type:"string",id:8},defCenX:{type:"float",id:9},defCenY:{type:"float",id:10},defCenZ:{type:"float",id:11},height:{type:"float",id:12},rotateAngleX:{type:"float",id:13},rotateAngleY:{type:"float",id:14},rotateAngleZ:{type:"float",id:15},scale:{type:"float",id:16},scaleLevel:{type:"string",id:17},naviType:{type:"int32",id:28},layerGroups:{rule:"repeated",type:"LayerGroup",id:18},buildings:{rule:"repeated",type:"Building",id:27}},nested:{Layer:{fields:{lid:{type:"int32",id:1},lname:{type:"string",id:2},alias:{type:"string",id:3},ltype:{type:"Type",id:4},offsetX:{type:"float",id:5},offsetY:{type:"float",id:6},height:{type:"float",id:7},rotateAngleX:{type:"float",id:8},rotateAngleY:{type:"float",id:9},rotateAngleZ:{type:"float",id:10},minScaleLevel:{type:"float",id:11},maxScaleLevel:{type:"float",id:12},isVisible:{type:"bool",id:13},isSelectable:{type:"bool",id:14},isEditable:{type:"bool",id:15},desc:{type:"string",id:16}},nested:{Type:{values:{GEOPOINT:1,GEOPOINT_ESCALATOR:2,GEOPOINT_LIFT:3,GEOPOINT_STAIR:4,GEOPOINT_PANORAMA:5,GEOPOINT_POI:6,GEOPOINT_STORELABEL:7,GEOPOINT_NAVINODE:8,GEOPOINT_MODEL:9,GEOLINE:20,GEOLINE_NAVISEGMENT:21,GEOLINE_BORDER:22,GEOPOLYGON:30,GEOPOLYGON_EXTENT:31,GEOPOLYGON_STORE:32,GEOPOLYGON_LABEL:33,RASTERATA:40,OVERLAYDATA:50}}}},LayerGroup:{fields:{gid:{type:"int32",id:1},gname:{type:"string",id:2},alias:{type:"string",id:3},height:{type:"float",id:4},desc:{type:"string",id:5},layers:{rule:"repeated",type:"Layer",id:6},floorId:{type:"string",id:7},naviType:{type:"int32",id:8}}},Floor:{fields:{gid:{type:"int32",id:1},x:{type:"float",id:2},y:{type:"float",id:3},offsetX:{type:"float",id:4},offsetY:{type:"float",id:5},angle:{type:"float",id:6},scale:{type:"float",id:7},fids:{rule:"repeated",type:"string",id:8},pgid:{type:"int32",id:9},baseLevel:{type:"bool",id:10},minlevel:{type:"int32",id:11},maxlevel:{type:"int32",id:12},floorId:{type:"string",id:13},idxs:{rule:"repeated",type:"IndexInfo",id:14},pts:{rule:"repeated",type:"double",id:15,options:{packed:!1}}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}},Building:{fields:{bid:{type:"string",id:1},name:{type:"string",id:2},ename:{type:"string",id:3},alias:{type:"string",id:4},x:{type:"float",id:5},y:{type:"float",id:6},mid:{type:"string",id:7},version:{type:"int32",id:8},floors:{rule:"repeated",type:"Floor",id:9},bcode:{type:"int32",id:10}}}}},Gate:{fields:{mid:{rule:"required",type:"string",id:1},floors:{rule:"repeated",type:"NaviFloor",id:2}},nested:{NaviFloor:{fields:{gid:{type:"int32",id:1},floorId:{type:"string",id:2},bid:{type:"string",id:3},mid:{type:"string",id:4},navi:{rule:"repeated",type:"NaviRelationship",id:5},drive:{rule:"repeated",type:"NaviRelationship",id:6},accessible:{rule:"repeated",type:"NaviRelationship",id:7}}},NaviRelationship:{fields:{eid:{rule:"required",type:"int32",id:1},type:{type:"int32",id:2},accessible:{type:"int32",id:3},idxs:{rule:"repeated",type:"IndexInfo",id:4},pts:{rule:"repeated",type:"double",id:5,options:{packed:!1}},flag:{type:"int32",id:6},toBid:{rule:"repeated",type:"string",id:7},toGid:{rule:"repeated",type:"string",id:8}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}},FloorGeo:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},height:{type:"float",id:3},extentLayer:{rule:"repeated",type:"GeneralGeoInfo",id:4},modelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:5},labelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:6},poiLayer:{rule:"repeated",type:"GeneralGeoInfo",id:7},polygonLayer:{rule:"repeated",type:"GeneralGeoInfo",id:8},polygonLabelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:9},liftLayer:{rule:"repeated",type:"GeneralGeoInfo",id:10},stairLayer:{rule:"repeated",type:"GeneralGeoInfo",id:11},escalatorLayer:{rule:"repeated",type:"GeneralGeoInfo",id:12},externalModelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:13}},nested:{GeneralGeoInfo:{fields:{eid:{rule:"required",type:"int32",id:1},geo:{type:"string",id:2},height:{type:"float",id:3},area:{type:"float",id:4},idxs:{rule:"repeated",type:"IndexInfo",id:5},pts:{rule:"repeated",type:"double",id:6,options:{packed:!1}},baseheight:{type:"float",id:7}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}},FloorBiz:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},extentLayer:{rule:"repeated",type:"ExtentBizInfo",id:3},modelLayer:{rule:"repeated",type:"ModelBizInfo",id:4},labelLayer:{rule:"repeated",type:"LabelBizInfo",id:5},poiLayer:{rule:"repeated",type:"POIBizInfo",id:6},polygonLayer:{rule:"repeated",type:"PolygonBizInfo",id:7},liftLayer:{rule:"repeated",type:"LiftBizInfo",id:8},stairLayer:{rule:"repeated",type:"StairBizInfo",id:9},polygonLabelLayer:{rule:"repeated",type:"PolygonLabelBizInfo",id:10},externalModelLayer:{rule:"repeated",type:"ExternalModelBizInfo",id:11}},nested:{ExtentBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},ModelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7},pass:{type:"int32",id:8}}},LabelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},PolygonBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},POIBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},LiftBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},flag:{type:"int32",id:4},floor:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},StairBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},flag:{type:"int32",id:4},minlevel:{type:"int32",id:5},maxlevel:{type:"int32",id:6}}},PolygonLabelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},width:{type:"float",id:4},name:{type:"string",id:5},ename:{type:"string",id:6},angle:{type:"float",id:7}}},ExternalModelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}}}},FloorNavi:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},naviNodes:{rule:"repeated",type:"NaviNode",id:3},naviSegments:{rule:"repeated",type:"NaviSegment",id:4},naviZones:{rule:"repeated",type:"NaviZone",id:5},naviModels:{rule:"repeated",type:"NaviModel",id:6},nextFloors:{rule:"repeated",type:"int32",id:7,options:{packed:!1}},naviExtents:{rule:"repeated",type:"NaviExtent",id:8}},nested:{NaviNode:{fields:{nodeId:{type:"int32",id:1},nodeType:{type:"int32",id:2},liftType:{type:"int32",id:3},liftFlag:{type:"int32",id:4},liftEntry:{type:"int32",id:5},liftFloor:{type:"string",id:6},linkSeg:{type:"string",id:7},geo:{type:"string",id:8},entranceType:{type:"int32",id:9},entranceFloor:{type:"string",id:10},doortype:{type:"int32",id:11},idxs:{rule:"repeated",type:"int32",id:12,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:13,options:{packed:!1}},accessible:{type:"int32",id:14,options:{default:0}}}},NaviSegment:{fields:{segmentId:{type:"int32",id:1},snode:{type:"int32",id:2},enode:{type:"int32",id:3},length:{type:"double",id:4},rank:{type:"int32",id:5},name:{type:"string",id:6},entry:{type:"int32",id:7},desc:{type:"string",id:8},geo:{type:"string",id:9},through:{type:"int32",id:10},idxs:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:12,options:{packed:!1}}}},NaviZone:{fields:{id:{rule:"required",type:"int32",id:1},type:{rule:"required",type:"int32",id:2,options:{default:0}},geo:{type:"string",id:3},rejects:{rule:"repeated",type:"string",id:4},idxs:{rule:"repeated",type:"int32",id:5,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:6,options:{packed:!1}}}},NaviModel:{fields:{modelid:{rule:"required",type:"int32",id:1},doorids:{rule:"repeated",type:"int32",id:2,options:{packed:!1}},nodetypes:{rule:"repeated",type:"int32",id:3,options:{packed:!1}},entrytypes:{rule:"repeated",type:"int32",id:4,options:{packed:!1}}}},NaviExtent:{fields:{id:{rule:"required",type:"int32",id:1},pts:{rule:"repeated",type:"double",id:2,options:{packed:!1}},idxs:{rule:"repeated",type:"IndexInfo",id:3}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}}}}}}}}class b0{constructor(){this.ks=null}}Object.assign(b0.prototype,{Ps(){this.ks||(this.ks=m0.Root.fromJSON((new("undefined"!=typeof KjWzhWlSj&&KjWzhWlSj.ProtoDef?KjWzhWlSj.ProtoDef:_0)).id))},Is(t){return this.Ps(),this.ks.lookup("Map").decode(t)},Fs(e){for(let t=0;t<e.buffers.length;t++){var i=e.buffers[t];if(1==i.btype)return this.js(i.data)}return null},Gs(e){for(let t=0;t<e.buffers.length;t++){var i=e.buffers[t];if(7==i.btype)return this.Us(i.data)}return null},Hs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(2==r.btype&&r.gid==i)return this.Bs(r.data)}return null},zs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(3==r.btype&&r.gid==i)return this.Vs(r.data)}return null},Ws(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(4==r.btype&&r.gid==i)return this.Ys(r.data)}return null},Xs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(5===r.btype&&r.gid===i)return this.Ys(r.data)}return null},Zs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(6===r.btype&&r.gid===i)return this.Ys(r.data)}return null},js(t){this.Ps();let e=this.ks.lookup("Scene").decode(t);return e.levels=[],e.layerGroups.forEach(t=>{e.levels.push(t.gid)}),e},Us(t){return this.Ps(),this.ks.lookup("Gate").decode(t)},Bs(t){return this.Ps(),this.ks.lookup("FloorGeo").decode(t)},Vs(t){return this.Ps(),this.ks.lookup("FloorBiz").decode(t)},Ys(t){return this.Ps(),this.ks.lookup("FloorNavi").decode(t)}});class y0{constructor(){var t;ot.environment===q.WX?this.qs=new ot.ProtoReaderStatic:void 0!==Uc.global().KjWzhWlSj&&Uc.global().KjWzhWlSj.ProtoReaderStatic?(t=Uc.global().KjWzhWlSj.ProtoReaderStatic,this.qs=new t):this.qs=new b0}}Object.assign(y0.prototype,{Is(t){return this.qs.Is(t)},Fs(t){return this.qs.Fs(t)},Gs(t){return this.qs.Gs(t)},Hs(t,e){return this.qs.Hs(t,e)},zs(t,e){return this.qs.zs(t,e)},Ws(t,e){return this.qs.Ws(t,e)},Xs(t,e){return this.qs.Xs(t,e)},Zs(t,e){return this.qs.Zs(t,e)},js(t){return this.qs.js(t)},Us(t){return this.qs.Us(t)},Bs(t){return this.qs.Bs(t)},Vs(t){return this.qs.Vs(t)},Ys(t){return this.qs.Ys(t)}});let w0="https://console.fengmap.com/api-s/",x0="https://console.fengmap.cool/api-s/",M0={domain:w0,online:w0+"sdk/check",check:w0+"sdk/auth/web",download:w0+"sdk/auth/obtainMapRoute",downloadTile:w0+"sdk/authLayered/obtainMapRoute",collect:w0+"sdk/collect",themeUrl:w0+"webtheme/",externalModelURL:w0+"webmodel/"},E0=function(){M0={domain:x0,online:x0+"sdk/check",check:x0+"sdk/auth/web",download:x0+"sdk/auth/obtainMapRoute",downloadTile:x0+"sdk/authLayered/obtainMapRoute",collect:x0+"sdk/collect",themeUrl:x0+"webtheme/",externalModelURL:x0+"webmodel/"}},L0=(()=>{function v(t,e){for(var i,r=0,n=0,n=0;n<8;n++)1&e&&(r^=t),i=128&t,t<<=1,i&&(t^=27),e>>=1;return r}function p(t,e,i){for(var r=0;r<4;r++)t[0+r]^=e[16*i+4*r],t[4+r]^=e[16*i+4*r+1],t[8+r]^=e[16*i+4*r+2],t[12+r]^=e[16*i+4*r+3]}function m(t){for(var e,i,r,n=1;n<4;n++)for(i=0;i<n;){for(r=t[4*n+4-1],e=3;0<e;e--)t[4*n+e]=t[4*n+e-1];t[4*n+0]=r,i++}}function g(t){for(var e,i,r=0;r<4;r++)for(e=0;e<4;e++)i=(240&t[4*r+e])>>4,t[4*r+e]=n[16*i+(15&t[4*r+e])]}function _(t){for(var e=0;e<4;e++)t[e]=i[16*((240&t[e])>>4)+(15&t[e])]}function b(t){return parseInt(t,16)}var i=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],n=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],y=0,w=0,x=[2,0,0,0];return{decryption:function(t,e){for(var i=Array(16),r=0;r<16;r++)i[r]=16*b(e.substr(2*r,1))+b(e.substr(2*r+1,1));var n=Array(16);for(r=0;r<16;r++)n[r]=16*b(t.substr(2*r,1))+b(t.substr(2*r+1,1));var s=Array(16);switch(r=[],i.length){default:case 16:y=4,w=10;break;case 24:y=6,w=12;break;case 32:y=8,w=14}for(var o=r=Array(16*(w+1)),a=Array(4),h=4*(w+1),l=0;l<y;l++)o[4*l+0]=i[4*l+0],o[4*l+1]=i[4*l+1],o[4*l+2]=i[4*l+2],o[4*l+3]=i[4*l+3];for(l=y;l<h;l++){if(a[0]=o[4*(l-1)+0],a[1]=o[4*(l-1)+1],a[2]=o[4*(l-1)+2],a[3]=o[4*(l-1)+3],0==l%y){for(var u=void 0,c=void 0,u=(i=a)[0],c=0;c<3;c++)i[c]=i[c+1];if(i[3]=u,_(a),1==(i=l/y))x[0]=1;else if(1<i)for(x[0]=2,i--;0<i-1;)x[0]=v(x[0],2),i--;(c=i=a)[0]=i[0]^(u=x)[0],c[1]=i[1]^u[1],c[2]=i[2]^u[2],c[3]=i[3]^u[3]}else 6<y&&4==l%y&&_(a);o[4*l+0]=o[4*(l-y)+0]^a[0],o[4*l+1]=o[4*(l-y)+1]^a[1],o[4*l+2]=o[4*(l-y)+2]^a[2],o[4*l+3]=o[4*(l-y)+3]^a[3]}for(o=Array(16),a=0;a<4;a++)for(l=0;l<4;l++)o[4*a+l]=n[a+4*l];for(p(o,r,w),n=w-1;1<=n;n--)for(m(o),g(o),p(o,r,n),a=o,l=[14,9,13,11],h=c=void 0,i=Array(4),u=Array(4),h=0;h<4;h++){for(c=0;c<4;c++)i[c]=a[4*c+h];var c=l,f=i,d=u;for(d[0]=v(c[0],f[0])^v(c[3],f[1])^v(c[2],f[2])^v(c[1],f[3]),d[1]=v(c[1],f[0])^v(c[0],f[1])^v(c[3],f[2])^v(c[2],f[3]),d[2]=v(c[2],f[0])^v(c[1],f[1])^v(c[0],f[2])^v(c[3],f[3]),d[3]=v(c[3],f[0])^v(c[2],f[1])^v(c[1],f[2])^v(c[0],f[3]),c=0;c<4;c++)a[4*c+h]=u[c]}for(m(o),g(o),p(o,r,0),a=0;a<4;a++)for(l=0;l<4;l++)s[a+4*l]=o[4*a+l];for(n="",r=0;r<16;++r)n+=o=(o=s[r].toString(16)).length<2?"0"+o:o;return n}}})(),T0=(()=>{function c(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function a(t,e,i,r,n,s){return c((e=c(c(e,t),c(r,s)))<<n|e>>>32-n,i)}function f(t,e,i,r,n,s,o){return a(e&i|~e&r,t,e,n,s,o)}function d(t,e,i,r,n,s,o){return a(e&r|i&~r,t,e,n,s,o)}function v(t,e,i,r,n,s,o){return a(e^i^r,t,e,n,s,o)}function p(t,e,i,r,n,s,o){return a(i^(e|~r),t,e,n,s,o)}function o(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i,r,n,s,o=1732584193,a=-271733879,h=-1732584194,l=271733878,u=0;u<t.length;u+=16)o=f(i=o,r=a,n=h,s=l,t[u],7,-680876936),l=f(l,o,a,h,t[u+1],12,-389564586),h=f(h,l,o,a,t[u+2],17,606105819),a=f(a,h,l,o,t[u+3],22,-1044525330),o=f(o,a,h,l,t[u+4],7,-176418897),l=f(l,o,a,h,t[u+5],12,1200080426),h=f(h,l,o,a,t[u+6],17,-1473231341),a=f(a,h,l,o,t[u+7],22,-45705983),o=f(o,a,h,l,t[u+8],7,1770035416),l=f(l,o,a,h,t[u+9],12,-1958414417),h=f(h,l,o,a,t[u+10],17,-42063),a=f(a,h,l,o,t[u+11],22,-1990404162),o=f(o,a,h,l,t[u+12],7,1804603682),l=f(l,o,a,h,t[u+13],12,-40341101),h=f(h,l,o,a,t[u+14],17,-1502002290),o=d(o,a=f(a,h,l,o,t[u+15],22,1236535329),h,l,t[u+1],5,-165796510),l=d(l,o,a,h,t[u+6],9,-1069501632),h=d(h,l,o,a,t[u+11],14,643717713),a=d(a,h,l,o,t[u],20,-373897302),o=d(o,a,h,l,t[u+5],5,-701558691),l=d(l,o,a,h,t[u+10],9,38016083),h=d(h,l,o,a,t[u+15],14,-660478335),a=d(a,h,l,o,t[u+4],20,-405537848),o=d(o,a,h,l,t[u+9],5,568446438),l=d(l,o,a,h,t[u+14],9,-1019803690),h=d(h,l,o,a,t[u+3],14,-187363961),a=d(a,h,l,o,t[u+8],20,1163531501),o=d(o,a,h,l,t[u+13],5,-1444681467),l=d(l,o,a,h,t[u+2],9,-51403784),h=d(h,l,o,a,t[u+7],14,1735328473),o=v(o,a=d(a,h,l,o,t[u+12],20,-1926607734),h,l,t[u+5],4,-378558),l=v(l,o,a,h,t[u+8],11,-2022574463),h=v(h,l,o,a,t[u+11],16,1839030562),a=v(a,h,l,o,t[u+14],23,-35309556),o=v(o,a,h,l,t[u+1],4,-1530992060),l=v(l,o,a,h,t[u+4],11,1272893353),h=v(h,l,o,a,t[u+7],16,-155497632),a=v(a,h,l,o,t[u+10],23,-1094730640),o=v(o,a,h,l,t[u+13],4,681279174),l=v(l,o,a,h,t[u],11,-358537222),h=v(h,l,o,a,t[u+3],16,-722521979),a=v(a,h,l,o,t[u+6],23,76029189),o=v(o,a,h,l,t[u+9],4,-640364487),l=v(l,o,a,h,t[u+12],11,-421815835),h=v(h,l,o,a,t[u+15],16,530742520),o=p(o,a=v(a,h,l,o,t[u+2],23,-995338651),h,l,t[u],6,-198630844),l=p(l,o,a,h,t[u+7],10,1126891415),h=p(h,l,o,a,t[u+14],15,-1416354905),a=p(a,h,l,o,t[u+5],21,-57434055),o=p(o,a,h,l,t[u+12],6,1700485571),l=p(l,o,a,h,t[u+3],10,-1894986606),h=p(h,l,o,a,t[u+10],15,-1051523),a=p(a,h,l,o,t[u+1],21,-2054922799),o=p(o,a,h,l,t[u+8],6,1873313359),l=p(l,o,a,h,t[u+15],10,-30611744),h=p(h,l,o,a,t[u+6],15,-1560198380),a=p(a,h,l,o,t[u+13],21,1309151649),o=p(o,a,h,l,t[u+4],6,-145523070),l=p(l,o,a,h,t[u+11],10,-1120210379),h=p(h,l,o,a,t[u+2],15,718787259),a=p(a,h,l,o,t[u+9],21,-343485551),o=c(o,i),a=c(a,r),h=c(h,n),l=c(l,s);return[o,a,h,l]}function h(t){for(var e="",i=32*t.length,r=0;r<i;r+=8)e+=String.fromCharCode(t[r>>5]>>>r%32&255);return e}function l(t){var e=[];for(e[(t.length>>2)-1]=void 0,r=0;r<e.length;r+=1)e[r]=0;for(var i=8*t.length,r=0;r<i;r+=8)e[r>>5]|=(255&t.charCodeAt(r/8))<<r%32;return e}function r(t){for(var e,i="0123456789abcdef",r="",n=0;n<t.length;n+=1)e=t.charCodeAt(n),r+=i.charAt(e>>>4&15)+i.charAt(15&e);return r}function u(t){return unescape(encodeURIComponent(t))}function n(t){return h(o(l(t=u(t)),8*t.length))}function s(t,e){var i,t=u(t),e=u(e),r=l(t),n=[],s=[];for(n[15]=s[15]=void 0,16<r.length&&(r=o(r,8*t.length)),i=0;i<16;i+=1)n[i]=909522486^r[i],s[i]=1549556828^r[i];return t=o(n.concat(l(e)),512+8*e.length),h(o(s.concat(t),640))}function e(t,e,i){return e?i?s(e,t):r(s(e,t)):i?n(t):r(n(t))}return{encryption:function(t){return e(t)}}})(),S0="026685bf295f587b5dffc1f18d5dc27c",A0="fengmap.localhost:",O0="0.0.0.0";class C0{constructor(){}}Object.assign(C0.prototype,{Js(t,e,i,r,n){void 0===ot.KjWzhWlSj||!ot.KjWzhWlSj.license||!ot.KjWzhWlSj.license||"string"==typeof e&&0!=e.length&&(e=L0.decryption(e,S0),i=T0.encryption(i),e=L0.decryption(e,i),-1!==t.indexOf(e))?r&&r():n&&n()},Ks(t,e,i,r){var n;-1!==e.indexOf("")||-1!==e.indexOf("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa")||void 0===t.mapURL||(n=T0.encryption(A0+t.appName),n=L0.decryption(t.key,n),-1!==e.indexOf(n))?this.Js(e,t.license,t.buildingID,()=>{i&&i()},()=>{r&&r(Wr.LICENSE_ERROR)}):r&&r(Wr.NAME_KEY_ERROR)},Qs(t,e,i){void 0!==t.mapURL?e&&e():this.$s(()=>{new Hc({method:"POST",url:M0.check,header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:this.eo(t)}).bs(()=>{e&&e()},t=>{i&&i(t)},()=>{e&&e()})},()=>{e&&e()})},$s(t,e){new Hc({method:"GET",url:M0.online}).bs(()=>{t&&t()},()=>{e&&e()},()=>{e&&e()})},eo(t,e){let i;ot.environment===q.BROWSER&&(r=Uc.global(),-1!==(r=(i=r.location.host).indexOf(":")))&&(i=i.slice(0,r));var r={mapId:t.buildingID,appName:t.appName};return e?r.keyValue=t.key:r.appKey=t.key,e?r.webUrl=i||O0:r.webURL=i||O0,r},io(t){if("undefined"!=typeof navigator&&"undefined"!=typeof document){var i={},r=(-1!==navigator.userAgent.indexOf("Opera")?i.userAgent="Opera":-1!==navigator.userAgent.indexOf("Firefox")?i.userAgent="FF":-1!==navigator.userAgent.indexOf("Chrome")?i.userAgent="Chrome":-1!==navigator.userAgent.indexOf("Safari")&&0===navigator.userAgent.indexOf("Chrome")?i.userAgent="Safari":-1!==navigator.userAgent.indexOf("compatible")&&-1!==navigator.userAgent.indexOf("MSIE")?i.userAgent="IE":-1!==navigator.userAgent.indexOf("Trident")&&(i.userAgent="Edge"),i.product="JS",i.sdkVersion=c.VERSION+"."+c.BUILD,i.appName=t.appName,i.appkey=t.key,t.gl.getExtension("WEBGL_debug_renderer_info"));i.gpu=r?t.gl.getParameter(r.UNMASKED_RENDERER_WEBGL):null,i.os=navigator.platform;let e=!0;var n=navigator.userAgent,s=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];for(let t=0;t<s.length;t++)if(0<n.indexOf(s[t])){e=!1;break}e?i.device="pc":i.device="mobile",new Hc({method:"POST",url:M0.collect,header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:i}).bs()}}});let R0=new C0;class N0{constructor(t={}){this.ro=t.disposeCallback,this.no=!1,this.so=!1,this.oo=void 0!==t.enable&&t.enable,this.name=void 0!==t.name?t.name:"",this.ao=new Map,this.ho=t.mapCreateTime}}Object.assign(N0.prototype,{uo(){!this.oo||this.so||this.no&&0===this.ao.size&&(this.ro({mapCreateTime:this.ho}),this.so=!0)},co(t){this.oo&&(this.no=t,this.uo())},fo(t){this.oo&&(this.ao.has(t),this.ao.set(t,0))},do(t){this.oo&&this.ao.has(t)&&(this.ao.delete(t),this.uo())}});let D0="2",k0=3;class P0{constructor(){this.qs=new y0,this.vo=[],this.po=new N0({enable:!0,name:"DataManager"})}}function I0(s){var o=[],t=s.length;for(let n=0;n<t;n++){let t=s[n],e={x:this.mo(t.x),y:this.mo(t.y)},i=o.length,r=!1;for(let t=0;t<i;t++){var a=o[t];if(a.x==e.x&&a.y==e.y){r=!0;break}}r||o.push(e)}return o}function F0(t){return+t.toFixed(2)}Object.assign(P0.prototype,{Kt(t){this.po.ro=t,this.vo.forEach(t=>{200!==t._s.status&&this.po.do(t.gs.url),t.Kt()}),this.vo.length=0,this.po.co(!0)},_o(e,i,r,n){if(e.mapURL){let t;t=e.isPreview?e.isOutdoor?e.tile?e.mapURL+e.buildingID+"/separate/"+e.buildingID+i+".fmap":e.mapURL+e.buildingID+"/"+e.buildingID+i+".fmap":e.tile?e.mapURL+e.mapID+"/"+e.bid+"/"+e.buildingID+"/separate/"+e.buildingID+i+".fmap":e.mapURL+e.mapID+"/"+e.bid+"/"+e.buildingID+"/"+e.buildingID+i+".fmap":e.mapURLAbsolute?e.mapURL+e.buildingID+i+".fmap":e.isOutdoor?e.mapURL+e.buildingID+"/"+e.buildingID+i+".fmap":e.mapURL+e.mapID+"/"+e.bid+"/"+e.buildingID+"/"+e.buildingID+i+".fmap",void(r&&r(t))}else{var t={newFlag:D0,keyType:k0,isSeparate:!1},i=(e.isOutdoor||(t.bId=e.bid,t.rootMid=e.mapID),new Hc({method:"POST",url:""===i?M0.download:M0.downloadTile+"/"+e.buildingID+i+".fmap",header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:Object.assign(t,R0.eo(e,!0))}));this.vo.push(i),i.bs(t=>{r&&r(t.replace('"',"").replace('"',""))},t=>{n&&n(t)},t=>{n&&n(t)})}},bo(r,n,s){R0.Qs(r,()=>{this._o(r,"",i=>{var t=new Hc({method:"GET",responseType:"arraybuffer",url:i});this.vo.push(t),this.po.fo(i),t.bs(t=>{this.po.do(i);var t=new Uint8Array(t);let e=this.qs.Is(t);!r.isOutdoor||(t=[],e.keys&&0!==e.keys.length?t.push(...e.keys):t.push(e.key),r.isPreview)?n&&n(e):R0.Ks(r,t,()=>{n&&n(e)},t=>{s&&s(t)})},t=>{s&&(t===Wr.PATH_ERROR?s(Wr.MAP_ID_URL_ERROR):s(t)),this.po.do(i)},t=>{s&&s(t),this.po.do(i)})},t=>{s&&s(t)})},t=>{s&&s(t)})},yo(r,n,s){R0.Qs(r,()=>{this._o(r,".scene",i=>{this.po.fo(i);var t=new Hc({method:"GET",responseType:"arraybuffer",url:i});this.vo.push(t),t.bs(t=>{var t=new Uint8Array(t);let e=this.qs.js(t);this.po.do(i),!r.isOutdoor||(t=[],e.keys&&0!==e.keys.length?t.push(...e.keys):t.push(e.key),r.isPreview)?n&&n(e):R0.Ks(r,t,()=>{n&&n(e)},t=>{s&&s(t)})},t=>{s&&s(t),this.po.do(i)},t=>{s&&s(t),this.po.do(i)})},t=>{s&&s(t)})},t=>{s&&s(t)})},wo(t,i,r){this._o(t,".gate",e=>{this.po.fo(e);var t=new Hc({method:"GET",responseType:"arraybuffer",url:e});this.vo.push(t),t.bs(t=>{t=new Uint8Array(t),t=this.qs.Us(t);i&&i(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)})},t=>{r&&r(t)})},xo(t,e,i,r){this._o(t,".floor."+e+".geo",e=>{var t=new Hc({method:"GET",responseType:"arraybuffer",url:e});this.po.fo(e),this.vo.push(t),t.bs(t=>{t=new Uint8Array(t),t=this.qs.Bs(t);i&&i(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)})},t=>{r&&r(t)})},Mo(t,e,i,r){this._o(t,".floor."+e+".biz",e=>{var t=new Hc({method:"GET",responseType:"arraybuffer",url:e});this.po.fo(e),this.vo.push(t),t.bs(t=>{t=new Uint8Array(t),t=this.qs.Vs(t);i&&i(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)})},t=>{r&&r(t)})},Eo(t,e,i,r){this._o(t,e,e=>{var t=new Hc({method:"GET",responseType:"arraybuffer",url:e});this.po.fo(e),this.vo.push(t),t.bs(t=>{t=new Uint8Array(t),t=this.qs.Ys(t);i&&i(t),this.po.do(e)},t=>{r&&r(t),this.po.do(e)})},t=>{r&&r(t)},t=>{r&&r(t)})},Lo(t,e,i,r){this.Eo(t,".floor."+e+".navi",i,r)},To(t,e,i,r){this.Eo(t,".floor."+e+".drive.navi",i,r)},So(t,e,i,r){this.Eo(t,".floor."+e+".accessible.navi",i,r)}});class j0{constructor(){}}Object.assign(j0.prototype,{Ao(i,r){var n=[];let s=0;for(let t=0;t<i.length;t++){let e=i[t].idxs;if("number"==typeof(e=e||i[t]))for(;s<e;)n.push({x:r[s],y:r[s+1]}),s+=2;else for(let t=0;t<e.length;t++)for(var o=e[t];s<o;)n.push({x:r[s],y:r[s+1]}),s+=2}return n},Oo(i,r){var n=[];let s=0;for(let t=0;t<i.length;t++){let e=i[t].idxs;if("number"==typeof(e=e||i[t])){for(var o=[];s<e;)o.push({x:r[s],y:r[s+1]}),s+=2;n.push(o)}else for(let t=0;t<e.length;t++){for(var a=e[t],h=[];s<a;)h.push({x:r[s],y:r[s+1]}),s+=2;n.push(h)}}return n},Co(i,r){var n=[],s=[];let o=0;for(let t=0;t<i.length;t++){let e=i[t].idxs;if("number"==typeof(e=e||i[t]))for(;o<e;)n.push({x:r[o],y:r[o+1]}),o+=2;else for(let t=0;t<e.length;t++)if(0===t)for(var a=e[t];o<a;)n.push({x:r[o],y:r[o+1]}),o+=2;else{for(var h=[],l=e[t];o<l;)h.push({x:r[o],y:r[o+1]}),o+=2;s.push(h)}}var t=[];return t.push(n),t.push(...s),t},Ro(t){return I0(t)},mo(t){return F0(t)}});let G0=new j0,U0={G1:"MULTIPOLYGON(((",G2:"POINT(",G3:"MULTILINESTRING(("};U0.GLEN1="MULTIPOLYGON(((".length,U0.GLEN2="POINT(".length,U0.GLEN3="MULTILINESTRING((".length;class H0{constructor(){}}Object.assign(H0.prototype,{Ao(t){var e=[];return 0!=t.indexOf(U0.G2)?[]:(t=t.substring(U0.GLEN2,t.length-1).split(" "),e.push({x:parseFloat(t[0]),y:parseFloat(t[1])}),e)},No(e,i){for(let t=0;t<e.length;t++){var r=e[t].split(" ");i.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}},Oo(t){return 0!=t.indexOf(U0.G3)?[]:(t=t.substring(U0.GLEN3,t.length-2).split(","),this.No(t,t=[]),[t])},Co(t){var e=[],i=[];if(0!=t.indexOf(U0.G1))return[];var r=t.substring(U0.GLEN1,t.length-3).split(/\),\(/);for(let t=0;t<r.length;t++){var n=r[t].split(/,/);if(0==t)this.No(n,e);else{var s=[];for(let t=0;t<n.length;t++){var o=n[t].split(" ");s.push({x:parseFloat(o[0]),y:parseFloat(o[1])})}i.push(s)}}t=[];return t.push(e),t.push(...i),t},Ro(t){return I0(t)},mo(t){return F0(t)}});let B0=new H0;class z0{constructor(t){this.Ei=cn.GROUP,this.I=new Map,this.Ht=-1,this.mi=null,Object.assign(this,t)}getType(){return this.Ei}getBound(){return this.mi||this.Ti(),this.mi}getChildren(){return this.I}}Object.assign(z0.prototype,{Kt(){for(var t of this.I.values())t.Kt&&t.Kt();this.I.clear()},Si(e){var t=e._support(this);t==os.PASS?this.I.forEach(t=>{t.Si(e)}):t==os.PUSH&&e._result.push(this)},Ti(){this.mi=new $n,0!=this.I.size&&this.I.forEach(t=>{this.mi.di(t.getBound())})}});class V0 extends as{constructor(t){super(),this.Ht=t.eid,this.Ei=cn.POINT,Object.assign(this,t)}}Object.assign(V0.prototype,{Ti(){this.mi=new $n,this.Li&&this.mi.vi(this.Li)},Si(t){t._support(this)==os.PUSH&&t._result.push(this)}});class W0{constructor(){this.Do=[1,2,3,4],this.ko=[6,7,9],this.Po=[31,32],this.Io=new Map,this.Io.set(31,cn.EXTENTGROUP),this.Io.set(32,cn.MODELGROUP),this.Io.set(6,cn.FACILITYGROUP),this.Io.set(7,cn.LABELGROUP),this.Io.set(9,cn.EXTERNALMODELGROUP),this.Fo=new Map,this.Fo.set(31,["extentLayer",null]),this.Fo.set(32,["modelLayer","labelLayer"]),this.Fo.set(6,["poiLayer",null]),this.Fo.set(7,["labelLayer",null]),this.Fo.set(9,["externalModelLayer",null]),this.qs=new y0}}Object.assign(W0.prototype,{jo(t){var e;return t?(e=t.scene,this.Go(e,t)):null},Go(t,i){let{layerGroups:e,...r}=t,n=t.fileVer,s=new z0(r);return e.forEach(t=>{var e=this.Uo(t,i,n);s.I.set(t.gid,e)}),s},Uo(t,e,i){let{layers:r,...n}=t,s=new z0(n),o=e&&e.floors?e.floors.get(t.gid).geo[0]:null,a=e&&e.floors?e.floors.get(t.gid).biz[0]:null;return r.forEach(t=>{6===t.ltype&&-1!==t.lname.indexOf("storelabel")&&(t.ltype=7);var e=this.Ho(t,o,a,i);null!==e&&s.I.set(this.Io.get(t.ltype),e)}),this.Bo(s),s},Bo(t){var e=Array.from(t.I);e.sort((t,e)=>t[0]-e[0]),t.I=new Map(e)},Ho(t,e,i,r){var n;return-1===this.Do.indexOf(t.ltype)&&this.Fo.get(t.ltype)?(n=new z0(t),this.zo(n,e,i,r),n&&(n.Ei=this.Io.get(t.ltype)),n):null},zo(t,e,i,r){if(t){var n=this.Fo.get(t.ltype);if(n){var s=e?e[n[0]]:[],o=i?i[n[0]]:[];switch(t.ltype){case 6:this.Vo(t,s,o,r,cn.FACILITY);break;case 7:this.Vo(t,s,o,r,cn.LABEL);break;case 9:this.Vo(t,s,o,r,cn.EXTERNALMODEL);break;case 31:this.Wo(t,s,o,r,cn.EXTENT,null);break;case 32:this.Wo(t,s,o,r,cn.MODEL,e?e[n[1]]:null)}}}},Vo(e,i,r,n,s){for(let t=0;t<i.length;t++){var o=this.Yo(i[t],r[t],n);o.Ei=s,e.I.set(i[t].eid,o)}},Yo(t,e,i){e=Object.assign({},e,{area:t.area,eid:t.eid,height:t.height}),e=new V0(e);return t.coordinates?e.Li=t.coordinates:(e.Li=1==i?B0.Ao(t.geo):G0.Ao(t.idxs,t.pts),t.coordinates=e.Li),e},Wo(e,i,r,n,s,o){for(let t=0;t<i.length;t++){var a=this.Xo(i[t],r[t],n,o?o[t]:null);a.Ei=s,e.I.set(i[t].eid,a)}},Xo(t,e,i,r){e=Object.assign({},e,{area:t.area,eid:t.eid,height:t.height,baseheight:t.baseheight}),e=new hs(e);return e.Li=1===i?B0.Co(t.geo):G0.Co(t.idxs,t.pts),r&&(r.coordinates||(r.coordinates=1===i?B0.Ao(r.geo):G0.Ao(r.idxs,r.pts)),e.wi=r.coordinates[0]),e}});let Y0={NONE_RODE_NETWORK:1,WALK_RODE_NETWORK:2,DRIVE_RODE_NETWORK:4,ACCESSIBLE_RODE_NETWORK:8};class X0{constructor(){this.wr=new Map,this.Zo=new Map,this.gs=new Map,this.qo=new Map,this.Jo=new Map,this.Ko=new Map,this.Qo=[2,3],this.$o=!1,this.qs=new y0,this.ta=new W0,this.ea=new P0}load(t,e){this.ia(t,e)}loadWhole(t,e){this.ra(t,e)}getDecode(t){t=void 0!==t.buildingID?t.buildingID:t.mapID;return this.na({buildingID:t})}getData(t){t=void 0!==t.buildingID?t.buildingID:t.mapID;return this.wr.get(t)}setCache(t){this.wr=t[0],this.Zo=t[1]}getCache(){return[this.wr,this.Zo]}}function Z0(t,e){return g.prototype.copy.call(t,e),t.fragmentShader=e.fragmentShader,t.vertexShader=e.vertexShader,t.uniforms=oo.clone(e.uniforms),t.lights=e.lights,t}function q0(e){Object.defineProperties(e,{color:{enumerable:!0,get:function(){return e.uniforms.diffuse.value},set:function(t){e.uniforms.diffuse.value=t}},opacity:{enumerable:!0,get:function(){return e.uniforms.opacity.value},set:function(t){e.uniforms.opacity.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}}})}function J0(t){t.fmcommon={diffuse:{value:new ft(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new N}}}function K0(t){let e=al.line.fragmentShader;if(!t.gradient)return e=(e=e.replace("#include <line_gradient_defined>","")).replace("#include <line_gradient>","");var{percent:i,color:r}=t.gradient,n=i.length,s=new ft;let o=`
		float stops[${n}];
		vec3 gradients[${n}];
		float fromPercent = ${Number(t.distancePercent[0]).toFixed(2)};
		float toPercent = ${Number(t.distancePercent[1]).toFixed(2)};
		`;for(let t=0;t<n;t++)o+=`stops[${t}] = ${Number(i[t]).toFixed(2)};
		`,s.setStyle(r[t]),o+=`gradients[${t}] = vec3(${Number(s.r).toFixed(2)},${Number(s.g).toFixed(2)}, ${Number(s.b).toFixed(2)});
		`;var a=`
		#ifdef GRADIENT
			float remap(float a0,float a1,float b0,float b1,float a) {
				return (a - a0) / (a1 - a0) * (b1 - b0) + b0;
			}

			vec3 getGradientColor(float gradientValue) {
				${o}

				gradientValue = remap(0., 1., fromPercent, toPercent, gradientValue);
				float t = 0.0;
				vec3 color = vec3(0.0);
				for (int i = 0; i < ${n}; i++) {
						if (gradientValue <= stops[i + 1]) {
								t = (gradientValue - stops[i]) / (stops[i + 1] - stops[i]);
								color = mix(gradients[i], gradients[i + 1], t);
								break;
						}
				}

				return color;
			}
		#endif
		`;let h="";return h=t.isNeedArrow?`
		#ifdef GRADIENT
			diffuseColor.rgb += getGradientColor( vUv2.y);
		#endif`:`
			#ifdef GRADIENT
				diffuseColor.rgb = getGradientColor( vUv2.y);
			#endif
		`,e=(e=e.replace("#include <line_gradient_defined>",a)).replace("#include <line_gradient>",h)}Object.assign(X0.prototype,{Kt(t){this.ea.Kt(t),this.Gn()},Gn(){this.wr.clear(),this.wr=null,this.Zo.clear(),this.Zo=null,this.gs.clear(),this.gs=null,this.qo.clear(),this.qo=null,this.Jo.clear(),this.Jo=null,this.Ko.clear(),this.Ko=null,this.sa&&this.sa({name:"DataManager"})},oa(t){this.qo.set(t.buildingID+t.uuid,null),this.Jo.set(t.buildingID+t.uuid,null),this.Ko.set(t.buildingID+t.uuid,0)},ia(s,o){this.oa(s),this.yo(s,(e,t)=>{o&&o(e,t);let n=this.aa(s);t=s.loadNavi&&n.buildings&&0<n.buildings.length;this.wo(s,t,(t,e)=>{o&&o(t,e);var i=void 0!==s.level?s.level:parseInt(n.defGid),r=(this.ha(s,i,o),s.visibleLevels||n.levels);for(let t=0;t<r.length;t++)r[t]===i||n.levels.indexOf(r[t])<0||this.ha(s,r[t],o);if(s.preLoad)for(let t=0;t<n.levels.length;t++)n.levels[t]!==i&&-1===r.indexOf(n.levels[t])&&this.ha(s,n.levels[t],o)},t=>{o&&o(e,t)})},(t,e)=>{o&&o(t,e)})},wo(i,t,r,n){t?(t=this.la(i))?r&&r("gate",t):this.ea.wo(i,t=>{this.Zo.get(i.buildingID).gate=t,r&&r("gate",t)},t=>{var e;i.navigationData?((e=this.Zo.get(i.buildingID)).gate=i.navigationData,r&&r("gate",e.gate)):n("error",t)}):r&&r("gate",null)},yo(e,i,r){var t=this.aa(e);t?(i&&i("scene",t),e.justDecode||(t=this.wr.get(e.buildingID),i&&i("building",t))):this.ea.yo(e,t=>{e.isOutdoor&&this.ua(t),this.Zo.set(e.buildingID,{scene:t}),i&&i("scene",t),e.justDecode||(t=this.ta.Go(t),this.wr.set(e.buildingID,t),i&&i("building",t))},t=>{r&&(t===Wr.PATH_ERROR?r("error",Wr.MAP_ID_URL_ERROR):r("error",t))})},ua(t){var e=t.fileVer;t.buildings&&1<e&&t.buildings.forEach(e=>{e.floors&&(e.levelChart=[],e.fids=[],e.floors.forEach(t=>{t.Li=G0.Co(t.idxs,t.pts),t.pgid&&e.levelChart.push(t.pgid,t.gid),t.baseLevel&&(e.minlevel=t.minlevel,e.maxlevel=t.maxlevel),t.fids&&e.fids.push.apply(e.fids,t.fids)}))})},ha(t,e,i,r){let n=this.qo.get(t.buildingID+t.uuid);n||(n=[],this.qo.set(t.buildingID+t.uuid,n)),r?n.unshift(e):n.push(e),this.$o&&1!==n.length||this.ca(t,i)},ca(s,o){let a=this.aa(s);if(a){let n=this.qo.get(s.buildingID+s.uuid);if(n&&0!==n.length){let t=this.Jo.get(s.buildingID+s.uuid),r=(t||(t=[],this.Jo.set(s.buildingID+s.uuid,t)),n[0]);-1!==t.indexOf(r)?(n.splice(n.indexOf(r),1),this.ca(s,o)):(t.push(r),this.fa(s,r,(t,e)=>{let i=this.Ko.get(s.buildingID+s.uuid);"layerGroup"===t&&(o&&o(t,e),i++,this.Ko.set(s.buildingID+s.uuid,i),i===a.layerGroups.length&&o&&o("decode",this.na(s)),n.splice(n.indexOf(r),1),this.ca(s,o)),"layer"===t&&o&&o(t,e),"floor"===t&&(o&&o(t,e),i===a.layerGroups.length)&&o&&o("complete",this.da(s))},(t,e)=>{o&&o(t,e)}))}}},fa(o,a,h,l){let u=this.aa(o);var t=this.va(u,a);if(t){var c=t.gname,t=t.naviType||0;let e=this.Qo[0],i=0,n=new Map,s=o.merge,r=function(r){if(i++,e===i){let e=n.get("geo"),i=n.get("biz");var t;s&&s.merge(a,e,i,u.fileVer),h&&h("layerGroup",n),o.justDecode||((t=r.Vi(o,a)).I.forEach(t=>{r.ta.zo(t,e,i,u.fileVer),h&&h("layer",t)}),h&&h("floor",t))}};o.loadNavi&&((0!=(t&Y0.WALK_RODE_NETWORK)||u.fileVer<3)&&(e++,this.Lo(o,a,c,(t,e)=>{n.set(t,e),h&&h(t,e),r(this)},t=>{l&&l(t)})),0!=(t&Y0.DRIVE_RODE_NETWORK)&&(e++,this.To(o,a,c,(t,e)=>{n.set(t,e),h&&h(t,e),r(this)},t=>{l&&l(t)})),0!=(t&Y0.ACCESSIBLE_RODE_NETWORK))&&(e++,this.So(o,a,c,(t,e)=>{n.set(t,e),h&&h(t,e),r(this)},t=>{l&&l(t)})),this.xo(o,a,c,(t,e)=>{n.set(t,e),h&&h(t,e),r(this)},t=>{l&&l(t)}),this.Mo(o,a,c,(t,e)=>{n.set(t,e),h&&h(t,e),r(this)},t=>{l&&l(t)})}else l&&l("error",Wr.DEFAULT_LEVEL_ERROR)},xo(e,i,t,r,n){var s=this.pa(e,i,"geo");s?r&&r("geo",s):this.ea.xo(e,t,t=>{this.ma(e,i,"geo",t),r&&r("geo",t)},t=>{n&&n("error",t)})},Mo(e,i,t,r,n){var s=this.pa(e,i,"biz");s?r&&r("biz",s):this.ea.Mo(e,t,t=>{this.ma(e,i,"biz",t),r&&r("biz",t)},t=>{n&&n("error",t)})},Lo(e,i,t,r,n){var s=this.pa(e,i,"navi");s?r&&r("navi",s):this.ea.Lo(e,t,t=>{this.ma(e,i,"navi",t),r&&r("navi",t)},t=>{n&&n("error",t)})},To(e,i,t,r,n){var s=this.pa(e,i,"drive_navi");s?r&&r("drive_navi",s):this.ea.To(e,t,t=>{this.ma(e,i,"drive_navi",t),r&&r("drive_navi",t)},t=>{n&&n("error",t)})},So(e,i,t,r,n){var s=this.pa(e,i,"accessible_navi");s?r&&r("drive_navi",s):this.ea.So(e,t,t=>{this.ma(e,i,"accessible_navi",t),r&&r("accessible_navi",t)},t=>{n&&n("error",t)})},ra(t,i){this.bo(t,(t,e)=>{i&&i(t,e)},(t,e)=>{i&&i(t,e)})},bo(e,i,r){let n=this.na(e);n?i&&i("decode",n):this.ea.bo(e,t=>{this.ga(e,t),n=this.na(e),i&&i("decode",n),e.justDecode||(t=this.ta.jo(n),this.wr.set(e.buildingID,t),i&&i("complete",t))},t=>{r&&r("error",t)})},da(t){if(this.wr)return this.wr.get(t.buildingID)||null},Vi(t,e){t=this.wr.get(t.buildingID);return t?t.I.get(e):null},ga(e,i){var r={scene:null,floors:new Map},n=this.qs.Fs(i);e.isOutdoor&&this.ua(n),r.scene=n,r.gate=this.qs.Gs(i);for(let t=0;t<n.layerGroups.length;t++){var s=n.layerGroups[t],o=this.qs.Hs(i,s.gid),a=this.qs.zs(i,s.gid),h=this.qs.Ws(i,s.gid),l=this.qs.Xs(i,s.gid),u=this.qs.Zs(i,s.gid),c=(e.merge&&e.merge.merge(s.gid,o,a,n.fileVer),new Map);c.set("geo",o),c.set("biz",a),c.set("navi",h),c.set("drive_navi",l),c.set("accessible_navi",u),r.floors.set(s.gid,c)}this.Zo.set(e.buildingID,r)},na(e){var t=this.Zo.get(e.buildingID);if(!t)return null;var i=t.scene,r=new Map,t={scene:i,floors:r,gate:t.gate};for(let t=0;t<i.layerGroups.length;t++){var n=i.layerGroups[t],s=n.gid,o={gid:s,gname:n.gname,level:s,geo:[],biz:[],navi:[],naviDrive:[],naviAccessible:[]},a=(o.geo.push(this.pa(e,s,"geo")),o.biz.push(this.pa(e,s,"biz")),this.pa(e,s,"navi")),a=(a&&o.navi.push(a),this.pa(e,s,"drive_navi")),a=(a&&o.naviDrive.push(a),this.pa(e,s,"accessible_navi"));a&&o.naviAccessible.push(a),r.set(n.gid,o)}return t},aa(t){t=this.Zo.get(t.buildingID);return t?t.scene:null},la(t){t=this.Zo.get(t.buildingID);return t?t.gate:null},ma(i,r,n,s){i=this.Zo.get(i.buildingID);if(i){let t=i.floors,e=(t||(t=new Map,i.floors=t),t.get(r));e||(e=new Map,t.set(r,e)),e.set(n,s)}},pa(t,e,i){var t=this.Zo.get(t.buildingID);return(t=t&&t.floors)&&(t=t.get(e))?t.get(i):null},va(t,e){if(null!=t){var i=t.layerGroups;for(let t=0;t<i.length;t++)if(i[t].gid==e)return i[t]}return null}}),J0(Ot),Ot.line={lineWidth:{value:1},resolution:{value:new St(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},mmap:{value:null},offset:{value:new St(0,0)},repeat:{value:new St(1,1)},miny:{value:0},pcolor:{value:new ft(11447982)},usePassOpacity:{value:0},passOpacity:{value:1}},al.line={uniforms:oo.merge([Ot.fmcommon,Ot.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>

		uniform float lineWidth;
		uniform vec2 resolution;

		attribute float uvyStart;
		attribute float uvyEnd;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;
		attribute vec2 uv2;


		varying vec2 vUv;
		varying vec2 vUv2;
		varying float uvScale;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		#include <logdepthbuf_pars_vertex>

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			float duvy = uvyEnd - uvyStart;
			float uvy = uvyStart + duvy * uv2.y;
			// vUv2 = vec2(uv2.x ,uvy);
			vUv2 = ( position.y < 0.5 ) ? vec2(uv2.x ,uvyStart) : vec2(uv2.x ,uvyEnd);
			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec2 ndcStart = clipStart.xy / clipStart.w;
			vec2 ndcEnd = clipEnd.xy / clipEnd.w;

			// direction
			vec2 dir = ndcEnd - ndcStart;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			float scaleDir = length(dir);
			uvScale = 0.05/scaleDir;
			dir = normalize( dir );

			// perpendicular to dir
			vec2 offset = vec2( dir.y, - dir.x );

			// undo aspect ratio adjustment
			dir.x /= aspect;
			offset.x /= aspect;

			// sign flip
			if ( position.x < 0.0 ) offset *= - 1.0;

			// endcaps
			if ( position.y < 0.0 ) {

				offset += - dir;

			} else if ( position.y > 1.0 ) {

				offset += dir;

			}

			// adjust for lineWidth
			offset *= lineWidth;

			// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
			offset /= resolution.y;

			// select end
			vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

			// back to clip space
			offset *= clip.w;

			clip.xy += offset;

			gl_Position = clip;

			#include <logdepthbuf_vertex>

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform vec2 repeat;
		uniform vec2 offset;
		uniform float miny;
		uniform vec3 pcolor;
		uniform float usePassOpacity;
		uniform float passOpacity;
	  #include <line_gradient_defined>

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

			uniform sampler2D mmap;

		varying float vLineDistance;

		#include <common>
		#include <color_pars_fragment>

		varying float uvScale;
		varying vec2 vUv;
		varying vec2 vUv2;

		#include <logdepthbuf_pars_fragment>

		void main() {

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			vec4 diffuseColor = vec4( diffuse, opacity );

			#include <logdepthbuf_fragment>

			#ifdef USE_MMAP

				if(vUv2.y >= miny && miny != 1.0){
				    vec4 texColor = texture2D( mmap, vUv2 * repeat + offset );
					diffuseColor = vec4(texColor.xyz,min(texColor.w, opacity));
				}else{
					float ret = opacity;
					if(usePassOpacity == 1.0) {
						ret = passOpacity;
					}
					diffuseColor = vec4(pcolor, ret);

					if(usePassOpacity == 1.0 && ret < 0.1) {
						discard;
					}
				}

			#endif

			#include <line_gradient>

			gl_FragColor = diffuseColor;
			#include <encodings_fragment>
		}
		`};let Q0=function(t){g.call(this,{type:"FMLineMaterial",uniforms:oo.clone(al.line.uniforms),vertexShader:al.line.vertexShader,fragmentShader:K0(t)}),t.gradient&&(this.defines={GRADIENT:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value.copy(t)}},lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},pcolor:{enumerable:!0,get:function(){return this.uniforms.pcolor.value},set:function(t){this.uniforms.pcolor.value.copy(t)}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}}),delete t.gradient,delete t.distancePercent,delete t.isNeedArrow,this.setValues(t)};Q0.prototype=Object.create(g.prototype),Q0.prototype.constructor=Q0,Q0.prototype.isFMLineMaterial=!0,Q0.prototype.copy=function(t){return g.prototype.copy.call(this,t),this.color.copy(t.color),this.lineWidth=t.lineWidth,this.resolution=t.resolution,this};var $0=2;function tv(t){K.call(this),this.type="SpriteMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}function ev(t){K.call(this),this.type="LineBasicMaterial",this.color=new ft(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}function iv(t){g.call(this,t),this.type="RawShaderMaterial"}tv.prototype=Object.create(K.prototype),tv.prototype.constructor=tv,tv.prototype.isSpriteMaterial=!0,tv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},ev.prototype=Object.create(K.prototype),ev.prototype.constructor=ev,ev.prototype.isLineBasicMaterial=!0,ev.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},iv.prototype=Object.create(g.prototype),iv.prototype.constructor=iv,iv.prototype.isRawShaderMaterial=!0;class rv{constructor(){this._a=!1,this.ba=new Map,this.ya=new Map}}Object.assign(rv.prototype,{wa(t,e){this.ya.has(t)||this.ya.set(t,new Set),this.ya.get(t).add(e)},xa(){this.ba.clear(),this.ba=null,this.ya.clear(),this.ya=null}});class nv{static getBrowser(){if(void 0!==navigator){var t,e,i,r,n,s,o=navigator.userAgent;if(void 0!==o)return t=-1<o.indexOf("Opera"),s=-1<o.indexOf("compatible")&&-1<o.indexOf("MSIE")&&!t,e=-1<o.indexOf("Edge"),i=-1<o.indexOf("Firefox"),r=-1<o.indexOf("Safari")&&-1===o.indexOf("Chrome"),n=-1<o.indexOf("Chrome")&&-1<o.indexOf("Safari"),s?(new RegExp("MSIE (\\d+\\.\\d+);").test(o),7===(s=parseFloat(RegExp.$1))?"IE7":8===s?"IE8":9===s?"IE9":10===s?"IE10":11===s?"IE11":"IE"):t?"Opera":e?"Edge":i?"FF":r?"Safari":n?"Chrome":void 0}}}let sv=nv.getBrowser();class ov extends rv{constructor(){super(),this.Ma=0,this.Ea=0,this.La=new Map}}Object.assign(ov.prototype,{Ta(t,e,i){let r;return this.ba.has(t)?(r=this.ba.get(t),e&&(r.isComplete?r.isError?e(null):e(r):this.wa(t,e))):r=this.Sa(t,e,i),r},Sa(e,t,i){let r=this;this.Ma++;let n;return(n=ot.environment===q.WX?ot.textureHelper.createImage(i):new Image).crossOrigin="Anonymous","IE11"===sv?n.onload=new function(){this.Ea++,n.isComplete=!0,r.Aa(e,n)}:n.onload=function(){r.Ea++,n.isComplete=!0,r.Aa(e,n)},n.onerror=function(t){r.Ea++,n.isComplete=!0,n.isError=!0,r.Aa(e,null)},n.src=e,n.isComplete=!1,this.ba.set(e,n),t&&this.wa(e,t),n},Aa(t,r){this.ya.has(t)&&(this.ya.get(t).forEach((t,e,i)=>{e(r),i.delete(t)}),this.ya.delete(t)),0<this.La.size&&this.Ma===this.Ea&&this.La.forEach((t,e)=>{t(e)})},xa(){this.ba.clear(),this.ya.clear()}});let av=new ov,hv={Left:0,Center:2,Right:4};class lv{constructor(t){this.qr=t}}Object.assign(lv.prototype,{Oa(t,e){var i=ot.document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=e,i.style.width=t+"px",i.style.height=e+"px",{canvas:i,ctx:r}},Ca(t,e,i,r,n){var s=n,o={x:n.x+e,y:n.y},a={x:n.x,y:n.y+i},e={x:n.x+e,y:n.y+i},n={x:s.x+r,y:s.y},i={x:o.x-r,y:o.y},h={x:o.x,y:o.y+r},l={x:e.x,y:e.y-r},u={x:e.x-r,y:e.y},c={x:a.x+r,y:a.y},f={x:a.x,y:a.y-r},d={x:s.x,y:s.y+r};t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(i.x,i.y),t.arcTo(o.x,o.y,h.x,h.y,r),t.lineTo(l.x,l.y),t.arcTo(e.x,e.y,u.x,u.y,r),t.lineTo(c.x,c.y),t.arcTo(a.x,a.y,f.x,f.y,r),t.lineTo(d.x,d.y),t.arcTo(s.x,s.y,n.x,n.y,r),t.closePath()},Ra(t,s){if(t){let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{var t=n.width,e=n.height,{canvas:i,ctx:r}=this.Oa(t,e);i.width=t,i.height=e,r.drawImage(n,0,0,t,e),s&&s(i)},n.src=t}else s(null)},Na(t,i,e,r){var n=r.scale??2;let s=1;var o=void 0!==r.needSize&&r.needSize,a=e.fontsize*n*1.2,h=2*n;let l=0,u=0;var c=(void 0!==e.fontWeight?e.fontWeight:400)+` ${a}px `+this.Da(r.family,e.fontFamily);let f=void 0!==e.space?e.space*n:2*n;var d,v;let p=0;void 0!==e.plateSize&&(p=(e.plateSize-e.fontsize)/2*n),p=Math.max(p,3*n);var m=a/3;let g=0,_=[],b,y;var w=0*n,x=0*n,M=ot.document.createElement("canvas"),E=M.getContext("2d");E.font=c,E.textBaseline="Alphabetic";let L=1.2*e.fontsize*n;void 0!==e.imageSize&&(L=1.2*e.imageSize*n),i&&0!=L||(L=0,f=0);var T=-1<t.indexOf("%rn%");if(T){for(var S of _=t.split("%rn%"))l=Math.max(E.measureText(S).width+h,l),u+=a;u+=_.length*h}else l=E.measureText(t).width+h,u=a+h;if(d=Math.ceil(u)+2*p,v=Math.ceil(l)+2*p,b=2*x+L+f+v,y=2*w+Math.max(d,L),e.plateStrokeColor&&(b+=2*n,y+=2*n),!0===r.onlyNeedSize)return{width:b,height:y};g=T?u/_.length/2+m+w+p:y/2+m,T&&(s=y/(a+2*w+2*p)),M.width=b,M.height=y,M.style.width=b+"px",M.style.height=y+"px",M.spriteScale=s,E.font=c,ot.environment===q.WX&&(E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowBlur=0,E.shadowColor="rgba(0,0,0,0.0)"),E.clearRect(0,0,M.width,M.height),(e.plateColor||e.plateStrokeColor)&&(e.plateColor&&(E.fillStyle=e.plateColor),E.lineWidth=n,this.Ca(E,v,d,5*n,{x:L+x+f,y:y/2-d/2}),e.plateColor&&E.fill(),e.plateStrokeColor&&(E.strokeStyle=e.plateStrokeColor,E.stroke()),E.beginPath()),i&&(m=(y-L)/2,E.drawImage(i,x,m,L,L));var A=L+x+f+p+h/2;E.lineWidth=2*n*(void 0!==e.strokeWidth?e.strokeWidth:1);let O=1;if(void 0!==e.strokeWidth&&(O=parseFloat(e.strokeWidth)),e.strokeColor&&0!==O)if(E.strokeStyle=e.strokeColor,T){let e=g;for(let t=0;t<_.length;t++)t&&(e+=a+h),i?(E.textAlign="left",E.strokeText(_[t],A,e)):r.textAlign===hv.Left?(E.textAlign="left",E.strokeText(_[t],0,e)):r.textAlign===hv.Right?(E.textAlign="right",E.strokeText(_[t],b,e)):(E.textAlign="center",E.strokeText(_[t],b/2,e))}else i?(E.textAlign="left",E.strokeText(t,A,g)):r.textAlign===hv.Left?E.strokeText(t,0,g):r.textAlign===hv.Right?(E.textAlign="right",E.strokeText(t,b,g)):(E.textAlign="center",E.strokeText(t,b/2,g));if(E.fillStyle=e.fillColor,T||!1===r.drawText){if(!1!==r.drawText){let e=g;for(let t=0;t<_.length;t++)t&&(e+=a+h),i?(E.textAlign="left",E.fillText(_[t],A,e)):r.textAlign===hv.Left?(E.textAlign="left",E.fillText(_[t],0,e)):r.textAlign===hv.Right?(E.textAlign="right",E.fillText(_[t],b,e)):(E.textAlign="center",E.fillText(_[t],b/2,e))}}else i?(E.textAlign="left",E.fillText(t,A,g)):r.textAlign===hv.Left?(E.textAlign="left",E.fillText(t,0,g)):r.textAlign===hv.Right?(E.textAlign="right",E.fillText(t,b,g)):(E.textAlign="center",E.fillText(t,b/2,g));let C=0;return o&&(C=T?e.fontsize+(h*(_.length-1)+w+p)/_.length:e.fontsize+w+p,M.size=C),M.drawTextWidth=l,M.drawTextLeft=A,M},ka(t){var e=t.width,i=t.height,r=t.arrowWidth||10,{canvas:n,ctx:s}=this.Oa(e,i),o=(s.fillStyle=t.godEdgeColor,s.fillRect(0,0,e,i),e*(1-t.godEdgePercent));s.fillStyle=t.godColor,s.fillRect((e-o)/2,0,o,i),s.fillStyle="#ffffff",s.shadowOffsetX=-2,s.shadowOffsetY=2,s.shadowBlur=4,s.shadowColor="rgba(0,0,0,0.5)";let a=e/2,h=i/2;var e=i*t.godArrowPercent,i=o*t.godArrowWidthPercent,o=a-i/2,l=h+e/2;return s.beginPath(),s.moveTo(o,l),s.lineTo(o,l+r),s.lineTo(o+i/2,l-e+r),s.lineTo(o+i,l+r),s.lineTo(o+i,l),s.lineTo(o+i/2,l-e),s.closePath(),s.fillStyle=t.godArrowColor,s.fill(),n},Pa(t){var e=t.width,i=t.height,{canvas:r,ctx:n}=this.Oa(e,i),e=(this.Ia(n,e,i),t.height*t.arrowHeightPercent),i=(1-t.arrowHeightPercent)*t.height/2,s=t.width*(t.arrowWidthPercent-t.arrowPercent);return n.beginPath(),n.moveTo(0,i),n.lineTo(s,i),n.lineTo(t.width*t.arrowWidthPercent,i+e/2),n.lineTo(s,i+e),n.lineTo(0,i+e),n.lineTo(t.width*t.arrowPercent,i+e/2),n.closePath(),n.fillStyle=t.color,n.fill(),r},Ia(t,e,i){var r=new N,n=(r.set(Math.cos(Math.PI/2),-Math.sin(Math.PI/2),+e/2,Math.sin(Math.PI/2),Math.cos(Math.PI/2),+i/2,0,0,1),new N),e=(n.set(1,0,-e/2,0,1,-i/2,0,0,1),r.multiply(n),r.elements);t.transform(e[0],e[3],e[1],e[4],e[2],e[6])},Fa(i){var t=i.width,e=i.height,r=i.dashArray;let{canvas:n,ctx:s}=this.Oa(t,e),o=(this.Ia(s,t,e),r.reduce(function(t,e){return t+e})),a=0;r.forEach(function(t,e){e%2==0&&(s.fillStyle=i.color,s.fillRect(a/o*i.width,0,t/o*i.width,i.height)),a+=t});r=this.Oa(e,t);return r.ctx.translate(e/2,t/2),r.ctx.rotate(Math.PI/2),r.ctx.drawImage(n,-t/2,-e/2,t,e),r.canvas},Da(t,e){var i=this.qr.Vt.Ri.fontFamily;return void 0!==t?t+","+i:void 0!==e&&'"Microsoft Yahei","",Tahoma,Arial'===i?e:i},Kt(){}});class uv extends rv{constructor(){super()}}Object.assign(uv.prototype,{ja(t){var e,i=[];for(e in t)i.push(t[e]);return i.join()}});class cv extends uv{constructor(t){super(),this.sa=null,this.Gn=this.Gn.bind(this),this.po=new N0({disposeCallback:this.Gn,enable:!0,name:"TextureManager",mapCreateTime:t.mapCreateTime})}}Object.assign(cv.prototype,{Ga(i,r){let n;if(ot.environment==q.BROWSER)n=new Lc(i);else{let e=r.paramKey;if(n=new f,r.labelImageCatch[e].image)return n.image=r.labelImageCatch[e].image,n.minFilter=Qe,n.generateMipmaps=!1,n.needsUpdate=!0,t=r.labelImageCatch[e].texture,n.scaleRatio=t.scaleRatio,n.mspriteScale=t.mspriteScale,r.needSize&&(n.size=t.size),n.needsUpdate=!0,r&&r.callback&&r.callback(n),n.useCatch=!0,n;r.labelImageCatch[e].texture={scaleRatio:i.height/i.width,mspriteScale:i.spriteScale,size:i.size};var t=i.toDataURL("image/png");ot.textureHelper.createImage({url:t,onload:t=>{n.image=t,n.needsUpdate=!0,r&&r.callback&&r.callback(n),r.labelImageCatch[e].canvas={size:i.size,spriteScale:i.spriteScale,width:i.width,height:i.height},r.labelImageCatch[e].image=t}})}return n.minFilter=Qe,n.generateMipmaps=!1,n.needsUpdate=!0,n},Ua(t){var e=new f;return e.minFilter=Qe,e.generateMipmaps=!1,e.flipY=t.flipY,e},Ha(e,i){void 0===e.flipY&&(e.flipY=!0);let n,s=this.ja(e);if(this.ba.has(s))this.ya.has(s)?this.wa(s,i):i(n=this.ba.get(s));else{n=this.Ua(e),this.ba.set(s,n),this.wa(s,i);let t="_getTexture"+Et.generateUUID();this.po.fo(t),av.Ta(e.url,r=>{n.image=r,n.needsUpdate=!0,this.ya.get(s).forEach((t,e,i)=>{r&&e(n),i.delete(t)}),this.ya.delete(s),this.po.do(t)},{needDraw:e.needDraw})}return n},Ba(t,e){var i=this.Ga(t,e);return i.useCatch||(i.scaleRatio=t.height/t.width,i.mspriteScale=t.spriteScale,e.needSize&&(i.size=t.size)),i},Kt(t){this.sa=t,this.po.co(!0)},Gn(){this.ba.forEach(function(t,e,i){t.dispose(),i.delete(e)}),this.ba.clear(),this.ba=null,this.ya.forEach(function(t,e,i){t.forEach(function(t,e,i){i.delete(e)}),i.delete(e)}),this.ya.clear(),this.ya=null,this.sa&&this.sa({name:"TextureManager"})}});let fv=`
precision mediump float;
precision mediump int;

attribute vec3 position;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
 `,dv=`
precision mediump float;
precision mediump int;

uniform vec3 color;
uniform float alpha;

void main() {
    gl_FragColor = vec4(color,alpha);
}
 `,vv=`
attribute float gradientAlpha;

varying float v_gradientAlpha;

void main() {
  v_gradientAlpha = gradientAlpha;
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
 `,pv=`

uniform vec3 color;
uniform float alpha;

varying float v_gradientAlpha;

void main() {
  gl_FragColor = vec4(color, alpha * v_gradientAlpha);
}
 `;var mv=`
#define LAMBERT

varying vec3 vLightFront;
varying vec3 vIndirectFront;
varying vec2 vUvMask;
varying vec3 v_positionMask;
varying float v_positionHeight;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
 
#include <common>             
#include <uv_pars_vertex>     
#include <bsdfs>              
#include <lights_pars_begin>  
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>    
	vUvMask=uv;
	v_positionMask = vec3(modelMatrix * vec4( position, 1.0 ));
	v_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;
	#include <beginnormal_vertex>    
	#include <morphnormal_vertex>    
	#include <defaultnormal_vertex>  

	#include <begin_vertex>            
	#include <project_vertex>
	#include <logdepthbuf_vertex>   
	#include <clipping_planes_vertex>      
	
	#include <worldpos_vertex>        
	#include <lights_lambert_vertex>  
	#include <fog_vertex>
	
}
`,gv=`
uniform bool mapMixColor;
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

uniform bool isMask;
uniform float maskType;
uniform sampler2D maskTexture;
uniform float maskHeight;
uniform float maskExtrudeHeight;
varying vec2 vUvMask;
varying vec3 v_positionMask;
varying float v_positionHeight;

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif


#include <common>                    
#include <packing>                  
#include <uv_pars_fragment>        
#include <map_pars_fragment>         
#include <bsdfs>                        
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>       
#include <fog_pars_fragment>   
#include <clipping_planes_pars_fragment>

void main() {
	#include <clipping_planes_fragment>
	if(isMask){
		vec4 maskColor=texture2D(maskTexture,vUvMask);
		if(maskType==0.0){
			if(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){
				if(maskExtrudeHeight>0.0){
					if(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
						discard;
					}
				} else {
					discard;
				}
				
			}
		} else {
			if(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){
				if(maskExtrudeHeight>0.0){
					if(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
						discard;
					}
				} else {
					discard;
				}
			}
		}
	}
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

    #include <logdepthbuf_fragment>
	#include <map_fragment_1>     
	  

	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );

	#ifdef DOUBLE_SIDED

		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

	#else

		reflectedLight.indirectDiffuse += vIndirectFront;

	#endif

	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED

		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

	#else

		reflectedLight.directDiffuse = vLightFront;

	#endif

	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );


	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <fog_fragment>  
}
`;J0(Ot),al.fmLambert={uniforms:oo.merge([Ot.fmcommon,Ot.lights,{emissive:{value:new ft(0)},mapMixColor:{value:!1},fogColor:{value:new ft(0)},fogDensity:{value:0},isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1}}]),vertexShader:mv,fragmentShader:gv};let _v=function(t){g.call(this),this.type="FMMeshLambertMaterial",this.uniforms=oo.clone(al.fmLambert.uniforms),this.vertexShader=al.fmLambert.vertexShader,this.fragmentShader=al.fmLambert.fragmentShader,this.lights=!0,this.fog=!0,q0(this),Object.defineProperties(this,{emissive:{enumerable:!0,get:function(){return this.uniforms.emissive.value},set:function(t){this.uniforms.emissive.value=t}},mapMixColor:{enumerable:!0,get:function(){return this.uniforms.mapMixColor.value},set:function(t){this.uniforms.mapMixColor.value=t}}}),this.setValues(t)};_v.prototype=Object.create(g.prototype),_v.prototype.constructor=_v,_v.prototype.isFMMeshLambertMaterial=!0,_v.prototype.copy=function(t){return Z0(this,t)};var bv=`
#include <common> 
#include <uv_pars_vertex> 
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>
varying vec2 vUvMask;
varying vec3 v_positionMask;
varying float v_positionHeight;

void main() {

	#include <uv_vertex> 

	vUvMask=uv;
	v_positionMask = vec3(modelMatrix * vec4( position, 1.0 ));
	v_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;

	#include <begin_vertex>       
	#include <project_vertex>   
	#include <logdepthbuf_vertex>     

	#include <worldpos_vertex>    
	#include <fog_vertex>
}
`,yv=`
uniform vec3 diffuse;
uniform float opacity;

uniform bool isMask;
uniform float maskType;
uniform sampler2D maskTexture;
uniform float maskHeight;
uniform float maskExtrudeHeight;
uniform vec2 boundCenter;
uniform vec2 boundSize;
varying vec2 vUvMask;
varying vec3 v_positionMask;
varying float v_positionHeight;


#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>                
#include <uv_pars_fragment>       
#include <map_pars_fragment>   
#include <logdepthbuf_pars_fragment>       
#include <fog_pars_fragment>     
 

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	if(isMask){
		vec2 uvMesk=vec2((v_positionMask.x -  (boundCenter.x - boundSize.x/2.0)) / boundSize.x , (v_positionMask.z - (boundCenter.y-boundSize.y/2.0)) / boundSize.y);
		vec4 maskColor=texture2D(maskTexture,uvMesk);
		if(maskType==0.0){
			if(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){
				if(maskExtrudeHeight>0.0){
					if(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
						discard;
					}
				} else {
					discard;
				}
				
			}
		} else {
			if(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){
				if(maskExtrudeHeight>0.0){
					if(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
						discard;
					}
				} else {
					discard;
				}
			}
		}
	}

	#include <map_fragment>    
	#include <logdepthbuf_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	#ifdef USE_LIGHTMAP

		reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;

	#else

		reflectedLight.indirectDiffuse += vec3( 1.0 );

	#endif

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <fog_fragment>  
 
}
`;function wv(t){g.call(this),this.type="FMMeshBasicMaterial",this.uniforms=oo.clone(al.fmBasic.uniforms),this.vertexShader=al.fmBasic.vertexShader,this.fragmentShader=al.fmBasic.fragmentShader,q0(this),this.setValues(t)}J0(Ot),al.fmBasic={uniforms:oo.merge([Ot.fmcommon,{isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1},boundCenter:{value:new St(0,0)},boundSize:{value:new St(0,0)}}]),vertexShader:bv,fragmentShader:yv},wv.prototype=Object.create(g.prototype),wv.prototype.constructor=wv,wv.prototype.isFMMeshBasicMaterial=!0,wv.prototype.copy=function(t){return g.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=oo.clone(t.uniforms),this};let xv=`


	#define STANDARD

	#ifdef PHYSICAL
		#define REFLECTIVITY
		#define CLEARCOAT
		#define TRANSPARENCY
	#endif

	varying vec3 v_position;
	varying vec2 vUvMask;
    varying float v_positionHeight;

	uniform bool isRect;
	uniform bool isAnnulus;

	uniform float sweepW;
	uniform float sweepH;
	uniform vec2 se2N;
	uniform vec2 se2RN;
	uniform vec2 moveP;
	uniform vec3 color_r;

	uniform vec2 circleC;
	uniform float maxR;
	uniform float minR;
	uniform vec3 color_a;

	uniform bool isSweepTexture;
	uniform sampler2D sweepTexture;
	uniform float sweepStrength;

	uniform bool isMask;
	uniform float maskType;
	uniform sampler2D maskTexture;
	uniform float maskHeight;
	uniform float maskExtrudeHeight;
	uniform vec2 boundCenter;
	uniform vec2 boundSize;

	bool isInRectW(vec2 v, vec2 a, float w){
		float a1 = abs(dot(v,a));
		return a1 < w;
	}
	bool isInRectH(vec2 v, vec2 a, float h){
		float a1 = abs(dot(v,a));
		return a1 < h;
	}

	bool isMaxCircle(vec3 a, vec2 b, float r){
		float c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);
		return c <= pow(r,2.0);
	}

	bool isMinCircle(vec3 a, vec2 b, float r){
		float c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);
		return c > pow(r,2.0);
	}

	uniform vec3 diffuse;
	uniform vec3 emissive;
	uniform float roughness;
	uniform float metalness;
	uniform float opacity;
	uniform bool isEnable;

	#ifdef TRANSPARENCY
		uniform float transparency;
	#endif

	#ifdef REFLECTIVITY
		uniform float reflectivity;
	#endif

	#ifdef CLEARCOAT
		uniform float clearcoat;
		uniform float clearcoatRoughness;
	#endif

	#ifdef USE_SHEEN
		uniform vec3 sheen;
	#endif

	varying vec3 vViewPosition;

	#ifndef FLAT_SHADED

		varying vec3 vNormal;

		#ifdef USE_TANGENT

			varying vec3 vTangent;
			varying vec3 vBitangent;

		#endif

	#endif

	#include <common>
	#include <packing>
	#include <dithering_pars_fragment>
	#include <color_pars_fragment>
	#include <uv_pars_fragment>
	#include <uv2_pars_fragment>
	#include <map_pars_fragment>
	#include <alphamap_pars_fragment>
	#include <aomap_pars_fragment>
	#include <lightmap_pars_fragment>
	#include <emissivemap_pars_fragment>
	#include <bsdfs>
	#include <cube_uv_reflection_fragment>
	#include <envmap_common_pars_fragment>
	#include <envmap_physical_pars_fragment>
	#include <fog_pars_fragment>
	#include <lights_pars_begin>
	#include <lights_physical_pars_fragment>
	#include <shadowmap_pars_fragment>
	#include <bumpmap_pars_fragment>
	#include <normalmap_pars_fragment>
	#include <clearcoat_pars_fragment>
	#include <roughnessmap_pars_fragment>
	#include <metalnessmap_pars_fragment>
	#include <logdepthbuf_pars_fragment>
	#include <clipping_planes_pars_fragment>

	void main() {
		#include <clipping_planes_fragment>
		if(isMask){
			vec2 uvMesk=vec2((v_position.x -  (boundCenter.x - boundSize.x/2.0)) / boundSize.x , (v_position.z - (boundCenter.y-boundSize.y/2.0)) / boundSize.y);
			vec4 maskColor=texture2D(maskTexture,uvMesk);
			if(maskType==0.0){
				if(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){
					if(maskExtrudeHeight>0.0){
						if(v_position.y >= v_positionHeight + maskHeight && v_position.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
							discard;
						}
					} else {
						discard;
					}
					
				}
			} else {
				if(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){
					if(maskExtrudeHeight>0.0){
						if(v_position.y >= v_positionHeight + maskHeight && v_position.y <= v_positionHeight + maskHeight+maskExtrudeHeight){
							discard;
						}
					} else {
						discard;
					}
				}
			}
		}


		vec4 diffuseColor = vec4( diffuse, opacity );
		ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
		vec3 totalEmissiveRadiance = emissive;

		#include <logdepthbuf_fragment>
		#include <map_fragment>
		#include <color_fragment>
		#include <alphamap_fragment>
		#include <alphatest_fragment>
		#include <roughnessmap_fragment>
		#include <metalnessmap_fragment>
		#include <normal_fragment_begin>
		#include <normal_fragment_maps>
		#include <clearcoat_normal_fragment_begin>
		#include <clearcoat_normal_fragment_maps>
		#include <emissivemap_fragment>

		// accumulation
		#include <lights_physical_fragment>
		#include <lights_fragment_begin>
		#include <lights_fragment_maps>
		#include <lights_fragment_end>

		// modulation
		#include <aomap_fragment>

		vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

		// this is a stub for the transparency model
		#ifdef TRANSPARENCY
			diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
		#endif

		gl_FragColor = vec4( outgoingLight, diffuseColor.a );

		if(isRect&&isEnable){

			vec2 v = vec2(v_position.x - moveP.x, v_position.z - moveP.y);
			if(isInRectW(v,se2N,sweepW) && isInRectH(v,se2RN,sweepH)){
				gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);
			}
		}
		if(isAnnulus&&isEnable){
			if(isMaxCircle(v_position.xyz,circleC,maxR) && isMinCircle(v_position.xyz,circleC,minR)){
				if(isSweepTexture){
					vec2 uv = vec2((v_position.x-(circleC.x-maxR))/(2.0*maxR),(v_position.z-(circleC.y-maxR))/(2.0*maxR));
					vec4 tex = texture2D( sweepTexture, uv );
					tex = mapTexelToLinear( tex );
					float d2 = pow(v_position.x-circleC.x,2.0) + pow(v_position.z-circleC.y,2.0);
					float a = smoothstep(0.0, pow(maxR,2.0), d2);
					a = 1.0 - a;
					tex.a = a;
					gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*tex.rgb, 0.2),gl_FragColor.a);
				} else {
					gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);
				}
			}

		}

		#include <tonemapping_fragment>
		#include <encodings_fragment>
		#include <fog_fragment>
		#include <premultiplied_alpha_fragment>
		#include <dithering_fragment>
	}
`,Mv=`
    #define STANDARD
    
    varying vec3 vViewPosition;
    varying vec3 v_position;

    varying float v_positionHeight;
    
    #ifndef FLAT_SHADED

        varying vec3 vNormal;
    
        #ifdef USE_TANGENT
    
            varying vec3 vTangent;
            varying vec3 vBitangent;
    
        #endif
    
    #endif
    
    #include <common>
    #include <uv_pars_vertex>
    #include <uv2_pars_vertex>
    #include <displacementmap_pars_vertex>
    #include <color_pars_vertex>
    #include <fog_pars_vertex>
    #include <morphtarget_pars_vertex>
    #include <skinning_pars_vertex>
    #include <shadowmap_pars_vertex>
    #include <logdepthbuf_pars_vertex>
    #include <clipping_planes_pars_vertex>

    void main() {
      	#include <uv_vertex>
        #include <uv2_vertex>
        #include <color_vertex>
    
        #include <beginnormal_vertex>
        #include <morphnormal_vertex>
        #include <skinbase_vertex>
        #include <skinnormal_vertex>
        #include <defaultnormal_vertex>
        
        #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED
        
            vNormal = normalize( transformedNormal );
        
            #ifdef USE_TANGENT
        
                vTangent = normalize( transformedTangent );
                vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
        
            #endif
        
        #endif
        
        #include <begin_vertex>
        #include <morphtarget_vertex>
        #include <skinning_vertex>
        #include <displacementmap_vertex>
        #include <project_vertex>
        #include <logdepthbuf_vertex>
        #include <clipping_planes_vertex>
    
        vViewPosition = - mvPosition.xyz;
    
        vec4 pos = vec4(position, 1.0);
        v_position = vec3(modelMatrix * vec4( position, 1.0 ));

        v_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;
    
        #include <worldpos_vertex>
        #include <shadowmap_vertex>
        #include <fog_vertex>
    }
 `,Ev=oo.merge([{sweepW:{value:0},sweepH:{value:0},se2N:{value:new St(0,0)},se2RN:{value:new St(0,0)},moveP:{value:new St(0,0)},color_r:{value:new ft(16711935)},color_a:{value:new ft(16776960)},isRect:{value:!1},isAnnulus:{value:!1},isEnable:{value:!1},circleC:{value:new St(0,0)},maxR:{value:0},minR:{value:0},isSweepTexture:{value:!1},sweepTexture:{value:null},sweepStrength:{value:1},isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1},boundCenter:{value:new St(0,0)},boundSize:{value:new St(0,0)}},al.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new St(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ft(0)},transparency:{value:0}}]);class Lv extends g{constructor(){super(),this.type="FMMeshStandardMaterial",this.uniforms=oo.clone(Ev),this.vertexShader=Mv,this.fragmentShader=xv,this.lights=!0,this.fog=!0}copy(t){return Z0(this,t)}}Lv.prototype.isFMMeshStandardMaterial=!0;class Tv{static setPixel({x:t,y:e,color:i,d:r,width:n}){r[4*(e*n+t)+0]=i[0],r[4*(e*n+t)+1]=i[1],r[4*(e*n+t)+2]=i[2],r[4*(e*n+t)+3]=i[3]}static getPowerOfTwoSizeCanvas(t){var e=Et.floorPowerOfTwo(t.width),i=Et.floorPowerOfTwo(t.height),r=ot.document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,e,i),r}static sizeCanvas(t,e,i){var r=ot.document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=(r.width=e,r.height=i,r.getContext("2d")),i=r.width/2,n=r.height/2,s=Math.min(r.width/t.width,r.height/t.height),o=t.width*s,s=t.height*s,i=i-o/2,n=n-s/2;return e.clearRect(0,0,r.width,r.height),e.drawImage(t,0,0,t.width,t.height,i,n,o,s),r}}class Sv{constructor(t){this.Vt=t,this.za=new lv(this),this.Va=new cv({mapCreateTime:this.Vt.R.Wa}),this.Ya={},this.Xa=new Map,this.Za=new Map,this.qa=new Map,this.Ja=new Map,this.Ka=new Map,this.Qa=new Map,this.$a={},this.th={},this.sa=null,this.Gn=this.Gn.bind(this),this.po=new N0({disposeCallback:this.Gn,enable:!0,name:"MaterialManager",mapCreateTime:this.Vt.R.Wa}),this.eh=null,this.ih={},this.rh()}get lamberMaterials(){return this.Za}getMaterialCacheKey(t){return this.nh(t)}regHook(t,e){this.ih[t]||(this.ih[t]=[]),this.ih[t].push(e)}callHook(t,...e){t=this.ih[t];t&&t.forEach(t=>t(...e))}}Object.assign(Sv.prototype,{sh(t,e){this.$a[e.uuid]||(this.$a[e.uuid]=[]),this.$a[e.uuid].push(t.uuid)},oh(t,r){t=this.$a[r.uuid]?.indexOf(t.uuid);if(void 0!==t&&(-1!==t&&this.$a[r.uuid].splice(t,1),0===this.$a[r.uuid].length)){let i=[];if(r instanceof Lv){this.Ka.forEach((t,e)=>{t.uuid===r.uuid&&i.push(e)});for(let t=0;t<i.length;t++)this.Ka.delete(i[t])}delete this.$a[r.uuid]}},nh(t){var e,i=[];for(e in t)t[e]?t[e].constructor===f?i.push(t[e].uuid):t[e].constructor===St?(i.push(t[e].x),i.push(t[e].y)):i.push(t[e]):i.push(t[e]);return i.join()},ah(t,e){var i=this.nh(t);return this.Xa.has(i)||(t=this.hh(t,e),this.Xa.set(i,t)),this.Xa.get(i)},lh(e,i,r){void 0!==e.url&&this.Va.Ha({url:e.url,flipY:e.flipY},function(t){t.image&&(i.map=t,i.needsUpdate=!0),e.finish&&e.finish(i),r&&r()})},hh(t,e){var i;return t.isline?new ev({color:t.color,linewidth:1,transparent:!0,opacity:t.opacity}):(i=new wv,void 0!==t.color&&(i.color=new ft(t.color)),void 0!==t.opacity&&(i.opacity=t.opacity),this.lh(t,i,e),e=void 0!==t.needDepth&&t.needDepth,i.transparent=!0,i.depthTest=e,i.depthWrite=e,i)},uh(t){var e=this.nh(t);return this.Za.has(e)||(t=this.fh(t),this.Za.set(e,t)),this.Za.get(e)},Zr(t){var e=this.nh(t);return this.Ka.has(e)||(t=this.dh(t),this.Ka.set(e,t)),this.Ka.get(e)},dh(t){var e=new Lv;return e.defines.USE_UV=!0,e.uniforms.diffuse.value=new ft(t.color),e.uniforms.emissive.value=new ft(t.emissive),e.defines.USE_METALNESSMAP=t.USE_METALNESSMAP,e.defines.USE_ROUGHNESSMAP=t.USE_ROUGHNESSMAP,e.uniforms.metalness.value=t.metalness,e.uniforms.metalnessMap.value=t.metalnessMap,e.uniforms.roughness.value=t.roughness,e.uniforms.roughnessMap.value=t.roughnessMap,e.defines.USE_NORMALMAP=t.USE_NORMALMAP,e.defines.TANGENTSPACE_NORMALMAP=t.TANGENTSPACE_NORMALMAP,e.uniforms.normalScale.value=t.normalScale,e.uniforms.normalMap.value=t.normalMap,e.defines.USE_EMISSIVEMAP=t.USE_EMISSIVEMAP,e.uniforms.emissiveMap.value=t.emissiveMap,e.defines.USE_MAP=t.USE_MAP,e.uniforms.map.value=t.map,t.aoMap&&(e.defines.USE_AOMAP=!0,e.uniforms.aoMap.value=t.aoMap),e.alphaTest=t.alphaTest,e.transparent=t.transparent,e.uniforms.opacity.value=t.opacity,e.skinning=t.skinning,e.side=t.side,e.vertexColors=t.vertexColors,this.eh&&(e.uniforms.envMap.value=this.eh,e.envMap=this.eh),e.needsUpdate=!0,e},Jr(t,e){(e=e||{}).uuid=t.uuid;var i=this.nh(e);return this.Qa.has(i)||(t=t.clone(),e.color&&(t.color=new ft(e.color)),e.opacity&&(t.opacity=e.opacity),e.transparent&&(t.transparent=e.transparent),this.Qa.set(i,t)),this.Qa.get(i)},fh(t){var e=new _v;return e.color=new ft(t.color),e.opacity=t.alpha,e.transparent=e.opacity<1,this.lh(t,e),e},ph(t){var e=void 0===t.needDepth||t.needDepth,t=new Q0({color:t.color,opacity:t.opacity,lineWidth:t.lineWidth,vertexColors:$0,dashed:!1,transparent:!0,gradient:t.gradient}),e=(t.depthWrite=e,t.depthTest=e,this.Vt.R);return ot.environment===q.BROWSER?t.resolution.set(e.A.renderer.domElement.clientWidth,e.A.renderer.domElement.clientHeight):t.resolution.set(e.A.renderer.domElement.width,e.A.renderer.domElement.height),t},mh(t){var e=this.nh(t);return this.qa.has(e)||(t=this.ph(t),this.qa.set(e,t)),this.qa.get(e)},gh(t,e,i){var r=new tv,t=(r.sizeAttenuation=!1,r.depthTest=!1,r.depthWrite=!1,r.transparent=!0,r.opacity=i.opacity,r.side=Kt,this._h(t,null,e,i));return r.map=t,i.needSize&&(r.size=t.size),r.userData.scaleRatio=t.scaleRatio,r.userData.mspriteScale=t.mspriteScale,r.needsUpdate=!0,r},bh(r,n,s,o){let a=new tv;if(a.sizeAttenuation=!1,a.depthTest=!1,a.depthWrite=!1,a.opacity=s.opacity,a.transparent=!0,s.imageUrl){a.visible=!1;let e="_createLabelMaterial"+Et.generateUUID(),i=(this.po.fo(e),this);av.Ta(s.imageUrl,t=>{t=this._h(r,t,n,{...s,callback:t=>{a.map=t,a.visible=!0,a.userData.scaleRatio=t.scaleRatio,a.userData.mspriteScale=t.mspriteScale,o&&o(a),a.needsUpdate=!0}});ot.environment===q.BROWSER&&(a.map=t,a.visible=!0,a.needsUpdate=!0,a.userData.scaleRatio=t.scaleRatio,a.userData.mspriteScale=t.mspriteScale,o)&&o(a),i.po.do(e)},{needDraw:!0})}else{var t=this._h(r,null,n,{...s,callback:t=>{a.map=t,a.needsUpdate=!0,a.userData.scaleRatio=t.scaleRatio,a.userData.mspriteScale=t.mspriteScale,o&&o(a),a.visible=!0}});ot.environment===q.BROWSER?(a.map=t,a.needsUpdate=!0,a.userData.scaleRatio=t.scaleRatio,a.userData.mspriteScale=t.mspriteScale,o&&o(a)):a.map||(a.visible=!1)}return a},yh(t,e,i){return this.wh(t,i.imageUrl,e,i)},xh(r,n,s,o){let a=new wo({transparent:!0});if(s.imageUrl){a.visible=!1;let e="_createLabelTopMaterial"+Et.generateUUID(),i=(this.po.fo(e),this);av.Ta(s.imageUrl,t=>{t=this._h(r,t,n,{...s,scale:s.scale,callback:t=>{a.map=t,a.visible=!0,o&&o(a),a.needsUpdate=!0}});ot.environment===q.BROWSER&&(a.map=t,a.visible=!0,a.needsUpdate=!0,o)&&o(a),i.po.do(e)},{needDraw:!0})}else{var t=this._h(r,null,n,{...s,scale:s.scale,callback:t=>{t.magFilter=Qe,t.minFilter=ei,a.map=t,a.needsUpdate=!0,o&&o(a),a.visible=!0}});ot.environment===q.BROWSER?(a.map=t,a.needsUpdate=!0,o&&o(a)):a.map||(a.visible=!1)}return a},_h(t,e,i,r){var n=this.Mh(t,i);this.th[n]||(this.th[n]={});let s;return s=this.th[n].canvas||this.za.Na(t,e,i,r),this.Va?.Ba(s,{paramKey:n,labelImageCatch:this.th,needSize:r.needSize,callback:r.callback})},wh(t,e,i,r){return this.za.Na(t,e,i,r)},Mh(t,e){var{alpha:e,fontsize:i,fillColor:r,image:n}=e;return[t,e,i,r,n].join()},Eh(t,e){var i=this.nh(t);return this.Ja.has(i)||(t=this.Lh(t,e),this.Ja.set(i,t)),e&&e(this.Ja.get(i)),this.Ja.get(i)},Lh(t,e){var i=void 0!==t.opacity?t.opacity:1;let r=new tv;return r.sizeAttenuation=!1,r.depthTest=t.needDepth,r.depthWrite=t.needDepth,r.transparent=!0,r.opacity=i,r.visible=!1,this.Va.Ha({url:t.url},function(t){t.image&&(r.map=t,r.needsUpdate=!0,r.visible=!0,r.userData.scaleRatio=t.image.width/t.image.height),e&&e(r)}),r},createArrowWidthBackTexture(i){var t=this.za.ka(i);if(ot.environment===q.BROWSER)return(r=new Lc(Tv.getPowerOfTwoSizeCanvas(t))).rotation=-Math.PI/2,r.updateMatrix(),r;{var r=t.toDataURL("image/png");let e=new f;return ot.textureHelper.createImage({url:r,onload:t=>{e.image=t,e.needsUpdate=!0,e.rotation=-Math.PI/2,e.updateMatrix(),i.callback&&i.callback()}}),e}},createNormalLineTexture(i){var t=this.za.Fa(i);if(ot.environment===q.BROWSER)return new Lc(Tv.getPowerOfTwoSizeCanvas(t));{t=t.toDataURL("image/png");let e=new f;return ot.textureHelper.createImage({url:t,onload:t=>{e.image=t,e.needsUpdate=!0,i.callback&&i.callback()}}),e}},Th(i){var t=this.za.Pa(i);if(ot.environment===q.BROWSER)return new Lc(Tv.getPowerOfTwoSizeCanvas(t));{t=t.toDataURL("image/png");let e=new f;return ot.textureHelper.createImage({url:t,onload:t=>{e.image=t,e.needsUpdate=!0,i.callback&&i.callback()}}),e}},Sh(t,e){var i;return this.Ya[t+e]||((i=new iv({uniforms:{color:{value:new ft(t)},alpha:{value:e}},vertexShader:fv,fragmentShader:dv})).transparent=!0,this.Ya[t+e]=i)},Ah(t,e){t=new g({uniforms:{color:{value:new ft(t)},alpha:{value:e}},vertexShader:vv,fragmentShader:pv});return t.depthTest=!0,t.depthWrite=!1,t.transparent=!0,t},Oh(t,e,i={}){let r=new f,n=(r.minFilter=i.generateMipmaps?ei:Qe,r.generateMipmaps=!!i.generateMipmaps,r.anisotropy=4,r.wrapS=Ye,r.wrapT=Ye,"_loadTexture"+Et.generateUUID()),s=(this.po.fo(n),this);return av.Ta(t,function(t){t&&(r.image=t,r.needsUpdate=!0),e(r),s.po.do(n)}),r},Kt(t){this.sa=t,this.Va.Kt(()=>{this.Va=null,this.po.co(!0)}),this.th={}},Gn(){av.xa(),this.za.Kt(),this.za=null,this.Xa.clear(),this.Za.clear(),this.qa.clear(),this.Ja.clear(),this.sa&&this.sa({name:"MaterialManager"})},rh(){this.Vt.R.Ri.hdr&&this.Vt.R.Ri.hdr.load(this.Vt.R,t=>{this.eh=t;for(var[e,i]of this.Ka)i.envMap||(i.uniforms.envMap.value=this.eh,i.envMap=this.eh)})}});class Av{constructor(){this.Ch={clearColor:16777215,clearAlpha:1,alphaTest:null},this.Rh=null,this.Nh=new Map,this.Dh=new Map,this.kh=new Map,this.Ph=new Map,this.Ih=new Map,this.Fh=new Map,this.jh=new Map,this.Gh=new Map,this.Uh=new Map,this.Hh=new Map,this.Bh=new Map,this.zh=new Map,this.Vh=new Map,this.Wh=null}resize(){this.Ch={clearColor:16777215,clearAlpha:1,alphaTest:null},this.Nh.clear(),this.Dh.clear(),this.kh.clear(),this.Ph.clear(),this.Ih.clear(),this.Fh.clear(),this.jh.clear(),this.Gh.clear(),this.Uh.clear(),this.Hh.clear(),this.Bh.clear(),this.zh.clear(),this.Vh.clear()}}Object.assign(Av.prototype,{Yh(e,t,i){for(var r in t)e[r]=t[r];if(i)for(var n in i){let t=e[n];if(t){if(i[n].type)switch(i[n].type){case"toColor":t=tn.toColor(t);break;case"toFloat":t=parseFloat(t);break;case"toRgba":t=tn.toRgba(t);break;case"toString":t+=""}i[n].name?(e[i[n].name]=t,delete e[n]):e[n]=t}}return e},Xh(t){this.resize(),t&&(this.sysPath=t.sysPath,this.userPath=t.userPath,this.logoPath=t.logoPath,this.sysModelPath=t.sysModelPath,this.userModelPath=t.userModelPath,this.Zh(t),this.qh(t.extenttheme,p.EXTENT),this.qh(t.storetheme,p.MODEL),this.Jh(t.floorapply,p.MODEL),this.Kh(t.storeapply,p.MODEL),this.qh(t.storelabeltheme,p.LABEL),this.Jh(t.floorstorelabelapply,p.LABEL),this.Kh(t.storelabelapply,p.LABEL),this.qh(t.poiimagetheme,p.FACILITY),this.Jh(t.floorpoiimageapply,p.FACILITY),this.Kh(t.poiimageapply,p.FACILITY),this.qh(t.externalmodeltheme,p.EXTERNAL_MODEL),this.Jh(t.floorexternalapply,p.EXTERNAL_MODEL),this.Kh(t.externalmodelapply,p.EXTERNAL_MODEL),this.Qh())},Zh(t){t.viewtheme&&((t=t.viewtheme).clearcolor&&(this.Ch.clearColor=tn.toColor(t.clearcolor)),t.clearalpha&&(this.Ch.clearAlpha=parseFloat(t.clearalpha)),t.lighttheme&&(this.Rh=t.lighttheme),null!=t.alphatest)&&(this.Ch.alphaTest=t.alphatest)},qh:function(t,e){if(t)for(var i of t)if(i.id)switch(e){case p.EXTERNAL_MODEL:this.Bh.set(i.id,this.Yh({},i,{color:{type:"toColor"}}));break;case p.FACILITY:i.imagename&&this.Gh.set(i.id,this.Yh({},i,{imagename:{name:"imageName"}}));break;case p.LABEL:this.Ih.set(i.id,this.Yh({},i,{alpha:{type:"toFloat"},fillcolor:{name:"fillColor",type:"toRgba"},strokecolor:{name:"strokeColor",type:"toRgba"},platesize:{name:"plateSize"},platestrokecolor:{name:"plateStrokeColor",type:"toRgba"},platecolor:{name:"plateColor",type:"toRgba"},strokewidth:{name:"strokeWidth",type:"toFloat"},space:{type:"toFloat"},fontfamily:{name:"fontFamily"},fontweight:{name:"fontWeight",type:"toFloat"},imagesize:{name:"imageSize",type:"toFloat"}}));break;case p.MODEL:this.Nh.set(i.id,this.Yh({},i,{color:{type:"toColor"},alpha:{type:"toFloat"},strokecolor:{name:"strokeColor",type:"toColor"},strokewidth:{name:"strokeWidth",type:"toFloat"}}));break;case p.EXTENT:this.Ph.set(i.id,this.Yh({},i,{color:{type:"toColor"},alpha:{type:"toFloat"}}))}},Jh:function(t,e){if(t)for(var i of t)for(var r of i.typeapply){var n,s=this.Yh({},r,{normalid:{name:"normalID",type:"toString"},selectedid:{name:"selectID",type:"toString"}});for(n of r.type.split(","))this.$h(e).set(n,s)}},Kh:function(t,e){if(t)for(var i of t)if(i.fids){var r,n=this.Yh({},i,{normalid:{name:"normalID",type:"toString"},selectedid:{name:"selectID",type:"toString"}});for(r of i.fids.split(","))this.tl(e).set(r,n)}},Qh(){this.Dh.get("0")&&this.Nh.get(this.Dh.get("0").selectID)&&(this.Wh=this.Nh.get(this.Dh.get("0").selectID).color)},tl:function(t){switch(t){case p.LABEL:return this.jh;case p.FACILITY:return this.Hh;case p.MODEL:return this.kh;case p.EXTERNAL_MODEL:return this.Vh}},$h:function(t){switch(t){case p.LABEL:return this.Fh;case p.FACILITY:return this.Uh;case p.MODEL:return this.Dh;case p.EXTERNAL_MODEL:return this.zh}},el:function(t){switch(t){case p.LABEL:return this.Ih;case p.FACILITY:return this.Gh;case p.MODEL:return this.Nh;case p.EXTERNAL_MODEL:return this.Bh}},Kt(){for(var t in this.resize(),this)this[""+t]=null,delete this[""+t]}});class Ov{constructor(t){this.Vt=t}}function Cv(t,e,i){var r=this,n=!1,s=0,o=0,a=void 0,h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.record=new Map,this.itemStart=function(t){this.record.has(t)||this.record.set(t,{}),o++,!1===n&&void 0!==r.onStart&&r.onStart(t,s,o),n=!0},this.itemEnd=function(t){this.record.delete(t),s++,void 0!==r.onProgress&&r.onProgress(t,s,o),s===o&&(n=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(t){this.record.delete(t),void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){t=h.indexOf(t);return-1!==t&&h.splice(t,2),this},this.getHandler=function(t){for(var e=0,i=h.length;e<i;e+=2){var r=h[e],n=h[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return n}return null},this.isLoaded=function(){return 0===this.record.size}}Object.assign(Ov.prototype,{il(t){var t=this.Vt.rl.get(t),e=this.Vt.rl.get(this.Vt.Ri.buildingID);let i={};return(i=t?{theme:t.theme,themeExtension:t.themeExtension}:i).theme||(i.theme=e.theme),i.themeExtension||(i.themeExtension=e.themeExtension),i},nl(t){t=this.il(t);return Object.assign({},t.theme.Ch,t.themeExtension.Ch)},sl(t){t=this.il(t);return Object.assign({},t.theme.Ph.get("0"),t.themeExtension.Ph.get("0"))},ol(t){return this.al(p.MODEL,t)},hl(t){return this.al(p.FACILITY,t)},ll(t){return this.al(p.LABEL,t)},ul(t){return this.al(p.EXTERNAL_MODEL,t)},al(t,e){var i=this.il(e.bid);let r,n;var s={},o={},a=i.themeExtension.tl(t).get(e.fid),h=i.theme.tl(t).get(e.fid);if(a||h){var l=(a&&void 0!==a.normalID?a:h).normalID;if(r=i.themeExtension.el(t).get(l),n=i.theme.el(t).get(l),r||n)return o.themeUseDetail={content:e.fid,name:"fid",isExtension:!!a},Object.assign(o,n,r,h,a)}return a=i.themeExtension.$h(t).get(e.typeID),h=i.theme.$h(t).get(e.typeID),(a||h)&&(o.themeUseDetail={content:e.typeID,name:"typeId",isExtension:!!a},Object.assign(s,h,a)),s.normalID||(a=i.themeExtension.$h(t).get("0"),h=i.theme.$h(t).get("0"),Object.assign(s,a,h)),r=i.themeExtension.el(t).get(s.normalID),n=i.theme.el(t).get(s.normalID),Object.assign(o,n,r)},cl(t){t=this.il(t);let e=t.themeExtension.Wh;return e=e||t.theme.Wh},Kt(){this.Vt=null},fl(t){let h=t.Ri.buildingOptions,l=h.buildings||h.theme,u=null,c=()=>{var e=t.getBuildings(),i=e.map(t=>t.Ht);if(!1===t.dl)u=setTimeout(c,1);else{null!==u&&clearTimeout(u);var r=[];if(l)for(let t=0;t<h.buildings.length;t++){var n,s=h.buildings[t],o=s.buildingID;i.includes(o)&&(n=this.Vt.P.Ut(o),this.Vt.rl.set(o,{theme:new Av}),n.themeLoaded=!0,n.themeNeedLoad=!1,this.Vt.vl({bid:o,theme:s.theme||h.theme,themeExtension:s.themeExtension||h.themeExtension}),r.push(o))}if(r.length!==e.length)for(let t=0;t<e.length;t++){var a=e[t].buildingID;r.includes(a)||((a=this.Vt.P.Ut(a)).themeLoaded=!0,a.themeNeedLoad=!1)}this.Vt.P.pl=this.Vt.ml()}};c()}});var Rv=new Cv,Nv={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}},Dv={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function kv(t){op.call(this,t)}function Pv(t){op.call(this,t)}function Iv(t){K.call(this),this.type="ShadowMaterial",this.color=new ft(0),this.transparent=!0,this.setValues(t)}function Fv(t){K.call(this),this.type="PointsMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function jv(t){K.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ft(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function Gv(t){jv.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new St(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Uv(t){K.call(this),this.type="MeshPhongMaterial",this.color=new ft(16777215),this.specular=new ft(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Hv(t){K.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ft(16777215),this.specular=new ft(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Bv(t){K.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function zv(t){K.call(this),this.type="MeshLambertMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Vv(t){K.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ft(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Wv(t){ev.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}kv.prototype=Object.assign(Object.create(op.prototype),{constructor:kv,load:function(r,n,t,e){void 0!==this.path&&(r=this.path+r),r=this.manager.resolveURL(r);var s=this,i=Dv.get(r);if(void 0!==i)return s.manager.itemStart(r),setTimeout(function(){n&&n(i),s.manager.itemEnd(r)},0),i;if(ot.environment===q.WX){let t;if(r.includes(wx.env.USER_DATA_PATH)){let i=wx.getFileSystemManager();i.readFile({filePath:r,encoding:"base64",success:t=>{t="data:image/png;base64,"+t.data;let e=ot.textureHelper.createImage({url:t,onload:()=>{Dv.add(r,e),n&&n(e),s.manager.itemEnd(r),i.unlink({filePath:r,fail(t){},success:()=>{}})}})},fail:t=>{console.error(t),e&&e(t),s.manager.itemError(r),s.manager.itemEnd(r)}})}else t=ot.textureHelper.createImage({url:r,onload:()=>{Dv.add(r,t),n&&n(t),s.manager.itemEnd(r)},onerror:t=>{console.error(t),e&&e(t),s.manager.itemError(r),s.manager.itemEnd(r)}});return t}var o=ot.document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1),Dv.add(r,this),n&&n(this),s.manager.itemEnd(r)}function h(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1),e&&e(t),s.manager.itemError(r),s.manager.itemEnd(r)}return o.addEventListener("load",a,!1),o.addEventListener("error",h,!1),"data:"!==r.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(r),o.src=r,o}}),Pv.prototype=Object.assign(Object.create(op.prototype),{constructor:Pv,load:function(e,i,t,r){var n=new f,s=new kv(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(t){n.image=t;t=0<e.search(/\.jpe?g($|\?)/i)||0===e.search(/^data\:image\/jpeg/);n.format=t?pi:mi,n.needsUpdate=!0,void 0!==i&&i(n)},t,r),n}}),Iv.prototype=Object.create(K.prototype),Iv.prototype.constructor=Iv,Iv.prototype.isShadowMaterial=!0,Iv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this},Fv.prototype=Object.create(K.prototype),Fv.prototype.constructor=Fv,Fv.prototype.isPointsMaterial=!0,Fv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},jv.prototype=Object.create(K.prototype),jv.prototype.constructor=jv,jv.prototype.isMeshStandardMaterial=!0,jv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},Gv.prototype=Object.create(jv.prototype),Gv.prototype.constructor=Gv,Gv.prototype.isMeshPhysicalMaterial=!0,Gv.prototype.copy=function(t){return jv.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,this.sheen=t.sheen?(this.sheen||new ft).copy(t.sheen):null,this.transparency=t.transparency,this},Uv.prototype=Object.create(K.prototype),Uv.prototype.constructor=Uv,Uv.prototype.isMeshPhongMaterial=!0,Uv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Hv.prototype=Object.create(K.prototype),Hv.prototype.constructor=Hv,Hv.prototype.isMeshToonMaterial=!0,Hv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Bv.prototype=Object.create(K.prototype),Bv.prototype.constructor=Bv,Bv.prototype.isMeshNormalMaterial=!0,Bv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},zv.prototype=Object.create(K.prototype),zv.prototype.constructor=zv,zv.prototype.isMeshLambertMaterial=!0,zv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Vv.prototype=Object.create(K.prototype),Vv.prototype.constructor=Vv,Vv.prototype.isMeshMatcapMaterial=!0,Vv.prototype.copy=function(t){return K.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Wv.prototype=Object.create(ev.prototype),Wv.prototype.constructor=Wv,Wv.prototype.isLineDashedMaterial=!0,Wv.prototype.copy=function(t){return ev.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Yv=Object.freeze({__proto__:null,ShadowMaterial:Iv,SpriteMaterial:tv,RawShaderMaterial:iv,ShaderMaterial:g,PointsMaterial:Fv,MeshPhysicalMaterial:Gv,MeshStandardMaterial:jv,MeshPhongMaterial:Uv,MeshToonMaterial:Hv,MeshNormalMaterial:Bv,MeshLambertMaterial:zv,MeshDepthMaterial:ac,MeshDistanceMaterial:hc,MeshBasicMaterial:wo,MeshMatcapMaterial:Vv,LineDashedMaterial:Wv,LineBasicMaterial:ev,Material:K});function Xv(t){op.call(this,t),this.textures={}}Xv.prototype=Object.assign(Object.create(op.prototype),{constructor:Xv,load:function(t,e,i,r){var n=this,s=new hp(n.manager);s.setPath(n.path),s.load(t,function(t){e(n.parse(JSON.parse(t)))},i,r)},parse:function(t){var e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var r,n=new Yv[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new ft).setHex(t.sheen)),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.vertexTangents&&(n.vertexTangents=t.vertexTangents),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=0<t.vertexColors:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var s in t.uniforms){var o=t.uniforms[s];switch(n.uniforms[s]={},o.type){case"t":n.uniforms[s].value=i(o.value);break;case"c":n.uniforms[s].value=(new ft).setHex(o.value);break;case"v2":n.uniforms[s].value=(new St).fromArray(o.value);break;case"v3":n.uniforms[s].value=(new Lt).fromArray(o.value);break;case"v4":n.uniforms[s].value=(new At).fromArray(o.value);break;case"m3":n.uniforms[s].value=(new N).fromArray(o.value);case"m4":n.uniforms[s].value=(new Tt).fromArray(o.value);break;default:n.uniforms[s].value=o.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)n.extensions[a]=t.extensions[a];return void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale&&(r=t.normalScale,!1===Array.isArray(r)&&(r=[r,r]),n.normalScale=(new St).fromArray(r)),void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new St).fromArray(t.clearcoatNormalScale)),n},setTextures:function(t){return this.textures=t,this}});var Zv=0,qv=1,Jv=2,Kv=3,Qv=4,$v=5,tp=1e3,ep=1002,ip=1,rp=2,np=1,sp=2;function op(t){this.manager=void 0!==t?t:Rv,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(op.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}}),Object.assign(op.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,i){for(var r=[],n=0;n<t.length;++n)r[n]=this.createMaterial(t[n],e,i);return r},createMaterial:(()=>{var s={NoBlending:Zv,NormalBlending:qv,AdditiveBlending:Jv,SubtractiveBlending:Kv,MultiplyBlending:Qv,CustomBlending:$v},l=new ft,u=new Pv,c=new Xv;return function(t,o,a){var h={};function e(t,e,i,r,n){var t=o+t,s=(new Cv).getHandler(t),s=(null!==s?s:(u.setCrossOrigin(a),u)).load(t),t=(void 0!==e&&(s.repeat.fromArray(e),1!==e[0]&&(s.wrapS=tp),1!==e[1])&&(s.wrapT=tp),void 0!==i&&s.offset.fromArray(i),void 0!==r&&("repeat"===r[0]&&(s.wrapS=tp),"mirror"===r[0]&&(s.wrapS=ep),"repeat"===r[1]&&(s.wrapT=tp),"mirror"===r[1])&&(s.wrapT=ep),void 0!==n&&(s.anisotropy=n),Et.generateUUID());return h[t]=s,t}var i,r={uuid:Et.generateUUID(),type:"MeshLambertMaterial"};for(i in t){var n=t[i];switch(i){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":r.name=n;break;case"blending":r.blending=s[n];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":r.color=l.fromArray(n).getHex();break;case"colorSpecular":r.specular=l.fromArray(n).getHex();break;case"colorEmissive":r.emissive=l.fromArray(n).getHex();break;case"specularCoef":r.shininess=n;break;case"shading":"basic"===n.toLowerCase()&&(r.type="MeshBasicMaterial"),"phong"===n.toLowerCase()&&(r.type="MeshPhongMaterial"),"standard"===n.toLowerCase()&&(r.type="MeshStandardMaterial");break;case"mapDiffuse":r.map=e(n,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":r.emissiveMap=e(n,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":r.lightMap=e(n,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":r.aoMap=e(n,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":r.bumpMap=e(n,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":r.bumpScale=n;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":r.normalMap=e(n,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":r.normalScale=n;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":r.specularMap=e(n,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":r.metalnessMap=e(n,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":r.roughnessMap=e(n,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":r.alphaMap=e(n,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":r.side=ip;break;case"doubleSided":r.side=rp;break;case"transparency":r.opacity=n;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":r[i]=n;break;case"vertexColors":!0===n&&(r.vertexColors=sp),"face"===n&&(r.vertexColors=np)}}return"MeshBasicMaterial"===r.type&&delete r.emissive,"MeshPhongMaterial"!==r.type&&delete r.specular,r.opacity<1&&(r.transparent=!0),c.setTextures(h),c.parse(r)}})()});var ap={};function hp(t){op.call(this,t)}hp.prototype=Object.assign(Object.create(op.prototype),{constructor:hp,load:function(o,t,e,i){void 0===o&&(o=""),void 0!==this.path&&(o=this.path+o),o=this.manager.resolveURL(o);var a=this,r=Dv.get(o);if(void 0!==r)return setTimeout(function(){t&&t(r)},0),r;if(void 0===ap[o]){var n=o.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var s=n[1],h=!!n[2],l=n[3],l=decodeURIComponent(l);h&&(l=atob(l));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var c=new Uint8Array(l.length),f=0;f<l.length;f++)c[f]=l.charCodeAt(f);d="blob"===u?new Blob([c.buffer],{type:s}):c.buffer;break;case"document":var d=(new DOMParser).parseFromString(l,s);break;case"json":d=JSON.parse(l);break;default:d=l}setTimeout(function(){t&&t(d),a.manager.itemEnd(o)},0)}catch(t){setTimeout(function(){i&&i(t),a.manager.itemError(o),a.manager.itemEnd(o)},0)}}else{ap[o]=[],ap[o].push({onLoad:t,onProgress:e,onError:i});var v,p=new ot.XMLHttpRequest;for(v in p.open("GET",o,!0),p.addEventListener("load",function(t){var e=this.response,i=ap[o];if(delete ap[o],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Dv.add(o,e);for(var r=0,n=i.length;r<n;r++)(s=i[r]).onLoad&&s.onLoad(e)}else{for(var s,r=0,n=i.length;r<n;r++)(s=i[r]).onError&&s.onError(t);a.manager.itemError(o)}a.manager.itemEnd(o)},!1),p.addEventListener("progress",function(t){for(var e=ap[o],i=0,r=e.length;i<r;i++){var n=e[i];n.onProgress&&n.onProgress(t)}},!1),p.addEventListener("error",function(t){var e=ap[o];delete ap[o];for(var i=0,r=e.length;i<r;i++){var n=e[i];n.onError&&n.onError(t)}a.manager.itemError(o),a.manager.itemEnd(o)},!1),p.addEventListener("abort",function(t){var e=ap[o];delete ap[o];for(var i=0,r=e.length;i<r;i++){var n=e[i];n.onError&&n.onError(t)}a.manager.itemError(o),a.manager.itemEnd(o)},!1),void 0!==this.responseType&&(p.responseType=this.responseType),void 0!==this.withCredentials&&(p.withCredentials=this.withCredentials),p.overrideMimeType&&p.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)p.setRequestHeader(v,this.requestHeader[v]);p.send(null)}return a.manager.itemStart(o),p}ap[o].push({onLoad:t,onProgress:e,onError:i})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this},dispose(){ap={}}});var lp={arraySlice:function(t,e,i){return lp.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(i){for(var t=i.length,e=new Array(t),r=0;r!==t;++r)e[r]=r;return e.sort(function(t,e){return i[t]-i[e]}),e},sortedArray:function(t,e,i){for(var r=t.length,n=new t.constructor(r),s=0,o=0;o!==r;++s)for(var a=i[s]*e,h=0;h!==e;++h)n[o++]=t[a+h];return n},flattenJSON:function(t,e,i,r){for(var n=1,s=t[0];void 0!==s&&void 0===s[r];)s=t[n++];if(void 0!==s){var o=s[r];if(void 0!==o)if(Array.isArray(o))for(;void 0!==(o=s[r])&&(e.push(s.time),i.push.apply(i,o)),void 0!==(s=t[n++]););else if(void 0!==o.toArray)for(;void 0!==(o=s[r])&&(e.push(s.time),o.toArray(i,i.length)),void 0!==(s=t[n++]););else for(;void 0!==(o=s[r])&&(e.push(s.time),i.push(o)),void 0!==(s=t[n++]););}},subclip:function(t,e,i,r,n){n=n||30;for(var s=t.clone(),o=(s.name=e,[]),a=0;a<s.tracks.length;++a){for(var h=s.tracks[a],l=h.getValueSize(),u=[],c=[],f=0;f<h.times.length;++f){var d=h.times[f]*n;if(!(d<i||r<=d)){u.push(h.times[f]);for(var v=0;v<l;++v)c.push(h.values[f*l+v])}}0!==u.length&&(h.times=lp.convertArray(u,h.times.constructor),h.values=lp.convertArray(c,h.values.constructor),o.push(h))}s.tracks=o;for(var p=1/0,a=0;a<s.tracks.length;++a)p>s.tracks[a].times[0]&&(p=s.tracks[a].times[0]);for(a=0;a<s.tracks.length;++a)s.tracks[a].shift(-1*p);return s.resetDuration(),s}};function up(t,e,i,r){this.parameterPositions=t,this._l=0,this.resultBuffer=void 0!==r?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function cp(t,e,i,r){up.call(this,t,e,i,r),this.bl=-0,this.yl=-0,this.wl=-0,this.xl=-0}function fp(t,e,i,r){up.call(this,t,e,i,r)}function dp(t,e,i,r){up.call(this,t,e,i,r)}function vp(t,e,i,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=lp.convertArray(e,this.TimeBufferType),this.values=lp.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function pp(t,e,i){vp.call(this,t,e,i)}function mp(t,e,i,r){vp.call(this,t,e,i,r)}function gp(t,e,i,r){vp.call(this,t,e,i,r)}function _p(t,e,i,r){up.call(this,t,e,i,r)}function bp(t,e,i,r){vp.call(this,t,e,i,r)}function yp(t,e,i,r){vp.call(this,t,e,i,r)}function wp(t,e,i,r){vp.call(this,t,e,i,r)}function xp(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=Et.generateUUID(),this.duration<0&&this.resetDuration()}function Mp(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return gp;case"vector":case"vector2":case"vector3":case"vector4":return wp;case"color":return mp;case"quaternion":return bp;case"bool":case"boolean":return pp;case"string":return yp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Ep(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e,i,r=Mp(t.type);return void 0===t.times&&(lp.flattenJSON(t.keys,e=[],i=[],"value"),t.times=e,t.values=i),void 0!==r.parse?r.parse(t):new r(t.name,t.times,t.values,t.interpolation)}function Lp(t){"boolean"==typeof t&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Rv,this.withCredentials=!1}function Tp(t,e){Z.call(this),this.type="Light",this.color=new ft(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Sp(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new St(512,512),this.map=null,this.mapPass=null,this.matrix=new Tt,this.Ml=new Ut,this.El=new St(1,1),this.Ll=1,this.Tl=[new At(0,0,1,1)]}function Ap(){Sp.call(this,new lt(-5,5,5,-5,.5,500))}function Op(t,e){Tp.call(this,t,e),this.type="DirectionalLight",this.position.copy(Z.DefaultUp),this.updateMatrix(),this.target=new Z,this.shadow=new Ap}function Cp(){Sp.call(this,new ht(90,1,.5,500)),this.El=new St(4,2),this.Ll=6,this.Tl=[new At(2,1,1,1),new At(0,1,1,1),new At(3,1,1,1),new At(1,1,1,1),new At(3,0,1,1),new At(1,0,1,1)],this.Sl=[new Lt(1,0,0),new Lt(-1,0,0),new Lt(0,0,1),new Lt(0,0,-1),new Lt(0,1,0),new Lt(0,-1,0)],this.Al=[new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,0,1),new Lt(0,0,-1)]}function Rp(t,e,i,r){Tp.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new Cp}function Np(){Sp.call(this,new ht(50,1,.5,500))}function Dp(t,e,i,r,n,s){Tp.call(this,t,e),this.type="SpotLight",this.position.copy(Z.DefaultUp),this.updateMatrix(),this.target=new Z,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==s?s:1,this.shadow=new Np}function kp(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Q.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Tt,this.bindMatrixInverse=new Tt}Object.assign(up.prototype,{evaluate:function(t){var e,i=this.parameterPositions,r=this._l,n=i[r],s=i[r-1];t:{e:{i:{r:if(!(t<n)){for(var o=r+2;;){if(void 0===n){if(t<s)break r;return r=i.length,this._l=r,this.afterEnd_(r-1,t,s)}if(r===o)break;if(s=n,t<(n=i[++r]))break e}e=i.length;break i}if(s<=t)break t;var a=i[1];t<a&&(r=2,s=a);for(o=r-2;;){if(void 0===s)return this._l=0,this.beforeStart_(0,t,n);if(r===o)break;if(n=s,(s=i[--r-1])<=t)break e}e=r,r=0}for(;r<e;){var h=r+e>>>1;t<i[h]?e=h:r=1+h}if(n=i[r],void 0===(s=i[r-1]))return this._l=0,this.beforeStart_(0,t,n);if(void 0===n)return r=i.length,this._l=r,this.afterEnd_(r-1,s,t)}this._l=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r,s=0;s!==r;++s)e[s]=i[n+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(up.prototype,{beforeStart_:up.prototype.copySampleValue_,afterEnd_:up.prototype.copySampleValue_}),cp.prototype=Object.assign(Object.create(up.prototype),{constructor:cp,DefaultSettings_:{endingStart:br,endingEnd:br},intervalChanged_:function(t,e,i){var r=this.parameterPositions,n=t-2,s=t+1,o=r[n],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case yr:n=t,o=2*e-i;break;case wr:o=e+r[n=r.length-2]-r[n+1];break;default:n=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case yr:s=t,a=2*i-e;break;case wr:a=i+r[s=1]-r[0];break;default:s=t-1,a=e}var h=.5*(i-e),l=this.valueSize;this.bl=h/(e-o),this.wl=h/(a-i),this.yl=n*l,this.xl=s*l},interpolate_:function(t,e,i,r){for(var n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=this.yl,u=this.xl,t=this.bl,c=this.wl,i=(i-e)/(r-e),r=i*i,e=r*i,f=-t*e+2*t*r-t*i,d=(1+t)*e+(-1.5-2*t)*r+(-.5+t)*i+1,v=(-1-c)*e+(1.5+c)*r+.5*i,p=c*e-c*r,m=0;m!==o;++m)n[m]=f*s[l+m]+d*s[h+m]+v*s[a+m]+p*s[u+m];return n}}),fp.prototype=Object.assign(Object.create(up.prototype),{constructor:fp,interpolate_:function(t,e,i,r){for(var n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=(i-e)/(r-e),u=1-l,c=0;c!==o;++c)n[c]=s[h+c]*u+s[a+c]*l;return n}}),dp.prototype=Object.assign(Object.create(up.prototype),{constructor:dp,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(vp.prototype,{constructor:vp,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:gr,InterpolantFactoryMethodDiscrete:function(t){return new dp(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new fp(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new cp(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case mr:e=this.InterpolantFactoryMethodDiscrete;break;case gr:e=this.InterpolantFactoryMethodLinear;break;case _r:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",i)}else this.createInterpolant=e;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return mr;case this.InterpolantFactoryMethodLinear:return gr;case this.InterpolantFactoryMethodSmooth:return _r}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,r=e.length;i!==r;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,r=e.length;i!==r;++i)e[i]*=t;return this},trim:function(t,e){for(var i,r=this.times,n=r.length,s=0,o=n-1;s!==n&&r[s]<t;)++s;for(;-1!==o&&r[o]>e;)--o;return++o,0===s&&o===n||(o<=s&&(s=(o=Math.max(o,1))-1),i=this.getValueSize(),this.times=lp.arraySlice(r,s,o),this.values=lp.arraySlice(this.values,s*i,o*i)),this},validate:function(){for(var t=!0,e=this.getValueSize(),i=(e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1),this.times),r=this.values,n=i.length,s=(0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1),null),o=0;o!==n;o++){var a=i[o];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==s&&a<s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),t=!1;break}s=a}if(void 0!==r&&lp.isTypedArray(r))for(var o=0,h=r.length;o!==h;++o){var l=r[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t},optimize:function(){for(var t=lp.arraySlice(this.times),e=lp.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===_r,n=1,s=t.length-1,o=1;o<s;++o){var a=!1,h=t[o];if(h!==t[o+1]&&(1!==o||h!==h[0]))if(r)a=!0;else for(var l=o*i,u=l-i,c=l+i,f=0;f!==i;++f){var d=e[l+f];if(d!==e[u+f]||d!==e[c+f]){a=!0;break}}if(a){if(o!==n){t[n]=t[o];for(var v=o*i,p=n*i,f=0;f!==i;++f)e[p+f]=e[v+f]}++n}}if(0<s){t[n]=t[s];for(v=s*i,p=n*i,f=0;f!==i;++f)e[p+f]=e[v+f];++n}return n!==t.length?(this.times=lp.arraySlice(t,0,n),this.values=lp.arraySlice(e,0,n*i)):(this.times=t,this.values=e),this},clone:function(){var t=lp.arraySlice(this.times,0),e=lp.arraySlice(this.values,0),t=new this.constructor(this.name,t,e);return t.createInterpolant=this.createInterpolant,t}}),pp.prototype=Object.assign(Object.create(vp.prototype),{constructor:pp,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:mr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),mp.prototype=Object.assign(Object.create(vp.prototype),{constructor:mp,ValueTypeName:"color"}),gp.prototype=Object.assign(Object.create(vp.prototype),{constructor:gp,ValueTypeName:"number"}),_p.prototype=Object.assign(Object.create(up.prototype),{constructor:_p,interpolate_:function(t,e,i,r){for(var n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,h=(i-e)/(r-e),l=a+o;a!==l;a+=4)at.slerpFlat(n,0,s,a-o,s,a,h);return n}}),bp.prototype=Object.assign(Object.create(vp.prototype),{constructor:bp,ValueTypeName:"quaternion",DefaultInterpolation:gr,InterpolantFactoryMethodLinear:function(t){return new _p(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),yp.prototype=Object.assign(Object.create(vp.prototype),{constructor:yp,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:mr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),wp.prototype=Object.assign(Object.create(vp.prototype),{constructor:wp,ValueTypeName:"vector"}),Object.assign(xp,{parse:function(t){for(var e=[],i=t.tracks,r=1/(t.fps||1),n=0,s=i.length;n!==s;++n)e.push(Ep(i[n]).scale(r));return new xp(t.name,t.duration,e)},CreateFromMorphTargetSequence:function(t,e,i,r){for(var n=e.length,s=[],o=0;o<n;o++){var a=[],h=((l=[]).push((o+n-1)%n,o,(o+1)%n),a.push(0,1,0),lp.getKeyframeOrder(l)),l=lp.sortedArray(l,1,h),a=lp.sortedArray(a,1,h);r||0!==l[0]||(l.push(n),a.push(a[0])),s.push(new gp(".morphTargetInfluences["+e[o].name+"]",l,a).scale(1/i))}return new xp(t,-1,s)},findByName:function(t,e){var i=t;Array.isArray(t)||(i=t.geometry&&t.geometry.animations||t.animations);for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,s=0,o=t.length;s<o;s++){var a=t[s],h=a.name.match(n);h&&1<h.length&&((h=r[l=h[1]])||(r[l]=h=[]),h.push(a))}var l,u=[];for(l in r)u.push(xp.CreateFromMorphTargetSequence(l,r[l],e,i));return u},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(t,e,i,r,n){var s;0!==i.length&&(lp.flattenJSON(i,i=[],s=[],r),0!==i.length)&&n.push(new t(e,i,s))},r=[],n=t.name||"default",s=t.length||-1,o=t.fps||30,a=t.hierarchy||[],h=0;h<a.length;h++){var l=a[h].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var u,c={},f=0;f<l.length;f++)if(l[f].morphTargets)for(var d=0;d<l[f].morphTargets.length;d++)c[l[f].morphTargets[d]]=-1;for(u in c){for(var v=[],p=[],d=0;d!==l[f].morphTargets.length;++d){var m=l[f];v.push(m.time),p.push(m.morphTarget===u?1:0)}r.push(new gp(".morphTargetInfluence["+u+"]",v,p))}s=c.length*(o||1)}else{var g=".bones["+e[h].name+"]";i(wp,g+".position",l,"pos",r),i(bp,g+".quaternion",l,"rot",r),i(wp,g+".scale",l,"scl",r)}}return 0===r.length?null:new xp(n,s,r)}}),Object.assign(xp.prototype,{resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e)var r=this.tracks[e],t=Math.max(t,r.times[r.times.length-1]);return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new xp(this.name,this.duration,t)}}),Object.assign(Lp.prototype,{crossOrigin:"anonymous",load:function(i,r,t,e){var n=this,s=void 0===this.path?Nv.extractUrlBase(i):this.path,o=(this.resourcePath=s+"maps/",new hp(this.manager));o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(i,function(t){var t=JSON.parse(t),e=t.metadata;if(void 0!==e){e=e.type;if(void 0!==e&&"object"===e.toLowerCase())return void console.error("JSONLoader: "+i+" should be loaded with ObjectLoader instead.")}e=n.parse(t,s);r(e.geometry,e.materials)},t,e)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,I){void 0!==(t=void 0!==t.data?t.data:t).scale?t.scale=1/t.scale:t.scale=1;var e,i,r,n,s,o,a,h,l,u,F,j,G,U,H,B,c,f,d,v,p,m,g,_,b=new Is,y=t,w=b,x=y.faces,M=y.vertices,E=y.normals,z=y.colors,V=y.scale,W=0;if(void 0!==y.uvs){for(e=0;e<y.uvs.length;e++)y.uvs[e].length&&W++;for(e=0;e<W;e++)w.faceVertexUvs[e]=[]}for(n=0,s=M.length;n<s;)(c=new Lt).x=M[n++]*V,c.y=M[n++]*V,c.z=M[n++]*V,w.vertices.push(c);for(n=0,s=x.length;n<s;)if(F=(u=x[n++])&2,j=u&8,G=u&16,U=u&32,H=u&64,B=u&128,u&1){if((d=new Rs).a=x[n],d.b=x[n+1],d.c=x[n+3],(v=new Rs).a=x[n+1],v.b=x[n+2],v.c=x[n+3],n+=4,F&&(l=x[n++],d.materialIndex=l,v.materialIndex=l),r=w.faces.length,j)for(e=0;e<W;e++)for(g=y.uvs[e],w.faceVertexUvs[e][r]=[],w.faceVertexUvs[e][r+1]=[],i=0;i<4;i++)_=new St(g[2*(h=x[n++])],g[2*h+1]),2!==i&&w.faceVertexUvs[e][r].push(_),0!==i&&w.faceVertexUvs[e][r+1].push(_);if(G&&(a=3*x[n++],d.normal.set(E[a++],E[a++],E[a]),v.normal.copy(d.normal)),U)for(e=0;e<4;e++)a=3*x[n++],m=new Lt(E[a++],E[a++],E[a]),2!==e&&d.vertexNormals.push(m),0!==e&&v.vertexNormals.push(m);if(H&&(p=z[o=x[n++]],d.color.setHex(p),v.color.setHex(p)),B)for(e=0;e<4;e++)p=z[o=x[n++]],2!==e&&d.vertexColors.push(new ft(p)),0!==e&&v.vertexColors.push(new ft(p));w.faces.push(d),w.faces.push(v)}else{if((f=new Rs).a=x[n++],f.b=x[n++],f.c=x[n++],F&&(l=x[n++],f.materialIndex=l),r=w.faces.length,j)for(e=0;e<W;e++)for(g=y.uvs[e],w.faceVertexUvs[e][r]=[],i=0;i<3;i++)_=new St(g[2*(h=x[n++])],g[2*h+1]),w.faceVertexUvs[e][r].push(_);if(G&&(a=3*x[n++],f.normal.set(E[a++],E[a++],E[a])),U)for(e=0;e<3;e++)a=3*x[n++],m=new Lt(E[a++],E[a++],E[a]),f.vertexNormals.push(m);if(H&&(o=x[n++],f.color.setHex(z[o])),B)for(e=0;e<3;e++)o=x[n++],f.vertexColors.push(new ft(z[o]));w.faces.push(f)}var L=t,T=b,S=void 0!==L.influencesPerVertex?L.influencesPerVertex:2;if(L.skinWeights)for(var A=0,Y=L.skinWeights.length;A<Y;A+=S){var X=L.skinWeights[A],Z=1<S?L.skinWeights[A+1]:0,q=2<S?L.skinWeights[A+2]:0,J=3<S?L.skinWeights[A+3]:0;T.skinWeights.push(new At(X,Z,q,J))}if(L.skinIndices)for(A=0,Y=L.skinIndices.length;A<Y;A+=S){var K=L.skinIndices[A],Q=1<S?L.skinIndices[A+1]:0,$=2<S?L.skinIndices[A+2]:0,tt=3<S?L.skinIndices[A+3]:0;T.skinIndices.push(new At(K,Q,$,tt))}T.bones=L.bones,T.bones&&0<T.bones.length&&(T.skinWeights.length!==T.skinIndices.length||T.skinIndices.length!==T.vertices.length)&&console.warn("When skinning, number of vertices ("+T.vertices.length+"), skinIndices ("+T.skinIndices.length+"), and skinWeights ("+T.skinWeights.length+") should match.");var O=t,C=b,et=O.scale;if(void 0!==O.morphTargets)for(var R=0,it=O.morphTargets.length;R<it;R++){C.morphTargets[R]={},C.morphTargets[R].name=O.morphTargets[R].name,C.morphTargets[R].vertices=[];for(var rt=C.morphTargets[R].vertices,nt=O.morphTargets[R].vertices,N=0,st=nt.length;N<st;N+=3){var ot=new Lt;ot.x=nt[N]*et,ot.y=nt[N+1]*et,ot.z=nt[N+2]*et,rt.push(ot)}}if(void 0!==O.morphColors&&0<O.morphColors.length){console.warn('fm.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var at=C.faces,ht=O.morphColors[0].colors,R=0,it=at.length;R<it;R++)at[R].color.fromArray(ht,3*R)}var D=t,lt=b,k=[],P=[];void 0!==D.animation&&P.push(D.animation),void 0!==D.animations&&(D.animations.length?P=P.concat(D.animations):P.push(D.animations));for(var ut=0;ut<P.length;ut++){var ct=xp.parseAnimation(P[ut],lt.bones);ct&&k.push(ct)}return lt.morphTargets&&(D=xp.CreateClipsFromMorphTargetSequences(lt.morphTargets,10),k=k.concat(D)),0<k.length&&(lt.animations=k),b.computeFaceNormals(),b.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:b}:{geometry:b,materials:op.prototype.initMaterials(t.materials,this.resourcePath||I,this.crossOrigin)}}}),Tp.prototype=Object.assign(Object.create(Z.prototype),{constructor:Tp,isLight:!0,copy:function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this}}),Object.assign(Sp.prototype,{Ol:new Tt,Cl:new Lt,Rl:new Lt,getViewportCount:function(){return this.Ll},getFrustum:function(){return this.Ml},updateMatrices:function(t){var e=this.camera,i=this.matrix,r=this.Ol,n=this.Rl,s=this.Cl;s.setFromMatrixPosition(t.matrixWorld),e.position.copy(s),n.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(n),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.Ml.setFromProjectionMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)},getViewport:function(t){return this.Tl[t]},getFrameExtents:function(){return this.El},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),Ap.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Ap,isDirectionalLightShadow:!0,updateMatrices:function(t){Sp.prototype.updateMatrices.call(this,t)}}),Op.prototype=Object.assign(Object.create(Tp.prototype),{constructor:Op,isDirectionalLight:!0,copy:function(t){return Tp.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Cp.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Cp,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var i=this.camera,r=this.matrix,n=this.Cl,s=this.Rl,o=this.Ol;n.setFromMatrixPosition(t.matrixWorld),i.position.copy(n),s.copy(i.position),s.add(this.Sl[e]),i.up.copy(this.Al[e]),i.lookAt(s),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this.Ml.setFromProjectionMatrix(o)}}),Rp.prototype=Object.assign(Object.create(Tp.prototype),{constructor:Rp,isPointLight:!0,copy:function(t){return Tp.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Np.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Np,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,i=2*Et.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;i===e.fov&&r===e.aspect&&n===e.far||(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),Sp.prototype.updateMatrices.call(this,t)}}),Dp.prototype=Object.assign(Object.create(Tp.prototype),{constructor:Dp,isSpotLight:!0,copy:function(t){return Tp.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),kp.prototype=Object.assign(Object.create(Q.prototype),{constructor:kp,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new At,e=this.geometry.attributes.skinWeight,i=0,r=e.count;i<r;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);var n=1/t.manhattanLength();n!=1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Q.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Pp=new Lt,Ip=new Lt,Fp=new Tt,jp=new _s,Gp=new Dt;function Up(t,e,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Z.call(this),this.type="Line",this.geometry=void 0!==t?t:new et,this.material=void 0!==e?e:new ev}Up.prototype=Object.assign(Object.create(Z.prototype),{constructor:Up,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,i=[0],r=1,n=e.count;r<n;r++)Pp.fromBufferAttribute(e,r-1),Ip.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=Pp.distanceTo(Ip);t.setAttribute("lineDistance",new x(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var s=t.vertices;(i=t.lineDistances)[0]=0;for(r=1,n=s.length;r<n;r++)i[r]=i[r-1],i[r]+=s[r-1].distanceTo(s[r])}return this},raycast:function(t,e){var i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Gp.copy(i.boundingSphere),Gp.applyMatrix4(r),Gp.radius+=n,!1!==t.ray.intersectsSphere(Gp)){Fp.getInverse(r),jp.copy(t.ray).applyMatrix4(Fp);var r=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=r*r,o=new Lt,a=new Lt,h=new Lt,l=new Lt,u=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var n=i.index,c=i.attributes.position.array;if(null!==n)for(var f=n.array,d=0,v=f.length-1;d<v;d+=u){var p=f[d],m=f[d+1];o.fromArray(c,3*p),a.fromArray(c,3*m),s<jp.distanceSqToSegment(o,a,l,h)||(l.applyMatrix4(this.matrixWorld),(g=t.ray.origin.distanceTo(l))<t.near)||g>t.far||e.push({distance:g,point:h.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}else for(d=0,v=c.length/3-1;d<v;d+=u)o.fromArray(c,3*d),a.fromArray(c,3*d+3),s<jp.distanceSqToSegment(o,a,l,h)||(l.applyMatrix4(this.matrixWorld),(g=t.ray.origin.distanceTo(l))<t.near)||g>t.far||e.push({distance:g,point:h.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}else if(i.isGeometry)for(var g,_=i.vertices,b=_.length,d=0;d<b-1;d+=u)s<jp.distanceSqToSegment(_[d],_[d+1],l,h)||(l.applyMatrix4(this.matrixWorld),(g=t.ray.origin.distanceTo(l))<t.near)||g>t.far||e.push({distance:g,point:h.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Hp=new Lt,Bp=new Lt;function zp(t,e){Up.call(this,t,e),this.type="LineSegments"}function Vp(t,e){Up.call(this,t,e),this.type="LineLoop"}zp.prototype=Object.assign(Object.create(Up.prototype),{constructor:zp,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,i=[],r=0,n=e.count;r<n;r+=2)Hp.fromBufferAttribute(e,r),Bp.fromBufferAttribute(e,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+Hp.distanceTo(Bp);t.setAttribute("lineDistance",new x(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var s=t.vertices,i=t.lineDistances,r=0,n=s.length;r<n;r+=2)Hp.copy(s[r]),Bp.copy(s[r+1]),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+Hp.distanceTo(Bp);return this}}),Vp.prototype=Object.assign(Object.create(Up.prototype),{constructor:Vp,isLineLoop:!0});var Wp=new Tt,Yp=new _s,Xp=new Dt,Zp=new Lt;function qp(t,e){Z.call(this),this.type="Points",this.geometry=void 0!==t?t:new et,this.material=void 0!==e?e:new Fv,this.updateMorphTargets()}function Jp(t,e,i,r,n,s,o){var a=Yp.distanceSqToPoint(t);a<i&&(i=new Lt,Yp.closestPointToPoint(t,i),i.applyMatrix4(r),(t=n.ray.origin.distanceTo(i))<n.near||t>n.far||s.push({distance:t,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o}))}function Kp(){Z.call(this),this.type="Bone"}qp.prototype=Object.assign(Object.create(Z.prototype),{constructor:qp,isPoints:!0,raycast:function(t,e){var i=this.geometry,r=this.matrixWorld,n=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Xp.copy(i.boundingSphere),Xp.applyMatrix4(r),Xp.radius+=n,!1!==t.ray.intersectsSphere(Xp)){Wp.getInverse(r),Yp.copy(t.ray).applyMatrix4(Wp);var n=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=n*n;if(i.isBufferGeometry){var n=i.index,o=i.attributes.position.array;if(null!==n)for(var a=n.array,h=0,l=a.length;h<l;h++){var u=a[h];Zp.fromArray(o,3*u),Jp(Zp,u,s,r,t,e,this)}else for(var h=0,c=o.length/3;h<c;h++)Zp.fromArray(o,3*h),Jp(Zp,h,s,r,t,e,this)}else for(var f=i.vertices,h=0,c=f.length;h<c;h++)Jp(f[h],h,s,r,t,e,this)}},updateMorphTargets:function(){var t,e,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,s=Object.keys(n);if(0<s.length){var o=n[s[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)i=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{n=r.morphTargets;void 0!==n&&0<n.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Kp.prototype=Object.assign(Object.create(Z.prototype),{constructor:Kp,isBone:!0});var Qp="\\[\\]\\.:\\/",$p=new RegExp("["+Qp+"]","g"),t1="[^"+Qp+"]",e1="[^"+Qp.replace("\\.","")+"]",i1=/((?:WC+[\/:])*)/.source.replace("WC",t1),r1=/(WCOD+)?/.source.replace("WCOD",e1),n1=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t1),s1=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t1),o1=new RegExp("^"+i1+r1+n1+s1+"$"),a1=["material","materials","bones"];function h1(t,e,i){i=i||l1.parseTrackName(e);this.Nl=t,this.Dl=t.subscribe_(e,i)}function l1(t,e,i){this.path=e,this.parsedPath=i||l1.parseTrackName(e),this.node=l1.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(h1.prototype,{getValue:function(t,e){this.bind();var i=this.Nl.nCachedObjects_,i=this.Dl[i];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var i=this.Dl,r=this.Nl.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)},bind:function(){for(var t=this.Dl,e=this.Nl.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this.Dl,e=this.Nl.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(l1,{Composite:h1,create:function(t,e,i){return new(t&&t.isAnimationObjectGroup?l1.Composite:l1)(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace($p,"")},parseTrackName:function(t){var e=o1.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var i,e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=e.nodeName&&e.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r&&(i=e.nodeName.substring(r+1),-1!==a1.indexOf(i))&&(e.nodeName=e.nodeName.substring(0,r),e.objectName=i),null===e.propertyName||0===e.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return e},findNode:function(t,r){if(!r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){var e=t.skeleton.getBoneByName(r);if(void 0!==e)return e}if(t.children){var n=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.name===r||i.uuid===r)return i;i=n(i.children);if(i)return i}return null},e=n(t.children);if(e)return e}return null}}),Object.assign(l1.prototype,{kl:function(){},Pl:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)t[e++]=i[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++]},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(t=l1.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this.kl,this.setValue=this.Pl,t){if(i){var s=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(var t=t.skeleton.bones,o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var a=t[r];if(void 0===a)e=e.nodeName,console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+r+" but it wasn't found.",t);else{var e=this.Versioning.None,h=(void 0!==(this.targetObject=t).needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),this.BindingType.Direct);if(void 0!==n){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===n){n=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===n){n=o;break}}}h=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(h=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][e]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this.Il,this.setValue=this.Fl}}),Object.assign(l1.prototype,{Il:l1.prototype.getValue,Fl:l1.prototype.setValue});var u1=new Tt,c1=new Tt;function f1(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Tt)}}Object.assign(f1.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new Tt;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var t,e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,s=t.length;n<s;n++){var o=t[n]?t[n].matrixWorld:c1;u1.multiplyMatrices(o,e[n]),u1.toArray(i,16*n)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new f1(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,i=this.bones.length;e<i;e++){var r=this.bones[e];if(r.name===t)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});var d1=(()=>{function t(t){op.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.fileLoaders=[]}function r(){var i={};return{get:function(t){return i[t]},add:function(t,e){i[t]=e},remove:function(t){delete i[t]},removeAll:function(){i={}}}}t.prototype=Object.assign(Object.create(op.prototype),{constructor:t,load:function(t,i,e,r){function n(t){r?r(t):console.error(t)}var s=this,o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Nv.extractUrlBase(t),a=(s.manager.itemStart(t),new hp(s.manager));return this.fileLoaders.push(a),a.setPath(this.path),a.setResponseType("arraybuffer"),"use-credentials"===s.crossOrigin&&a.setWithCredentials(!0),a.load(t,function(e){try{s.parse(e,o,function(t){i(t,e)},n)}catch(t){n(t)}},e,n)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},parse:function(t,e,i,r){var n,s={};if("string"==typeof t)n=t;else if(Nv.decodeText(new Uint8Array(t,0,4))===p){try{s[c.KHR_BINARY_GLTF]=new m(t)}catch(t){return void(r&&r(t))}n=s[c.KHR_BINARY_GLTF].content}else n=Nv.decodeText(new Uint8Array(t));var o=JSON.parse(n);if(void 0===o.asset||o.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(o.extensionsUsed)for(var a=0;a<o.extensionsUsed.length;++a){var h=o.extensionsUsed[a],l=o.extensionsRequired||[];switch(h){case c.KHR_LIGHTS_PUNCTUAL:s[h]=new f(o);break;case c.KHR_MATERIALS_CLEARCOAT:s[h]=new v;break;case c.KHR_MATERIALS_UNLIT:s[h]=new d;break;case c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[h]=new b;break;case c.KHR_DRACO_MESH_COMPRESSION:s[h]=new g(o,this.dracoLoader);break;case c.MSFT_TEXTURE_DDS:s[h]=new u(this.ddsLoader);break;case c.KHR_TEXTURE_TRANSFORM:s[h]=new _;break;case c.KHR_MESH_QUANTIZATION:s[h]=new y;break;default:0<=l.indexOf(h)&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}new F(o,s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(i,r)}}});var c={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function u(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=c.MSFT_TEXTURE_DDS,this.ddsLoader=t}function f(t){this.name=c.KHR_LIGHTS_PUNCTUAL;t=t.extensions&&t.extensions[c.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function d(){this.name=c.KHR_MATERIALS_UNLIT}function v(){this.name=c.KHR_MATERIALS_CLEARCOAT}f.prototype.loadLight=function(t){var e,i=this.lightDefs[t],r=new ft(16777215),n=(void 0!==i.color&&r.fromArray(i.color),void 0!==i.range?i.range:0);switch(i.type){case"directional":(e=new Op(r)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new Rp(r)).distance=n;break;case"spot":(e=new Dp(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,e.angle=i.spot.outerConeAngle,e.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==i.intensity&&(e.intensity=i.intensity),e.name=i.name||"light_"+t,Promise.resolve(e)},d.prototype.getMaterialType=function(){return wo},d.prototype.extendParams=function(t,e,i){var r,n=[],e=(t.color=new ft(1,1,1),t.opacity=1,e.pbrMetallicRoughness);return e&&(Array.isArray(e.baseColorFactor)&&(r=e.baseColorFactor,t.color.fromArray(r),t.opacity=r[3]),void 0!==e.baseColorTexture)&&n.push(i.assignTexture(t,"map",e.baseColorTexture)),Promise.all(n)},v.prototype.getMaterialType=function(){return Gv},v.prototype.extendParams=function(t,e,i){var r=[],e=e.extensions[this.name];return void 0!==e.clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&r.push(i.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(r.push(i.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale)&&(i=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new St(i,i)),Promise.all(r)};var p="glTF",a=12,h={JSON:1313821514,BIN:5130562};function m(t){this.name=c.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,a);if(this.header={magic:Nv.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==p)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=new DataView(t,a),r=0;r<i.byteLength;){var n,s=i.getUint32(r,!0),o=(r+=4,i.getUint32(r,!0));r+=4,o===h.JSON?(n=new Uint8Array(t,a+r,s),this.content=Nv.decodeText(n)):o===h.BIN&&(this.body=t.slice(n=a+r,n+s)),r+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=c.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function _(){this.name=c.KHR_TEXTURE_TRANSFORM}function l(t){jv.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new ft).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this.jl=o,this.onBeforeCompile=function(t){for(var e in o)t.uniforms[e]=o[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",r),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){(o.glossinessMap.value=t)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function b(){return{name:c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return l},extendParams:function(t,e,i){var r,e=e.extensions[this.name],n=(t.color=new ft(1,1,1),t.opacity=1,[]);return Array.isArray(e.diffuseFactor)&&(r=e.diffuseFactor,t.color.fromArray(r),t.opacity=r[3]),void 0!==e.diffuseTexture&&n.push(i.assignTexture(t,"map",e.diffuseTexture)),t.emissive=new ft(0,0,0),t.glossiness=void 0!==e.glossinessFactor?e.glossinessFactor:1,t.specular=new ft(1,1,1),Array.isArray(e.specularFactor)&&t.specular.fromArray(e.specularFactor),void 0!==e.specularGlossinessTexture&&(r=e.specularGlossinessTexture,n.push(i.assignTexture(t,"glossinessMap",r)),n.push(i.assignTexture(t,"specularMap",r))),Promise.all(n)},createMaterial:function(t){var e=new l(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=kr,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function y(){this.name=c.KHR_MESH_QUANTIZATION}function T(t,e,i,r){up.call(this,t,e,i,r)}g.prototype.decodePrimitive=function(t,e){var i,r=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},h={},l={};for(i in o){var u=C[i]||i.toLowerCase();a[u]=o[i]}for(i in t.attributes){var c,f,u=C[i]||i.toLowerCase();void 0!==o[i]&&(c=r.accessors[t.attributes[i]],f=L[c.componentType],l[u]=f,h[u]=!0===c.normalized)}return e.getDependency("bufferView",s).then(function(t){return new Promise(function(r){n.decodeDracoFile(t,function(t){for(var e in t.attributes){var i=t.attributes[e],e=h[e];void 0!==e&&(i.normalized=e)}r(t)},a,l)})})},_.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},((l.prototype=Object.create(jv.prototype)).constructor=l).prototype.copy=function(t){return jv.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},((T.prototype=Object.create(up.prototype)).constructor=T).prototype.beforeStart_=T.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r*3+r,s=0;s!==r;s++)e[s]=i[n+s];return e},T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(t,e,i,r){for(var n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,h=3*o,l=r-e,r=(i-e)/l,i=r*r,e=i*r,u=t*h,c=u-h,f=-2*e+3*i,d=e-i,v=1-f,p=d-i+r,m=0;m!==o;m++){var g=s[c+m+o],_=s[c+m+a]*l,b=s[u+m+o],y=s[u+m]*l;n[m]=v*g+p*_+f*b+d*y}return n};var w=0,x=1,H=2,B=3,z=4,M=5,E=6,L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},S={9728:qe,9729:Qe,9984:Je,9985:$e,9986:Ke,9987:ti},A={33071:Xe,33648:Ze,10497:Ye},O={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},C={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},V={CUBICSPLINE:void 0,LINEAR:gr,STEP:mr},W="OPAQUE",Y="MASK",X="BLEND",N={"image/png":mi,"image/jpeg":pi};function D(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||ot.environment==q.WX&&ot.WX_USER_DATA_PATH.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function k(t,e,i){for(var r in i.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=i.extensions[r])}function P(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function I(t){for(var e="",i=Object.keys(t).sort(),r=0,n=i.length;r<n;r++)e+=i[r]+":"+t[i[r]]+";";return e}function F(t,e,i){this.json=t||{},this.extensions=e||{},this.options=i||{},this.cache=new r,this.primitiveCache={},this.textureLoader=new Pv(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new hp(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}F.prototype.parse=function(e,t){var i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){t={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};k(n,t,r),P(t,r),e(t)}).catch(t)},F.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[],r={},n={},s=0,o=e.length;s<o;s++)for(var a=e[s].joints,h=0,l=a.length;h<l;h++)t[a[h]].isBone=!0;for(var u=0,c=t.length;u<c;u++){var f=t[u];void 0!==f.mesh&&(void 0===r[f.mesh]&&(r[f.mesh]=n[f.mesh]=0),r[f.mesh]++,void 0!==f.skin)&&(i[f.mesh].isSkinnedMesh=!0)}this.json.meshReferences=r,this.json.meshUses=n},F.prototype.getDependency=function(t,e){var i=t+":"+e,r=this.cache.get(i);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this.loadMesh(e);break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this.loadBufferView(e);break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this.loadMaterial(e);break;case"texture":r=this.loadTexture(e);break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;case"light":r=this.extensions[c.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,r)}return r},F.prototype.getDependencies=function(i){var r,t,e=this.cache.get(i);return e||(t=(r=this).json[i+("mesh"===i?"es":"s")]||[],e=Promise.all(t.map(function(t,e){return r.getDependency(i,e)})),this.cache.add(i,e)),e},F.prototype.loadBuffer=function(t){var i,r=this.json.buffers[t],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");return void 0===r.uri&&0===t?Promise.resolve(this.extensions[c.KHR_BINARY_GLTF].body):(i=this.options,new Promise(function(t,e){n.load(D(r.uri,i.path),t,void 0,function(){e(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})}))},F.prototype.loadBufferView=function(t){var r=this.json.bufferViews[t];return this.getDependency("buffer",r.buffer).then(function(t){var e=r.byteLength||0,i=r.byteOffset||0;return t.slice(i,i+e)})},F.prototype.loadAccessor=function(t){var g=this,_=this.json,b=this.json.accessors[t];return void 0===b.bufferView&&void 0===b.sparse?Promise.resolve(null):((t=[]).push(void 0!==b.bufferView?this.getDependency("bufferView",b.bufferView):null),void 0!==b.sparse&&(t.push(this.getDependency("bufferView",b.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",b.sparse.values.bufferView))),Promise.all(t).then(function(t){var e=t[0],i=O[b.type],r=L[b.componentType],n=r.BYTES_PER_ELEMENT,s=b.byteOffset||0,o=void 0!==b.bufferView?_.bufferViews[b.bufferView].byteStride:void 0,a=!0===b.normalized,h=o&&o!==n*i?(l=Math.floor(s/o),u="InterleavedBuffer:"+b.bufferView+":"+b.componentType+":"+l+":"+b.count,(c=g.cache.get(u))||(c=new wc(new r(e,l*o,b.count*o/n),o/n),g.cache.add(u,c)),new Mc(c,i,s%o/n,a)):new J(null===e?new r(b.count*i):new r(e,s,b.count*i),i,a);if(void 0!==b.sparse){var l=L[b.sparse.indices.componentType],u=b.sparse.indices.byteOffset||0,c=b.sparse.values.byteOffset||0,f=new l(t[1],u,b.sparse.count*O.SCALAR),d=new r(t[2],c,b.sparse.count*i);null!==e&&(h=new J(h.array.slice(),h.itemSize,h.normalized));for(var v=0,p=f.length;v<p;v++){var m=f[v];if(h.setX(m,d[v*i]),2<=i&&h.setY(m,d[v*i+1]),3<=i&&h.setZ(m,d[v*i+2]),4<=i&&h.setW(m,d[v*i+3]),5<=i)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h}))};let j=0;function G(c,f,d){var t,e=f.attributes,i=[];for(t in e){var r=C[t]||t.toLowerCase();r in c.attributes||i.push(((t,e)=>d.getDependency("accessor",t).then(function(t){c.setAttribute(e,t)}))(e[t],r))}void 0===f.indices||c.index||(n=d.getDependency("accessor",f.indices).then(function(t){c.setIndex(t)}),i.push(n)),P(c,f);var n=c,s=f,o=d,a=s.attributes,h=new Ct;if(void 0!==a.POSITION){var l=(b=o.json.accessors[a.POSITION]).min,u=b.max;if(void 0===l||void 0===u)console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");else{h.set(new Lt(l[0],l[1],l[2]),new Lt(u[0],u[1],u[2]));var v=s.targets;if(void 0!==v){for(var p=new Lt,m=new Lt,g=0,_=v.length;g<_;g++){var b,y=v[g];void 0!==y.POSITION&&(l=(b=o.json.accessors[y.POSITION]).min,u=b.max,void 0!==l&&void 0!==u?(m.setX(Math.max(Math.abs(l[0]),Math.abs(u[0]))),m.setY(Math.max(Math.abs(l[1]),Math.abs(u[1]))),m.setZ(Math.max(Math.abs(l[2]),Math.abs(u[2]))),p.max(m)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}h.expandByVector(p)}n.boundingBox=h;a=new Dt;h.getCenter(a.center),a.radius=h.min.distanceTo(h.max)/2,n.boundingSphere=a}}return Promise.all(i).then(function(){if(void 0===f.targets)return c;for(var i=c,t=f.targets,e=d,r=!1,n=!1,s=0,o=t.length;s<o&&(void 0!==(u=t[s]).POSITION&&(r=!0),void 0!==u.NORMAL&&(n=!0),!r||!n);s++);if(!r&&!n)return Promise.resolve(i);for(var a=[],h=[],s=0,o=t.length;s<o;s++){var l,u=t[s];r&&(l=void 0!==u.POSITION?e.getDependency("accessor",u.POSITION):i.attributes.position,a.push(l)),n&&(l=void 0!==u.NORMAL?e.getDependency("accessor",u.NORMAL):i.attributes.normal,h.push(l))}return Promise.all([Promise.all(a),Promise.all(h)]).then(function(t){var e=t[0],t=t[1];return r&&(i.morphAttributes.position=e),n&&(i.morphAttributes.normal=t),i.morphTargetsRelative=!0,i})})}function U(t,e){var i=t.getIndex();if(null===i){var r=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var s=0;s<n.count;s++)r.push(s);t.setIndex(r),i=t.getIndex()}var o=i.count-2,a=[];if(e===Mr)for(s=1;s<=o;s++)a.push(i.getX(0)),a.push(i.getX(s)),a.push(i.getX(s+1));else for(s=0;s<o;s++)s%2==0?(a.push(i.getX(s)),a.push(i.getX(s+1)),a.push(i.getX(s+2))):(a.push(i.getX(s+2)),a.push(i.getX(s+1)),a.push(i.getX(s)));a.length/3!=o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");e=t.clone();return e.setIndex(a),e}return F.prototype.loadTexture=function(t){var i,e=this,r=this.json,n=this.options,s=this.textureLoader,o=(ot.environment===q.BROWSER&&(i=self.URL||self.webkitURL),r.textures[t]),a=o.extensions||{},h=a[c.MSFT_TEXTURE_DDS]?r.images[a[c.MSFT_TEXTURE_DDS].source]:r.images[o.source],l=h.uri,u=!1;return void 0!==h.bufferView&&(l=e.getDependency("bufferView",h.bufferView).then(function(n){var t;if(ot.environment===q.BROWSER)return u=!0,t=new Blob([n],{type:h.mimeType}),l=i.createObjectURL(t);{let t=wx.getFileSystemManager();return new Promise(function(e,i){let r=wx.env.USER_DATA_PATH+"/"+j+".png";j++,t.writeFile({filePath:r,data:n,encoding:"binary",success:t=>{e(r)},fail:t=>{console.error("******",r,t),i(r)}})})}})),Promise.resolve(l).then(function(i){var r=(r=n.manager.getHandler(i))||(a[c.MSFT_TEXTURE_DDS]?e.extensions[c.MSFT_TEXTURE_DDS].ddsLoader:s);return new Promise(function(t,e){r.load(D(i,n.path),t,void 0,e)})}).then(function(t){!0===u&&i.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name),h.mimeType in N&&(t.format=N[h.mimeType]);var e=(r.samplers||{})[o.sampler]||{};return t.magFilter=S[e.magFilter]||Qe,t.minFilter=S[e.minFilter]||ti,t.wrapS=A[e.wrapS]||Ye,t.wrapT=A[e.wrapT]||Ye,t})},F.prototype.assignTexture=function(i,r,n){var s=this;return this.getDependency("texture",n.index).then(function(t){if(!t.isCompressedTexture)switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":t.format=pi}var e;void 0===n.texCoord||0==n.texCoord||"aoMap"===r&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+r+" not yet supported."),s.extensions[c.KHR_TEXTURE_TRANSFORM]&&(e=void 0!==n.extensions?n.extensions[c.KHR_TEXTURE_TRANSFORM]:void 0)&&(t=s.extensions[c.KHR_TEXTURE_TRANSFORM].extendTexture(t,e)),i[r]=t})},F.prototype.assignFinalMaterial=function(t){var e,i,r=t.geometry,n=t.material,s=void 0!==r.attributes.tangent,o=void 0!==r.attributes.color,a=void 0===r.attributes.normal,h=!0===t.isSkinnedMesh,l=0<Object.keys(r.morphAttributes).length,u=l&&void 0!==r.morphAttributes.normal;t.isPoints?(e="PointsMaterial:"+n.uuid,(i=this.cache.get(e))||(i=new Fv,K.prototype.copy.call(i,n),i.color.copy(n.color),i.map=n.map,i.sizeAttenuation=!1,this.cache.add(e,i)),n=i):t.isLine&&(e="LineBasicMaterial:"+n.uuid,(i=this.cache.get(e))||(i=new ev,K.prototype.copy.call(i,n),i.color.copy(n.color),this.cache.add(e,i)),n=i),(s||o||a||h||l)&&(e="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),h&&(e+="skinning:"),s&&(e+="vertex-tangents:"),o&&(e+="vertex-colors:"),a&&(e+="flat-shading:"),l&&(e+="morph-targets:"),u&&(e+="morph-normals:"),(i=this.cache.get(e))||(i=n.clone(),h&&(i.skinning=!0),s&&(i.vertexTangents=!0),o&&(i.vertexColors=!0),a&&(i.flatShading=!0),l&&(i.morphTargets=!0),u&&(i.morphNormals=!0),this.cache.add(e,i)),n=i),n.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",new J(r.attributes.uv.array,2)),n.normalScale&&!s&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!s&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},F.prototype.loadMaterial=function(t){var e,i,r=this.json,n=this.extensions,s=r.materials[t],o={},r=s.extensions||{},t=[],a=(r[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(i=n[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],e=i.getMaterialType(),t.push(i.extendParams(o,s,this))):r[c.KHR_MATERIALS_UNLIT]?(i=n[c.KHR_MATERIALS_UNLIT],e=i.getMaterialType(),t.push(i.extendParams(o,s,this))):(e=jv,i=s.pbrMetallicRoughness||{},o.color=new ft(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)&&(a=i.baseColorFactor,o.color.fromArray(a),o.opacity=a[3]),void 0!==i.baseColorTexture&&t.push(this.assignTexture(o,"map",i.baseColorTexture)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(t.push(this.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),t.push(this.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture)))),!0===s.doubleSided&&(o.side=Kt),s.alphaMode||W);return a===X?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,a===Y&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==wo&&(t.push(this.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new St(1,1),void 0!==s.normalTexture.scale)&&o.normalScale.set(s.normalTexture.scale,s.normalTexture.scale),void 0!==s.occlusionTexture&&e!==wo&&(t.push(this.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength)&&(o.aoMapIntensity=s.occlusionTexture.strength),void 0!==s.emissiveFactor&&e!==wo&&(o.emissive=(new ft).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==wo&&t.push(this.assignTexture(o,"emissiveMap",s.emissiveTexture)),r[c.KHR_MATERIALS_CLEARCOAT]&&(i=n[c.KHR_MATERIALS_CLEARCOAT],e=i.getMaterialType(),t.push(i.extendParams(o,{extensions:r},this))),Promise.all(t).then(function(){var t=e===l?n[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new e(o);return s.name&&(t.name=s.name),t.map&&(t.map.encoding=Lr),t.emissiveMap&&(t.emissiveMap.encoding=Lr),P(t,s),s.extensions&&k(n,t,s),t})},F.prototype.loadGeometries=function(t){var i=this,r=this.extensions,e=this.primitiveCache;for(var n=[],s=0,o=t.length;s<o;s++){var a=t[s],h=(l=void 0,l=(l=(h=a).extensions&&h.extensions[c.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+I(l.attributes):h.indices+":"+I(h.attributes)+":"+h.mode),l=e[h];l?n.push(l.promise):(l=a.extensions&&a.extensions[c.KHR_DRACO_MESH_COMPRESSION]?(e=>r[c.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return G(t,e,i)}))(a):G(new et,a,i),e[h]={primitive:a,promise:l},n.push(l))}return Promise.all(n)},F.prototype.loadMesh=function(m){for(var g=this,_=this.json.meshes[m],b=_.primitives,t=[],e=0,i=b.length;e<i;e++){var r=void 0===b[e].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new jv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qt})),r.DefaultMaterial):this.getDependency("material",b[e].material);t.push(r)}return t.push(g.loadGeometries(b)),Promise.all(t).then(function(t){for(var e=t.slice(0,t.length-1),i=t[t.length-1],r=[],n=0,s=i.length;n<s;n++){var o,a=i[n],h=b[n],l=e[n];if(h.mode===z||h.mode===M||h.mode===E||void 0===h.mode)!0!==(o=new(!0===_.isSkinnedMesh?kp:Q)(a,l)).isSkinnedMesh||o.geometry.attributes.skinWeight.normalized||o.normalizeSkinWeights(),h.mode===M?o.geometry=U(o.geometry,xr):h.mode===E&&(o.geometry=U(o.geometry,Mr));else if(h.mode===x)o=new zp(a,l);else if(h.mode===B)o=new Up(a,l);else if(h.mode===H)o=new Vp(a,l);else{if(h.mode!==w)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);o=new qp(a,l)}if(0<Object.keys(o.geometry.morphAttributes).length){v=d=f=c=u=void 0;var u=o,c=_;if(u.updateMorphTargets(),void 0!==c.weights)for(var f=0,d=c.weights.length;f<d;f++)u.morphTargetInfluences[f]=c.weights[f];if(c.extras&&Array.isArray(c.extras.targetNames)){var v=c.extras.targetNames;if(u.morphTargetInfluences.length===v.length){u.morphTargetDictionary={};for(f=0,d=v.length;f<d;f++)u.morphTargetDictionary[v[f]]=f}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}o.name=_.name||"mesh_"+m,1<i.length&&(o.name+="_"+n),P(o,_),g.assignFinalMaterial(o),r.push(o)}if(1===r.length)return r[0];for(var p=new mc,n=0,s=r.length;n<s;n++)p.add(r[n]);return p})},F.prototype.loadCamera=function(t){var e,t=this.json.cameras[t],i=t[t.type];if(i)return"perspective"===t.type?e=new ht(Et.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===t.type&&(e=new lt(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),t.name&&(e.name=t.name),P(e,t),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F.prototype.loadSkin=function(t){var t=this.json.skins[t],e={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(e):this.getDependency("accessor",t.inverseBindMatrices).then(function(t){return e.inverseBindMatrices=t,e})},F.prototype.loadAnimation=function(E){for(var L=this.json.animations[E],t=[],e=[],i=[],r=[],n=[],s=0,o=L.channels.length;s<o;s++){var a=L.channels[s],h=L.samplers[a.sampler],a=a.target,l=void 0!==a.node?a.node:a.id,u=void 0!==L.parameters?L.parameters[h.input]:h.input,c=void 0!==L.parameters?L.parameters[h.output]:h.output;t.push(this.getDependency("node",l)),e.push(this.getDependency("accessor",u)),i.push(this.getDependency("accessor",c)),r.push(h),n.push(a)}return Promise.all([Promise.all(t),Promise.all(e),Promise.all(i),Promise.all(r),Promise.all(n)]).then(function(t){for(var e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=[],a=0,h=e.length;a<h;a++){var l,u=e[a],c=i[a],f=r[a],d=n[a],v=s[a];if(void 0!==u){switch(u.updateMatrix(),u.matrixAutoUpdate=!0,R[v.path]){case R.weights:l=gp;break;case R.rotation:l=bp;break;default:l=wp}var p,m=u.name||u.uuid,g=void 0!==d.interpolation?V[d.interpolation]:gr,_=[],b=(R[v.path]===R.weights?u.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&_.push(t.name||t.uuid)}):_.push(m),f.array);if(f.normalized){if(b.constructor===Int8Array)p=1/127;else if(b.constructor===Uint8Array)p=1/255;else if(b.constructor==Int16Array)p=1/32767;else{if(b.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");p=1/65535}for(var y=new Float32Array(b.length),w=0,x=b.length;w<x;w++)y[w]=b[w]*p;b=y}for(w=0,x=_.length;w<x;w++){var M=new l(_[w]+"."+R[v.path],c.array,b,g);"CUBICSPLINE"===d.interpolation&&(M.createInterpolant=function(t){return new T(this.times,this.values,this.getValueSize()/3,t)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(M)}}}return new xp(L.name||"animation_"+E,void 0,o)})},F.prototype.loadNode=function(t){var e=this.json,s=this.extensions,i=this,r=e.meshReferences,n=e.meshUses,o=e.nodes[t];return e=[],void 0!==o.mesh&&e.push(i.getDependency("mesh",o.mesh).then(function(t){var e,i;return 1<r[o.mesh]?(e=n[o.mesh]++,(i=t.clone()).name+="_instance_"+e):i=t,void 0!==o.weights&&i.traverse(function(t){if(t.isMesh)for(var e=0,i=o.weights.length;e<i;e++)t.morphTargetInfluences[e]=o.weights[e]}),i})),void 0!==o.camera&&e.push(i.getDependency("camera",o.camera)),o.extensions&&o.extensions[c.KHR_LIGHTS_PUNCTUAL]&&void 0!==o.extensions[c.KHR_LIGHTS_PUNCTUAL].light&&e.push(i.getDependency("light",o.extensions[c.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e).then(function(t){var e,i=!0===o.isBone?new Kp:1<t.length?new mc:1===t.length?t[0]:new Z;if(i!==t[0])for(var r=0,n=t.length;r<n;r++)i.add(t[r]);return o.name&&(i.userData.name=o.name,i.name=l1.sanitizeNodeName(o.name)),P(i,o),o.extensions&&k(s,i,o),void 0!==o.matrix?((e=new Tt).fromArray(o.matrix),i.applyMatrix4(e)):(void 0!==o.translation&&i.position.fromArray(o.translation),void 0!==o.rotation&&i.quaternion.fromArray(o.rotation),void 0!==o.scale&&i.scale.fromArray(o.scale)),i})},F.prototype.loadScene=function(t){for(var e=this.json,i=this.extensions,t=this.json.scenes[t],r=new As,n=(t.name&&(r.name=t.name),P(r,t),t.extensions&&k(i,r,t),t.nodes||[]),s=[],o=0,a=n.length;o<a;o++)s.push(function o(t,a,h,l){var u=h.nodes[t];return l.getDependency("node",t).then(function(t){var a;return void 0===u.skin?t:l.getDependency("skin",u.skin).then(function(t){for(var e=[],i=0,r=(a=t).joints.length;i<r;i++)e.push(l.getDependency("node",a.joints[i]));return Promise.all(e)}).then(function(o){return t.traverse(function(t){if(t.isMesh){for(var e=[],i=[],r=0,n=o.length;r<n;r++){var s=o[r];s?(e.push(s),s=new Tt,void 0!==a.inverseBindMatrices&&s.fromArray(a.inverseBindMatrices.array,16*r),i.push(s)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[r])}t.bind(new f1(e,i),t.matrixWorld)}}),t})}).then(function(t){a.add(t);var e=[];if(u.children)for(var i=u.children,r=0,n=i.length;r<n;r++){var s=i[r];e.push(o(s,t,h,l))}return Promise.all(e)})}(n[o],r,e,this));return Promise.all(s).then(function(){return r})},t})(),v1=function(t){op.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};v1.prototype=Object.assign(Object.create(op.prototype),{constructor:v1,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,i,e,r){var n=new hp(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&n.setWithCredentials(!0),n.load(t,t=>{var e={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,e).then(i).catch(r)},e,r)},decodeDracoFile:function(t,e,i,r){r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,r).then(e)},decodeGeometry:function(i,r){for(var t in r.attributeTypes){var e=r.attributeTypes[t];void 0!==e.BYTES_PER_ELEMENT&&(r.attributeTypes[t]=e.name)}var n,s=JSON.stringify(r);if(v1.taskCache.has(i)){var o=v1.taskCache.get(i);if(o.key===s)return o.promise;if(0===i.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a=this.workerNextTaskID++,o=i.byteLength,o=this.Gl(a,o).then(t=>(n=t,new Promise((t,e)=>{n.Ul[a]={resolve:t,reject:e},n.postMessage({type:"decode",id:a,taskConfig:r,buffer:i},[i])}))).then(t=>this.Hl(t.geometry));return o.finally(()=>{n&&a&&this.Bl(n,a)}),v1.taskCache.set(i,{key:s,promise:o}),o},Hl:function(t){var e=new et;t.index&&e.setIndex(new J(t.index.array,1));for(var i=0;i<t.attributes.length;i++){var r=t.attributes[i],n=r.name;e.setAttribute(n,new J(r.array,r.itemSize))}return e},zl:function(i,t){var r=new hp(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((t,e)=>{r.load(i,t,void 0,e)})},preload:function(){return this.Vl(),this},Vl:function(){var i,t;return this.decoderPending||(t=[],(i="object"!=typeof WebAssembly||"js"===this.decoderConfig.type)?t.push(this.zl("draco_decoder.js","text")):(t.push(this.zl("draco_wasm_wrapper.js","text")),t.push(this.zl("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var e=t[0],t=(i||(this.decoderConfig.wasmBinary=t[1]),v1.DRACOWorker.toString()),e=["/* draco decoder */",e,"","/* worker */",t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([e]))})),this.decoderPending},Gl:function(t,e){return this.Vl().then(()=>{this.workerPool.length<this.workerLimit?((i=new Worker(this.workerSourceURL)).Ul={},i.Wl={},i.Yl=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(t){var e=t.data;switch(e.type){case"decode":i.Ul[e.id].resolve(e);break;case"error":i.Ul[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},this.workerPool.push(i)):this.workerPool.sort(function(t,e){return t.Yl>e.Yl?-1:1});var i=this.workerPool[this.workerPool.length-1];return i.Wl[t]=e,i.Yl+=e,i})},Bl:function(t,e){t.Yl-=t.Wl[e],delete t.Ul[e],delete t.Wl[e]},debug:function(){this.workerPool.map(t=>t.Yl)},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),v1.DRACOWorker=function(){var i,e;onmessage=function(t){var s=t.data;switch(s.type){case"init":i=s.decoderConfig,e=new Promise(function(e){i.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(i)});break;case"decode":var o=s.buffer,a=s.taskConfig;e.then(t=>{var t=t.draco,e=new t.Decoder,i=new t.DecoderBuffer;i.Init(new Int8Array(o),o.byteLength);try{var r=((t,e,i,r)=>{var n,s,o=r.attributeIDs,a=r.attributeTypes,h=e.GetEncodedGeometryType(i);if(h===t.TRIANGULAR_MESH)n=new t.Mesh,s=e.DecodeBufferToMesh(i,n);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");n=new t.PointCloud,s=e.DecodeBufferToPointCloud(i,n)}if(!s.ok()||0===n.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var l,u,c,f={index:null,attributes:[]};for(l in o){var d=self[a[l]];if(r.useUniqueIDs)c=o[l],u=e.GetAttributeByUniqueId(n,c);else{if(-1===(c=e.GetAttributeId(n,t[o[l]])))continue;u=e.GetAttribute(n,c)}f.attributes.push(((t,e,i,r,n,s)=>{var o,a,h=s.num_components(),l=i.num_points()*h;switch(n){case Float32Array:o=new t.DracoFloat32Array,e.GetAttributeFloatForAllPoints(i,s,o),a=new Float32Array(l);break;case Int8Array:o=new t.DracoInt8Array,e.GetAttributeInt8ForAllPoints(i,s,o),a=new Int8Array(l);break;case Int16Array:o=new t.DracoInt16Array,e.GetAttributeInt16ForAllPoints(i,s,o),a=new Int16Array(l);break;case Int32Array:o=new t.DracoInt32Array,e.GetAttributeInt32ForAllPoints(i,s,o),a=new Int32Array(l);break;case Uint8Array:o=new t.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(i,s,o),a=new Uint8Array(l);break;case Uint16Array:o=new t.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(i,s,o),a=new Uint16Array(l);break;case Uint32Array:o=new t.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(i,s,o),a=new Uint32Array(l);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var u=0;u<l;u++)a[u]=o.GetValue(u);return t.destroy(o),{name:r,array:a,itemSize:h}})(t,e,n,l,d,u))}if(h===t.TRIANGULAR_MESH){for(var v=n.num_faces(),p=new Uint32Array(3*v),m=new t.DracoInt32Array,g=0;g<v;++g){e.GetFaceFromMesh(n,g,m);for(var _=0;_<3;++_)p[3*g+_]=m.GetValue(_)}f.index={array:p,itemSize:1},t.destroy(m)}return t.destroy(n),f})(t,e,i,a),n=r.attributes.map(t=>t.array.buffer);r.index&&n.push(r.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:r},n)}catch(t){console.error(t),self.postMessage({type:"error",id:s.id,error:t.message})}finally{t.destroy(i),t.destroy(e)}})}}},v1.taskCache=new WeakMap,v1.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},v1.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},v1.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},v1.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};class p1 extends rv{constructor(t){super(),this.R=t,this.Xl=new Lp,this.Zl=new d1,this.ql=!1,this.Jl=!1,this.R.Ri.decoderURL&&((t=new v1).setDecoderPath(this.R.Ri.decoderURL),this.Zl.setDRACOLoader(t))}}Object.assign(p1.prototype,{ia(n,s,i){if(!this.ba.has(n)){this.ba.set(n,{loadComplete:!1});let r=-1===n.indexOf(".js"),t=this.Zl;return(t=r?t:this.Xl).load(n,(t,e)=>{if(!0!==this.Jl){if(r)this.ba.set(n,{gltf:t,data:e,isAnimate:0<t.animations.length,isGltf:!0,loadComplete:!0}),s&&s(r,t);else{if(Array.isArray(e))for(var i of e)i.map&&this.ql&&i.color.setScalar(1);else e.map&&this.ql&&e.color.setScalar(1);this.ba.set(n,{geometry:t,material:e,isGltf:!1,loadComplete:!0}),s&&s(r,t,e)}this.R.Vt.Kl(),this.Ql(n,!1)}},function(t){},e=>{var t;!0!==this.Jl&&(this.ba.delete(n),i&&i(e),(t=this.ya.get(n))&&t.forEach(t=>{t.fail&&t.fail(e)}),this.ya.delete(n),this.R.Vt.Kl(),this.Ql(n,e))})}this.wa(n,{success:s,fail:i}),!0===this.ba.get(n).loadComplete&&(this.R.Vt.Kl(),this.Ql(n))},Ql(s,o){if(this.ya.has(s)){let n=this.ba.get(s);n&&(this.ya.get(s).forEach((t,e,i)=>{var r;o?e.fail&&e.fail(o):n.isGltf?n.isAnimate?this.Zl.parse(n.data,Nv.extractUrlBase(s),function(t){e.success&&e.success(!0,t)},function(t){e.fail&&e.fail(t)}):((r={animations:[]}).scene=n.gltf.scene.clone(),r.scene.traverse(t=>{"Mesh"===t.type&&delete t.userData.sourceMaterial}),e.success&&e.success(!0,r)):e.success&&e.success(!1,n.geometry,n.material),i.delete(t)}),this.ya.delete(s))}},Kt(){this.Jl=!0,this.ba.clear(),this.ya.clear(),this.Xl=null,this.Zl.fileLoaders.forEach(t=>{t.dispose()}),this.Zl.fileLoaders.length=0,this.Zl=null}});class m1 extends rv{constructor(t){var e;super(),this.Zl=new d1,t.Ri.decoderURL&&((e=new v1).setDecoderPath(t.Ri.decoderURL),this.Zl.setDRACOLoader(e))}}function h(){this.type="Curve",this.arcLengthDivisions=200}function g1(t,e,i,r,n,s,o,a){h.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}function _1(t,e,i,r,n,s){g1.call(this,t,e,i,i,r,n,s),this.type="ArcCurve"}function b1(){var n=0,s=0,o=0,a=0;function h(t,e,i,r){o=-3*(n=t)+3*e-2*(s=i)-r,a=2*t-2*e+i+r}return{initCatmullRom:function(t,e,i,r,n){h(e,i,n*(i-t),n*(r-e))},initNonuniformCatmullRom:function(t,e,i,r,n,s,o){t=(e-t)/n-(i-t)/(n+s)+(i-e)/s,n=(i-e)/s-(r-e)/(s+o)+(r-i)/o;h(e,i,t*=s,n*=s)},calc:function(t){var e=t*t;return n+s*t+o*e+a*(e*t)}}}Object.assign(m1.prototype,{ia(i,r,n){this.ba.has(i)?(this.wa(i,{success:r,fail:n}),!0===this.ba.get(i).loadComplete&&this.Ql(i)):(this.ba.set(i,{loadComplete:!1}),this.Zl.load(i,(t,e)=>{t.scene.userData.sourceScale=t.scene.scale.clone(),this.ba.set(i,{gltf:t,isAnimate:0<t.animations.length,data:0<t.animations.length?e:null,loadComplete:!0}),this.wa(i,{success:r,fail:n}),this.Ql(i)},function(t){},t=>{this.ba.delete(i),n&&n(t),this.Ql(i,t)}))},Ql(s,o){if(this.ya.has(s)){let n=this.ba.get(s);n&&(this.ya.get(s).forEach((t,e,i)=>{var r;o?e.fail&&e.fail(o):n.isAnimate?this.Zl.parse(n.data,Nv.extractUrlBase(s),function(t){t.scene.userData.sourceScale=t.scene.scale.clone(),e.success&&e.success(t)},function(t){e.fail&&e.fail(t)}):((r={animations:[]}).scene=n.gltf.scene.clone(!0),e.success&&e.success(r)),i.delete(t)}),this.ya.delete(s))}},Kt(){this.Zl=null,this.ba.clear(),this.ba=null,this.ya.clear(),this.ya=null}}),Object.assign(h.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){t=this.getUtoTmapping(t);return this.getPoint(t,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,r=[],n=this.getPoint(0),s=0;for(r.push(0),i=1;i<=t;i++)s+=(e=this.getPoint(i/t)).distanceTo(n),r.push(s),n=e;return this.cacheArcLengths=r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){for(var i,r=this.getLengths(),n=0,s=r.length,o=e||t*r[s-1],a=0,h=s-1;a<=h;)if((i=r[n=Math.floor(a+(h-a)/2)]-o)<0)a=n+1;else{if(!(0<i)){h=n;break}h=n-1}return r[n=h]===o?n/(s-1):(n+(o-(e=r[n]))/(r[n+1]-e))/(s-1)},getTangent:function(t){var e=t-1e-4,t=t+1e-4,e=(1<t&&(t=1),this.getPoint(e=e<0?0:e));return this.getPoint(t).clone().sub(e).normalize()},getTangentAt:function(t){t=this.getUtoTmapping(t);return this.getTangent(t)},computeFrenetFrames:function(t,e){for(var i,r=new Lt,n=[],s=[],o=[],a=new Lt,h=new Tt,l=0;l<=t;l++)n[l]=this.getTangentAt(l/t),n[l].normalize();s[0]=new Lt,o[0]=new Lt;var u=Number.MAX_VALUE,c=Math.abs(n[0].x),f=Math.abs(n[0].y),d=Math.abs(n[0].z);for(c<=u&&(u=c,r.set(1,0,0)),f<=u&&(u=f,r.set(0,1,0)),d<=u&&r.set(0,0,1),a.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],a),o[0].crossVectors(n[0],s[0]),l=1;l<=t;l++)s[l]=s[l-1].clone(),o[l]=o[l-1].clone(),a.crossVectors(n[l-1],n[l]),a.length()>Number.EPSILON&&(a.normalize(),i=Math.acos(Et.clamp(n[l-1].dot(n[l]),-1,1)),s[l].applyMatrix4(h.makeRotationAxis(a,i))),o[l].crossVectors(n[l],s[l]);if(!0===e)for(i=Math.acos(Et.clamp(s[0].dot(s[t]),-1,1)),i/=t,0<n[0].dot(a.crossVectors(s[0],s[t]))&&(i=-i),l=1;l<=t;l++)s[l].applyMatrix4(h.makeRotationAxis(n[l],i*l)),o[l].crossVectors(n[l],s[l]);return{tangents:n,normals:s,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),g1.prototype=Object.create(h.prototype),g1.prototype.constructor=g1,g1.prototype.isEllipseCurve=!0,g1.prototype.getPoint=function(t,e){for(var e=e||new St,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,n=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;i<r;)r-=i;r<Number.EPSILON&&(r=n?0:i),!0!==this.aClockwise||n||(r===i?r=-i:r-=i);var s,o,a,h,n=this.aStartAngle+t*r,t=this.aX+this.xRadius*Math.cos(n),n=this.aY+this.yRadius*Math.sin(n);return 0!==this.aRotation&&(s=Math.cos(this.aRotation),o=Math.sin(this.aRotation),t=(a=t-this.aX)*s-(h=n-this.aY)*o+this.aX,n=a*o+h*s+this.aY),e.set(t,n)},g1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},_1.prototype=Object.create(g1.prototype),_1.prototype.constructor=_1,_1.prototype.isArcCurve=!0;var y1=new Lt,w1=new b1,x1=new b1,M1=new b1;function E1(t,e,i,r){h.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=r||.5}function L1(t,e,i,r,n){var e=.5*(r-e),n=.5*(n-i),s=t*t;return(2*i-2*r+e+n)*(t*s)+(-3*i+3*r-2*e-n)*s+e*t+i}function T1(t,e){t=1-t;return t*t*e}function S1(t,e){return 2*(1-t)*t*e}function A1(t,e){return t*t*e}function O1(t,e,i,r){return T1(t,e)+S1(t,i)+A1(t,r)}function C1(t,e){t=1-t;return t*t*t*e}function R1(t,e){var i=1-t;return 3*i*i*t*e}function N1(t,e){return 3*(1-t)*t*t*e}function D1(t,e){return t*t*t*e}function k1(t,e,i,r,n){return C1(t,e)+R1(t,i)+N1(t,r)+D1(t,n)}function P1(t,e,i,r){h.call(this),this.type="CubicBezierCurve",this.v0=t||new St,this.v1=e||new St,this.v2=i||new St,this.v3=r||new St}function I1(t,e,i,r){h.call(this),this.type="CubicBezierCurve3",this.v0=t||new Lt,this.v1=e||new Lt,this.v2=i||new Lt,this.v3=r||new Lt}function F1(t,e){h.call(this),this.type="LineCurve",this.v1=t||new St,this.v2=e||new St}function j1(t,e){h.call(this),this.type="LineCurve3",this.v1=t||new Lt,this.v2=e||new Lt}function G1(t,e,i){h.call(this),this.type="QuadraticBezierCurve",this.v0=t||new St,this.v1=e||new St,this.v2=i||new St}function U1(t,e,i){h.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Lt,this.v1=e||new Lt,this.v2=i||new Lt}function H1(t){h.call(this),this.type="SplineCurve",this.points=t||[]}function B1(){h.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function z1(t){B1.call(this),this.type="Path",this.currentPoint=new St,t&&this.setFromPoints(t)}function V1(t){z1.call(this,t),this.uuid=Et.generateUUID(),this.type="Shape",this.holes=[]}E1.prototype=Object.create(h.prototype),E1.prototype.constructor=E1,E1.prototype.isCatmullRomCurve3=!0,E1.prototype.getPoint=function(t,e){var i,r,n,s,e=e||new Lt,o=this.points,a=o.length,t=(a-(this.closed?0:1))*t,h=Math.floor(t),t=t-h;return this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/a)+1)*a:0===t&&h===a-1&&(h=a-2,t=1),i=this.closed||0<h?o[(h-1)%a]:(y1.subVectors(o[0],o[1]).add(o[0]),y1),r=o[h%a],n=o[(h+1)%a],h=this.closed||h+2<a?o[(h+2)%a]:(y1.subVectors(o[a-1],o[a-2]).add(o[a-1]),y1),"centripetal"===this.curveType||"chordal"===this.curveType?(o="chordal"===this.curveType?.5:.25,a=Math.pow(i.distanceToSquared(r),o),(s=Math.pow(r.distanceToSquared(n),o))<1e-4&&(s=1),a<1e-4&&(a=s),(o=Math.pow(n.distanceToSquared(h),o))<1e-4&&(o=s),w1.initNonuniformCatmullRom(i.x,r.x,n.x,h.x,a,s,o),x1.initNonuniformCatmullRom(i.y,r.y,n.y,h.y,a,s,o),M1.initNonuniformCatmullRom(i.z,r.z,n.z,h.z,a,s,o)):"catmullrom"===this.curveType&&(w1.initCatmullRom(i.x,r.x,n.x,h.x,this.tension),x1.initCatmullRom(i.y,r.y,n.y,h.y,this.tension),M1.initCatmullRom(i.z,r.z,n.z,h.z,this.tension)),e.set(w1.calc(t),x1.calc(t),M1.calc(t)),e},E1.prototype.copy=function(t){h.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},P1.prototype=Object.create(h.prototype),P1.prototype.constructor=P1,P1.prototype.isCubicBezierCurve=!0,P1.prototype.getPoint=function(t,e){var e=e||new St,i=this.v0,r=this.v1,n=this.v2,s=this.v3;return e.set(k1(t,i.x,r.x,n.x,s.x),k1(t,i.y,r.y,n.y,s.y)),e},P1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},I1.prototype=Object.create(h.prototype),I1.prototype.constructor=I1,I1.prototype.isCubicBezierCurve3=!0,I1.prototype.getPoint=function(t,e){var e=e||new Lt,i=this.v0,r=this.v1,n=this.v2,s=this.v3;return e.set(k1(t,i.x,r.x,n.x,s.x),k1(t,i.y,r.y,n.y,s.y),k1(t,i.z,r.z,n.z,s.z)),e},I1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},F1.prototype=Object.create(h.prototype),F1.prototype.constructor=F1,F1.prototype.isLineCurve=!0,F1.prototype.getPoint=function(t,e){e=e||new St;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},F1.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},F1.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},F1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},j1.prototype=Object.create(h.prototype),j1.prototype.constructor=j1,j1.prototype.isLineCurve3=!0,j1.prototype.getPoint=function(t,e){e=e||new Lt;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},j1.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},j1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},G1.prototype=Object.create(h.prototype),G1.prototype.constructor=G1,G1.prototype.isQuadraticBezierCurve=!0,G1.prototype.getPoint=function(t,e){var e=e||new St,i=this.v0,r=this.v1,n=this.v2;return e.set(O1(t,i.x,r.x,n.x),O1(t,i.y,r.y,n.y)),e},G1.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},U1.prototype.getPoint=function(t,e){var e=e||new Lt,i=this.v0,r=this.v1,n=this.v2;return e.set(O1(t,i.x,r.x,n.x),O1(t,i.y,r.y,n.y),O1(t,i.z,r.z,n.z)),e},H1.prototype=Object.create(h.prototype),H1.prototype.constructor=H1,H1.prototype.isSplineCurve=!0,H1.prototype.getPoint=function(t,e){var e=e||new St,i=this.points,t=(i.length-1)*t,r=Math.floor(t),t=t-r,n=i[0===r?r:r-1],s=i[r],o=i[r>i.length-2?i.length-1:r+1],i=i[r>i.length-3?i.length-1:r+2];return e.set(L1(t,n.x,s.x,o.x,i.x),L1(t,n.y,s.y,o.y,i.y)),e},H1.prototype.copy=function(t){h.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push(r.clone())}return this},B1.prototype=Object.assign(Object.create(h.prototype),{constructor:B1,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new F1(e,t))},getPoint:function(t){for(var e,i,r,n=t*this.getLength(),s=this.getCurveLengths(),o=0;o<s.length;){if(s[o]>=n)return e=s[o]-n,r=(i=this.curves[o]).getLength(),i.getPointAt(0===r?0:1-e/r);o++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],r=0,n=this.curves;r<n.length;r++)for(var s=n[r],o=s&&s.isEllipseCurve?2*t:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o),h=0;h<a.length;h++){var l=a[h];e&&e.equals(l)||(i.push(l),e=l)}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(t){h.prototype.copy.call(this,t),this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}}),z1.prototype=Object.assign(Object.create(B1.prototype),{constructor:z1,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var i=new F1(this.currentPoint.clone(),new St(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,i,r){t=new G1(this.currentPoint.clone(),new St(t,e),new St(i,r));return this.curves.push(t),this.currentPoint.set(i,r),this},bezierCurveTo:function(t,e,i,r,n,s){t=new P1(this.currentPoint.clone(),new St(t,e),new St(i,r),new St(n,s));return this.curves.push(t),this.currentPoint.set(n,s),this},splineThru:function(t){var e=new H1([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,i,r,n,s){var o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,r,n,s),this},absarc:function(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this},ellipse:function(t,e,i,r,n,s,o,a){var h=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+h,e+l,i,r,n,s,o,a),this},absellipse:function(t,e,i,r,n,s,o,a){t=new g1(t,e,i,r,n,s,o,a),0<this.curves.length&&((e=t.getPoint(0)).equals(this.currentPoint)||this.lineTo(e.x,e.y)),this.curves.push(t),i=t.getPoint(1);return this.currentPoint.copy(i),this},copy:function(t){return B1.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this}}),V1.prototype=Object.assign(Object.create(z1.prototype),{constructor:V1,getPointsHoles:function(t){for(var e=[],i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){z1.prototype.copy.call(this,t),this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var r=t.holes[e];this.holes.push(r.clone())}return this}});var W1={triangulate:function(t,e,i){i=i||2;var r,n,s,o,a,h=e&&e.length,l=h?e[0]*i:t.length,u=Y1(t,0,l,i,!0),c=[];if(u&&u.next!==u.prev){if(h&&(u=$1(t,e,u,i)),t.length>80*i){for(var f=r=t[0],d=n=t[1],v=i;v<l;v+=i)(s=t[v])<f&&(f=s),(o=t[v+1])<d&&(d=o),r<s&&(r=s),n<o&&(n=o);a=0!==(a=Math.max(r-f,n-d))?1/a:0}Z1(u,c,i,f,d,a)}return c}};function Y1(t,e,i,r,n){var s,o;if(n===0<bm(t,e,i,r))for(s=e;s<i;s+=r)o=mm(s,t[s],t[s+1],o);else for(s=i-r;e<=s;s-=r)o=mm(s,t[s],t[s+1],o);return o&&um(o,o.next)&&(gm(o),o=o.next),o}function X1(t,e){if(!t)return t;e=e||t;var i,r=t;do{if(i=!1,r.steiner||!um(r,r.next)&&0!==lm(r.prev,r,r.next))r=r.next;else{if(gm(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Z1(t,e,i,r,n,s,o){if(t){!o&&s&&rm(t,r,n,s);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,s?J1(t,r,n,s):q1(t))e.push(a.i/i),e.push(t.i/i),e.push(h.i/i),gm(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?Z1(t=K1(t,e,i),e,i,r,n,s,2):2===o&&Q1(t,e,i,r,n,s):Z1(X1(t),e,i,r,n,s,1);break}}}function q1(t){var e=t.prev,i=t,r=t.next;if(0<=lm(e,i,r))return!1;for(var n=t.next.next;n!==t.prev;){if(am(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=lm(n.prev,n,n.next))return!1;n=n.next}return!0}function J1(t,e,i,r){var n=t.prev,s=t,o=t.next;if(0<=lm(n,s,o))return!1;for(var a=(n.x<s.x?n.x<o.x?n:o:s.x<o.x?s:o).x,h=(n.y<s.y?n.y<o.y?n:o:s.y<o.y?s:o).y,l=(n.x>s.x?n.x>o.x?n:o:s.x>o.x?s:o).x,u=(n.y>s.y?n.y>o.y?n:o:s.y>o.y?s:o).y,c=sm(a,h,e,i,r),f=sm(l,u,e,i,r),d=t.prevZ,v=t.nextZ;d&&d.z>=c&&v&&v.z<=f;){if(d!==t.prev&&d!==t.next&&am(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=lm(d.prev,d,d.next))return!1;if(d=d.prevZ,v!==t.prev&&v!==t.next&&am(n.x,n.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=lm(v.prev,v,v.next))return!1;v=v.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&am(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=lm(d.prev,d,d.next))return!1;d=d.prevZ}for(;v&&v.z<=f;){if(v!==t.prev&&v!==t.next&&am(n.x,n.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=lm(v.prev,v,v.next))return!1;v=v.nextZ}return!0}function K1(t,e,i){var r=t;do{var n=r.prev,s=r.next.next}while(!um(n,s)&&cm(n,r,r.next,s)&&dm(n,s)&&dm(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),gm(r),gm(r.next),r=t=s),(r=r.next)!==t);return r}function Q1(t,e,i,r,n,s){var o=t;do{for(var a,h=o.next.next;h!==o.prev;){if(o.i!==h.i&&hm(o,h))return a=pm(o,h),o=X1(o,o.next),a=X1(a,a.next),Z1(o,e,i,r,n,s),void Z1(a,e,i,r,n,s);h=h.next}}while((o=o.next)!==t)}function $1(t,e,i,r){for(var n,s=[],o=0,a=e.length;o<a;o++)(n=Y1(t,e[o]*r,o<a-1?e[o+1]*r:t.length,r,!1))===n.next&&(n.steiner=!0),s.push(om(n));for(s.sort(tm),o=0;o<s.length;o++)em(s[o],i),i=X1(i,i.next);return i}function tm(t,e){return t.x-e.x}function em(t,e){(e=im(t,e))&&X1(e=pm(e,t),e.next)}function im(t,e){var i,r=e,n=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&o<a){if((o=a)===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}}while((r=r.next)!==e);if(!i)return null;if(n===o)return i.prev;for(var h,l=i,u=i.x,c=i.y,f=1/0,r=i.next;r!==l;)n>=r.x&&r.x>=u&&n!==r.x&&am(s<c?n:o,s,u,c,s<c?o:n,s,r.x,r.y)&&((h=Math.abs(s-r.y)/(n-r.x))<f||h===f&&r.x>i.x)&&dm(r,t)&&(i=r,f=h),r=r.next;return i}function rm(t,e,i,r){for(var n=t;null===n.z&&(n.z=sm(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==t;);n.prevZ.nextZ=null,n.prevZ=null,nm(n)}function nm(t){var e,i,r,n,s,o,a,h,l=1;do{for(i=t,s=t=null,o=0;i;){for(o++,r=i,e=a=0;e<l&&(a++,r=r.nextZ);e++);for(h=l;0<a||0<h&&r;)0!==a&&(0===h||!r||i.z<=r.z)?(i=(n=i).nextZ,a--):(r=(n=r).nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}}while(s.nextZ=null,l*=2,1<o);return t}function sm(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function om(t){for(var e=t,i=t;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),(e=e.next)!==t;);return i}function am(t,e,i,r,n,s,o,a){return 0<=(n-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(r-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(n-o)*(r-a)}function hm(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!fm(t,e)&&dm(t,e)&&dm(e,t)&&vm(t,e)}function lm(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function um(t,e){return t.x===e.x&&t.y===e.y}function cm(t,e,i,r){return!!(um(t,i)&&um(e,r)||um(t,r)&&um(i,e))||0<lm(t,e,i)!=0<lm(t,e,r)&&0<lm(i,r,t)!=0<lm(i,r,e)}function fm(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&cm(i,i.next,t,e))return!0}while((i=i.next)!==t);return!1}function dm(t,e){return lm(t.prev,t,t.next)<0?0<=lm(t,e,t.next)&&0<=lm(t,t.prev,e):lm(t,e,t.prev)<0||lm(t,t.next,e)<0}function vm(t,e){for(var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r}function pm(t,e){var i=new _m(t.i,t.x,t.y),r=new _m(e.i,e.x,e.y),n=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=n).prev=i,(r.next=i).prev=r,(s.next=r).prev=s,r}function mm(t,e,i,r){t=new _m(t,e,i);return r?(t.next=r.next,(t.prev=r).next.prev=t,r.next=t):(t.prev=t).next=t,t}function gm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _m(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bm(t,e,i,r){for(var n=0,s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}var ym={area:function(t){for(var e=t.length,i=0,r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return.5*i},isClockWise:function(t){return ym.area(t)<0},triangulateShape:function(t,e){var i=[],r=[],n=[],s=(wm(t),xm(i,t),t.length);e.forEach(wm);for(var o=0;o<e.length;o++)r.push(s),s+=e[o].length,xm(i,e[o]);for(var a=W1.triangulate(i,r),o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function wm(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function xm(t,e){for(var i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}function Mm(t,e){Is.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Em(t,e)),this.mergeVertices()}function Em(t,c){et.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:c},c=c||12;var f=[],d=[],v=[],p=[],e=0,m=0;if(!1===Array.isArray(t))r(t);else for(var i=0;i<t.length;i++)r(t[i]),this.addGroup(e,m,i),e+=m,m=0;function r(t){var e,i=d.length/3,t=t.extractPoints(c),r=t.shape,n=t.holes;for(!1===ym.isClockWise(r)&&(r=r.reverse()),o=0,a=n.length;o<a;o++)e=n[o],!0===ym.isClockWise(e)&&(n[o]=e.reverse());for(var s=ym.triangulateShape(r,n),o=0,a=n.length;o<a;o++)e=n[o],r=r.concat(e);for(o=0,a=r.length;o<a;o++){var h=r[o];d.push(h.x,h.y,0),v.push(0,0,1),p.push(h.x,h.y)}for(o=0,a=s.length;o<a;o++){var l=s[o],u=l[0]+i;f.push(u,l[1]+i,l[2]+i),m+=3}}this.setIndex(f),this.setAttribute("position",new x(d,3)),this.setAttribute("normal",new x(v,3)),this.setAttribute("uv",new x(p,2))}function Lm(t,e){Is.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Tm(t,e)),this.mergeVertices()}function Tm(t,K){et.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:K},t=Array.isArray(t)?t:[t];for(var Q=this,$=[],tt=[],e=0,i=t.length;e<i;e++)(t=>{var r=[],I=void 0!==K.curveSegments?K.curveSegments:12,f=void 0!==K.steps?K.steps:1,F=void 0!==K.depth?K.depth:100,e=void 0===K.bevelEnabled||K.bevelEnabled,j=void 0!==K.bevelThickness?K.bevelThickness:6,G=void 0!==K.bevelSize?K.bevelSize:j-2,U=void 0!==K.bevelOffset?K.bevelOffset:0,d=void 0!==K.bevelSegments?K.bevelSegments:3,i=K.extrudePath,H=void 0!==K.UVGenerator?K.UVGenerator:Sm;void 0!==K.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),F=K.amount);var n,s,o,a,h,l,u,c,B=!1;i&&(n=i.getSpacedPoints(f),e=!(B=!0),s=i.computeFrenetFrames(f,!1),o=new Lt,a=new Lt,h=new Lt),e||(U=G=j=d=0);var v=(i=t.extractPoints(I)).shape,p=i.holes;if(!ym.isClockWise(v))for(v=v.reverse(),u=0,c=p.length;u<c;u++)l=p[u],ym.isClockWise(l)&&(p[u]=l.reverse());var m=ym.triangulateShape(v,p),g=v;for(u=0,c=p.length;u<c;u++)l=p[u],v=v.concat(l);function _(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}var b,y,w,x,M,E,L=v.length,z=m.length;function V(t,e,i){var r=t.x-e.x,n=t.y-e.y,s=i.x-t.x,o=i.y-t.y,a=r*r+n*n;if(Math.abs(r*o-n*s)>Number.EPSILON){var h=Math.sqrt(a),l=Math.sqrt(s*s+o*o),u=e.x-n/h,e=e.y+r/h,h=((i.x-o/l-u)*o-(i.y+s/l-e)*s)/(r*o-n*s),i=(l=u+r*h-t.x)*l+(u=e+n*h-t.y)*u;if(i<=2)return new St(l,u);h=Math.sqrt(i/2)}else{e=!1;r>Number.EPSILON?s>Number.EPSILON&&(e=!0):r<-Number.EPSILON?s<-Number.EPSILON&&(e=!0):Math.sign(n)===Math.sign(o)&&(e=!0),h=e?(l=-n,u=r,Math.sqrt(a)):(l=r,u=n,Math.sqrt(a/2))}return new St(l/h,u/h)}for(var W=[],T=0,S=g.length,A=S-1,O=T+1;T<S;T++,A++,O++)A===S&&(A=0),O===S&&(O=0),W[T]=V(g[T],g[A],g[O]);var C,R,Y=[],X=W.concat();for(u=0,c=p.length;u<c;u++){for(l=p[u],C=[],T=0,S=l.length,A=S-1,O=T+1;T<S;T++,A++,O++)A===S&&(A=0),O===S&&(O=0),C[T]=V(l[T],l[A],l[O]);Y.push(C),X=X.concat(C)}for(b=0;b<d;b++){for(w=b/d,x=j*Math.cos(w*Math.PI/2),y=G*Math.sin(w*Math.PI/2)+U,T=0,S=g.length;T<S;T++)N((M=_(g[T],W[T],y)).x,M.y,-x);for(u=0,c=p.length;u<c;u++)for(l=p[u],C=Y[u],T=0,S=l.length;T<S;T++)N((M=_(l[T],C[T],y)).x,M.y,-x)}for(y=G+U,T=0;T<L;T++)M=e?_(v[T],X[T],y):v[T],B?(a.copy(s.normals[0]).multiplyScalar(M.x),o.copy(s.binormals[0]).multiplyScalar(M.y),h.copy(n[0]).add(a).add(o),N(h.x,h.y,h.z)):N(M.x,M.y,0);for(R=1;R<=f;R++)for(T=0;T<L;T++)M=e?_(v[T],X[T],y):v[T],B?(a.copy(s.normals[R]).multiplyScalar(M.x),o.copy(s.binormals[R]).multiplyScalar(M.y),h.copy(n[R]).add(a).add(o),N(h.x,h.y,h.z)):N(M.x,M.y,F/f*R);for(b=d-1;0<=b;b--){for(w=b/d,x=j*Math.cos(w*Math.PI/2),y=G*Math.sin(w*Math.PI/2)+U,T=0,S=g.length;T<S;T++)N((M=_(g[T],W[T],y)).x,M.y,F+x);for(u=0,c=p.length;u<c;u++)for(l=p[u],C=Y[u],T=0,S=l.length;T<S;T++)M=_(l[T],C[T],y),B?N(M.x,M.y+n[f-1].y,n[f-1].x+x):N(M.x,M.y,F+x)}function Z(t,e){var i,r;for(T=t.length;0<=--T;){(r=(i=T)-1)<0&&(r=t.length-1);for(var n=0,s=f+2*d,n=0;n<s;n++){var o=L*n,a=L*(n+1),h=(c=u=l=h=void 0,e+i+o),l=e+r+o,u=e+r+a,c=e+i+a;D(h),D(l),D(c),D(l),D(u),D(c),h=$.length/3,k((l=H.generateSideWallUV(Q,$,h-6,h-3,h-2,h-1))[0]),k(l[1]),k(l[3]),k(l[1]),k(l[2]),k(l[3])}}}function N(t,e,i){r.push(t),r.push(e),r.push(i)}function q(t,e,i){D(t),D(e),D(i);t=$.length/3,e=H.generateTopUV(Q,$,t-3,t-2,t-1);k(e[0]),k(e[1]),k(e[2])}function D(t){$.push(r[3*t+0]),$.push(r[3*t+1]),$.push(r[3*t+2])}function k(t){tt.push(t.x),tt.push(t.y)}t=$.length/3;if(e){var P=0*L;for(T=0;T<z;T++)q((E=m[T])[2]+P,E[1]+P,E[0]+P);for(P=L*(f+2*d),T=0;T<z;T++)q((E=m[T])[0]+P,E[1]+P,E[2]+P)}else{for(T=0;T<z;T++)q((E=m[T])[2],E[1],E[0]);for(T=0;T<z;T++)q((E=m[T])[0]+L*f,E[1]+L*f,E[2]+L*f)}Q.addGroup(t,$.length/3-t,0);var I=$.length/3,J=0;for(Z(g,J),J+=g.length,u=0,c=p.length;u<c;u++)Z(l=p[u],J),J+=l.length;Q.addGroup(I,$.length/3-I,1)})(t[e]);this.setAttribute("position",new x($,3)),this.setAttribute("uv",new x(tt,2)),this.computeVertexNormals()}Mm.prototype=Object.create(Is.prototype),Mm.prototype.constructor=Mm,Em.prototype=Object.create(et.prototype),Em.prototype.constructor=Em,Lm.prototype=Object.create(Is.prototype),Lm.prototype.constructor=Lm,Tm.prototype=Object.create(et.prototype),Tm.prototype.constructor=Tm;var Sm={generateTopUV:function(t,e,i,r,n){var s=e[3*i],o=e[3*r],r=e[3*r+1],a=e[3*n],n=e[3*n+1];return[new St(s,e[3*i+1]),new St(o,r),new St(a,n)]},generateSideWallUV:function(t,e,i,r,n,s){var o=e[3*i],a=e[3*i+1],i=e[3*i+2],h=e[3*r],l=e[3*r+1],r=e[3*r+2],u=e[3*n],c=e[3*n+1],n=e[3*n+2],f=e[3*s],d=e[3*s+1],e=e[3*s+2];return Math.abs(a-l)<.01?[new St(o,1-i),new St(h,1-r),new St(u,1-n),new St(f,1-e)]:[new St(a,1-i),new St(l,1-r),new St(c,1-n),new St(d,1-e)]}},Am=new St,Om;function Cm(t,e){this.min=void 0!==t?t:new St(1/0,1/0),this.max=void 0!==e?e:new St(-1/0,-1/0)}Object.assign(Cm.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){e=Am.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new St),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new St),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new St),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new St),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Am.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});class Rm{constructor(){}static findNearNthPowerOfTwo(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}static polygonArea(e){if(e.length<3)return 0;let i=e.length;if(e[0].x===e[i-1].x&&e[0].y===e[i-1].y&&--i,i<3)return 0;let r=e[0].y*(e[i-1].x-e[1].x);for(let t=1;t<i-1;++t)r+=e[t].y*(e[t-1].x-e[t+1].x);return.5*(r=e[i-1].y*(e[i-2].x-e[0].x))}static closedPoints(t){var e=t.length;return!(e<3||(t[0].x===t[e-1].x&&t[0].y===t[e-1].y||(t[e]={x:t[e-1].x,y:t[e-1].y}),0))}static IsRectCross(t,e,i,r){return Math.min(t.x,e.x)<=Math.max(i.x,r.x)&&Math.min(i.x,r.x)<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=Math.max(i.y,r.y)&&Math.min(i.y,r.y)<=Math.max(t.y,e.y)}static IsLineSegmentCross(t,e,i,r){var n=t.x*(i.y-e.y)+e.x*(t.y-i.y)+i.x*(e.y-t.y),s=t.x*(r.y-e.y)+e.x*(t.y-r.y)+r.x*(e.y-t.y);return!(0<=(n^s)&&(0!=n||0!=s)||0<=((n=i.x*(t.y-r.y)+r.x*(i.y-t.y)+t.x*(r.y-i.y))^(s=i.x*(e.y-r.y)+r.x*(i.y-e.y)+e.x*(r.y-i.y)))&&(0!=n||0!=s))}static computerFocus(t,e,i,r){var n,s,o;return 0==(s=(r.x-i.x)*(t.y-e.y)-(e.x-t.x)*(i.y-r.y))||(n=(o=(t.y-i.y)*(e.x-t.x)*(r.x-i.x)+i.x*(r.y-i.y)*(e.x-t.x)-t.x*(e.y-t.y)*(r.x-i.x))/s,o=e.y*(t.x-e.x)*(r.y-i.y)+(r.x-e.x)*(r.y-i.y)*(t.y-e.y)-r.y*(i.x-r.x)*(e.y-t.y),0==(s=(t.x-e.x)*(r.y-i.y)-(e.y-t.y)*(i.x-r.x)))?null:{x:n,y:o/s}}static GetLineSegmentCrossPoint(t,e,i,r){return this.IsRectCross(t,e,i,r)?this.computerFocus(t,e,i,r):null}static IsPointInPolygon(i,r){let n=!1;for(let t=0,e=i.length-1;t<i.length;e=t++)(i[t].y<=r.y&&r.y<i[e].y||i[e].y<=r.y&&r.y<i[t].y)&&r.x<(i[e].x-i[t].x)*(r.y-i[t].y)/(i[e].y-i[t].y)+i[t].x&&(n=!n);return n}static PointCmp(t,e,i){var r;return 0<=t.x&&e.x<0||(0===t.x&&0===e.x?t.y>e.y:(r=(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y))<0||!(0<r)&&(e.x-i.x)*(e.x-i.y)+(e.y-i.y)*(e.y-i.y)<(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))}static ClockwiseSortPoints(i){var r,n={x:0,y:0};let e=0,s=0;for(let t=0;t<i.length;t++)e+=i[t].x,s+=i[t].y;n.x=e/i.length,n.y=s/i.length;for(let e=0;e<i.length-1;e++)for(let t=0;t<i.length-e-1;t++)this.PointCmp(i[t],i[t+1],n)&&(r=i[t],i[t]=i[t+1],i[t+1]=r)}static PolygonClip(i,r,n){if(i.length<3||r.length<3)return!1;for(let e=0;e<i.length;e++){var s=(e+1)%i.length;for(let t=0;t<r.length;t++){var o=(t+1)%r.length,o=this.GetLineSegmentCrossPoint(i[e],i[s],r[t],r[o]);o&&n.push(o)}}for(let t=0;t<i.length;t++)this.IsPointInPolygon(r,i[t])&&n.push(i[t]);for(let t=0;t<r.length;t++)this.IsPointInPolygon(i,r[t])&&n.push(r[t]);return!(n.length<=0||(this.ClockwiseSortPoints(n),0))}}class Nm extends Av{constructor(){super(),this.Ch={}}resize(){super.resize(),this.Ch={}}}class Dm{constructor(){}}Object.assign(Dm.prototype,{bs(t,e,i,r,n){n=void 0!==n?"?contentVersion="+n:"";t=new Hc({method:"GET",url:t+e+"/"+e+".theme"+n});return t.bs(function(t){i&&i(t)},function(t){r&&(t===Wr.PATH_ERROR?r(Wr.THEME_ID_URL_ERROR):r(t))}),t}});let km=new Dm,Pm={NORMAL:1,INDOOR:2,OUTDOOR:4};Object.freeze(Pm);var Im=new Lt,Fm=new Lt,jm=new Lt,Gm=new St,Um=new St,Hm=new Tt,Bm=new Lt,zm=new Lt,Vm=new Lt,Wm=new St,Ym=new St,Xm=new St;function Zm(t){var e;Z.call(this),this.type="Sprite",void 0===Om&&(Om=new et,e=new wc(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5),Om.setIndex([0,1,2,0,2,3]),Om.setAttribute("position",new Mc(e,3,0,!1)),Om.setAttribute("uv",new Mc(e,2,3,!1))),this.geometry=Om,this.material=void 0!==t?t:new tv,this.center=new St(.5,.5)}function qm(t,e,i,r,n,s){Gm.subVectors(t,i).addScalar(.5).multiply(r),void 0!==n?(Um.x=s*Gm.x-n*Gm.y,Um.y=n*Gm.x+s*Gm.y):Um.copy(Gm),t.copy(e),t.x+=Um.x,t.y+=Um.y,t.applyMatrix4(Hm)}Zm.prototype=Object.assign(Object.create(Z.prototype),{constructor:Zm,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Fm.setFromMatrixScale(this.matrixWorld),Hm.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),jm.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Fm.multiplyScalar(-jm.z);var i,r,n=this.material.rotation,n=(0!==n&&(r=Math.cos(n),i=Math.sin(n)),this.center);qm(Bm.set(-.5,-.5,0),jm,n,Fm,i,r),qm(zm.set(.5,-.5,0),jm,n,Fm,i,r),qm(Vm.set(.5,.5,0),jm,n,Fm,i,r),Wm.set(0,0),Ym.set(1,0),Xm.set(1,1),null===t.ray.intersectTriangle(Bm,zm,Vm,!1,Im)&&(qm(zm.set(-.5,.5,0),jm,n,Fm,i,r),Ym.set(0,1),null===t.ray.intersectTriangle(Bm,Vm,zm,!1,Im))||(n=t.ray.origin.distanceTo(Im))<t.near||n>t.far||e.push({distance:n,point:Im.clone(),uv:yo.getUV(Im,Bm,zm,Vm,Wm,Ym,Xm,new St),face:null,object:this})},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Z.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});class Jm{constructor(t){this.$l=t,this.er=!0,this.tu=new Map,this.eu={x:1,y:1,z:1},this.iu=!0,this.Ai=null}get visible(){return this.er}set visible(t){this.er=t,this.tu.forEach(t=>{t.ru()})}get show(){return this.iu}set show(t){t!==this.iu&&(this.iu=t,this.nu({opacity:t?1:0,duration:1,finish:()=>{}}))}setFacadeNode(t){let e=t.FID;t.type===p.LABEL&&(e="label"+t.FID),this.tu.set(e,t)}}Object.assign(Jm.prototype,{Xh(t){var e;this.iu=!this.$l.parent.Vt.vs(this.$l),this.$l.su===Pm.NORMAL&&(this.$l.ou(),e=this.$l.parent.P.Ut(this.$l.Ht),this.eu.z=e.isZoomLimit?.2:1),t.Ji&&(t.Ei===p.EXTERNAL_MODEL?(t.Ji.scale.x=this.eu.x,t.Ji.scale.y=this.eu.z,t.Ji.scale.z=this.eu.y):t.Ei===p.MODEL&&(t.Ji.scale.x=this.eu.x,t.Ji.scale.y=this.eu.y,t.Ji.scale.z=this.eu.z)),this.nu({opacity:this.iu?1:0,duration:1,finish:()=>{}})},au(s,o){if(o.scale.z!==this.eu.z||o.scale.y!==this.eu.y){let t=void 0!==o.duration?o.duration:.5;this.eu=o.scale,this.tu.forEach(n=>{if((n.Ei===p.MODEL||n.Ei===p.EXTERNAL_MODEL)&&n.Ji){let e={x:n.Ji.scale.x,y:n.Ji.scale.y,z:n.Ji.scale.z},i={x:o.scale.x-e.x,y:o.scale.z-e.y,z:o.scale.y-e.z},r=(n.Ei===p.MODEL&&(i={x:o.scale.x-e.x,y:o.scale.y-e.y,z:o.scale.z-e.z}),new en({src:[0],dest:[1]}));r.ot(t).st(t=>{t=t.destination[0];n.Ji?(n.Ji.scale.x=i.x*t+e.x,n.Ji.scale.y=i.y*t+e.y,n.Ji.scale.z=i.z*t+e.z,s.enableUpdateRender()):s.lt.ht(r)}).nt(()=>{s.lt.ht(r),o.finish&&o.finish()}),s.lt.ut(r.et())}})}},nu(n){this.Ai?this.Ai.finish():this.Ai=new en,this.visible=!0;let i=this.$l.parent,s=[];if(this.tu.forEach(r=>{r.Ji&&r.Ji.traverse(e=>{if(e.constructor===Q){var i;r.Ei===p.MODEL&&(i=e.material.clone(),e.material.dispose(),e.material=i);let t=e.material;Array.isArray(t)||(t=[t]),r.hu&&t.push(r.hu.material),t.forEach(t=>{"FMMeshStandardMaterial"===t.type?s.push({material:t,offset:n.opacity-t.uniforms.opacity.value,opacity:t.uniforms.opacity.value}):s.push({material:t,offset:n.opacity-t.opacity,opacity:t.opacity})})}})}),this.Ai.Nt([0]).Rt([1]).ot(n.duration).st(t=>{var e=t.destination[0];for(let t=0;t<s.length;t++)"FMMeshStandardMaterial"===s[t].material.type?s[t].material.uniforms.opacity.value=s[t].offset*e+s[t].opacity:s[t].material.opacity=s[t].offset*e+s[t].opacity,s[t].material.transparent=!0,s[t].needsUpdate=!0;i.enableUpdateRender()}).nt(()=>{this.visible=this.iu;for(let t=0;t<s.length;t++)"FMMeshStandardMaterial"===s[t].material.type?s[t].material.uniforms.opacity.value=s[t].opacity:s[t].material.opacity=s[t].opacity,s[t].needsUpdate=!0;i.lt.ht(this.Ai),n.finish&&n.finish(),i.enableUpdateRender()}).play(),i.lt.ut(this.Ai),0===n.duration){this.Ai.finish();for(let t=0;t<s.length;t++)"FMMeshStandardMaterial"===s[t].material.type?s[t].material.uniforms.opacity.value=n.opacity:s[t].material.opacity=n.opacity,s[t].needsUpdate=!0,i.enableUpdateRender()}}});class Km extends Es{constructor(t){super(t),this.lu=t.minlevel,this.uu=t.maxlevel,this.cu=t.levelChart,this.fu=t.fids,this.su=Pm.NORMAL,this.du=new Jm(this),this.vu=!1,this.pu=new Map,this.mu=!0}get zoomRange(){return{minLevel:this.lu,maxLevel:this.uu}}get alignHeight(){return this.mu&&(this.gu(),this.mu=!1),this.pu}get overviewMode(){return this.su}get visible(){return this.er}set visible(t){this.er=t,this.U.Vt._u(this),this.U.enableUpdateNode()}get levelChart(){return this.cu}setTheme(t){this.U.Vt.bu({themeID:t,bid:this.Ht})}setThemeExtension(t){this.U.Vt.yu({data:t,bid:this.Ht})}clearThemeExtension(){this.U.Vt.yu({bid:this.Ht})}getFadeFeatures(){var t,e=[];for(t of this.du.tu.values())e.push(t);return e}dispose(){super.dispose()}}function Qm(t,e){return Object.assign({},e.Ri,{buildingID:t.sr,level:t.level,visibleLevels:t.visibleLevels,bid:t.Ht})}function $m(t){Object.assign(t.prototype,{wu(e,i,t){var r=this.P.Ut(this.R.S.Ht).themeID,n=this.Ri,s=this.rl.get(this.Ri.buildingID).theme;let o="";if(o=t===this.Ri.buildingID?n.userThemeURL?n.userThemeURL+r:n.themeURL+r:(t=(t=this.rl.get(t))&&t.theme?t.theme.themeID:r,n.userThemeURL?n.userThemeURL+t:n.themeURL+t),n.isPreview){let t=n.themeURL;return"path"===i?("1"===e.isuser?t+=s.userPath+"/":t+=s.sysPath+"/",t):"logoPath"===i?t+=s.logoPath+"/":"model"===i?("1"===e.isuser?t+=s.userModelPath+"/":t+=s.sysModelPath+"/",t):void 0}if("model"===i){if(n.externalModelURL)return n.externalModelURL+"models/";if(n.userThemeURL)return o+"/models/"}return o+"/"},xu(e){if(this.Mu||(this.Mu=[0,0,0,0,0]),!this.Mu.every(t=>1==t)){let t=!0;switch(e){case"sceneLoaded":this.Mu[0]=1,t=1===this.Mu[0],this.Eu=5;break;case"loaded":this.Mu[1]=1,t=1===this.Mu[1],this.Eu=85;break;case"externalFirstLoaded":this.Mu[2]=1,this.Mu[4]?this.Eu=100:t=!1;break;case"visibleLevelsLoaded":this.Mu[3]=1,t=1===this.Mu[3],this.Eu=55;break;case"firstViewLoaded":this.Mu[4]=1,this.Mu[2]?this.Eu=100:t=!1}t&&this.R.Yt.Wt({type:"progress",progressBar:this.Eu})}},Kl(){if(this.P&&!this.P.Lu){if(this.P.us&&0===this.Jn.length){let e=!0;if(this.Tu.ba.forEach(t=>{t.loadComplete||(e=!1)}),e)t:for(let t=0;t<this.R.children.length;t++){var i=this.R.children[t];if(!this.Su(i)){var r=i.getFloor(i.level)?.children[1];if(r)for(let t=0;t<r.children.length;t++){var n=r.children[t];if(1===n.Au||0===n.Au||!0!==n.Ou){e=!1;break t}}}}e&&(this.P.Lu=!0,this.R.Yt.Wt({type:"externalFirstLoaded"}),this.xu("externalFirstLoaded"))}this.P&&!this.P.Lu&&(clearTimeout(this.Cu),this.Cu=setTimeout(()=>{this.Kl()},50))}},Ru(t,o){if(this.Ri.tile&&!this.Ri.preLoad){let n=[],s=t.building;for(let t=0;t<s.visibleLevels.length;t++){var e=s.getFloor(s.visibleLevels[t]);e&&0===this.Nu(e)&&(this.Du(e)?(e.ku(),this.Pu(e)):n.push(s.visibleLevels[t]))}0<n.length?((t=Qm(s,this)).buildings=null,this.R.Mr.ia(t,(t,i)=>{if("floor"===t){var r=this.P.Iu(s.Ht);if(r.set(i.gid,!0),-1<n.indexOf(i.gid)){t=s.getFloor(i.gid);this.Fu(t);let e=!0;for(let t=0;t<n.length;t++)if(!r.get(n[t])){e=!1;break}e&&o&&o()}}})):o&&o()}else o&&o()},ju(t,e={}){var i=this.P.Ut(t),r=i.themeExtension||e.themeExtension,n=i.themeID||e.themeID;(i.themeID=n)&&t?(this.rl.set(t,{theme:new Av}),i.themeLoaded=!1,i.themeNeedLoad=!0,this.vl({bid:t,themeID:n,themeExtension:r,contentVersion:e.contentVersion})):(i.themeLoaded=!0,i.themeNeedLoad=!1)},Gu(o){o=o||[];var t=this.R.Ri.buildingOptions;let a=t.buildings||t.themeID,h=null,l=()=>{var e=this.R.getBuildings();if(!1===this.R.dl)h=setTimeout(l,1);else{null!==h&&clearTimeout(h);var i=[];if(0<o.length)for(let t=0;t<o.length;t++){var r=o[t].bcode,r=this.Uu(r);this.ju(r,o[t]),i.push(r)}if(a)for(let t=0;t<e.length;t++){var n=e[t].buildingID;i.includes(n)||this.ju(n)}if(i.length!==e.length)for(let t=0;t<e.length;t++){var s=e[t].buildingID;i.includes(s)||((s=this.P.Ut(s)).themeLoaded=!0,s.themeNeedLoad=!1)}}};l()},vl(r){return new Promise((i,t)=>{this.Hu(r,t=>{var e=this.rl.get(r.bid);e.theme.Xh(t),e.theme.themeID=r.themeID,r.themeExtension&&(e.themeExtension=new Nm,e.themeExtension.Xh(r.themeExtension)),this.P.Ut(r.bid).themeLoaded=!0,r.bid===this.Ri.buildingID&&(this.P.Bu(this.zu),this.R.setBackgroundColor(this.P.backgroundColor,this.P.backgroundAlpha),this.Ri.isPreview?this.zu.fl(this.R):this.Gu(t.buildings)),this.P.pl=this.ml(),(this.P.Vu||this.P.Wu)&&(this.$(null,null,this.P.Vu,!1,this.P.Wu,this.P.pl),this.P.Vu)&&(this.P.Vu=!1),i()})})},Hu(t,i){if(t.theme)i(t.theme);else{let e="_loadTheme"+Et.generateUUID();this.po.fo(e),km.bs(this.Ri.themeURL,t.themeID,t=>{i&&i(t),this.po.do(e)},t=>{this.R.Yt.Wt({type:"info",InfoMode:t}),this.po.do(e)},t.contentVersion)}},Yu(t){var e,i=this.P.Ut(t.Ht);i.buildingLoaded||(this.Ri.tile?this.vs(t)?((e=Qm(t,this)).buildings=null,e.isOutdoor=!1,this.Xu(e)):i.sceneLoaded||this.Ri.tile&&((e=Qm(t,this)).buildings=null,e.isOutdoor=!1,this.Zu(e)):((i=Object.assign({},this.Ri)).isOutdoor=!1,i.buildingID=t.sr,i.bid=t.Ht,i.buildings=null,this.qu(i)))},Ju(t,e){let i=null;t=this.R.getBuilding(t.bid),e={type:"info",InfoMode:e,buildingID:i=t?t.Ht:i};this.R.Xi.error.push(e),this.R.Yt.Wt(e)},Ku(t,e){let i=null;t.buildingID!==t.mapID&&(i=t.bid),this.Qu({bid:t.bid,levels:e.levels}),this.R.Yt.Wt({type:"sceneLoaded",buildingID:i}),this.R.Yt.Wt({type:"info",InfoMode:Wr.INFO,mapID:e.mid,buildingID:i})},qu(a){this.R.Mr.ra(a,(t,s)=>{if(!(0<this.R.Xi.error.length))if("complete"===t)if(a.isOutdoor){var e=this.$u(s);if(!(0<this.R.Xi.error.length)){var i=this.P.Ut(e.Ht);if(i.buildingLoaded=!0,!(i.sceneLoaded=!0)!==this.tc(s,!0)){var r=this.P.Iu(e.Ht);for(let t=0;t<e.ur.length;t++){var n=s.I.get(e.ur[t]),o=(r.set(n.gid,!0),this.Uo(e,n,e.ur[t]));this.Fu(o),this.ec(e,n.gid)}}}}else this.R.I.forEach(e=>{if(e.sr===s.mid){e.ur=s.levels,e.vr=new Ct(new Lt(s.minX,s.minY),new Lt(s.maxX,s.maxY));var t=this.P.Ut(e.Ht),i=(t.buildingLoaded=!0,t.sceneLoaded=!0,this.P.Iu(e.Ht));for(let t=0;t<s.levels.length;t++){var r=s.I.get(s.levels[t]),n=(i.set(r.gid,!0),this.Uo(e,r,s.levels[t]));this.Fu(n),this.ec(e,r.gid)}}});else if("decode"===t){let t=null;i=this.R.getBuilding(a.bid);i&&(t=i.Ht),this.Qu({bid:void 0!==a.bid?a.bid:a.buildingID,levels:s.scene.levels}),this.R.Yt.Wt({type:"sceneLoaded",buildingID:t}),this.R.Yt.Wt({type:"info",InfoMode:Wr.INFO,mapID:s.scene.mid,buildingID:t})}else"error"===t&&this.Ju(a,s)})},tc(e,i){if(e.buildings)for(let t=0;t<e.buildings.length;t++){var r=this.ic(e.buildings[t]);if(0<this.R.Xi.error.length&&i)return!1;this.Yu(r)}return e.buildings&&0!==e.buildings.length&&e.buildings.length!==this.R.I.length-1||(this.R.dl=!0),!0},rc(e,i){for(let t=0;t<e.ur.length;t++){var r=i.I.get(e.ur[t]);this.Uo(e,r,e.ur[t])}},Xu(n){this.R.Mr.ia(n,(t,e)=>{if(!(0<this.R.Xi.error.length)){if("building"===t){let t=null;var i=this.P.Ut(n.bid),r=i.sceneLoaded;i.buildingLoaded=!0,i.sceneLoaded=!0,n.buildingID===n.mapID?(t=this.$u(e),this.tc(e,!1)):(t=this.R.getBuilding(n.bid),r||(t.ur=e.levels,t.vr=new Ct(new Lt(e.minX,e.minY),new Lt(e.maxX,e.maxY)))),r||this.rc(t,e)}"scene"===t&&this.Ku(n,e),"floor"===t&&(i=this.R.getBuilding(n.bid),this.P.Iu(i.Ht).set(e.gid,!0),(r=i.getFloor(e.gid)).Ki=e,this.Fu(r),this.ec(i,e.gid)),"error"===t&&this.Ju(n,e)}})},Zu(n){let i=null;this.R.Mr.yo(n,(t,e)=>{"building"===t?((i=this.R.getBuilding(n.bid)).ur=e.levels,i.vr=new Ct(new Lt(e.minX,e.minY),new Lt(e.maxX,e.maxY)),this.P.Ut(i.Ht).sceneLoaded=!0,this.rc(i,e),this.ec(i,void 0)):"scene"===t&&this.Ku(n,e)},(t,e)=>{let i=null;var r=this.R.getBuilding(n.bid);r&&(i=r.Ht),this.R.Yt.Wt({type:"info",InfoMode:e,buildingID:i})})},_u(t){this.Yu(t)},ec(t,e){var i=this.P.Ut(t.Ht),r=i.loaded,n=i.visibleLevelsLoaded;this.nc(t),!n&&i.visibleLevelsLoaded&&(this.P.Vu&&this.P.pl?(this.$(null,e,!0,!0,!1,this.P.pl),this.P.Vu=!1):this.$(null,e,!1,!0,!1,this.P.pl),n={type:"visibleLevelsLoaded"},t!==this.R.S&&(n.buildingID=t.Ht),this.R.Yt.Wt(n)),!r&&i.loaded&&(t!==this.R.S?this.R.Yt.Wt({type:"buildingLoaded",buildingID:t.Ht}):this.R.Yt.Wt({type:"mapLoaded"})),this.P.Wu&&this.P.pl&&this.$(null,e,!1,!1,!0,this.P.pl)},ml(){let e=!0;for(let t=0;t<this.R.I.length;t++){var i=this.R.I[t];if(i.constructor===Km){if(this.vs(i)&&!this.P.ml(i.Ht)){e=!1;break}}else if(!this.P.ml(i.Ht)){e=!1;break}}return e}})}Object.assign(Km.prototype,{ut(t){(t.U=this).I.push(t)},ou(){var t,e=this.parent.P.Ut(this.Ht);this.su===Pm.OUTDOOR?e.isZoomLimit=!1:(t=this.parent.getZoom(),e.isZoomLimit=!(t<this.lu||t>=this.uu))},sc(t={}){this.ou();var e=this.parent.P.Ut(this.Ht);this.du.au(this.parent,{scale:{x:1,y:1,z:e.isZoomLimit?.2:1},duration:void 0!==t.duration?t.duration:1,finish:()=>{}})},gu(){if(this.U){var e=this.U.S;for(let t=0;t<this.cu.length;t+=2){var i=e.floorSpace*this.cu[t];this.pu.set(this.cu[t+1],i)}}},oc(e){if(null==this.level)for(let t=0;t<this.cu.length;t+=2){var i;this.cu[t]===e&&((i=this.parent.P.Ut(this.Ht)).level=this.cu[t+1],i.visibleLevels=[this.cu[t+1]])}}});let tg={NAME:2,ENAME:4,FID:8};Object.freeze(tg);class eg extends Es{constructor(t){super(t),this.T=t.height,this.vr=t.bounds,this.ac=t.zoom}get height(){return this.T}get floorSpace(){return super.floorSpace}set floorSpace(t){super.floorSpace=t,this.U.traverse(t=>{t!==this&&(t.mu=!0,t.traverse(t=>{t.pr({animate:!1})}))})}getFloors(){return this.I}}Object.assign(eg.prototype,{ut(t){(t.U=this).I.push(t)}});class ig{constructor(t=0,e=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){var i=t.x,r=t.y,t=t.z,n=e.x,s=e.y,e=e.z;return this.x=r*e-t*s,this.y=t*n-i*e,this.z=i*s-r*n,this}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e?Math.PI/2:(t=this.dot(t)/e,e=Math.max(-1,Math.min(1,t)),Math.acos(e))}normalize(){return this.divideScalar(this.length()||1)}divideScalar(t){return this.multiplyScalar(1/t)}}class rg{constructor(t){this.Yn=t.size,this.wi=t.center,this.hc=t.points}get size(){return this.Yn}get min(){return{x:this.wi.x-this.Yn.x/2,y:this.wi.y-this.Yn.y/2}}get max(){return{x:this.wi.x+this.Yn.x/2,y:this.wi.y+this.Yn.y/2}}get center(){return{x:this.wi.x,y:this.wi.y}}get points(){return this.hc}}class ng{constructor(t){this.lc=[],this.Yn=null,this.uc=[],this.Se=void 0!==t.distance?t.distance:0,this.cc=void 0!==t.circleSegment?t.circleSegment:8,this.fc=Math.PI/2/this.cc,this.dc=void 0!==t.endCapStyle?t.endCapStyle:"circle",this.vc=void 0!==t.isSingleSide&&t.isSingleSide}computeOffsetCurve(e){this.uc=[];let i=null;var t,r,n=this.Se,s="left";for(let t=2;t<e.length;t++){var o=e[t-2],a=e[t-1],h=e[t],l={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this.mc({p0:o,p1:a},s,n,l),{p0:a,p1:h}),c={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this.mc(u,s,n,c),this.gc(o,a,h));0==u?this._c(l,c):-1==u?this.bc(u,l,c,a):this.yc(u,l,c,a),i=c}this.uc.push(i.p1),this.wc(e[e.length-2],e[e.length-1]);for(let t=e.length-1;2<=t;t--){var f=e[t],d=e[t-1],v=e[t-2],p={p0:{x:null,y:null},p1:{x:null,y:null}},m=(this.mc({p0:f,p1:d},s,n,p),{p0:d,p1:v}),g={p0:{x:null,y:null},p1:{x:null,y:null}},m=(this.mc(m,s,n,g),this.gc(f,d,v));0==m?this._c(p,g):-1==m?this.bc(m,p,g,d):this.yc(m,p,g,d),i=g}return this.uc.push(i.p1),this.wc(e[1],e[0]),this.uc=this.xc(this.uc),this.uc.length<1||(t=this.uc[0],r=this.uc[this.uc.length-1],t.x===r.x&&t.y===r.y||this.uc.push(t),this.uc=this.Mc(this.uc,e),this.uc.length<1)?[]:this.uc}computeSingleSidedBufferCurve(i,r){this.uc=[];let n=null,s=this.Se;if("left"==r){let e=!1;for(let t=2;t<i.length;t++){var o=i[t-2],a=i[t-1],h=i[t],l={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this.mc({p0:o,p1:a},r,s,l),{p0:a,p1:h}),c={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this.mc(u,r,s,c),this.gc(o,a,h));e||(this.uc.push(l.p0),e=!0),0==u?this._c(l,c):-1==u&&"left"===r||1==u&&"right"===r?this.bc(u,l,c,a):this.yc(u,l,c,a),n=c}this.uc.push(n.p1),this.Ec(i[i.length-2],i[i.length-1],"left");for(let t=i.length-1;0<=t;t--)this.uc.push(i[t]);this.Ec(i[1],i[0],"right")}else if("right"==r){r="left",s=-s,this.Se=s;let e=!1;for(let t=i.length-1;2<=t;t--){var f=i[t],d=i[t-1],v=i[t-2],p={p0:{x:null,y:null},p1:{x:null,y:null}},m=(this.mc({p0:f,p1:d},r,s,p),{p0:d,p1:v}),g={p0:{x:null,y:null},p1:{x:null,y:null}},m=(this.mc(m,r,s,g),this.gc(f,d,v));e||(this.uc.push(p.p0),e=!0),0==m?this._c(p,g):-1==m&&"left"===r||1==m&&"right"===r?this.bc(m,p,g,d):this.yc(m,p,g,d),n=g}this.uc.push(n.p1),this.Ec(i[1],i[0],"left");for(let t=0;t<i.length;t++)this.uc.push(i[t]);this.Ec(i[i.length-2],i[i.length-1],"right")}var t,e;return this.uc=this.xc(this.uc),this.uc=this.Mc(this.uc),this.uc.length<1?[]:(t=this.uc[0],e=this.uc[this.uc.length-1],t.x===e.x&&t.y===e.y||this.uc.push(t),this.uc)}computeSingleSideRingBufferCurve(e,i,t){this.uc=[],!t&&this.vc&&(this.Se=-this.Se);var r,n=this.Se;if("left"===i){this.Lc(e[e.length-2],e[0],e[1],i);for(let t=2;t<e.length;t++){var s=e[t-2],o=e[t-1],a=e[t],h={p0:{x:null,y:null},p1:{x:null,y:null}},l=(this.mc({p0:s,p1:o},i,n,h),{p0:o,p1:a}),u={p0:{x:null,y:null},p1:{x:null,y:null}},l=(this.mc(l,i,n,u),this.gc(s,o,a));0==l?this._c(h,u):-1==l&&"left"===i||1==l&&"right"===i?this.bc(l,h,u,o):this.yc(l,h,u,o)}}else if("right"===i){this.Lc(e[1],e[0],e[e.length-2],i="left");for(let t=e.length-1;2<=t;t--){var c=e[t],f=e[t-1],d=e[t-2],v={p0:{x:null,y:null},p1:{x:null,y:null}},p=(this.mc({p0:c,p1:f},i,n,v),{p0:f,p1:d}),m={p0:{x:null,y:null},p1:{x:null,y:null}},p=(this.mc(p,i,n,m),this.gc(c,f,d));0==p?this._c(v,m):-1==p&&"left"===i||1==p&&"right"===i?this.bc(p,v,m,f):this.yc(p,v,m,f)}}return this.uc=this.xc(this.uc),this.uc=this.Mc(this.uc),this.uc.length<1?[]:(t=this.uc[0],r=this.uc[this.uc.length-1],t.x===r.x&&t.y===r.y||this.uc.push(t),this.uc)}isCCW(e){let i=0;for(let t=0;t<e.length-1;t++)i+=e[t].x*e[t+1].y-e[t].y*e[t+1].x;return!(i<0)}mc(t,e,i,r){var e="left"===e?1:-1,n=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,o=Math.sqrt(n*n+s*s),n=e*i*n/o,e=e*i*s/o;r.p0.x=t.p0.x-e,r.p0.y=t.p0.y+n,r.p1.x=t.p1.x-e,r.p1.y=t.p1.y+n}gc(t,e,i){var r=e.x-t.x,n=i.x-e.x,r=r*(i.y-e.y)-(e.y-t.y)*n;return 0<r?1:r<0?-1:0}_c(t,e){this.uc.push(t.p1),this.uc.push(e.p0)}bc(t,e,i,r){U.Se(e,i)<.001*this.Se?this.uc.push(e.p1):(this.uc.push(e.p1),this.Tc(r,e.p1,i.p0,t,this.Se),this.uc.push(i.p0))}yc(t,e,i,r){var n={x:null,y:null};let s=e.p1.x-e.p0.x,o=e.p1.y-e.p0.y,a=i.p1.x-i.p0.x,h=i.p1.y-i.p0.y;if(Math.abs(s*h-a*o)<.001){if(U.be(i.p0,i.p1,e.p1))return void this.uc.push(e.p1);this.uc.push(i.p0)}U.ke(e.p0,e.p1,i.p0,i.p1,n)?this.uc.push(n):(this.Sc=!0,U.Se(e.p1,i.p0)<.001*this.Se?this.uc.push(e.p1):(this.uc.push(e.p1),this.uc.push(i.p0)))}Tc(t,e,i,r,n){var s=e.x-t.x;let o=Math.atan2(e.y-t.y,s);s=i.x-t.x,s=Math.atan2(i.y-t.y,s);-1===r?o<=s&&(o+=2*Math.PI):o>=s&&(o-=2*Math.PI),this.uc.push(e),this.Ac(t,o,s,r,n),this.uc.push(i)}Ac(e,i,t,r,n){var s=-1===r?-1:1,r=Math.abs(i-t),o=Math.trunc(r/this.fc+.5);if(o<1)return null;var a=r/o;for(let t=0;t<o;t++){var h=i+s*t*a,l={x:null,y:null};l.x=e.x+n*Math.cos(h),l.y=e.y+n*Math.sin(h),this.uc.push(l)}}wc(t,e){var i={p0:t,p1:e},r={p0:{x:null,y:null},p1:{x:null,y:null}},n=(this.mc(i,"left",this.Se,r),{p0:{x:null,y:null},p1:{x:null,y:null}}),i=(this.mc(i,"right",this.Se,n),e.x-t.x),s=Math.atan2(e.y-t.y,i);switch(this.dc){case"circle":this.uc.push(r.p1),this.Ac(e,s+Math.PI/2,s-Math.PI/2,-1,this.Se),this.uc.push(n.p1);break;case"flat":this.uc.push(r.p1),this.uc.push(n.p1);break;case"square":var o={x:null,y:null},a=(o.x=Math.abs(this.Se)*Math.cos(s),o.y=Math.abs(this.Se)*Math.sin(s),{x:r.p1.x+o.x,y:r.p1.y+o.y}),o={x:n.p1.x+o.x,y:n.p1.y+o.y};this.uc.push(a),this.uc.push(o)}}Ec(t,e,i){var r,n,s={p0:t,p1:e},o={p0:{x:null,y:null},p1:{x:null,y:null}},s=("left"==i?this.mc(s,"left",this.Se,o):"right"==i&&this.mc(s,"right",this.Se,o),e.x-t.x),a=Math.atan2(e.y-t.y,s),h={x:null,y:null};switch(h.x=Math.abs(this.Se)*Math.cos(a),h.y=Math.abs(this.Se)*Math.sin(a),this.dc){case"circle":"left"==i?(this.uc.push(o.p1),this.Ac(e,a+Math.PI/2,a,-1,this.Se),this.uc.push({x:e.x+h.x,y:e.y+h.y})):"right"==i&&(this.uc.push({x:e.x+h.x,y:e.y+h.y}),this.Ac(e,a,a-Math.PI/2,-1,this.Se),this.uc.push(o.p1));break;case"flat":break;case"square":"left"==i?(r={x:o.p1.x+h.x,y:o.p1.y+h.y},n={x:e.x+h.x,y:e.y+h.y},this.uc.push(r),this.uc.push(n)):"right"==i&&(r={x:o.p1.x+h.x,y:o.p1.y+h.y},n={x:e.x+h.x,y:e.y+h.y},this.uc.push(n),this.uc.push(r))}}xc(e){var i=[];for(let t=0;t<e.length-1;t++)U.distance(e[t],e[t+1])<1e-4||i.push(e[t]);return 1e-4<U.distance(e[e.length-1],e[e.length-2])&&i.push(e[e.length-1]),i}Mc(r,n){if(r.length<=4)return r;for(;;){let i=null;for(let e=1;e<r.length;e++){var s=r[e-1],o=r[e];for(let t=e+2;t<r.length;t++){var a=r[t-1],h=r[t];if(1!==e||t!==r.length-1){var l={x:null,y:null};if(U.ke(s,o,a,h,l)){i={start:e,length:t-e,cross:l};break}}}if(i)break}if(!i)return r;var{start:u,length:c,cross:f}=i;let t=!1;for(let e of[[...r.slice(0,u),f,...r.slice(u+c),r[0]],[f,...r.slice(u,u+c),f]])if(!n||"circle"!==this.dc&&"square"!==this.dc?n&&"flat"===this.dc?2<=n.length&&(t=n.slice(1,n.length-1).every(t=>U.Le(t,e,e.length-1))):t=!0:t=n.every(t=>U.Le(t,e,e.length-1)),t){r=e;break}}}Lc(t,e,i,r){var n={p0:{x:null,y:null},p1:{x:null,y:null}},s=(this.mc({p0:t,p1:e},r,this.Se,n),{p0:e,p1:i}),o={p0:{x:null,y:null},p1:{x:null,y:null}},s=(this.mc(s,r,this.Se,o),this.gc(t,e,i));0==s?this._c(n,o):-1==s&&"left"===r||1==s&&"right"===r?this.bc(s,n,o,e):this.yc(s,n,o,e)}}class sg{constructor(){}static distance(t,e){return U.distance(t,e)}static isContain(t,e){return U.isPolygonContainPoint(t,e)}static bound(e){let i=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MAX_VALUE;for(let t=0;t<e.length;t++)e[t].x>i&&(i=e[t].x),e[t].y>r&&(r=e[t].y),e[t].x<n&&(n=e[t].x),e[t].y<s&&(s=e[t].y);return{max:{x:i,y:r},min:{x:n,y:s},size:{x:i-n,y:r-s},center:{x:(i+n)/2,y:(r+s)/2}}}static orientedBound(s){var t={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]};if(s&&0!=s.length){var o=tn.cov(s),a=tn.eig(o).eigVect;let e=Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let t=0;t<s.length;t++){var h=s[t].x*a[0][0]+s[t].y*a[0][1],l=s[t].x*a[1][0]+s[t].y*a[1][1];h<e&&(e=h),l<i&&(i=l),h>r&&(r=h),l>n&&(n=l)}var o=[(r+e)/2,(n+i)/2],u=a[0][0]*a[1][1]-a[1][0]*a[0][1],u=[[a[1][1]/u,-a[0][1]/u],[-a[1][0]/u,a[0][0]/u]],o=[u[0][0]*o[0]+u[0][1]*o[1],u[1][0]*o[0]+u[1][1]*o[1]],o=(t.center.x=o[0],t.center.y=o[1],t.size.x=r-e,t.size.y=n-i,[[e,i],[e,n],[r,n],[r,i]]),c=[[],[],[],[]],u=(c[0]=[u[0][0]*o[0][0]+u[0][1]*o[0][1],u[1][0]*o[0][0]+u[1][1]*o[0][1]],c[1]=[u[0][0]*o[1][0]+u[0][1]*o[1][1],u[1][0]*o[1][0]+u[1][1]*o[1][1]],c[2]=[u[0][0]*o[2][0]+u[0][1]*o[2][1],u[1][0]*o[2][0]+u[1][1]*o[2][1]],c[3]=[u[0][0]*o[3][0]+u[0][1]*o[3][1],u[1][0]*o[3][0]+u[1][1]*o[3][1]],new ig(1,0,0)),o=new ig(c[0][0],0,c[0][1]),o=new ig(c[3][0],0,c[3][1]).clone().sub(o).normalize(),f=o.angleTo(u)*U.de(),o=0<o.clone().cross(u).y?f:360-f,f=new ig(c[0][0],0,c[0][1]),f=new ig(c[1][0],0,c[1][1]).clone().sub(f).normalize(),d=f.angleTo(u)*U.de(),f=0<f.clone().cross(u).y;return t.rotation={x:o,y:f?d:360-d},t.corners=[{x:c[0][0],y:c[0][1]},{x:c[1][0],y:c[1][1]},{x:c[2][0],y:c[2][1]},{x:c[3][0],y:c[3][1]}],t}}static scaleBound(t,e){var{max:t,min:i}=t,t=new St(t.x,t.y),i=new St(i.x,i.y),r=t.clone().add(i).multiplyScalar(.5),t=t.clone().sub(i),i=t.clone().normalize(),t=t.clone().length()*e,e=r.clone().add(i.clone().multiplyScalar(t/2)),r=r.clone().add(i.clone().multiplyScalar(-t/2)),i=e.x,t=e.y,e=r.x,r=r.y;return{max:{x:i,y:t},min:{x:e,y:r},size:{x:Math.abs(i-e),y:Math.abs(t-r)},center:{x:(i+e)/2,y:(t+r)/2}}}static rectangleBuilder(t,e,i){var r=[];return r.push({x:i.x-t/2,y:i.y+e/2}),r.push({x:i.x+t/2,y:i.y+e/2}),r.push({x:i.x+t/2,y:i.y-e/2}),r.push({x:i.x-t/2,y:i.y-e/2}),r}static circleBuilder(e,i,r){var n=[];for(let t=0;t<=r;t++){var s=t/r*Math.PI*2;n.push({x:i.x+e*Math.cos(s),y:i.y+e*Math.sin(s)})}return n}static fanBuilder(e,i,r,t){var n=[],s=(n.push(i),[t[0]/180*Math.PI,t[1]/180*Math.PI]),o=(s[1]-s[0])/r;for(let t=0;t<=r;t++){var a=s[0]+t*o;n.push({x:i.x+e*Math.sin(a),y:i.y+e*Math.cos(a)})}return n}static area(t){return U.De(t,t.length)}static TriangleCentroid(t,e,i,r){var n=e.x-t.x,s=i.x-t.x;return r.area=(n*(i.y-t.y)-s*(e.y-t.y))/2,r.centroid={},r.centroid.x=(t.x+e.x+i.x)/3,r.centroid.y=(t.y+e.y+i.y)/3,!0}static calculatorInsideCentroid(e,t){var i=e.length;if(i<3)return!1;var n=[];for(let t=1;t<i-1;t++){var r={};this.TriangleCentroid(e[0],e[t],e[t+1],r),n.push(r)}let s=[],o=(n.forEach(function(t,e,i){s.push(t)}),!1);s.sort(function(t,e){return(0<t.area?t.area:-t.area)-(0<e.area?e.area:-e.area)});for(;0<s.length&&!(o=this.calculatorCentroid(e,s,t));)s.shift();if(!o){let r=[];n.forEach(function(t,e,i){r.push(t)});for(;0<r.length&&!(o=this.calculatorCentroid(e,r,t));)r.shift()}return o}static calculatorCentroid(t,e,i){let r=0;var n={x:0,y:0};for(let t=0;t<e.length;t++)n.x+=e[t].centroid.x*e[t].area,n.y+=e[t].centroid.y*e[t].area,r+=e[t].area;return i.x=n.x/r,i.y=n.y/r,this.isContain(t,i)}static latlngToMapCoordinate(t){return{x:20037508.34*parseFloat(t.x)/180,y:Math.log(Math.tan((90+parseFloat(t.y))*Math.PI/360))/(Math.PI/180)*20037508.34/180}}static mapCoordinateToLatlng(t){var e=parseFloat(t.y)/20037508.34*180;return{x:parseFloat(t.x)/20037508.34*180,y:180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2)}}static maxInnerRect(v,t){if(v&&0!=v.length){var p=new ig(0,0,1),m={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]};let i=Number.MAX_VALUE,r=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=-Number.MAX_VALUE;var g=[];for(let t=0;t<v.length;t++){var _=v[t].x,b=v[t].y;_<i&&(i=_),b<r&&(r=b),_>e&&(e=_),b>n&&(n=b),g.push({x:_,y:b})}var y=(e-i<n-r?e-i:n-r)/100,w=Math.ceil((e-i)/y),x=Math.ceil((n-r)/y),M=[];for(let e=0;e<x-1;e++){var E=new Array(w-1).fill(0);for(let t=0;t<w-1;t++){var L=i+y*t,T=i+y*(t+1),S=r+y*e,A=r+y*(e+1),L=[{x:L,y:S},{x:L,y:A},{x:T,y:A},{x:T,y:S}];U.isPolygonInPolygon(L,g)&&(E[t]=1)}M.push(E)}var O=new Array(w).fill(0);let s=0,o=0,a=0,h=0,l=0;for(let e=0;e<x-1;e++){var C=[];for(let t=0;t<w;t++){for(O[w-1]=0,t<w-1&&(O[t]=1==M[e][t]?O[t]+1:0);0<C.length&&O[C[C.length-1]]>=O[t];){var R=C[C.length-1],N=(C.pop(),O[R]*(0==C.length?t:t-C[C.length-1]-1));N>s&&(s=N,o=0==C.length?0:C[C.length-1]+1,a=t,h=e,l=e-O[R]+1)}C.push(t)}}var D=i+o*y,k=r+(h+1)*y,P=i+(a+1)*y,I=r+l*y,F=[[D,I],[D,k],[P,k],[P,I]];let u=0,c=2,f=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let t=0;t<F.length;t++)F[t][0]*F[t][0]+F[t][1]*F[t][1]<f&&(u=t,f=F[t][0]*F[t][0]+F[t][1]*F[t][1]),F[t][0]*F[t][0]+F[t][1]*F[t][1]>d&&(c=t,d=F[t][0]*F[t][0]+F[t][1]*F[t][1]);m.corners=[{x:F[0][0],y:F[0][1]},{x:F[1][0],y:F[1][1]},{x:F[2][0],y:F[2][1]},{x:F[3][0],y:F[3][1]}],m.center.x=(F[c][0]+F[u][0])/2,m.center.y=(F[c][1]+F[u][1])/2;var D=new ig(F[u][0],0,F[u][1]),k=new ig(F[(u+c)/2][0],0,F[(u+c)/2][1]),P=k.clone().sub(D).normalize(),I=(P.angleTo(p),U.de(),P.clone().cross(p).y,new ig(F[(u+c)/2][0],0,F[(u+c)/2][1])),j=new ig(F[c][0],0,F[c][1]),G=j.clone().sub(I).normalize();return G.angleTo(p),U.de(),G.clone().cross(p).y,P.clone().cross(G).y<0?(m.size.x=k.clone().sub(D).length(),m.size.y=j.clone().sub(I).length()):(m.size.x=j.clone().sub(I).length(),m.size.y=k.clone().sub(D).length()),new rg({center:m.center,size:m.size,points:m.corners})}}static angle(t){var e=new ig(0,0,1),i=new ig(t.start.x,0,t.start.y),t=new ig(t.end.x,0,t.end.y).clone().sub(i).normalize(),i=t.angleTo(e)*U.de();return t.clone().cross(e).y<0?i:360-i}static intersection(t,e){var i={x:null,y:null};return 2<=t.length&&2<=e.length&&U.ke(t[0],t[1],e[0],e[1],i),i}static lineBufferBuilder(e,i){var r={points:[],holes:[]};if(void 0!==i.distance&&0!=i.distance){var n=i.distance,s=(i.endCapStyle=void 0!==i.endCapStyle?i.endCapStyle:"circle",i.circleSegment=void 0!==i.circleSegment?i.circleSegment:8,null!=i.isSingleSide&&i.isSingleSide),o=e[e.length-1].x==e[0].x&&e[e.length-1].y==e[0].y;if(!(o&&e.length<4)){let t=!1;i=new ng(i);o&&(t=i.isCCW(e)),s?o?0<n?t?r.points=i.computeSingleSideRingBufferCurve(e,"right",!0):r.points=i.computeSingleSideRingBufferCurve(e,"left",!0):(t?r.points=i.computeSingleSideRingBufferCurve(e,"left",!1):r.points=i.computeSingleSideRingBufferCurve(e,"right",!1),i.isCCW(r.points)!=t&&(r.points=[])):r.points=0<n?i.computeSingleSidedBufferCurve(e,"left"):i.computeSingleSidedBufferCurve(e,"right"):o?(t?(r.points=i.computeSingleSideRingBufferCurve(e,"right",!0),r.holes=i.computeSingleSideRingBufferCurve(e,"left",!1)):(r.points=i.computeSingleSideRingBufferCurve(e,"left",!0),r.holes=i.computeSingleSideRingBufferCurve(e,"right",!1)),i.isCCW(r.holes)!=t&&(r.holes=[])):r.points=i.computeOffsetCurve(e)}}return r}}function og(t){Object.assign(t.prototype,{Oc(t){var t=this.map.getBuilding(t);return null===t?-1:(t=t.bounds,Math.sqrt((t.maxX-t.minX)*(t.maxX-t.minX)+(t.maxY-t.minY)*(t.maxY-t.minY)))},Cc(t){t=this.R.getBuilding(t.bid);let e=!0;this.vs(t)&&(this._u(t),e=!1),t.du&&(t.du.show=e),this.Bt(),this.R.enableUpdateNode()},Su(t){if(this.vs(t))return!1;{t=t.getFloor(t.level);if(!t)return!0;t=t.getLayers(p.EXTENT_LAYER)[0];if(null==t)return!0;let e=!1;return t&&t.traverse(t=>{e=!sg.isContain(t.coordinates[0],this.R.Rc())}),!!e}},vs(t){return!1!==t.visible&&(t.overviewMode===Pm.INDOOR||(t.overviewMode!==Pm.OUTDOOR||this.P.k===t.buildingID)&&(this.P.k!==this.R.Ri.buildingID?this.P.k===t.Ht:t===this.R.S||!!this.R.Nc(t)&&!!this.R.Dc()))},$u(t){var e=new eg({bid:this.Ri.buildingID,mid:this.Ri.mapID,height:t.height,scaleLevel:t.scaleLevel,name:t.mname,levels:t.levels,x:t.x,y:t.y,bounds:new Ct(new Lt(t.minX,t.minY),new Lt(t.maxX,t.maxY))});return this.R.ut(e),this.R.S=e,this.R.o=t.x,this.R.u=t.y,e},ic(i){var e=this.P.Ut(i.bid);if(!e.visibleLevels||0===e.visibleLevels.length){var r=[];for(let e=0;e<i.levelChart.length;e+=2)for(let t=0;t<this.R.S.visibleLevels.length;t++)i.levelChart[e]===this.R.S.visibleLevels[t]&&r.push(i.levelChart[e+1]);e.visibleLevels=r}if(void 0===e.level)for(let t=0;t<i.levelChart.length;t+=2)i.levelChart[t]===this.R.S.level&&(e.level=i.levelChart[t+1]);var n=new Map;if(i.floors)for(let t=0;t<i.floors.length;t++){var s=i.floors[t].Li,o=i.floors[t].gid;n.set(o,s)}var t=new Km(i);return e.minLevel&&(t.lu=e.minLevel),e.maxLevel&&(t.uu=e.maxLevel),t.su=e.overviewMode,t.kc=n,this.R.ut(t),t},Uu(e){var t=this.R.getBuildings().find(t=>String(t.bcode)===String(e));return t?t.buildingID:null}}),Object.assign(t.prototype,{Pc(){this.R.traverse(t=>{t.traverse(t=>{t=t.getLayers(p.LABEL_LAYER)[0];t&&t.traverse(t=>{this.P.Ic===tg.FID?t.text=t.Ki.fid:this.P.Ic===tg.ENAME?t.text=t.Ki.ename:t.text=t.Ki.name})})})},Fc(t){let e=0;return e=this.R.ft.isPerspectiveCamera?t/(this.R.A.renderer.domElement.clientHeight/(2*Math.tan(this.R.ft.fov*l.DEG2RAD/2))):t*Math.abs(this.R.ft.top-this.R.ft.bottom)/this.R.ft.zoom/this.R.A.renderer.domElement.clientHeight,e=isNaN(e)?1:e},jc(t,e){var i;return this.R.ft.isPerspectiveCamera?(i=new Tt,t.updateMatrixWorld(),this.R.Pi.updateMatrixWorld(),i.multiplyMatrices(this.R.Pi.matrixWorldInverse,t.matrixWorld),t=(new Lt).applyMatrix4(i),this.Fc(e)*Math.abs(t.z)):this.Fc(e)}}),Object.assign(t.prototype,{Gc(t){null!==this.Uc&&(clearTimeout(this.Uc),this.Uc=null),this.Uc=setTimeout(()=>{this.Hc({changeScopeTypes:t.changeScopeTypes,fids:t.fids,succCallback:t.succCallback})},t.time||0)},Hc(t={}){let{changeScopeTypes:e,fids:i}=t,r=(e=e||[p.EXTENT,p.MODEL,p.LABEL,p.FACILITY,p.EXTERNAL_MODEL],i=i||[],[]),n=()=>{if(r.length<=0)this.R.off("update",n),t.succCallback&&t.succCallback();else{let e=0;for(let t=0;t<r.length&&!(20<++e);t++)r[t].Bc(this,this.zu),r.splice(t,1),t--;this.R.enableUpdateRender()}};this.R.off("update",n),this.R.traverse(t=>{t.traverse(t=>{t.parent.visibleLevels.includes(t.level)&&t.traverse(t=>{t.traverse(t=>{(!(0<i.length)||i.includes(t.FID))&&e.includes(t.type)&&t.visible&&t.Bc&&t.Ji&&r.push(t)})})})}),this.R.on("update",n)},zc(t,e){t.Ji&&((!t.du||t.du.visible)&&t.er?t.Ji.visible=t.Ki.maxlevel&&e>=t.Ki.minlevel&&e<t.Ki.maxlevel:t.Ji.visible=!1)},Vc(){this.rl.set(this.Ri.buildingID,{theme:new Av});let e=this.P.Ut(this.Ri.buildingID);e.themeNeedLoad=!0,e.themeLoaded=!1,this.vl({bid:this.Ri.buildingID,themeID:this.Ri.themeID,theme:this.Ri.Wc,themeExtension:this.Ri.themeExtension}).then(()=>{var t;this.Ri.tile?((t=Object.assign({},this.Ri,{level:e.level,visibleLevels:e.visibleLevels})).bid=t.buildingID,this.Xu(t)):this.qu(this.Ri)})},qn(n=!1,t){if(this.P.Yc&&this.Xc&&(ot.environment!==q.WX||1!=this.R.A.Di||this.R.A.yn%2==0)){this.Jn=[];var s=t||this.R.getZoom(),e=this.Ri.tile&&!this.Ri.preLoad;for(let r=0;r<this.R.I.length;r++){var o=this.R.I[r],a=this.Su(o),h=(e=>{var i=[],t=e.getFloor(e.level),r=(t&&i.push(t),e.visibleLevels);for(let t=0;t<r.length;t++)r[t]!==e.level&&e.getFloor(r[t])&&i.push(e.getFloor(r[t]));var n=e.I;for(let t=0;t<n.length;t++)r.indexOf(n[t].level)<0&&i.push(n[t]);return i})(o);for(let t=0;t<h.length;t++){var l=h[t];let i=null;var u=-1<o.visibleLevels.indexOf(l.level),c=(u&&!a&&(i=this.Zc(o,l.level),0===this.Nu(l))&&this.Du(l)&&(l.ku(),this.Pu(l),this.Bt()),[]);for(let t=0;t<l.I.length;t++){var f=l.I[t];if(!u||a&&e)this.qc(f)&&e&&c.push(f);else for(let e=0;e<f.I.length;e++){var d=f.I[e];let t=!0;a||!d.visible||d.du&&!d.du.visible?t=!1:d.Ki&&d.Ki.maxlevel&&(s>=d.Ki.maxlevel||s<d.Ki.minlevel)?(t=!1)===d.canDispose&&(t=!0):this.Jc(d,i)||!0===n||(t=!1),!d.Ji&&t&&this.Jn.push([r,d]),d.initTargetShow=t,!d.Ji||t||d.fading||d.rs||d.Kc&&d.Kc(),d.rs&&d.ss(1)}}for(let t=0;t<c.length;t++)l.remove(c[t]),c[t].dispose()}}this.P.Yc=!1,this.R.enableUpdateRender()}},qc(t){var e=p.EXTENT_LAYER|p.FACILITY_LAYER|p.LABEL_LAYER|p.MODEL_LAYER|p.EXTERNAL_MODEL_LAYER;return 0!=(t.Ei&e)},Kn(){if(0<this.Jn.length){let e=!1,i=0;for(let t=0;t<this.Jn.length&&!(20<++i);t++){var r=this.Jn[t][1];r.Ei!==p.FACILITY&&r.Ei!==p.LABEL||(e=!0),r.Xh(),this.Jn.splice(t,1),t--}e&&this.hs(),this.Kl(),this.R.enableUpdateRender(),this.P.ls&&0===this.Jn.length&&!this.Qc&&(this.R.Yt.Wt({type:"firstViewLoaded"}),this.Qc=!0)}!this.Qc&&this.P.ls&&0===this.Jn.length&&(this.R.Yt.Wt({type:"firstViewLoaded"}),this.Qc=!0)},$c(t,e){var{typeID:e,FID:i}=e,t=this.R.getMapOptions().hideList[t];if(void 0===t)return!0;let r=t.typeIDs,n=t.FIDs;return void 0===r&&(r=[]),void 0===n&&(n=[]),!r.includes(e)&&!n.includes(i)},Pu(t){t.U.Ht===this.Ri.buildingID&&t.traverse(t=>{t.type!==p.MODEL_LAYER&&t.type!==p.EXTERNAL_MODEL_LAYER&&t.type!==p.LABEL_LAYER||t.traverse(i=>{this.R.traverse(e=>{if(e!==this.R.S)for(let t=0;t<e.fu.length;t++)e.fu[t]===i.FID&&(e.du.setFacadeNode(i),i.du=e.du)})})})}})}function ag(i,t){var r=void 0!==(t=t||{}).duration?t.duration:1,n=void 0!==t.size?t.size:8;let s=t.times||void 0,o=void 0!==t.delay?t.delay:0,a=1,h=i.rr(_);if(h){let e;return i.Ai.has("boost")?((e=i.Ai.get("boost")).stop(),h.lt.ht(e)):(e=new en({src:[i.Yn],dest:[n]}),i.Ai.set("boost",e)),e.ot(r).et().st(t=>{i.Ji&&h.A.Wn(i.Ji,t.destination[0]),h.enableUpdateRender()}).nt(()=>{if(!(a>s)){let t=o;0<a%1&&(t=0),e.ee().Qt(t).et(),h.enableUpdateRender(),a+=.5}}),h.lt.ut(e),e}}function hg(t){var e=t.rr(_),i=t.Ai.get("boost");i&&e&&(e.lt.ht(i),t.Ai.delete("boost"),t.Ji&&e.A.Wn(t.Ji,t.Yn),e.enableUpdateRender())}function lg(n,s){let o=n.rr(_);if(o){var a=void 0!==s.duration?s.duration:1;let t=void 0!==s.times?s.times:1/0,e=void 0!==s.delay?s.delay:0,i=(0===t&&(t=1/0),0),r;return n.Ai.has("jump")?((r=n.Ai.get("jump")).Nt([n.T]),r.Rt([n.T+s.height])):(r=new en({src:[n.T],dest:[n.T+s.height]}),n.Ai.set("jump",r),o.lt.ut(r)),r.ot(a).Qt(0).st(t=>{n.Ji&&(n.Ji.position.y=t.destination[0]),o.enableUpdateRender()}).nt(()=>{if((i+=.5)<t){let t=e;i%1==0&&(t=0),r.ee().Qt(t),r.et()}}),r.et(),r}}function ug(t){var e,i;t.Ji&&(e=t.rr(_))&&((i=t.Ai.get("jump"))&&(e.lt.ht(i),t.Ai.delete("jump")),t.Ji.position.y=t.T,e.enableUpdateRender())}function cg(e,i){if(i.Ji){e=e.Fc(i.size||i.Yn);let t=1;i.Ji.material.userData.scaleRatio&&(t=i.Ji.material.userData.scaleRatio),i.Ji.scale.set(e,e/t,e)}}function fg(e){return!0===e.needUpdateBound&&(e.mi.reset(),e.I.forEach(t=>{e.mi.expand(t.bound)}),e.needUpdateBound=!1),e.mi.clone()}class dg extends Ms{constructor(){super(),this.Fn=new As}get scene(){return this.Fn}get bound(){return fg(this)}get isLayer(){return!0}get visible(){return super.visible}set visible(t){(super.visible=t)?this.Fn.parent||this.parent.effectScene.add(this.Fn):this.Fn.parent&&this.parent.effectScene.remove(this.Fn)}init(){this.Fn.position.y=this.parent.T}}class vg extends dg{constructor(t){super(),this.tf=[],void 0!==t&&void 0!==t.type&&(this.Ei=t.type)}getMarkers(){return this.I}add(t){t.U=this,t.ef||t.Xh()?this.Ms(t):this.tf.push(t),this.needUpdateBound=!0}remove(t){this.if(t),t.dispose();var e=this.I.indexOf(t),e=(-1<e&&this.I.splice(e,1),this.tf.indexOf(t));-1<e&&this.tf.splice(e,1),this.needUpdateBound=!0}clear(){for(var t of this.I)this.if(t),t.dispose();this.I.length=0}traverse(t){for(var e of this.I)t&&t(e)}dispose(){for(var t of this.I)this.if(t),t.dispose();this.I.length=0,this.Fn=void 0}}Object.assign(vg.prototype,{rf(){for(var t of this.tf){var e;t.Xh()&&(-1<(e=this.tf.indexOf(t))&&this.tf.splice(e,1),this.Ms(t))}},Ms(t){this.I.push(t),t.Ji&&this.Fn.add(t.Ji)},if(t){t.U=void 0,this.Fn.remove(t.Ji)}});class pg extends vg{constructor(){super(),this.Ei=p.IMAGE_MARKER,this.ns=!0}get collision(){return this.ns}}class mg extends vg{constructor(){super(),this.Ei=p.TEXT_MARKER,this.isHasText=!0,this.ns=!0}get collision(){return this.ns}}class gg extends vg{constructor(){super(),this.Ei=p.POLYGON_MARKER}}class _g extends vg{constructor(){super(),this.Ei=p.EXTRUDE_MARKER}}class bg extends vg{constructor(){super(),this.Ei=p.HEAT_MAP_MARKER,this.nf=!1,this.sf=this.sf.bind(this)}add(t){super.add(t),t.ef&&!t.af&&this.hf(t.lf),0<this.tf.length&&this.rr(_).on("update",this.sf)}remove(t){super.remove(t),this.nf&&this.hf(null)}}function yg(t,e){Tp.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}Object.assign(bg.prototype,{rf(){for(var t of this.tf){var e;t.Xh()&&(-1<(e=this.tf.indexOf(t))&&this.tf.splice(e,1),this.Ms(t),t.af||this.hf(t.lf),t.needUpdateBound=!0)}},hf(n){var t=this.rr(u),e=t.getExtendMesh();let i=e.material.map;(e.material.map=n)?(e.material.mapMixColor=!0,e.material.map.needsUpdate=!0):e.material.mapMixColor=!1,e.material.needsUpdate=!0,t.getModelMeshs().forEach(function(i){if(i)if("MultiMaterial"===i.material.type){var r=i.material.materials.length;let t=0,e;for(;t<r;)(i.material.materials[t].map=n)?(i.material.materials[t].map.needsUpdate=!0,i.material.materials[t].mapMixColor=!0):(i.material.materials[t].mapMixColor=!1,i.material.materials[t].transparent=!0),i.material.materials[t].needsUpdate=!0,e=0===t?3:2,t+=e}else(i.material.map=n)?(i.material.mapMixColor=!0,i.material.map.needsUpdate=!0,1===i.material.opacity&&(i.material.transparent=!1)):(i.material.mapMixColor=!1,i.material.transparent=!0),i.material.needsUpdate=!0}),i&&(i.dispose(),i=null),this.nf=!0},sf(){this.rf(),0===this.tf.length&&this.rr(_).off("update",this.sf)}}),yg.prototype=Object.assign(Object.create(Tp.prototype),{constructor:yg,isAmbientLight:!0});class wg{constructor(t){this.R=t,this.uf=null,this.cf=null,this.ff=null,this.df=null,this.createLight=this.createLight.bind(this)}createLight(t,e){var i=this.R.getMapOptions(),r=i.lockedLight,i=i.lightConfig[e];return t.vf=new yg(i[1].color,i[1].intensity),t.pf=new Z,t.mf=new Op(i[0].color,i[0].intensity),t.mf.position.set(i[0].position.x,i[0].position.y,i[0].position.z),t.mf.target=t.pf,t.gf=new Op(i[2].color,i[2].intensity),t.gf.position.set(i[2].position.x,i[2].position.y,i[2].position.z),t.gf.target=t.pf,this.uf=t,this.cf=e,r&&(this._f=this._f.bind(this),this.R.on("viewChanged",this._f)),this}createLightByTheme(t,e,i){return t.vf=new yg(new ft("rgb("+i[1].color+")"),i[1].intensity),t.mf=new Op(new ft("rgb("+i[0].color+")"),i[0].intensity),t.mf.position.set(i[0].position.x,i[0].position.y,i[0].position.z),t.pf=new Z,t.pf.position.set(i[0].target.x,i[0].target.y,i[0].target.z),t.mf.target=t.pf,t.gf=new Op(new ft("rgb("+i[2].color+")"),i[2].intensity),t.gf.position.set(i[2].position.x,i[2].position.y,i[2].position.z),t.bf=new Z,t.bf.position.set(i[2].target.x,i[2].target.y,i[2].target.z),t.gf.target=t.bf,this.uf=t,this.cf=e,this}}function xg(t,e,i){i.Ji=new Q(t,e),(i.Ji.mapNode=i).Ji.rotation.set(-Math.PI/2,0,0,"XYZ")}function Mg(e){let i=e.rr(_);i.Ri.hdr&&i.Ri.hdr.load(i,t=>{e.Fn.environment=t,i.enableUpdateRender()})}function Eg(t,e,i){var r=new Q(new eo(200,200,1,1),new wo({color:"#38382f",side:2}));return void 0!==t&&(r.rotation.y=t),r.position.set(e.x,e.y,e.z),i.parent.Fn.add(r),r}Object.assign(wg.prototype,{yf(t){var e=new Hr;return e.setFromVector3(t),e.theta},wf(t,e){var i=new Hr,e=(i.setFromVector3(t),i.theta=e,new Lt);e.setFromSpherical(i),t.copy(e)},_f(){var t,e,i;this.uf&&(t=this.yf(this.R.camera.position),null===this.ff&&(e=this.yf(this.uf.mf.position),i=this.yf(this.uf.gf.position),this.ff=e-t,this.df=i-t),e=t+this.ff,this.wf(this.uf.mf.position,e),i=t+this.df,this.wf(this.uf.gf.position,i))},Kt(){var t=this.R.getMapOptions().lockedLight;t&&this.R.off("viewChanged",this._f)}});class Lg extends vg{constructor(){super(),this.scene.name="dynamicModel",this.Ei=p.DYNAMIC_MODEL_MARKER}init(){super.init(),this.xf(),this.Mf(),Mg(this)}remove(e){var t;e.Ef?e.Lf({src:[1],dest:[0],duration:1,callback:()=>{var t=e.Ji?.parent;t&&t.remove(e.Ji),super.remove(e)}}):((t=e.Ji?.parent)&&t.remove(e.Ji),super.remove(e))}}Object.assign(Lg.prototype,{xf(){var t=this.rr(_);this.Tf=new wg(t).createLight(this,"FMDynamicModelLayer")},Mf(){this.Fn.add(this.mf),this.Fn.add(this.vf),this.Fn.add(this.gf),this.Fn.add(this.pf),this.Fn.removeLight=()=>{this.Sf()}},Sf(){this.Fn.remove(this.mf),this.Fn.remove(this.vf),this.Fn.remove(this.gf),this.Tf.Kt()}});class Tg extends vg{constructor(){super(),this.Ei=p.LINE_MARKER}init(){super.init(),this.Fn.position.y=0}}class Sg extends vg{constructor(){super(),this.Ei=p.LOCATION_MARKER}init(){super.init(),this.Fn.position.y=0}}class Ag extends vg{constructor(){super(),this.Ei=p.DOM_MARKER}init(){}add(t){this.I.push(t),this.needUpdateBound=!0}remove(t){t=this.I.indexOf(t);-1<t&&this.I.splice(t,1),this.needUpdateBound=!0}clear(){for(;0<this.I.length;)this.I[0].dispose();this.I.length=0,this.needUpdateBound=!0}dispose(){this.I.length=0,this.Fn=void 0}get visible(){return this.er}set visible(e){for(let t=0;t<this.I.length;t++)this.I[t].visible=e}}function Og(t){var e=t.rr(_);e&&(t.Ji&&e.Vt.hs(),e.enableUpdateNode(),e.enableUpdateRender())}function Cg(t){var e,i=t.rr(_);i&&(t.Ji&&(e=i.getZoom(),i.Vt.zc(t,e)),i.enableUpdateNode(),i.enableUpdateRender())}function Rg(t){t.Af&&t.Af(),t.Ji&&(t.Ji.parent&&t.Ji.parent.remove(t.Ji),t.Ji instanceof mc?t.Ji.children.forEach(t=>{t.geometry&&t.geometry.dispose(),t.geometry=void 0,t.material=void 0,t.mapNode=void 0}):(t.Ji.geometry.dispose(),t.Ji.geometry=void 0,t.Ji.material=void 0,t.Ji.mapNode=void 0),t.Ji=void 0)}class Ng extends Ms{constructor(t){super(t),this.Of=void 0,this.Gr=!1,this.Cf=null,this.Hr=0,this.zr=void 0,this.Vr=void 0,this.Wr=null,this.Yr=null}get isbloom(){return this.Of}set isbloom(t){this.Of=t}get ID(){return this.Ki.Ht}get level(){return this.U.U.mr}get x(){return this.bound.center.x}get y(){return this.bound.center.y}get height(){return this.Ki.height}get bound(){return!0===this.ir&&(this.Ki.mi=null,this.mi=this.Ki.getBound(),this.ir=!1),this.mi.clone()}get boundNoClone(){return 1==this.ir&&(this.Ki.mi=null,this.mi=this.Ki.getBound(),this.ir=!1),this.mi}get zoomRange(){return{maxLevel:this.Ki.maxlevel,minLevel:this.Ki.minlevel}}get visible(){return this.er}set visible(t){this.er=t,this.ru()}getData(){var t=this.Ki;return{ID:t.Ht,typeID:t.type,FID:t.fid,height:t.height,name:t.name,eName:t.ename,minLevel:t.minlevel,maxLevel:t.maxlevel}}getBound(){var t=this.bound;return{maxY:t.max.y,maxX:t.max.x,minX:t.min.x,minY:t.min.y}}getRenderNode(){return this.Ji}dispose(){this.Kc(),this.R=null,super.dispose()}}Object.assign(Ng.prototype,{ru(){(this.Ei===p.LABEL||this.Ei===p.FACILITY?Og:Cg)(this)},Kc(){Rg(this)}});class Dg extends Ng{constructor(t){super(),this.Ki=t,this.T=t.height,this.Ei=p.EXTENT,this.Wc=null,this.Rf=null,this.Ji=null,this.Nf=0}get zoomRange(){}getData(){var t=this.Ki;return{ID:t.Ht,height:t.height,area:t.area}}getArea(){return sg.area(this.Ki.Li[0])}get coordinates(){return this.Ki.Li}}Object.assign(Dg.prototype,{Xh(){if(!this.Ji&&1!==this.Nf){let n=this.rr(_);if(n){let r=this.rr(Es);var t=n.Vt,e=n.P.Df?t.kf:t.Pf;this.Nf=1,e.bind(t)({type:this.type,data:this.Ki,amount:this.T}).then(t=>{this.Nf=2,this.Wc=n.Vt.zu.sl(r.Ht);var e=this.jr(n,r.Ht),i=(r!==n.S&&(e.polygonOffset=!0,e.polygonOffsetFactor=1,e.polygonOffsetUnits=1),r===n.S&&1!==n.children.length&&1===n.S.I.length&&(e.stencilWrite=!0,e.stencilRef=1,e.stencilFunc=jr,e.stencilFail=Fr,e.stencilZFail=Fr,e.stencilZPass=Fr),this.Ki.getBound());this.Ji=new Q(t.geometry,e),this.Ji.rotation.set(-Math.PI/2,0,0,"XYZ"),this.Ji.position.set(i.center.x-n.o,-this.T,n.u-i.center.y),this.Ji.receiveShadow=!0,this.Ji.visible=this.er,(this.Ji.mapNode=this).U.Fn.add(this.Ji)})}}},Bc(t,e){var i;this.Ji&&(i=this.rr(Es),this.Wc=e.sl(i.Ht),this.If())},Ff(t){t!==this.Rf&&(this.Rf=t,this.If())},If(){var t,e;this.Ji&&(t=this.rr(_))&&(e=this.rr(Es),this.Ji.material=this.jr(t,e.Ht),t.enableUpdateRender())},jr(t,e){var i=this.rr(u),i={color:this.Wc.color,alpha:this.Wc.alpha*i.jf,buildingID:e},e=(this.Rf&&(i.url=this.Rf,i.finish=function(){t.enableUpdateRender()}),t.Vt.qr.uh(i));return e.polygonOffset=!0,e.polygonOffsetFactor=1,e.polygonOffsetUnits=4,e.userData.opacity=e.opacity,this.Gr?((i=e.clone()).userData.opacity=i.opacity,i.uniforms.isMask.value=!0,i.uniforms.maskType.value=this.Hr,i.uniforms.maskTexture.value=this.Cf,void 0!==this.zr&&void 0!==this.Vr&&(i.uniforms.maskHeight.value=this.zr,i.uniforms.maskExtrudeHeight.value=this.Vr),i.uniformsNeedUpdate=!0,i):e},ru(){var t=this.rr(_);t&&(this.Ji&&(this.Ji.visible=this.er),t.enableUpdateNode(),t.enableUpdateRender())},updateMaterialByThemeTool(t){this.Wc=t,this.If()}});var kg=new Ct;function Pg(t,e){this.object=t,void 0===e&&(e=16776960);var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new et;r.setIndex(new J(t,1)),r.setAttribute("position",new J(i,3)),zp.call(this,r,new ev({color:e,toneMapped:!1})),this.matrixAutoUpdate=!1,this.update()}function Ig(t,e,i){this.Gf=t,this.Uf=e,this.Hf=i||null;for(var r=e.tracks,n=r.length,s=new Array(n),o={endingStart:br,endingEnd:br},a=0;a!==n;++a){var h=r[a].createInterpolant(null);(s[a]=h).settings=o}this.Bf=o,this.zf=s,this.Vf=new Array(n),this.Wf=null,this.Yf=null,this.Xf=null,this.Zf=null,this.loop=vr,this.qf=-1,this.Jf=null,this.time=0,this.timeScale=1,this.Kf=1,this.weight=1,this.Qf=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Fg(t,e,i){this.binding=t,this.valueSize=i;var r,n=Float64Array;switch(e){case"quaternion":r=this.$f;break;case"string":case"bool":n=Array,r=this.td;break;default:r=this.ed}this.buffer=new n(4*i),this.rd=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function jg(t){this.ks=t,this.nd(),this.sd=0,this.time=0,this.timeScale=1}Pg.prototype=Object.create(zp.prototype),Pg.prototype.constructor=Pg,Pg.prototype.update=function(t){var e,i,r;void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&kg.setFromObject(this.object),kg.isEmpty()||(t=kg.min,e=kg.max,(r=(i=this.geometry.attributes.position).array)[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere())},Pg.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Pg.prototype.copy=function(t){return zp.prototype.copy.call(this,t),this.object=t.object,this},Pg.prototype.clone=function(){return(new this.constructor).copy(this)},Object.assign(Ig.prototype,{play:function(){return this.Gf.od(this),this},stop:function(){return this.Gf.ad(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this.qf=-1,this.Jf=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this.Jf&&this.Gf.hd(this)},isScheduled:function(){return this.Gf.hd(this)},startAt:function(t){return this.Jf=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this.Qf=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this.Qf},fadeIn:function(t){return this.ld(t,0,1)},fadeOut:function(t){return this.ld(t,1,0)},crossFadeFrom:function(t,e,i){var r,n;return t.fadeOut(e),this.fadeIn(e),i&&(n=(i=this.Uf.duration)/(r=t.Uf.duration),t.warp(1,r/i,e),this.warp(n,1,e)),this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this.Zf;return null!==t&&(this.Zf=null,this.Gf.ud(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this.Kf=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this.Kf},setDuration:function(t){return this.timeScale=this.Uf.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this.Kf,0,t)},warp:function(t,e,i){var r=this.Gf,n=r.time,s=this.Xf,o=this.timeScale,r=(null===s&&(s=r.fd(),this.Xf=s),s.parameterPositions),s=s.sampleValues;return r[0]=n,r[1]=n+i,s[0]=t/o,s[1]=e/o,this},stopWarping:function(){var t=this.Xf;return null!==t&&(this.Xf=null,this.Gf.ud(t)),this},getMixer:function(){return this.Gf},getClip:function(){return this.Uf},getRoot:function(){return this.Hf||this.Gf.ks},K:function(t,e,i,r){if(this.enabled){var n=this.Jf;if(null!==n){n=(t-n)*i;if(n<0||0===i)return;this.Jf=null,e=i*n}e*=this.dd(t);var s=this.vd(e),o=this.pd(t);if(0<o)for(var a=this.zf,h=this.Vf,l=0,u=a.length;l!==u;++l)a[l].evaluate(s),h[l].accumulate(r,o)}else this.pd(t)},pd:function(t){var e,i,r=0;return this.enabled&&(r=this.weight,null!==(e=this.Zf))&&(r*=i=e.evaluate(t)[0],t>e.parameterPositions[1])&&(this.stopFading(),0===i)&&(this.enabled=!1),this.Qf=r},dd:function(t){var e,i=0;return this.paused||(i=this.timeScale,null!==(e=this.Xf)&&(i*=e.evaluate(t)[0],t>e.parameterPositions[1])&&(this.stopWarping(),0===i?this.paused=!0:this.timeScale=i)),this.Kf=i},vd:function(t){var e,i=this.time+t,r=this.Uf.duration,n=this.loop,s=this.qf,o=n===pr;if(0===t)return-1!==s&&o&&1==(1&s)?r-i:i;if(n===dr){-1===s&&(this.qf=0,this.md(!0,!0,!1));t:{if(r<=i)i=r;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this.Gf.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else if(-1===s&&(0<=t?this.md(!(s=0),0===this.repetitions,o):this.md(0===this.repetitions,!0,o)),r<=i||i<0?(i-=r*(n=Math.floor(i/r)),s+=Math.abs(n),(e=this.repetitions-s)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i=0<t?r:0,this.Gf.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1==e?this.md(e=t<0,!e,o):this.md(!1,!1,o),this.qf=s,this.time=i,this.Gf.dispatchEvent({type:"loop",action:this,loopDelta:n}))):this.time=i,o&&1==(1&s))return r-i;return i},md:function(t,e,i){var r=this.Bf;i?(r.endingStart=yr,r.endingEnd=yr):(r.endingStart=t?this.zeroSlopeAtStart?yr:br:wr,r.endingEnd=e?this.zeroSlopeAtEnd?yr:br:wr)},ld:function(t,e,i){var r=this.Gf,n=r.time,s=this.Zf,r=(null===s&&(s=r.fd(),this.Zf=s),s.parameterPositions),s=s.sampleValues;return r[0]=n,s[0]=e,r[1]=n+t,s[1]=i,this}}),Object.assign(Fg.prototype,{accumulate:function(t,e){var i=this.buffer,r=this.valueSize,n=t*r+r,t=this.cumulativeWeight;if(0===t){for(var s=0;s!==r;++s)i[n+s]=i[s];t=e}else this.rd(i,n,0,e/(t+=e),r);this.cumulativeWeight=t},apply:function(t){var e=this.valueSize,i=this.buffer,r=t*e+e,t=this.cumulativeWeight,n=this.binding;this.cumulativeWeight=0,t<1&&this.rd(i,r,3*e,1-t,e);for(var s=e,o=e+e;s!==o;++s)if(i[s]!==i[s+e]){n.setValue(i,r);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,r=3*i;t.getValue(e,r);for(var n=i,s=r;n!==s;++n)e[n]=e[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},td:function(t,e,i,r,n){if(.5<=r)for(var s=0;s!==n;++s)t[e+s]=t[i+s]},$f:function(t,e,i,r){at.slerpFlat(t,e,t,e,t,i,r)},ed:function(t,e,i,r,n){for(var s=1-r,o=0;o!==n;++o){var a=e+o;t[a]=t[a]*s+t[i+o]*r}}}),jg.prototype=Object.assign(Object.create(S.prototype),{constructor:jg,gd:function(t,e){var i=t.Hf||this.ks,r=t.Uf.tracks,n=r.length,s=t.Vf,o=t.zf,a=i.uuid,t=this._d,h=t[a];void 0===h&&(t[a]=h={});for(var l=0;l!==n;++l){var u=r[l],c=u.name,f=h[c];if(void 0===f){if(void 0!==(f=s[l])){null===f.Wf&&(++f.referenceCount,this.bd(f,a,c));continue}var d=e&&e.Vf[l].binding.parsedPath;++(f=new Fg(l1.create(i,c,d),u.ValueTypeName,u.getValueSize())).referenceCount,this.bd(f,a,c)}s[l]=f,o[l].resultBuffer=f.buffer}},od:function(t){if(!this.hd(t)){null===t.Wf&&(e=(t.Hf||this.ks).uuid,i=t.Uf.uuid,r=this.yd[i],this.gd(t,r&&r.knownActions[0]),this.wd(t,i,e));for(var e,i,r,n=t.Vf,s=0,o=n.length;s!==o;++s){var a=n[s];0==a.useCount++&&(this.xd(a),a.saveOriginalState())}this.Md(t)}},ad:function(t){if(this.hd(t)){for(var e=t.Vf,i=0,r=e.length;i!==r;++i){var n=e[i];0==--n.useCount&&(n.restoreOriginalState(),this.Ed(n))}this.Ld(t)}},nd:function(){this.Td=[],this.Sd=0,this.yd={},this.Dl=[],this.Ad=0,this._d={},this.Od=[],this.Cd=0;var t=this;this.stats={actions:{get total(){return t.Td.length},get inUse(){return t.Sd}},bindings:{get total(){return t.Dl.length},get inUse(){return t.Ad}},controlInterpolants:{get total(){return t.Od.length},get inUse(){return t.Cd}}}},hd:function(t){t=t.Wf;return null!==t&&t<this.Sd},wd:function(t,e,i){var r=this.Td,n=this.yd,s=n[e];void 0===s?(s={knownActions:[t],actionByRoot:{}},t.Yf=0,n[e]=s):(n=s.knownActions,t.Yf=n.length,n.push(t)),t.Wf=r.length,r.push(t),s.actionByRoot[i]=t},Rd:function(t){var e=this.Td,i=e[e.length-1],r=t.Wf,r=(e[i.Wf=r]=i,e.pop(),t.Wf=null,t.Uf.uuid),i=this.yd,e=i[r],n=e.knownActions,s=n[n.length-1],o=t.Yf;n[s.Yf=o]=s,n.pop(),t.Yf=null,delete e.actionByRoot[(t.Hf||this.ks).uuid],0===n.length&&delete i[r],this.Nd(t)},Nd:function(t){for(var e=t.Vf,i=0,r=e.length;i!==r;++i){var n=e[i];0==--n.referenceCount&&this.Dd(n)}},Md:function(t){var e=this.Td,i=t.Wf,r=this.Sd++,n=e[r];e[t.Wf=r]=t,e[n.Wf=i]=n},Ld:function(t){var e=this.Td,i=t.Wf,r=--this.Sd,n=e[r];e[t.Wf=r]=t,e[n.Wf=i]=n},bd:function(t,e,i){var r=this._d,n=r[e],s=this.Dl;void 0===n&&(r[e]=n={}),(n[i]=t).Wf=s.length,s.push(t)},Dd:function(t){var e=this.Dl,i=t.binding,r=i.rootNode.uuid,i=i.path,n=this._d,s=n[r],o=e[e.length-1],t=t.Wf;e[o.Wf=t]=o,e.pop(),delete s[i],0===Object.keys(s).length&&delete n[r]},xd:function(t){var e=this.Dl,i=t.Wf,r=this.Ad++,n=e[r];e[t.Wf=r]=t,e[n.Wf=i]=n},Ed:function(t){var e=this.Dl,i=t.Wf,r=--this.Ad,n=e[r];e[t.Wf=r]=t,e[n.Wf=i]=n},fd:function(){var t=this.Od,e=this.Cd++,i=t[e];return void 0===i&&(t[(i=new fp(new Float32Array(2),new Float32Array(2),1,this.Pd)).kd=e]=i),i},ud:function(t){var e=this.Od,i=t.kd,r=--this.Cd,n=e[r];e[t.kd=r]=t,e[n.kd=i]=n},Pd:new Float32Array(1),clipAction:function(t,e){var i=e||this.ks,r=i.uuid,i="string"==typeof t?xp.findByName(i,t):t,t=null!==i?i.uuid:t,n=this.yd[t],s=null;if(void 0!==n){var o=n.actionByRoot[r];if(void 0!==o)return o;s=n.knownActions[0],null===i&&(i=s.Uf)}return null===i?null:(o=new Ig(this,i,e),this.gd(o,s),this.wd(o,t,r),o)},existingAction:function(t,e){var e=e||this.ks,i=e.uuid,e="string"==typeof t?xp.findByName(e,t):t,e=e?e.uuid:t,t=this.yd[e];return void 0!==t&&t.actionByRoot[i]||null},stopAllAction:function(){var t=this.Td,e=this.Sd,i=this.Dl,r=this.Ad;this.Sd=0;for(var n=this.Ad=0;n!==e;++n)t[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this.Td,i=this.Sd,r=this.time+=t,n=Math.sign(t),s=this.sd^=1,o=0;o!==i;++o)e[o].K(r,t,n,s);for(var a=this.Dl,h=this.Ad,o=0;o!==h;++o)a[o].apply(s);return this},setTime:function(t){for(var e=this.time=0;e<this.Td.length;e++)this.Td[e].time=0;return this.update(t)},getRoot:function(){return this.ks},uncacheClip:function(t){var e=this.Td,t=t.uuid,i=this.yd,r=i[t];if(void 0!==r){for(var n=r.knownActions,s=0,o=n.length;s!==o;++s){var a=n[s],h=(this.ad(a),a.Wf),l=e[e.length-1];a.Wf=null,a.Yf=null,e[l.Wf=h]=l,e.pop(),this.Nd(a)}delete i[t]}},uncacheRoot:function(t){var e,i=t.uuid,r=this.yd;for(e in r){var n=r[e].actionByRoot[i];void 0!==n&&(this.ad(n),this.Rd(n))}var s=this._d[i];if(void 0!==s)for(var o in s){o=s[o];o.restoreOriginalState(),this.Dd(o)}},uncacheAction:function(t,e){t=this.existingAction(t,e);null!==t&&(this.ad(t),this.Rd(t))}});var Gg={exports:{}},Ug=(Gg.exports,(t=>{var l,u,rt,c,nt;t.exports=(l=function(t){return t.reduce(function(t,e){return 2*t+e},0)},u=function(t){for(var e=[],i=7;0<=i;i--)e.push(!!(t&1<<i));return e},rt=function(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return t instanceof Uint8Array?t[this.pos++]:255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],i=0;i<t;i++)e.push(this.readByte());return e},this.read=function(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},c=function(t,r){for(var e,i,n=0,s=[],o=1<<t,a=1+o,h=t+1,l=[];;)if(i=e,(e=(t=>{for(var e=0,i=0;i<t;i++)r.charCodeAt(n>>3)&1<<(7&n)&&(e|=1<<i),n++;return e})(h))===o){u=void 0,l=[],h=t+1;for(var u=0;u<o;u++)l[u]=[u];l[o]=[],l[a]=null}else{if(e===a)break;if(e<l.length)i!==o&&l.push(l[i].concat(l[e][0]));else{if(e!==l.length)throw new Error("Invalid LZW code.");l.push(l[i].concat(l[i][0]))}s.push.apply(s,l[e]),l.length===1<<h&&h<12&&h++}return s},nt=function(s,o){o=o||{};var r=function(t){for(var e=[],i=0;i<t;i++)e.push(s.readBytes(3));return e},a=function(){for(var t,e="";t=s.readByte(),e+=s.read(t),0!==t;);return e},e=function(t){function e(t){var e;s.readByte(),t.identifier=s.read(8),t.authCode=s.read(3),"NETSCAPE"===t.identifier?(e=t,s.readByte(),e.unknown=s.readByte(),e.iterations=s.readUnsigned(),e.terminator=s.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(e)):((e=t).appData=a(),o.app&&o.app[e.identifier]&&o.app[e.identifier](e))}var i,r,n;switch(t.label=s.readByte(),t.label){case 249:t.extType="gce",r=t,s.readByte(),n=u(s.readByte()),r.reserved=n.splice(0,3),r.disposalMethod=l(n.splice(0,3)),r.userInput=n.shift(),r.transparencyGiven=n.shift(),r.delayTime=s.readUnsigned(),r.transparencyIndex=s.readByte(),r.terminator=s.readByte(),o.gce&&o.gce(r);break;case 254:t.extType="com",(n=t).comment=a(),o.com&&o.com(n);break;case 1:t.extType="pte",r=t,s.readByte(),r.ptHeader=s.readBytes(12),r.ptData=a(),o.pte&&o.pte(r);break;case 255:t.extType="app",e(t);break;default:t.extType="unknown",(i=t).data=a(),o.unknown&&o.unknown(i)}},i=function(t){function e(t,e){for(var i=new Array(t.length),r=t.length/e,n=[0,4,2,1],s=[8,8,4,2],o=0,a=0;a<4;a++)for(var h=n[a];h<r;h+=s[a]){u=l=void 0;var l=h,u=o;u=t.slice(u*e,(u+1)*e),i.splice.apply(i,[l*e,e].concat(u)),o++}return i}t.leftPos=s.readUnsigned(),t.topPos=s.readUnsigned(),t.width=s.readUnsigned(),t.height=s.readUnsigned();var i=u(s.readByte()),i=(t.lctFlag=i.shift(),t.interlaced=i.shift(),t.sorted=i.shift(),t.reserved=i.splice(0,2),t.lctSize=l(i.splice(0,3)),t.lctFlag&&(t.lct=r(1<<t.lctSize+1)),t.lzwMinCodeSize=s.readByte(),a());t.pixels=c(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=e(t.pixels,t.width)),o.img&&o.img(t)},n=function(){var t={};switch(t.sentinel=s.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",e(t);break;case",":t.type="img",i(t);break;case";":t.type="eof",o.eof&&o.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&setTimeout(n,0)},t={};if(t.sig=s.read(3),t.ver=s.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=s.readUnsigned(),t.height=s.readUnsigned();var h=u(s.readByte());t.gctFlag=h.shift(),t.colorRes=l(h.splice(0,3)),t.sorted=h.shift(),t.gctSize=l(h.splice(0,3)),t.bgColor=s.readByte(),t.pixelAspectRatio=s.readByte(),t.gctFlag&&(t.gct=r(1<<t.gctSize+1)),o.hdr&&o.hdr(t),setTimeout(n,0)},function(t){var e,i,n,o={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(e in t)o[e]=t[e];o.vp_w&&o.vp_h&&(o.is_vp=!0);function r(){M=w,E=w=y=b=null}function I(){try{nt(i,it)}catch(t){s("parse")}}function F(t,e){v.width=t*D(),v.height=e*D(),m.style.minWidth=t*D()+"px",g.width=t,g.height=e,g.style.width=t+"px",g.style.height=e+"px",g.getContext("2d").setTransform(1,0,0,1,0,0)}function s(t){X=t,n={width:C.width,height:C.height},A=[],p.fillStyle="black",p.fillRect(0,0,o.c_w||n.width,o.c_h||n.height),p.strokeStyle="red",p.lineWidth=3,p.moveTo(0,0),p.lineTo(o.c_w||n.width,o.c_h||n.height),p.moveTo(0,o.c_h||n.height),p.lineTo(o.c_w||n.width,0),p.stroke()}function j(){E&&(A.push({data:E.getImageData(0,0,n.width,n.height),delay:y}),O.push({x:0,y:0}))}function G(t){et(i.pos,i.data.length,t)}function U(){}function a(e,i){return function(t){e(t),G(i)}}function H(){var t=C.parentNode,e=document.createElement("div");v=document.createElement("canvas"),p=v.getContext("2d"),m=document.createElement("div"),g=document.createElement("canvas"),e.width=v.width=C.width,e.height=v.height=C.height,m.style.minWidth=C.width+"px",e.className="jsgif",m.className="jsgif_toolbar",e.appendChild(v),e.appendChild(m),t.insertBefore(e,C),t.removeChild(C),o.c_w&&o.c_h&&F(o.c_w,o.c_h),k=!0}function B(t){return!(_||(P=t||!1,_=!0,A=[],r(),L=E=M=x=null))}function z(){return A.reduce(function(t,e){return t+e.delay},0)}var h,V,l,u,c,W,Y,f,d,v,p,m,g,X=null,_=!1,b=null,y=null,w=null,x=null,M=null,E=null,L=null,T=!0,S=!1,A=[],O=[],C=o.gif,Z=(void 0===o.auto_play&&(o.auto_play=!C.getAttribute("rel:auto_play")||"1"==C.getAttribute("rel:auto_play")),o.hasOwnProperty("on_end")?o.on_end:null),q=o.hasOwnProperty("loop_delay")?o.loop_delay:0,J=o.hasOwnProperty("loop_mode")?o.loop_mode:"auto",R=!o.hasOwnProperty("draw_while_loading")||o.draw_while_loading,K=!!R&&(!o.hasOwnProperty("show_progress_bar")||o.show_progress_bar),Q=o.hasOwnProperty("progressbar_height")?o.progressbar_height:25,$=o.hasOwnProperty("progressbar_background_color")?o.progressbar_background_color:"rgba(255,255,255,0.4)",tt=o.hasOwnProperty("progressbar_foreground_color")?o.progressbar_foreground_color:"rgba(255,0,22,.8)",et=function(t,e,i){var r,n,s;i&&K&&(i=Q,o.is_vp?s=S?(n=(o.vp_t+o.vp_h-i)/D(),i/=D(),r=o.vp_l/D()+t/e*(o.vp_w/D()),v.width/D()):(n=o.vp_t+o.vp_h-i,r=o.vp_l+t/e*o.vp_w,v.width):(n=(v.height-i)/(S?D():1),r=t/e*v.width/(S?D():1),s=v.width/(S?D():1),i/=S?D():1),p.fillStyle=$,p.fillRect(r,n,s-r,i),p.fillStyle=tt,p.fillRect(0,n,r,i))},N=(u=-1,c=0,V=function(){null!==Z&&Z(C),c++,!1!==J||c<0?l():T=h=!1},{init:function(){X||(o.c_w&&o.c_h||p.scale(D(),D()),(o.auto_play?f:(u=0,d))())},step:f=function(){h||setTimeout(l,0)},play:function(){T=!0,f()},pause:function(){T=!1},playing:T,move_relative:Y=function(t){u+=t,d()},current_frame:function(){return u},length:function(){return A.length},move_to:function(t){u=t,d()}}),it={hdr:a(function(t){F((n=t).width,n.height)}),gce:a(function(t){j(),r(),b=t.transparencyGiven?t.transparencyIndex:null,y=t.delayTime,w=t.disposalMethod}),com:a(U),app:{NETSCAPE:a(U)},img:a(function(t){E=E||g.getContext("2d");var e=A.length,i=t.lctFlag?t.lct:n.gct,r=(0<e&&(3===M?null!==x?E.putImageData(A[x].data,0,0):E.clearRect(L.leftPos,L.topPos,L.width,L.height):x=e-1,2===M)&&E.clearRect(L.leftPos,L.topPos,L.width,L.height),E.getImageData(t.leftPos,t.topPos,t.width,t.height));t.pixels.forEach(function(t,e){t!==b&&(r.data[4*e+0]=i[t][0],r.data[4*e+1]=i[t][1],r.data[4*e+2]=i[t][2],r.data[4*e+3]=255)}),E.putImageData(r,t.leftPos,t.topPos),S||(p.scale(D(),D()),S=!0),R&&(p.drawImage(g,0,0),R=o.auto_play),L=t},!(h=!(W=function(){return(u+1+A.length)%A.length}))),eof:function(t){j(),G(!1),o.c_w&&o.c_h||(v.width=n.width*D(),v.height=n.height*D()),N.init(),_=!1,P&&P(C)}},D=function(){var t=o.max_width&&n&&n.width>o.max_width?o.max_width/n.width:1;return t},k=!(d=function(){var t;(u=parseInt(u,10))>A.length-1&&(u=0),t=O[u=u<0?0:u],g.getContext("2d").putImageData(A[u].data,t.x,t.y),p.globalCompositeOperation="copy",p.drawImage(g,0,0)}),P=!(l=function(){var t;(h=T)&&(Y(1),t=(t=10*A[u].delay)||100,0===W()?(t+=q,setTimeout(V,t)):setTimeout(l,t))});return{play:N.play,pause:N.pause,move_relative:N.move_relative,move_to:N.move_to,get_playing:function(){return T},get_canvas:function(){return v},get_canvas_scale:function(){return D()},get_loading:function(){return _},get_auto_play:function(){return o.auto_play},get_length:function(){return N.length()},get_frames:function(){return A},get_duration:z,get_duration_ms:function(){return 10*z()},get_current_frame:function(){return N.current_frame()},load_url:function(t,e){B(e)&&((e=new XMLHttpRequest).open("GET",t,!0),"overrideMimeType"in e?e.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in e?e.responseType="arraybuffer":e.setRequestHeader("Accept-Charset","x-user-defined"),e.onloadstart=function(){k||H()},e.onload=function(t){200!=this.status&&s("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var e=this.response;0<e.toString().indexOf("ArrayBuffer")&&(e=new Uint8Array(e)),i=new rt(e),setTimeout(I,0)},e.onprogress=function(t){t.lengthComputable&&et(t.loaded,t.total,!0)},e.onerror=function(){s("xhr")},e.send())},load:function(t){this.load_url(C.getAttribute("rel:animated_src")||C.src,t)},load_raw:function(t,e){B(e)&&(k||H(),i=new rt(t),setTimeout(I,0))},set_frame_offset:function(t,e){O[t]?(void 0!==e.x&&(O[t].x=e.x),void 0!==e.y&&(O[t].y=e.y)):O[t]=e}}})})(Gg),Gg.exports),Hg=rs(Ug);class Bg{constructor(t){this.gs=t,this.R=this.gs.map,this.Id={},this.Rf=null,this.Fd={},this.jd=0,this.T=512,this.Gd=512,this.Ud=!1,this.B=null,this.K=this.K.bind(this)}get isAdded(){return this.Ud}add(t){null===this.Rf&&(this.Rf=t),this.Hd(t=>{this.Bd(t)})}dispose(t){this.R.off("update",this.K),t&&t()}stop(){this.R.off("update",this.K)}}function zg(t,e,i,r,n,s,o,a,h){f.call(this,t,e,i,r,n,s,o,a,h),this.format=void 0!==o?o:pi,this.minFilter=void 0!==s?s:Qe,this.magFilter=void 0!==n?n:Qe,this.generateMipmaps=!1}Object.assign(Bg.prototype,{Hd(e){var t=this.gs.externalModel.getRenderNode();t.renderOrder=1,this.gs.externalModel.zd?t.traverse(t=>{"Mesh"===t.type&&(t.renderOrder=1,e(t))}):e(t)},Bd(r){let n=this,s=0,o=null;Array.isArray(r.material)?(this.Id[r.name]=[],function i(){s<r.material.length?n.If(r.material[s],(t,e)=>{n.Id[r.name].push(r.material[s].clone()),e&&(r.material[s].dispose(),r.material[s]=t),s++,o=setTimeout(i,0)}):(null!==o&&clearTimeout(o),n.B=(new Date).getTime(),n.R.on("update",n.K))}()):this.If(r.material,(t,e)=>{this.Id[r.name]=r.material.clone(),e&&(r.material.dispose(),r.material=t),this.B=(new Date).getTime(),this.R.on("update",n.K)})},If(t,e){let i=null;var r;t&&(this.gs.externalModel.zd?t.uniforms&&t.uniforms.map&&t.uniforms.map.value?i=t.uniforms.map.value.name:t.map&&(i=""+t.map.name):t.map&&(i=""+t.map.name).indexOf(".gif")<0&&(i=t.name)),(null===i||!this.gs.parent.Vd||!this.gs.parent.Vd[i])&&null!==i&&0<=i.indexOf(".gif")?(t=(t=i.split("."))[0]+"."+t[1],(r=this.Fd[t])?r.canvasArray&&0<r.canvasArray.length&&(r=new Lc(r.canvasArray[r.canvascount]),this.gs.externalModel.zd&&(r.flipY=!1),r.repeat.set(1,1),r.name=i,r.magFilter=Qe,r.minFilter=ei,(r=new wo({map:r})).isBasic=!0,r.gifname=t,r.transparent=!0,e(r,!0)):this.Wd(this.Rf+t,t,t=>{e(t,!0)})):e(null,!1)},Wd(t,i,r){var n=document.createElement("div");n.style.display="none",document.body.appendChild(n);let s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{r&&((t=document.createElement("canvas")).width=this.Gd,t.height=this.T,t.getContext("2d").drawImage(s,0,0,this.Gd,this.T),t=new Lc(t),this.gs.externalModel.zd&&(t.flipY=!1),t.repeat.set(1,1),t.magFilter=Qe,t.minFilter=ei,(t=new wo({map:t})).transparent=!0,t.isBasic=!0,t.gifname=i,r(t)),this.Fd[i]={canvascount:0,canvasArray:[]},n.appendChild(s);var t,e=new Hg({gif:s});e.load(()=>{this.Yd(e,i,n)})},s.src=t},Yd(r,n,t){let s=this,o=null,e=r.get_length(),a=1;this.Fd[n].canvascount=0,function i(){if(a>e)document.body.removeChild(t),null!==o&&clearTimeout(o);else{r.move_to(a);let t=document.createElement("canvas"),e=(t.width=s.Gd,t.height=s.T,t.getContext("2d"));e.drawImage(r.get_canvas(),0,0,s.Gd,s.T),s.Fd[n].canvasArray.push(t),a++,o=setTimeout(i,0)}}()},Xd(t,e){t=t.split("."),t=t[0]+"."+t[1];this.Fd[t]&&(this.Fd[t].canvasArray.length=0,this.Fd[t].canvascount=0),this.Wd(e,t),this.K(),this.Ud||(this.Ud=!0,this.R.on("update",this.K))},oa(t){var e=t.split("."),e=e[0]+"."+e[1];this.Xd(t,this.Rf+e)},K(){var t=(new Date).getTime();let e=t-this.B,n=(50<=e&&(this.B=t),t=>{50<=e&&t&&(t.canvascount<t.canvasArray.length-1?t.canvascount++:t.canvascount=0)});this.gs.externalModel.getRenderNode()&&(this.Hd(r=>{if(Array.isArray(r.material)){var t,e=r.material;for(let i=0;i<e.length;i++)!e[i].isBasic||r.material[i].isupdate?this.If(this.Id[r.name][i],(t,e)=>{e&&(r.material[i].dispose(),r.material[i]=t)}):((t=this.Fd[e[i].gifname])&&t.canvasArray[t.canvascount]&&(r.material.isupdate?this.If(this.Id[r.name][i],(t,e)=>{e&&(r.material[i].dispose(),r.material[i]=t)}):(r.material[i].map.image=t.canvasArray[t.canvascount],r.material[i].map.needsUpdate=!0)),n(t))}else{var i;r.material.isBasic&&!r.material.isupdate?((i=this.Fd[r.material.gifname])&&i.canvasArray[i.canvascount]&&(r.material.isupdate?this.If(this.Id[r.name],(t,e)=>{e&&(r.material.dispose(),r.material=t)}):(r.material.map.image=i.canvasArray[i.canvascount],r.material.map.needsUpdate=!0)),n(i)):this.If(this.Id[r.name],(t,e)=>{e&&(r.material.dispose(),r.material=t)})}}),this.R.enableUpdateRender())}}),zg.prototype=Object.assign(Object.create(f.prototype),{constructor:zg,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});class Vg{constructor(t){this.gs=t,this.Zd=t.externalModel,this.R=this.gs.map,this.qd=[],this.Jd=null,this.Kd={},this.Qd=null,this.Ud=!1,this.oldmaterial={},this.Rf=null,this.$d={},this.K=this.K.bind(this)}get isAdded(){return this.Ud}add(t){null===this.Rf&&(this.Rf=t),this.Hd(t=>{this.Bd(t)}),this.R.on("update",this.K)}dispose(){for(let t=0;t<this.qd.length;t++){var e=this.qd[t];null!==document.getElementById(e)&&document.getElementById(e).parentNode.removeChild(document.getElementById(e))}this.R.off("update",this.K)}stop(){this.R.off("update",this.K)}}Object.assign(Vg.prototype,{Hd(e){var t=this.gs.externalModel.getRenderNode();this.Zd.zd?t.traverse(t=>{"Mesh"===t.type&&e(t)}):e(t)},Bd(r){let n=this,s=r.material,o=0,a=null;Array.isArray(s)?(this.oldmaterial[r.name]=[],function i(){o<s.length?n.If(s[o],(t,e)=>{n.oldmaterial[r.name].push(s[o].clone()),e&&(r.material[o].dispose(),r.material[o]=t),o++,a=setTimeout(i,0)}):null!==a&&clearTimeout(a)}()):this.If(s,(t,e)=>{this.oldmaterial[r.name]=s.clone(),e&&(r.material.dispose(),r.material=t)})},If(i,r){let n=null;if(i&&(this.Zd.zd?i.uniforms&&i.uniforms.map&&i.uniforms.map.value?n=i.uniforms.map.value.name:i.map&&(n=""+i.map.name):i.map&&(n=""+i.map.name).indexOf(".mp4")<0&&n.indexOf(".webm")<0&&n.indexOf(".ogg")<0&&(n=i.name)),null!==n&&this.gs.parent.Vd&&this.gs.parent.Vd[n])r(null,!1);else if(null!==n&&(0<=n.indexOf(".mp4")||0<=n.indexOf(".webm")||0<=n.indexOf(".ogg"))){let e=n.split("."),t=this.$d[n];(t=t||this.Kd[e[0]+"."+e[1]])?((i=new wo({map:t.clone()})).isBasic=!0,r&&r(i,!0)):this.t0(this.Rf+e[0]+"."+e[1],t=>{t.name=n;t=new wo({map:(this.Kd[e[0]+"."+e[1]]=t).clone()});t.isBasic=!0,r(t,!0)})}else r(null,!1)},t0(t,i){let r=this,n=(this.Qd=t,null);var e=document.createElement("div");e.style.display="none";let s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});this.Jd=s+"_div",this.qd.push(this.Jd),e.setAttribute("id",this.Jd),e.innerHTML='<video id="'+s+'" loop crossOrigin="anonymous" muted><source src="'+t+'"></video>',document.body.appendChild(e),function t(){let e=document.getElementById(s);e?(null!==n&&clearTimeout(n),e.addEventListener("loadeddata",()=>{var t=new zg(e);t.video_id=s+"_div",r.Zd.zd&&(t.flipY=!1),i&&i(t),e.play()})):n=setTimeout(t,0)}()},e0(r){this.gs.externalModel.getRenderNode()&&this.Hd(i=>{var t=i.material;if(Array.isArray(t))for(let e=0;e<t.length;e++)this.If(this.oldmaterial[i.name][e],t=>{t&&t.map&&t.map.name===r&&(i.material[e].dispose(),i.material[e]=t)});else this.If(this.oldmaterial[i.name],t=>{t&&t.map&&t.map.name===r&&(i.material.dispose(),i.material=t)})})},oa(t){var e;this.$d[t]&&(e=this.$d[t].video_id,null!==document.getElementById(e)&&document.getElementById(e).parentNode.removeChild(document.getElementById(e)),this.$d[t].dispose(),this.$d[t]=void 0,this.e0(t))},Xd(e,t){this.t0(t,t=>{this.$d[e]&&this.oa(e),t.name=e,this.$d[e]=t,this.e0(e)}),this.Ud||(this.Ud=!0,this.R.on("update",this.K))},K(){this.gs.externalModel.getRenderNode()&&(this.Hd(i=>{var t=i.material;if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e].isBasic&&!t[e].isupdate||this.If(this.oldmaterial[i.name][e],t=>{t&&(i.material[e].dispose(),i.material[e]=t)});else t.isBasic?t.isupdate&&this.If(this.oldmaterial[i.name],t=>{t&&(i.material.dispose(),i.material=t)}):this.If(this.oldmaterial[i.name],t=>{t&&(i.material.dispose(),i.material=t)})}),this.R.enableUpdateRender())}});class Wg{constructor(t){this.R=t.parent.parent.parent.parent,this.Zd=t,this.K=this.K.bind(this),this.Ei="no",this.i0=new Bg({map:this.R,externalModel:t,parent:this}),this.r0=new Vg({map:this.R,externalModel:t,parent:this}),this.Vd=null,this.n0=[],this.s0={},this.R.on("update",this.K)}get gifTool(){return this.i0}get videoTool(){return this.r0}get isGltf(){return this.Zd.zd}get textureNames(){return this.n0}get oldMaterial(){return this.s0}replace(t,e){null===this.Vd&&(this.Vd={}),this.Vd[t]=!0}reset(t){this.Vd[t]=!1}dispose(){this.i0.Ud&&this.i0.dispose(),this.r0.Ud&&this.r0.dispose()}}Object.assign(Wg.prototype,{K(){var t=this.Zd.getRenderNode();let i=(t,e)=>{t=this.o0(t);t.needgif&&!this.i0.Ud&&(this.i0.add(e),this.i0.Ud=!0),t.needvideo&&!this.r0.Ud&&(this.r0.add(e),this.r0.Ud=!0)};if(t){this.R.off("update",this.K);let e=this.Zd.a0;this.Zd.zd?t.traverse(t=>{"Mesh"===t.type&&i(t,e)}):i(t,e)}},o0(t){var e={needgif:!1,needvideo:!1};let i=!1,r=!1;var n=t.material,s=t=>{0<=t.indexOf(".gif")?(i=!0,this.n0.push(t)):(0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg"))&&(r=!0,this.n0.push(t))},o=(t,e)=>{0<=t.indexOf(".gif")||0<=e.indexOf(".gif")?(i=!0,0<=t.indexOf(".gif")?this.n0.push(t):this.n0.push(e)):(0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg")||0<=e.indexOf(".mp4")||0<=e.indexOf(".webm")||0<=e.indexOf(".ogg"))&&(r=!0,0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg")?this.n0.push(t):this.n0.push(e))};if(Array.isArray(n)){this.s0[t.name]=[];for(let e=0;e<n.length;e++)if(this.s0[t.name].push(n[e].clone()),this.Zd.zd){let t="";n[e].uniforms&&n[e].uniforms.map&&n[e].uniforms.map.value?t=n[e].uniforms.map.value.name:n[e].map&&s(t=n[e].map.name)}else{let t="";n[e].map&&(t=""+n[e].map.name);var a=""+n[e].name;o(t,a)}}else if(this.s0[t.name]=n.clone(),this.Zd.zd){let t="";n.uniforms&&n.uniforms.map&&n.uniforms.map.value?t=n.uniforms.map.value.name:n.map&&(t=n.map.name),s(t)}else{let t="";n.map&&(t=""+n.map.name);var h=""+n.name;o(t,h)}return e.needgif=i,e.needvideo=r,e}});class Yg{constructor(t,e){this.R=t,this.Zd=e,this.h0=null,this.l0=null,this.u0=null,this.c0=null,this.f0=null,this.d0=new hp(Rv),this.d0.setResponseType("json"),this.m0=this.m0.bind(this),this.R.on("viewChanged",this.m0)}}Object.assign(Yg.prototype,{g0(){this.Zd._0({needFadeIn:!1,needFadeOut:!1,initLODMesh:!1,lodName:this.l0,callback:t=>{t!==this.l0&&this.g0()}})},m0(){var t=this.b0(this.h0,this.R.getZoom());this.l0!==t&&null!==t&&(this.l0=t,null!==this.f0&&clearTimeout(this.f0),this.g0(),this.f0=setTimeout(()=>{},50))},b0(e,i){if(!e)return null;var{maxlevel:t,minlevel:r}=this.Zd.Ki;if(i<r||t<i)return null;let n=null;for(let t=0;t<e.length;t++){var s=e[t],{maxlevel:o,minlevel:a}=s;if(a<=i&&i<=o){n=s.name;break}}return n},y0(s){return this.c0!==s&&(this.c0=s,this.u0=null),new Promise((r,n)=>{this.w0(s).then(t=>{t.lod&&Array.isArray(t.lod)||n("lod format error");var e=this.b0(t.lod,this.R.getZoom()),i=(null===e&&n(null),Nv.extractUrlBase(s));this.h0=t.lod,r(""+i+e)}).catch(n)})},w0(i){return new Promise((e,t)=>{this.u0?e(this.u0):this.d0.load(i,t=>{this.u0=t,e(this.u0)},null,t)})},Kt(){this.R.off("viewChanged",this.m0),this.d0=null}});class Xg extends Ng{constructor(t){super(),this.Ki=t,this.Ei=p.EXTERNAL_MODEL,this.Wc=null,this.Ji=null,this.x0=null,this.M0=null,this.E0=null,this.jf=null,this.L0=!1,this.Fr=null,this.zd=null,this.Gf=null,this.Td=[],this.du=null,this.T0=this.T0.bind(this),this.S0=new en,this.A0=!0,this.O0=null,this.a0=null,this.Au=null,this.Ou=!1,this.C0=!1,this.R0=null,this.N0=null,this.D0=!1,this.k0=null,this.n0=[],this.P0=!1,this.Br=null,this.I0=0,this.Jl=!0}get multiMediaTool(){return this.O0}get fading(){return!this.S0.J}get FID(){return this.Ki.fid}get typeID(){return this.Ki.type}get name(){return this.Ki.name}get eName(){return this.Ki.ename}get color(){return this.E0}set color(t){this.E0=t,this.If()}get opacity(){return this.jf}set opacity(t){this.jf=t,this.If()}get canDispose(){return this._canDispose}get show(){return this.iu}set show(t){t?this.du&&!this.du.show||this.F0():this.j0()}get isGltf(){return this.zd}get boundNoClone(){var t=this.getBound();return t?{min:{x:t.minX,y:t.minY},max:{x:t.maxX,y:t.maxY}}:null}resetColor(){this.L0=!0,this.If()}setColor(t,e){this.E0=t,this.jf=e,this.If()}beforRemove(){var t=this.parent?.parent?.parent;this.C0=!t||!t.visibleLevels.includes(this.level)}getBound(){if(this.M0)return this.M0;var e={};if(this.Ji){var t=new Pg(this.Ji,16776960),i=t.geometry.attributes.position.array,r=t.geometry.attributes.position.count;for(let t=0;t<r;t++){var n=i[3*t],s=i[3*t+2],o=i[3*t+1];(!e.minX||n<e.minX)&&(e.minX=n),(!e.maxX||e.maxX<n)&&(e.maxX=n),(!e.minY||s<e.minY)&&(e.minY=s),(!e.maxY||e.maxY<s)&&(e.maxY=s),(!e.minH||o<e.minH)&&(e.minH=o),(!e.maxH||e.maxH<o)&&(e.maxH=o)}t.material.dispose(),t.geometry.dispose(),t.material=void 0,t.geometry=void 0;var t=this.rr(_);return e.minX=e.minX+t.x,e.maxX=e.maxX+t.x,e.minY=t.y-e.minY,e.maxY=t.y-e.maxY,e.maxY<e.minY&&(t=e.minY,e.minY=e.maxY,e.maxY=t),this.M0=e,this.M0}}startAction(e,t,i){var r=this.Td[e];if(r){if(t){var n=this.getActionNames();for(let t=0;t<n.length;t++)n[t]!==e&&!0===this.Td[n[t]].clampWhenFinished&&!0===this.Td[n[t]].paused&&this.Td[n[t]].stop();r.loop=dr,r.clampWhenFinished=!0}else r.clampWhenFinished=!1,r.loop=vr;if(this.R0&&this.R0===e){if(this.R0===e){let t=!1;r.time=this.N0,i?this.D0?t=!0:(t=!1,this.R0=null,this.N0=null):(this.R0=null,this.N0=null,this.D0=!1),r.paused=t,r.play()}}else r.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play()}t=this.rr(_);t&&t.on("beforeRender",this.T0)}getActionNames(){return Object.keys(this.Td)}stopAction(t,e){var i=this.rr(_),i=(i&&i.off("beforeRender",this.T0),this.Td[t]);i&&(i.paused=!0,this.R0=t,this.N0=i.time,this.k0=i.loop,e||(this.D0=!0))}dispose(){null!==this.O0&&this.O0.dispose(),this.Kc(),super.dispose()}getTextureNames(){return this.n0}}Object.assign(Xg.prototype,{Xh(t){this.Ou=!0,this.C0=!1,!this.Ji&&this.Ki&&this.G0(()=>{this.du&&this.du.Xh(this),t&&t()},{initLODMesh:!0})},g0(t={needFadeIn:!0,needFadeOut:!0,initLODMesh:!0}){this.Ji&&this.U.Fn.remove(this.Ji),this.Ji=null,this.I0=0,this.G0(null,t)},_0(e={needFadeIn:!0,needFadeOut:!0,initLODMesh:!1}){1===this.I0&&this.Jl&&(this.I0=0),this.G0(t=>{e.onLoaded=()=>{this.Ji&&this.U.Fn.remove(this.Ji),this.x0=this.Ji,this.Ji=null},this.U0(t,()=>{e.callback&&e.callback(e.lodName),!this.visible&&this.Ji&&(this.Ji.visible=!1)},e)},e)},Bc(){this.g0()},U0(t,r,n={}){let s=this.rr(_);var e;s&&s.Vt&&(e=s.Vt.Tu.ia(t,(t,e,i)=>{this.zd=t,n.onLoaded&&n.onLoaded(),this.zd?this.H0(e,n):this.B0(e,i,this.Wc),ot.environment===q.BROWSER&&null===this.O0&&(this.O0=new Wg(this)),s.enableUpdateRender(),r&&r(),this.Au=2},t=>{this.Au=-2}))&&s.z0.add(t,e)},G0(e,i){var t,r,n;1!==this.I0&&(this.I0=1,i=i||{},t=this.rr(_),r=this.rr(Es),this.Wc=t.Vt.zu.ul({fid:this.Ki.fid,typeID:this.Ki.type+"",bid:r.Ht}),this.Wc)&&this.Wc.normalID&&(n=t.Vt.wu(this.Wc,"model",r.buildingID)+this.Wc.model+"?keyValue="+t.Ri.key,null===this.a0&&(this.a0=t.Vt.wu(this.Wc,"model",r.buildingID)),n.includes(".json")?(this.V0||(this.V0=new Yg(t,this)),this.V0.y0(n).then(t=>{!1!==i.initLODMesh?this.U0(t,e,i):e&&e(t)})):this.U0(n,e))},W0(t,e){this.L0&&void 0!==t.userData.originColor&&(this.E0=t.userData.originColor,t.color=t.userData.originColor,void 0!==t.userData.originOpacity)&&(t.opacity=t.userData.originOpacity*e.jf,this.jf=t.userData.originOpacity)},B0(t,e,i){if(!this.Ji){var r=this.rr(u);if(r){var n=r.rr(_);if(Array.isArray(e))for(var s of e)s.map&&(s.map.wrapS=Ye,s.map.wrapT=Ye),null==s.userData.sourceOpacity&&(s.userData.sourceOpacity=s.opacity),void 0===s.userData.originColor&&(s.userData.originColor=s.color),void 0===s.userData.originOpacity&&(s.userData.originOpacity=s.opacity),s.opacity=s.userData.sourceOpacity*r.jf,s.opacity<1&&(s.transparent=!0);else e.map&&(e.map.wrapS=Ye,e.map.wrapT=Ye),null==e.userData.sourceOpacity&&(e.userData.sourceOpacity=e.opacity),e.userData.sourceTransparent=e.transparent,void 0===e.userData.originColor&&(e.userData.originColor=e.color),void 0===e.userData.originOpacity&&(e.userData.originOpacity=e.opacity),e.opacity=e.userData.sourceOpacity*r.jf,e.opacity<1&&(e.transparent=!0);var o=[];if(void 0!==e.length)for(let t=0;t<e.length;t++){var a=e[t].clone();this.Y0(a),this.W0(a,r),o.push(a)}else{var h=e.clone();this.Y0(h),this.W0(h,r),o.push(h)}if(this.L0=!1,!this.P0){for(let t=0;t<o.length;t++)o[t].map&&this.n0.push(o[t].name);this.P0=!0}this.Ji=new Q(t,o),this.Fr&&this.If(),this.du||this.F0();var h=i.scale.split(","),t=(this.Ji.scale.set(parseFloat(h[0]),parseFloat(h[2]),parseFloat(h[1])),i.rotate.split(",")),h=new Lt,l=Math.PI/180,t=(h.set(parseFloat(t[0])*l,parseFloat(t[2])*l,parseFloat(t[1])*l),this.Ji.rotation.setFromVector3(h,"YXZ"),i.translate.split(",")),l=new Lt(this.Ki.Li[0].x-n.o,this.Ki.Li[0].y-n.u,0).applyEuler(new C(-Math.PI/2,0,0,"XYZ")).add(new Lt(0,-1===this.Ki.height?2.2:this.Ki.height,0));l.add(new Lt(parseFloat(t[0]),parseFloat(t[2]),parseFloat(t[1]))),this.Ji.position.set(l.x,l.y,l.z),(this.Ji.mapNode=this).U.Fn.add(this.Ji)}}},H0(t,e){let r=this;if(e=e||{},!this.Ji){var i=this.rr(_);if(i){var n=t.scene,s=this.Wc.rotate.split(","),o=new Lt,a=Math.PI/180,s=(o.set(parseFloat(s[0])*a,parseFloat(s[2])*a,parseFloat(s[1])*a),n.rotation.setFromVector3(o,"YXZ"),this.Wc.scale.split(",")),a=(n.scale.set(parseFloat(s[0]),parseFloat(s[2]),parseFloat(s[1])),this.Wc.translate.split(",")),o=new Lt(this.Ki.Li[0].x-i.o,this.Ki.Li[0].y-i.u,0).applyEuler(new C(-Math.PI/2,0,0,"XYZ")).add(new Lt(0,-1===this.Ki.height?2.2:this.Ki.height,0));if(o.add(new Lt(parseFloat(a[0]),parseFloat(a[2]),parseFloat(a[1]))),n.position.set(o.x,o.y,o.z),this.Ji=n,(this.Ji.mapNode=this).P0||(!function e(t){"Mesh"===t.type&&t.material.map&&r.n0.push(t.material.map.name);let i=t.children;for(let t=0;t<i.length;t++)e(i[t])}(this.Ji),this.P0=!0),this.If(),this.X0(()=>{this.U.Fn.add(this.Ji),this.er&&(this.Ji.visible=!0),this.du||this.Gr||this.F0({duration:!1===e.needFadeIn?0:void 0})}),0<t.animations.length){this.Gf=new jg(this.Ji);for(var h of t.animations)this.Td[h.name]=this.Gf.clipAction(h);s=this.rr(_);if(s.lt.Z0(this.Gf),s.Ri.autoPlay){let t=!1;null!==this.k0&&this.k0===dr&&(t=!0),this.startAction(this.getActionNames()[0],t,!0)}}}}},X0(i){let r=[],n=null;this.Gr?(function e(t){"Mesh"===t.type&&r.push(t);let i=t.children;for(let t=0;t<i.length;t++)e(i[t])}(this.Ji),function t(){let e=!0;for(let t=0;t<r.length;t++)if(!r[t].isUpdateComplete){e=!1;break}e?(i&&i(),null!==n&&clearTimeout(n)):n=setTimeout(t,10)}()):i&&i()},Ur(t){var e=this.rr(_),i=this.rr(u);let r;return(r=e.getMapOptions().materialMode===xs.REAL?(i=this.Xr(t,i),e.Vt.qr.dh(i)):t.clone()).userData=t.userData,r},q0(){let n=[];var t=this.Ji;if(this.zd)this.Ji.traverse(e=>{if("Mesh"===e.type)if(e.userData.sourceMaterial||(e.userData.sourceMaterial=e.material),Array.isArray(e.material)){var i=[];for(let t=0;t<e.material.length;t++){var r=this.Ur(e.material[t]);r.transparent=!0,i.push(r)}e.material=i,n=n.concat(i)}else{var t=this.Ur(e.material);t.transparent=!0,e.material=t,n.push(t)}});else if(t.userData.sourceMaterial||(t.userData.sourceMaterial=t.material),Array.isArray(this.Ji.material)){var e=[];for(let t=0;t<this.Ji.material.length;t++){var i=this.Ji.material[t];i.transparent=!0,e.push(i.clone())}this.Ji.material=e,n=n.concat(e)}else{t=this.Ji.material.clone();t.transparent=!0,n.push(t),this.Ji.material=t}return n},J0(){var t=this.Ji;let e=t=>{var e;t&&t.userData.sourceMaterial&&(e=t.material,t.material=t.userData.sourceMaterial,delete t.userData.sourceMaterial,Array.isArray(e)?e.forEach(t=>{t.dispose()}):e.dispose())};this.zd&&t?this.Ji.traverse(t=>{"Mesh"===t.type&&e(t)}):e(t),this.If()},F0(t){if(this.Jl){t=void 0!==(t=t||{}).duration?t.duration:.5;let n=this.rr(u),s=n.rr(_);if(this.S0&&!1===this.S0.J){if(this.A0)return;this.S0.stop()}this.A0=!0;let o=this.q0();this.S0.Nt([0]).Rt([1]).ot(t).st(t=>{var e=t.destination[0];for(let t=0;t<o.length;t++){var i=o[t],r=void 0!==this.jf?this.jf:i.userData.sourceOpacity;this.zd&&s.getMapOptions().materialMode===xs.REAL?i.uniforms.opacity.value=e*r*n.jf:i.opacity=e*r*n.jf}s.enableUpdateRender()}).nt(()=>{s.lt.ht(this.S0),this.J0()}),s.lt.ut(this.S0.play())}},j0(t){if(this.Jl){var e=void 0!==(t=t||{}).duration?t.duration:.5;let r=this.rr(u),n=r.rr(_);if(this.S0&&!1===this.S0.J){if(!this.A0)return;this.S0.stop()}this.A0=!1;let s=this.q0();this.S0.Nt([1]).Rt([0]).ot(e).st(t=>{var e=t.destination[0];for(let t=0;t<s.length;t++){var i=void 0!==this.jf?this.jf:s[t].userData.sourceOpacity;this.zd&&n.getMapOptions().materialMode===xs.REAL?s[t].uniforms.opacity.value=e*i*r.jf:s[t].opacity=e*i*r.jf}n.enableUpdateRender()}).nt(()=>{n.lt.ht(this.S0),this.Kc(),n.enableUpdateNode(),t.finish&&t.finish()}),n.lt.ut(this.S0.play())}},K0(t,e){e=this.Xr(t,e);t.color=new ft(e.color),t.opacity=e.opacity,t.transparent=e.transparent},If(){if(this.Ji){let n=this.rr(_),t=this.rr(u);if(n){if(this.zd)this.Ji.traverse(e=>{if("Mesh"===e.type||"SkinnedMesh"===e.type){var i,r=this.Xr(e.material,t);if(n.Ri.materialMode===xs.REAL){let t=null;this.Gr?(t=n.Vt.qr.dh(r),this.Q0(t)):t=n.Vt.qr.Zr(r),t.userData=e.material.userData,e.material=t,this.Fr&&(r.color=this.Fr,(i=n.Vt.qr.Zr(r)).userData=e.material.userData,this.Gr&&this.Q0(i),e.userData.sourceMaterial=e.material,e.material=i)}else if(Array.isArray(e.material.length))for(let t=0;t<e.material.length;t++)e.material[t].depthWrite=!0,e.material[t]=n.Vt.qr.Jr(e.material[t],r),this.Fr&&(r.color=this.Fr,e.userData.sourceMaterial=e.material,e.material[t]=n.Vt.qr.Jr(e.material[t],r));else e.material.depthWrite=!0,e.material=n.Vt.qr.Jr(e.material,r),this.Fr&&(r.color=this.Fr,e.userData.sourceMaterial=e.material,e.material=n.Vt.qr.Jr(e.material,r));this.Gr&&(e.isUpdateComplete=!0)}});else{var e=this.Ji.material;if(Array.isArray(e)){var i,r,s=[];for(i of e)this.K0(i,t),this.Fr&&((r=i.clone()).color=new ft(this.Fr),s.push(r));this.Fr&&(this.Ji.userData.sourceMaterial=this.Ji.material,this.Ji.material=s)}else this.K0(e,t),this.Fr&&((e=e.clone()).color=new ft(this.Fr),this.Ji.userData.sourceMaterial=this.Ji.material,this.Ji.material=e)}this.L0&&(this.L0=!1),n.enableUpdateRender()}}},Q0(t){t.uniforms.isMask.value=!0,t.uniforms.maskType.value=this.Hr,t.uniforms.maskTexture.value=this.Br,void 0!==this.zr&&void 0!==this.Vr&&(t.uniforms.maskHeight.value=this.zr,t.uniforms.maskExtrudeHeight.value=this.Vr),t.uniforms.boundCenter.value=this.Wr,t.uniforms.boundSize.value=this.Yr,t.uniformsNeedUpdate=!0},Y0(t){this.E0&&(t.color=new ft(this.E0)),null!==this.jf&&(t.opacity=this.jf)},Xr(t,e){let i={};this.rr(_).Ri.materialMode===xs.REAL?(t.constructor===jv||t.constructor===Gv?(null==t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),t.userData.sourceTransparent=t.transparent,void 0===t.userData.originColor&&(t.userData.originColor=t.color),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.opacity),null===this.jf&&(this.jf=t.opacity),i={alphaTest:t.alphaTest,color:t.color.getHex(),USE_EMISSIVEMAP:!!t.emissiveMap,USE_METALNESSMAP:!!t.metalnessMap,USE_NORMALMAP:!!t.normalMap,TANGENTSPACE_NORMALMAP:!!t.normalMap,USE_ROUGHNESSMAP:!!t.roughnessMap,USE_MAP:!!t.map,USE_AOMAP:!!t.aoMap,map:n(t.map,null),aoMap:n(t.aoMap,null),emissive:t.emissive.getHex(),emissiveMap:n(t.emissiveMap,null),metalness:n(t.metalness,0),metalnessMap:n(t.metalnessMap,null),roughness:n(t.roughness,1),roughnessMap:n(t.roughnessMap,null),normalScale:n(t.normalScale,new St(1,1)),normalMap:n(t.normalMap,null),vertexColors:t.vertexColors,side:t.side,skinning:t.skinning}):t.constructor===Lv&&(i={alphaTest:t.alphaTest,USE_EMISSIVEMAP:t.defines.USE_EMISSIVEMAP,USE_MAP:t.defines.USE_MAP,USE_AOMAP:t.defines.USE_AOMAP,USE_METALNESSMAP:t.defines.USE_METALNESSMAP,USE_NORMALMAP:t.defines.USE_NORMALMAP,TANGENTSPACE_NORMALMAP:t.defines.TANGENTSPACE_NORMALMAP,USE_ROUGHNESSMAP:t.defines.USE_ROUGHNESSMAP,aoMap:n(t.uniforms.aoMap.value,null),map:n(t.uniforms.map.value,null),color:t.uniforms.diffuse.value.getHex(),emissive:t.uniforms.emissive.value.getHex(),emissiveMap:n(t.uniforms.emissiveMap.value,null),metalness:n(t.uniforms.metalness.value,0),metalnessMap:n(t.uniforms.metalnessMap.value,null),roughness:n(t.uniforms.roughness.value,1),roughnessMap:n(t.uniforms.roughnessMap.value,null),normalScale:n(t.uniforms.normalScale.value,new St(1,1)),normalMap:n(t.uniforms.normalMap.value,null),vertexColors:t.vertexColors,side:t.side,skinning:t.skinning},void 0===t.userData.originColor&&(t.userData.originColor=t.uniforms.diffuse.value),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.uniforms.opacity.value),null===this.jf)&&(this.jf=t.userData.originOpacity),null===this.E0&&(this.E0=i.color)):(void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent),void 0===t.userData.originColor&&(t.userData.originColor=t.color),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.opacity),null===this.E0&&(this.E0=t.color),null===this.jf&&(this.jf=t.opacity)),this.E0&&(i.color=this.E0);let r=void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity:t.opacity;return null!==this.jf&&(r=this.jf),this.W0(t,e),i.opacity=r*e.jf,i.transparent=t.userData.sourceTransparent||i.opacity<1,i;function n(t,e){return void 0!==t?t:e}},$0(t){t&&"Scene"===t.type&&(t.parent&&t.parent.remove(t),this.C0&&t.traverse(t=>{"Mesh"===t.type&&t.material?.uniforms?.map?.value?.dispose()}),t.mapNode=void 0)},Kc(){if(this.Jl){var t;if(this.Gf&&(this.stopAction(this.getActionNames()[0],!0),(t=this.rr(_))&&t.lt.tv(this.Gf),this.Gf=null),this.S0&&!1===this.S0.J&&this.S0.finish(),this.Ji&&"Mesh"===this.Ji.type){if(this.Ji.parent&&this.Ji.parent.remove(this.Ji),Array.isArray(this.Ji.material))for(var e of this.Ji.material)e.map&&this.C0&&e.map.dispose(),e.dispose();else this.Ji.material.map&&this.C0&&this.Ji.material.map.dispose(),this.Ji.material.dispose();this.Ji.geometry.dispose(),this.Ji.geometry=void 0,this.Ji.material=void 0,this.Ji.mapNode=void 0,this.Ji=void 0}else this.$0(this.Ji),this.$0(this.x0),this.Ji=void 0,this.x0=void 0,this.V0&&(this.V0.l0=null);this.I0=0}},T0(){var t=this.rr(_);t&&t.enableUpdateRender()}});class Zg extends Ng{constructor(t){super(),this.Ki=t,this.T=t.height,this.Ei=p.FACILITY,this.Yn=0,this.ev=null,this.Ai=new Map,this.Wc=null}get FID(){return this.Ki.fid}get typeID(){return this.Ki.type}get eName(){return this.Ki.ename}get name(){return this.Ki.name}get size(){return this.ev||this.Wc.height}set size(t){var e;this.ev=t,this.ev?this.Yn=this.ev:(t=this.rr(_),e=this.rr(Es),this.Bu(t,e),this.Yn=this.Wc.height),this.If()}get scaleSize(){return this.size/this.Yn||1}jump(t){return lg(this,t)}stopJump(){return ug(this)}boost(t){return ag(this,t)}stopBoost(){return hg(this)}getPosition(){return{x:this.Ki.Li[0].x,y:this.Ki.Li[0].y,z:this.T}}updateMaterialByThemeTool(t){this.Wc=t,this.Yn=parseInt(this.Wc.height),this.ev&&(this.Yn=this.ev),this.If(),this.Ji.userData.size=this.Yn}}Object.assign(Zg.prototype,{Bu(t,e){this.Wc=t.Vt.zu.hl({fid:this.Ki.fid,typeID:""+this.Ki.type,bid:e.Ht})},Xh(){var t,e;if(!this.Ji)return t=this.rr(_),e=this.rr(Es),this.Bu(t,e),this.Yn=parseInt(this.Wc.height),(e=this.jr(t)).userData.opacity=e.opacity,this.Ji=new Zm(e),e=new Lt((e=this.Ki.Li[0]).x-t.o,-e.y+t.u,0).applyEuler(new C(Math.PI/2,0,0,"XYZ")).add(new Lt(0,this.T,0)),this.Ji.position.copy(e),this.Xn(t.Vt),this.Ji.userData.size=this.Yn,(this.Ji.mapNode=this).U.Fn.add(this.Ji),!0},Bc(t,e){var i;this.Ji&&(i=this.rr(Es),this.Wc=e.hl({fid:this.Ki.fid,typeID:""+this.Ki.type,bid:i.Ht}),this.Yn=parseInt(this.Wc.height),this.If(),this.Ji.userData.size=this.Yn)},If(){var t;this.Ji&&(t=this.rr(_))&&(this.Ji.material=this.jr(t))},jr(t){var e=this.rr(u),i=e.parent;return t.Vt.qr.Eh({opacity:e.jf,needDepth:!1,url:t.Vt.wu(this.Wc,"path",i.buildingID)+this.Wc.imageName},()=>{this.Xn(t.Vt),t.Vt.hs(),t.enableUpdateRender()})},Xn(t){cg(t,this)}});class qg{constructor(t){this.iv=t,this.rv=0,this.nv="";t=this.iv.parent.parent.sv(this.iv.FID);this.Li=t.Ki.Li[0],this.ov=t.getArea()}get renderNode(){return this.av}}Object.assign(qg.prototype,{hv(n){return new Promise((i,t)=>{if(this.lv)i();else if(n){let e=[];this.Li.forEach(t=>{e.push(t.x,t.y)});var r=new ArrayBuffer(8*e.length);new Float64Array(r).set(e),n.__addTask({type:"maxInnerRect",coords:r},[r]).then(t=>{this.lv=t.result.rect,i()})}else this.lv=sg.maxInnerRect(this.Li),i()})},Kt(){this.av&&(this.av=null,this.Li=null)},cv(t){var e=this.lv;let i=e.size.x,r=e.size.y;return i<=0||r<=0?{x:1,y:1}:(i/r<(t=t.width/t.height)?r=i/t:i=r*t,{x:i/e.size.x,y:r/e.size.y})},Xh(t){var e;"MeshBasicMaterial"===t.type&&0<this.iv.fv.length&&(e=new eo(this.lv.size.x,this.lv.size.y,1,1),this.av=new Q(e,t),this.av.renderOrder=10,this.rv=0,this.dv=this.iv.Ki.mi.center,this.av.rotation.set(-Math.PI/2,0,0,"XYZ"),this.vv(t))},vv(i){if(this.av&&i&&"MeshBasicMaterial"===i.type&&i.map){this.av.material=i;var r=this.iv.Wc;let t=this.cv(i.map.image);r.sizes&&(i=r.sizes.split(","),t={x:t.x*parseFloat(i[0]),y:t.y*parseFloat(i[1])});i=void 0!==r.angle?r.angle:0,i=(this.av.scale.set(t.x,t.y,1),this.av.rotation.z=-i*Math.PI/180,this.iv.R);let e=[this.lv.center.x-i.x,i.y-this.lv.center.y];r.coords&&(r=r.coords.split(","),e=[parseFloat(r[0])-i.x,i.y-parseFloat(r[1])]),this.iv?.Ji?.position.set(e[0],this.iv.Ki.height+.01,e[1])}}});let Jg=Object.freeze({Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}})});class Kg extends Ng{constructor(t,e){super(),this.Ki=t,this.R=e,this.Ei=p.LABEL,this.Wc=null,this.pv=null,this.Qr=!1,this.du=null,e.P.Ic===tg.ENAME?this.fv=t.ename:e.P.Ic===tg.FID?this.fv=t.fid:this.fv=t.name,this.fv||(this.fv="",this.Qr=!0),this.mv=e.Ri.HDText,!0===this.mv&&ot.environment===q.BROWSER&&(this.gv=new ot.LabelCollection,this.iv=null),this._v=null,this.bv=!0,this.yv=!0,this.wv=!0,this.xv=!0,this.Mv=!0,this.Ev=!0,this.Lv={show:!1},this.rs=this.R.getMapOptions().labelFade,this.Kc=this.Kc.bind(this),this.Tv=new en}get FID(){return this.Ki.fid}get typeID(){return this.Ki.type}get name(){return this.Ki.name}get eName(){return this.Ki.ename}get text(){return this.fv}set text(t){t?(this.fv=t,this.Qr=!1):(this.fv="",this.Qr=!0),this.Ji&&(this.If(),this.ru()),this.Mv=!0,this.Ev=!0}set fontSize(t){this._v=t,this._v?this.Wc.fontsize=this._v:this.Bu(this.R.Vt,this.R.Vt.zu),this.Ji&&this.If(),this.Mv=!0,this.Ev=!0}get fontSize(){return this._v||this.Wc.fontsize}setText(t){this.text=t}get fading(){return!this.Tv.J}get initTargetShow(){return this.yv}set initTargetShow(t){t!==this.yv&&(this.yv=t,this.Ev=!0)}get collisionTargetShow(){return this.xv}set collisionTargetShow(t){t!==this.xv&&(this.xv=t,this.Mv=!0)}}Object.assign(Kg.prototype,{Af(){this.R.lt.ht(this.Tv)},ss(){if(this.rs&&(!1!==this.Ev||0!=this.Mv)){let t=null;var e;this.yv&&this.xv&&!this.Lv.show&&(t=this.Sv(0,1)),(t=this.yv&&this.xv&&this.Lv.show?this.Sv(1,1):this.yv&&this.xv||!this.Lv.show?(e=this.Ev?this.Kc:null,this.Sv(0,0,e)):(e=this.Ev?this.Kc:null,this.Sv(1,0,e)))&&(this.Ev&&(this.Ev=!1,this.bv=this.yv),this.Mv)&&(this.Mv=!1,this.wv=this.xv),"1"!==this.Wc?.mode||this.yv||this.Kc()}},Av(t){return this.fontSize=t,new Promise(t=>{!1===this.mv&&t(),this.readyCallback=t})},Ov(){return new Promise(t=>{!1===this.mv||this.mv&&this.Ji&&1<this.Ji.children.length?t():this.readyCallback=t})},Cv(o,t){if(o&&t){this.gv||(this.gv=new ot.LabelCollection,this.iv=null);let{width:e,drawTextWidth:i,drawTextLeft:r}=t;t=this.fontSize;this.gv.map=o;let n,s=(this.iv?(n=this.iv).labelMeshInstance&&(this.Ji.remove(n.labelMeshInstance.mesh),this.Ji.remove(n.labelOutlineMeshInstance.mesh)):(n=this.gv.add(),this.iv=n),n.Rv=!0,n.Nv=[],n.Dv=!0,n.rootNode=this.Ji,n.text=this.fv,n.font=t+"px "+(this.Wc.fontFamily||'"Microsoft Yahei","",Tahoma,Arial'),n.kv=tn.rgbToArray(this.Wc.fillColor),n.outlineWidth=void 0!==this.Wc.strokeWidth?2*this.Wc.strokeWidth:4,n.outlineColor=tn.rgbToArray(this.Wc.strokeColor),n.pixelRatio=o.A.renderer.getPixelRatio(),()=>{var t;this.gv.update(),!1===n.Rv&&(t=(r+i/2-e/2)/2/1.2,n.pixelOffset=[t,0],o.enableUpdateRender(),o.off("update",s),this.readyCallback)&&this.readyCallback()});this.Pv=s,o.on("update",s),o.on("pixelRatioChanged",()=>{n.pixelRatio=o.A.renderer.getPixelRatio()})}},Iv(){var t=this.jr(),t=(t.userData.opacity=t.opacity,this.Fv&&this.Fv.Kt(),new Zm(t)),t=(t.scale.set(0,0,0),this.Ji.add(t),(t.mapNode=this).rr(u)),t=t.U.U,e=this.Ki.Li[0],e=new Lt(e.x-t.o,-e.y+t.u,0).applyEuler(new C(Math.PI/2,0,0,"XYZ")).add(new Lt(0,this.Ki.height,0));this.Ji.position.copy(e)},initTopMesh(){this.Fv||(this.Fv=new qg(this,this.R)),this.Fv.hv(this.R.Vt.jv).then(()=>{var t;this.Ji&&"1"===this.Wc?.mode&&((t=this.jr()).opacity=1,t.userData.opacity=t.opacity,this.Ji.visible=!0,this.Fv?.Xh(t),this.Fv?.renderNode)&&((this.Fv.renderNode.mapNode=this).Ji.add(this.Fv.renderNode),this.R.enableUpdateNode())})},Xh(){var t;this.Ji||(t=this.rr(u).U.U,this.Bu(this.R.Vt,t.Vt.zu),this.Ji=new mc,"1"===(this.Ji.mapNode=this).Wc.mode?(this.mv=!1,this.iv&&(this.iv.labelMeshInstance&&(this.Ji.remove(this.iv.labelMeshInstance.mesh),this.Ji.remove(this.iv.labelOutlineMeshInstance.mesh)),this.iv=null,t.off("update",this.Pv)),0<this.fv.length&&this.initTopMesh()):(this.mv=t.Ri.HDText,this.Iv()),this.Xn(this.R.Vt),this.U.Fn.add(this.Ji),this.du&&this.du.Xh(this))},Bc(t,e){this.Ji&&(this.Ev=!0,this.Mv=!0,this.Bu(t,e),this.If())},If(){var t,e;this.Ji&&(this.Ji.children[0]?this.rr(_)&&(t="1"===this.Wc.mode?"Mesh":"Sprite","Mesh"===(e=this.Ji.children[0].type)&&"Mesh"!=t||"Sprite"===e&&"Sprite"!=t?(this.Kc(),this.Xh()):this.jr(t=>{var e;this.Ji&&(e=this.Ji.children[0].material,this.Ji.children[0].material=t,e.map&&(e.map.dispose(),e.map=null),e.dispose())})):this.Fv&&(this.Kc(),this.R.enableUpdateNode()))},Sv(i=0,r=1,t){if(!this.Ji||this.Ji.children.length<1)return null;if(this.fv.length<1)return this.Ji.visible=!1,null;this.Tv.stop();var e=this.rr(u);let n=this.Wc.alpha*e.jf;this.Lv.show=1==r;e="1"!==this.Wc?.mode;return e||(r=1),this.R.C.controls.activeing&&e?(1===r&&(this.Ji.visible=!0),0===i&&0===r?(this.Ji.children.forEach(t=>{t.material.opacity=0}),this.iv&&(this.iv.opacity=0),this.R.enableUpdateRender()):(1===i&&(i=n),1===r&&(r=n),i===r?(this.Ji.children.forEach(t=>{t.material.opacity=i}),this.iv&&(this.iv.opacity=i),this.R.enableUpdateRender()):(this.Tv.Nt([i]).Rt([r]).ot(.2).st(t=>{let e=t.destination[0];this.Ji.children.forEach(t=>{t.material.opacity=e,this.R.enableUpdateRender()});t=Jg.Cubic.In(e/Math.max(i,r));this.iv&&(this.iv.opacity=t)}).nt(()=>{t&&t(this),this.R.lt.ht(this.Tv)}).et(),this.R.lt.ut(this.Tv)))):(this.Ji.visible=1==r,this.Ji.children.forEach(t=>{t.material.opacity=n}),this.iv&&(this.iv.opacity=n),this.R.enableUpdateRender()),1},jr(e){var t=this.rr(u);let i={scale:2,needSize:!0,opacity:this.Wc.alpha*t.jf,drawText:!this.mv};this.Wc.image&&(i.imageUrl=this.pv+this.Wc.image);t=this.R.Vt.qr;let r="1"===this.Wc.mode?t.xh:t.bh;return(r=r.bind(t))(this.fv,this.Wc,i,t=>{e&&e(t),this.rs&&(t.opacity=0,this.Ev=!0,this.Mv=!0,this.ss()),this.Ji&&this.Xn(this.R.Vt),void 0!==i.imageUrl&&this.R.Vt.hs(),ot.environment===q.WX&&this.R.Vt.hs(),this.Fv&&this.Fv.vv(t),!0===this.mv?(t.map&&(t.map.minFilter=qe,t.map.magFilter=qe),this.Cv(this.R,t.map?.image),this.iv.opacity=t.opacity):this.readyCallback&&this.readyCallback(),this.ss(1),this.R.enableUpdateRender()})},Xn(t){var e,i,r=this.Ji.children[0];r&&r.material.map&&r.material.map.image&&(e=r.material).userData.mspriteScale&&(t=t.Fc(this.fontSize),i=2*this.fontSize*1.2,i=e.map.image.height/i,e.userData.mspriteScale=Math.max(i,e.userData.mspriteScale),r.scale.set(t,t,t),r.scale.multiplyScalar(e.userData.mspriteScale),r.scale.setX(r.scale.x/e.userData.scaleRatio))},Bu(t,e){var i=this.rr(Es);this.Wc=e.ll({fid:this.Ki.fid,typeID:this.Ki.type+"",bid:i.Ht}),this._v&&(this.Wc.fontsize=this._v),this.pv=t.wu(this.Wc,"path",i.buildingID),parseInt(this.fontSize)},updateMaterialByThemeTool(t){this.Wc=t;var t=this.rr(u).U,e=t.U.Vt;this.pv=e.wu(this.Wc,"path",t.buildingID),this.If()}});class Qg extends Ms{constructor(t){super(),this.T=void 0!==(t=t||{}).height?t.height:1,this.o=t.x,this.u=t.y,this.Ji=null,this.ef=!1,this.Of=void 0,this.Gv=t.userID,void 0===this.Gv&&(this.Gv=""+tn.generateUUID())}set userID(t){this.Gv=t}get userID(){return this.Gv}get isInit(){return this.ef}set isInit(t){this.ef=t}get isbloom(){return this.Of}set isbloom(t){this.Of=t}get x(){return this.o}get y(){return this.u}get height(){return this.T}set height(t){this.T=t,this.Uv()}get level(){var t=this.rr(u);return t?t.level:null}get visible(){return this.er}set visible(t){this.er=t,this.Ji&&(this.Ji.visible=this.er,t=this.rr(_))&&t.enableUpdateRender()}get opacity(){return this.jf}set opacity(t){this.jf=t,this.Ji&&(this.Ji.material.opacity=this.jf)}get isMarker(){return!0}get bound(){return[p.IMAGE_MARKER,p.DOM_MARKER,p.DYNAMIC_MODEL_MARKER,p.LOCATION_MARKER,p.TEXT_MARKER].find(t=>t===this.Ei)?!0===this.needUpdateBound&&(this.mi.reset(),void 0!==this.o)&&void 0!==this.u&&(this.mi.expandByCoords([{x:this.o,y:this.u}]),this.needUpdateBound=!1):!0===this.needUpdateBound&&(this.mi.reset(),this.mi.expandByCoords(this.hc),this.needUpdateBound=!1),this.mi.clone()}addTo(t){t.getOrCreateLayer(this.Ei).add(this),this.Ji&&(this.Ji?.updateMatrixWorld(!0),this.Ji?.parent?.updateMatrixWorld(!0))}remove(){var t=this.rr(_);this.U&&this.U.remove(this),t&&t.enableUpdateRender()}dispose(){this.remove(),this.Ji&&(this.Ji.traverse(t=>{t instanceof Q&&(t.geometry.dispose(),t.geometry=void 0,Array.isArray(t.material)?t.material.forEach(t=>{this.Hv(t)}):this.Hv(t.material)),"SkinnedMesh"===t.type&&(t.skeleton.boneTexture&&t.skeleton.boneTexture.dispose(),t.skeleton.dispose())}),this.Ji.mapNode=void 0,this.Ji=void 0),this.ef=!1}}Object.assign(Qg.prototype,{Hv(t){if(t){if(t instanceof Lv){var e,i=t.uniforms;for(e in i)i[e]&&i[e].value instanceof f&&i[e].value.dispose();t.dispose()}else for(var r in t)t[r]&&t[r]instanceof f&&t[r].dispose();t.dispose()}},Bv(){var t;void 0!==this.o&&void 0!==this.u||(t=this.rr(u),this.o=t.center.x,this.u=t.center.y)},Xh(){return!1},Uv(){}});var $g={exports:{}},t_=($g.exports,(t=>{function r(t,e){var i=t.length-1,r=[t[0]];return function t(e,i,r,n,s){for(var o,a,h,l,u,c,f,d=n,v=i+1;v<r;v++){a=e[v],p=e[r],f=c=u=l=void 0,u=(h=e[i]).x,h=h.y,c=p.x-u,f=p.y-h,0==c&&0==f||(1<(l=((a.x-u)*c+(a.y-h)*f)/(c*c+f*f))?(u=p.x,h=p.y):0<l&&(u+=c*l,h+=f*l));var p=(c=a.x-u)*c+(f=a.y-h)*f;d<p&&(o=v,d=p)}n<d&&(1<o-i&&t(e,i,o,n,s),s.push(e[o]),1<r-o)&&t(e,o,r,n,s)}(t,0,i,e,r),r.push(t[i]),r}function e(t,e,i){return t.length<=2||(e=void 0!==e?e*e:1,t=r(t=i?t:((t,e)=>{for(var i,r,n,s,o=t[0],a=[o],h=1,l=t.length;h<l;h++)i=t[h],n=o,s=void 0,(s=(r=i).x-n.x)*s+(r=r.y-n.y)*r>e&&(a.push(i),o=i);return o!==i&&a.push(i),a})(t,e),e)),t}t.exports=e,t.exports.default=e})($g),$g.exports),e_=rs(t_);class i_ extends et{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.hc=[],this.zv=null,this.widthCallback=null,this.totalLength=0,this.matrixWorld=new Tt,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this.zv},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this.hc},set:function(t){this.setPoints(t,this.widthCallback)}}})}}function r_(t,e){var i=new Tt,r=new _s,n=new Dt,s=new Lt,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),n.copy(o.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(n,s)){i.copy(this.matrixWorld).invert(),r.copy(t.ray).applyMatrix4(i);var a=new Lt,h=new Lt,l=new Lt,u=this instanceof zp?2:1,n=o.index,i=o.attributes;if(null!==n)for(var c=n.array,f=i.position.array,d=0,v=c.length-1;d<v;d+=u){var p,m=c[d],g=c[d+1];a.fromArray(f,3*m),h.fromArray(f,3*g),m=this.material.fmmap,g=this.material.lineWidth/4,p=void 0,p={x:ot.document.body.clientWidth/2,y:ot.document.body.clientHeight/2},g={x:p.x+g,y:p.y},p=st.coordsScreenToMap(m,p),m=st.coordsScreenToMap(m,g),g=(p.x-m.x)*(p.x-m.x)+(p.y-m.y)*(p.y-m.y);g<r.distanceSqToSegment(a,h,s,l)||(s.applyMatrix4(this.matrixWorld),(p=t.ray.origin.distanceTo(s))<t.near)||p>t.far||(e.push({distance:p,point:l.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this}),d=v)}}}function n_(t,e,i,r,n){var s;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,n&&e+n):t.slice(e,n&&e+n):t,i.set)i.set(t,r);else for(s=0;s<t.length;s++)i[s+r]=t[s];return i}i_.prototype.setMatrixWorld=function(t){this.matrixWorld=t},i_.prototype.setGeometry=function(t,e){this.Vv=t,this.setPoints(t.getAttribute("position").array,e)},i_.prototype.setPoints=function(e,i){if(e instanceof Float32Array||e instanceof Array){this.hc=e,this.totalLength=0,this.widthCallback=i,this.positions=[],this.counters=[];let t=!0;if(0!==e.length){if(e.length&&e[0]instanceof Lt)for(var r=0;r<e.length;r++){var n=e[r];if(isNaN(""+n.x)||isNaN(""+n.y)||isNaN(""+n.z)){t=!1;break}var s,o,a=r/e.length;this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z),this.counters.push(a),this.counters.push(a),0<r&&(n=e[r].x-e[r-1].x,s=e[r].y-e[r-1].y,o=e[r].z-e[r-1].z,this.totalLength=this.totalLength+Math.sqrt(n*n+s*s+o*o))}else for(r=0;r<e.length;r+=3){var h,l,u,a=r/e.length;if(isNaN(""+e[r])||isNaN(""+e[r+1])||isNaN(""+e[r+2])){t=!1;break}this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(a),this.counters.push(a),0<r&&(h=e[r]-e[u=r-3],l=e[r+1]-e[1+u],u=e[r+2]-e[2+u],this.totalLength=this.totalLength+Math.sqrt(h*h+l*l+u*u))}t&&this.process()}}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},i_.prototype.raycast=r_,i_.prototype.compareV3=function(t,e){t*=6,e*=6;return this.positions[t]===this.positions[e]&&this.positions[1+t]===this.positions[1+e]&&this.positions[2+t]===this.positions[2+e]},i_.prototype.copyV3=function(t){t*=6;return[this.positions[t],this.positions[1+t],this.positions[2+t]]},i_.prototype.process=function(){var t,e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);let i=0;for(var r,n,s,o=0;o<e;o++)this.side.push(1),this.side.push(-1),s=this.widthCallback?this.widthCallback(o/(e-1)):1,this.width.push(s),this.width.push(s),o<e-1&&(t=this.copyV3(o),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]),this.indices_array.push(s=2*o,1+s,2+s),this.indices_array.push(2+s,1+s,3+s)),0<o&&(t=this.copyV3(o),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),s=this.copyV3(o-1),r=t[0]-s[0],n=t[1]-s[1],s=t[2]-s[2],i+=Math.sqrt(r*r+n*n+s*s)),this.uvs.push(i/this.totalLength,0),this.uvs.push(i/this.totalLength,1);t=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this.Wv&&this.Wv.position.count===this.positions.length?(this.Wv.position.copyArray(new Float32Array(this.positions)),this.Wv.position.needsUpdate=!0,this.Wv.previous.copyArray(new Float32Array(this.previous)),this.Wv.previous.needsUpdate=!0,this.Wv.next.copyArray(new Float32Array(this.next)),this.Wv.next.needsUpdate=!0,this.Wv.side.copyArray(new Float32Array(this.side)),this.Wv.side.needsUpdate=!0,this.Wv.width.copyArray(new Float32Array(this.width)),this.Wv.width.needsUpdate=!0,this.Wv.uv.copyArray(new Float32Array(this.uvs)),this.Wv.uv.needsUpdate=!0,this.Wv.index.copyArray(new Uint16Array(this.indices_array)),this.Wv.index.needsUpdate=!0):this.Wv={position:new J(new Float32Array(this.positions),3),previous:new J(new Float32Array(this.previous),3),next:new J(new Float32Array(this.next),3),side:new J(new Float32Array(this.side),1),width:new J(new Float32Array(this.width),1),uv:new J(new Float32Array(this.uvs),2),index:new J(new Uint16Array(this.indices_array),1),counters:new J(new Float32Array(this.counters),1)},this.setAttribute("position",this.Wv.position),this.setAttribute("previous",this.Wv.previous),this.setAttribute("next",this.Wv.next),this.setAttribute("side",this.Wv.side),this.setAttribute("width",this.Wv.width),this.setAttribute("uv",this.Wv.uv),this.setAttribute("counters",this.Wv.counters),this.setIndex(this.Wv.index),this.computeBoundingSphere(),this.computeBoundingBox()},i_.prototype.advance=function(t){var e=this.Wv.position.array,i=this.Wv.previous.array,r=this.Wv.next.array,n=e.length;n_(e,0,i,0,n),n_(e,6,e,0,n-6),e[n-6]=t.x,e[n-5]=t.y,e[n-4]=t.z,e[n-3]=t.x,e[n-2]=t.y,e[n-1]=t.z,n_(e,6,r,0,n-6),r[n-6]=t.x,r[n-5]=t.y,r[n-4]=t.z,r[n-3]=t.x,r[n-2]=t.y,r[n-1]=t.z,this.Wv.position.needsUpdate=!0,this.Wv.previous.needsUpdate=!0,this.Wv.next.needsUpdate=!0},b.meshline_vert=["",b.common,b.logdepthbuf_pars_vertex,b.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","varying vec2 vUvPass;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","\t vUvPass=uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",b.logdepthbuf_vertex,"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",b.fog_vertex,"}"].join("\n"),b.meshline_frag=["",b.fog_pars_fragment,b.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","uniform bool ispassed;","uniform vec3 passColor;","uniform float currentPercent;","uniform float beginPercent;","uniform float endPercent;","uniform bool isGradient;","uniform mat3 uvTransform;","uniform float gradientPercent[{num}];","uniform vec4 gradientColor[{num}];","uniform float gradientBegin;","uniform float gradientEnd;","uniform bool isArrow;","uniform bool usePassOpacity;","uniform float passOpacity;","uniform bool zFighting;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","varying vec2 vUvPass;","","void main() {","",b.logdepthbuf_fragment,"","    vec4 c = vColor;","\t vec4 gColor=vec4(0.0,0.0,0.0,0.0);","    if(isGradient){","\t\tfloat value = gradientBegin + vUvPass.x * (gradientEnd - gradientBegin);","\t\tvec4 colorBegin=gradientColor[0];","\t\tvec4 colorEnd=gradientColor[0];","\t\tfloat bPercent=gradientPercent[0];","       float ePercent=gradientPercent[0];","\t\tfor(int i=0;i<{num};i++){","\t\t\tif(value>=gradientPercent[i]){","\t\t\t\tcolorBegin=gradientColor[i];","\t\t\t\tcolorEnd=gradientColor[i];","\t\t\t\tbPercent=gradientPercent[i];","\t\t\t\tePercent=gradientPercent[i];","\t\t\t\tif(i+1<={num}-1){","\t\t\t\t\tcolorEnd=gradientColor[i+1];","\t\t\t\t\tePercent=gradientPercent[i+1];","\t\t\t\t}","\t\t\t}","\t\t}","\t\tfloat perCent=(value-bPercent)/(ePercent-bPercent);","\t\tgColor=mix(colorBegin,colorEnd,perCent);","\t }","    if( useMap == 1. ) {","   vec2 uvRepet = vUV * repeat;","   vec2 uvRotation = ( uvTransform * vec3( uvRepet, 1.0 ) ).xy;","\t \tc = texture2D( map, uvRotation );","\t\tif(isArrow){","    \t\tc=c+gColor;","\t\t} else {","\t\t\tif(isGradient){","\t\t\t\tc.rgb=gColor.rgb;","\t\t\t}","\t\t}","\t } else {","       c = vColor;","\t\tif(isGradient){","\t\t\tc=gColor;","\t\t\tc.a=vColor.a;","\t\t}","\t }","\t bool isPassed2=false;","\t if(ispassed) {","\t\tif(currentPercent>=endPercent){","\t\t\tc=vec4(passColor,vColor.a);","\t\t\tisPassed2=true;","\t\t} else {","\t\t\tif((endPercent-currentPercent)<(1.0-vUvPass.x)*(endPercent-beginPercent)){","\t\t\t\tc=vec4(passColor,vColor.a);","\t\t\t\tisPassed2=true;","\t\t\t}","\t\t}","\t }","\t if(zFighting && !isPassed2){","\t\tdiscard;","\t }","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","\t if(usePassOpacity&&isPassed2){","\t\tgl_FragColor.a=passOpacity;","\t\tif(passOpacity<0.1){","\t\t\tdiscard;","\t\t}","\t }","",b.fog_fragment,"}"].join("\n");class s_ extends g{constructor(t,e,i){super({uniforms:Object.assign({},Ot.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new ft(16777215)},opacity:{value:1},resolution:{value:new St(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new St(1,1)},offset:{value:new St(1,1)},ispassed:{value:!1},passColor:{value:new ft(16777215)},currentPercent:{value:0},beginPercent:{value:0},endPercent:{value:0},isGradient:{value:!1},gradientPercent:{value:[]},gradientColor:{value:[]},gradientBegin:{value:0},gradientEnd:{value:0},isArrow:{value:!1},usePassOpacity:{value:!1},passOpacity:{value:1},zFighting:{value:!1}}),vertexShader:b.meshline_vert,fragmentShader:b.meshline_frag.replace(/{num}/g,""+e)}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",this.fmmap=i,this.uniforms.uvTransform={value:new N},Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){t&&(this.uniforms.map.value=t,this.uniforms.uvTransform.value=t.matrix)}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value.copy(t)}},ispassed:{enumerable:!0,get:function(){return this.uniforms.ispassed.value},set:function(t){this.uniforms.ispassed.value=t}},beginPercent:{enumerable:!0,get:function(){return this.uniforms.beginPercent.value},set:function(t){this.uniforms.beginPercent.value=t}},endPercent:{enumerable:!0,get:function(){return this.uniforms.endPercent.value},set:function(t){this.uniforms.endPercent.value=t}},currentPercent:{enumerable:!0,get:function(){return this.uniforms.currentPercent.value},set:function(t){this.uniforms.currentPercent.value=t}},passColor:{enumerable:!0,get:function(){return this.uniforms.passColor.value},set:function(t){this.uniforms.passColor.value=t}},gradientPercent:{enumerable:!0,get:function(){return this.uniforms.gradientPercent.value},set:function(t){this.uniforms.gradientPercent.value=t}},gradientColor:{enumerable:!0,get:function(){return this.uniforms.gradientColor.value},set:function(t){this.uniforms.gradientColor.value=t}},isGradient:{enumerable:!0,get:function(){return this.uniforms.isGradient.value},set:function(t){this.uniforms.isGradient.value=t}},gradientBegin:{enumerable:!0,get:function(){return this.uniforms.gradientBegin.value},set:function(t){this.uniforms.gradientBegin.value=t}},gradientEnd:{enumerable:!0,get:function(){return this.uniforms.gradientEnd.value},set:function(t){this.uniforms.gradientEnd.value=t}},isArrow:{enumerable:!0,get:function(){return this.uniforms.isArrow.value},set:function(t){this.uniforms.isArrow.value=t}},usePassOpacity:{enumerable:!0,get:function(){return this.uniforms.usePassOpacity.value},set:function(t){this.uniforms.usePassOpacity.value=t}},passOpacity:{enumerable:!0,get:function(){return this.uniforms.passOpacity.value},set:function(t){this.uniforms.passOpacity.value=t}},zFighting:{enumerable:!0,get:function(){return this.uniforms.zFighting.value},set:function(t){this.uniforms.zFighting.value=t}}}),this.setValues(t)}}function o_(){et.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function a_(t,e,i){wc.call(this,t,e),this.meshPerAttribute=i||1}function h_(t){et.call(this),this.type="WireframeGeometry";var e,i,r,n,s,o,a=[],h=[0,0],l={},u=["a","b","c"];if(t&&t.isGeometry){for(var c=t.faces,f=0,d=c.length;f<d;f++)for(var v=c[f],p=0;p<3;p++)n=v[u[p]],s=v[u[(p+1)%3]],h[0]=Math.min(n,s),h[1]=Math.max(n,s),void 0===l[o=h[0]+","+h[1]]&&(l[o]={index1:h[0],index2:h[1]});for(o in l)y=t.vertices[(r=l[o]).index1],a.push(y.x,y.y,y.z),y=t.vertices[r.index2],a.push(y.x,y.y,y.z)}else if(t&&t.isBufferGeometry){var m,g,_,b,y=new Lt;if(null!==t.index){for(m=t.attributes.position,g=t.index,i=(_=(e=0)===(_=t.groups).length?[{start:0,count:g.count,materialIndex:0}]:_).length;e<i;++e)for(d=(f=(b=_[e]).start)+b.count;f<d;f+=3)for(p=0;p<3;p++)n=g.getX(f+p),s=g.getX(f+(p+1)%3),h[0]=Math.min(n,s),h[1]=Math.max(n,s),void 0===l[o=h[0]+","+h[1]]&&(l[o]={index1:h[0],index2:h[1]});for(o in l)y.fromBufferAttribute(m,(r=l[o]).index1),a.push(y.x,y.y,y.z),y.fromBufferAttribute(m,r.index2),a.push(y.x,y.y,y.z)}else for(f=0,d=(m=t.attributes.position).count/3;f<d;f++)for(p=0;p<3;p++)y.fromBufferAttribute(m,3*f+p),a.push(y.x,y.y,y.z),y.fromBufferAttribute(m,3*f+(p+1)%3),a.push(y.x,y.y,y.z)}this.setAttribute("position",new x(a,3))}s_.prototype.copy=function(t){return g.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},o_.prototype=Object.assign(Object.create(et.prototype),{constructor:o_,isInstancedBufferGeometry:!0,copy:function(t){return et.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),a_.prototype=Object.assign(Object.create(wc.prototype),{constructor:a_,isInstancedInterleavedBuffer:!0,copy:function(t){return wc.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),h_.prototype=Object.create(et.prototype),h_.prototype.constructor=h_;class l_ extends o_{constructor(){super(),this.type="LineSegmentsGeometry";this.isLineSegmentsGeometry=!0,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new x([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new x([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2)),this.setAttribute("uv2",new x([0,0,1,0,0,1/3,1,1/3,0,2/3,1,2/3,0,1,1,1],2))}applyMatrix(t){var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(i),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var e,t=new a_(e,6,1);return this.setAttribute("instanceStart",new Mc(t,3,0)),this.setAttribute("instanceEnd",new Mc(t,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var e,t=new a_(e,6,1);return this.addAttribute("instanceColorStart",new Mc(t,3,0)),this.addAttribute("instanceColorEnd",new Mc(t,3,3)),this}setUvys(t){t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var e,t=new a_(e,2,1);return this.setAttribute("uvyStart",new Mc(t,1,0)),this.setAttribute("uvyEnd",new Mc(t,1,1)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new h_(t.geometry)),this}fromLineSegements(t){t=t.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this}computeBoundingBox(){var t=new Ct,e=(null===this.boundingBox&&(this.boundingBox=new Ct),this.attributes.instanceStart),i=this.attributes.instanceEnd;void 0!==e&&void 0!==i&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(i),this.boundingBox.union(t))}computeBoundingSphere(){var t=new Lt,e=(null===this.boundingSphere&&(this.boundingSphere=new Dt),null===this.boundingBox&&this.computeBoundingBox(),this.attributes.instanceStart),i=this.attributes.instanceEnd;if(void 0!==e&&void 0!==i){for(var r=this.boundingSphere.center,n=(this.boundingBox.getCenter(r),0),s=0,o=e.count;s<o;s++)t.fromBufferAttribute(e,s),n=Math.max(n,r.distanceToSquared(t)),t.fromBufferAttribute(i,s),n=Math.max(n,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("fm.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}clone(){}copy(t){return this}}class u_ extends l_{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(t){for(var e=t.length-3,i=new Float32Array(2*e),r=0;r<e;r+=3)i[2*r]=t[r],i[2*r+1]=t[r+1],i[2*r+2]=t[r+2],i[2*r+3]=t[r+3],i[2*r+4]=t[r+4],i[2*r+5]=t[r+5];return this.test="ddd",(new l_).setPositions.call(this,i),this}setColors(t){for(var e=t.length-3,i=new Float32Array(2*e),r=0;r<e;r+=3)i[2*r]=t[r],i[2*r+1]=t[r+1],i[2*r+2]=t[r+2],i[2*r+3]=t[r+3],i[2*r+4]=t[r+4],i[2*r+5]=t[r+5];return(new l_).setColors.call(this,i),this}fromLine(t){t=t.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this}copy(t){return this}}var c_=new Lt,f_=new Lt;function d_(t,e){this.start=void 0!==t?t:new Lt,this.end=void 0!==e?e:new Lt}function v_(t={x:0,y:0,z:0},e={x:0,y:0,z:0},i){t=new At(t.x,t.y,t.z,1),e=new At(e.x,e.y,e.z,1);return t.applyMatrix4(i.projectionMatrix),e.multiplyScalar(t.w),e.applyMatrix4(i.projectionMatrixInverse),{x:e.x,y:e.y,z:e.z}}Object.assign(d_.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Lt),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Lt),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Lt),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){c_.subVectors(t,this.start),f_.subVectors(this.end,this.start);t=f_.dot(f_),t=f_.dot(c_)/t;return t=e?Et.clamp(t,0,1):t},closestPointToPoint:function(t,e,i){t=this.closestPointToPointParameter(t,e);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Lt),this.delta(i).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});class p_ extends Q{constructor(t,e){super(t,e),this.type="LineSegments2",this.isLineSegments2=!0}computeLineDistances(){for(var t=new Lt,e=new Lt,i=this.geometry,r=i.attributes.instanceStart,n=i.attributes.instanceEnd,s=new Float32Array(2*r.data.count),o=0,a=0,h=r.data.count;o<h;o++,a+=2)t.fromBufferAttribute(r,o),e.fromBufferAttribute(n,o),s[a]=0===a?0:s[a-1],s[a+1]=s[a]+t.distanceTo(e);var l=new a_(s,2,1);return i.setAttribute("instanceDistanceStart",new Mc(l,1,0)),i.setAttribute("instanceDistanceEnd",new Mc(l,1,1)),this}copy(t){return this}raycast(t,i){null===t.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var r=new At,n=new At,e=new At,s=new Lt,o=new Tt,a=new d_,h=new Lt,l=new Ct,u=new Dt,c=void 0!==t.params.Line2&&t.params.Line2.threshold||0,f=t.ray,d=t.camera,v=d.projectionMatrix,p=this.matrixWorld,m=this.geometry,g=this.material,_=g.resolution,b=g.uniforms.lineWidth.value+c,y=m.attributes.instanceStart,w=m.attributes.instanceEnd,x=-d.near,g=2*Math.max(b/_.width,b/_.height),c=(null===m.boundingSphere&&m.computeBoundingSphere(),u.copy(m.boundingSphere).applyMatrix4(p),Math.max(d.near,u.distanceToPoint(f.origin))),c=v_({x:0,y:0,z:-c},{x:g,y:0,z:0},d);if(d.isPerspectiveCamera?c.x/=2:c.x=b/d.zoom,u.radius+=c.x,!1!==t.ray.intersectsSphere(u)){null===m.boundingBox&&m.computeBoundingBox(),l.copy(m.boundingBox).applyMatrix4(p);c=v_({x:0,y:0,z:-Math.max(d.near,l.distanceToPoint(f.origin))},{x:g,y:0,z:0},d);if(d.isPerspectiveCamera?c.x/=2:c.x=b/d.zoom,l.max.x+=c.x,l.max.y+=c.x,l.max.z+=c.x,l.min.x-=c.x,l.min.y-=c.x,l.min.z-=c.x,!1!==t.ray.intersectsBox(l)){f.at(1,e),e.w=1,e.applyMatrix4(d.matrixWorldInverse),e.applyMatrix4(v),e.multiplyScalar(1/e.w),e.x*=_.x/2,e.y*=_.y/2,e.z=0,s.copy(e),o.multiplyMatrices(d.matrixWorldInverse,p);for(let t=0,e=y.count;t<e;t++){r.fromBufferAttribute(y,t),n.fromBufferAttribute(w,t),r.w=1,n.w=1,r.applyMatrix4(o),n.applyMatrix4(o);var M=r.z>x&&n.z>x;if(!M){r.z>x?(M=r.z-n.z,M=(r.z-x)/M,r.lerp(n,M)):n.z>x&&(M=n.z-r.z,M=(n.z-x)/M,n.lerp(r,M)),r.applyMatrix4(v),n.applyMatrix4(v),r.multiplyScalar(1/r.w),n.multiplyScalar(1/n.w),r.x*=_.x/2,r.y*=_.y/2,n.x*=_.x/2,n.y*=_.y/2,a.start.copy(r),a.start.z=0,a.end.copy(n),a.end.z=0;var M=a.closestPointToPointParameter(s,!0),M=(a.at(M,h),Et.lerp(r.z,n.z,M)),M=-1<=M&&M<=1,E=h.distanceTo(n)<1||h.distanceTo(r)<1?.5*b*Math.sqrt(2):.5*b,E=s.distanceTo(h)<E;if(M&&E){a.start.fromBufferAttribute(y,t),a.end.fromBufferAttribute(w,t),a.start.applyMatrix4(p),a.end.applyMatrix4(p);M=new Lt,E=new Lt;f.distanceSqToSegment(a.start,a.end,E,M),i.push({point:E,pointOnLine:M,distance:f.origin.distanceTo(E),object:this,face:null,faceIndex:t,uv:null,uv2:null});break}}}}}}}class m_ extends p_{constructor(t,e){super(t,e),this.type="Line2",this.isLine2=!0}}class g_{constructor(){}calculatePoint(t,e,i){return(new Lt).copy(i).add((new Lt).copy(t).sub(i).normalize().multiplyScalar(e))}computerArcLineByPoints(t,e,i,r,n){var s=[],t=this.calculatePoint(t,r,e),i=this.calculatePoint(i,r,e),o=new U1(t,e,i);s.push(t);for(let t=0;t<n-1;t++){var a=(t+1)/n,a=o.getPoint(a);s.push(a)}return s.push(i),s}}class __{constructor(){this.hc=null,this.mr=0,this.Yv=void 0,this.Xv=!0,this.Zv=1,this.qv=[],this.Jv=!1,this.Kv=null,this.Qv=null,this.$v=[],this.tp=[],this.ep=[],this.ip=null,this.rp=null,this.np=!1}get points(){return this.hc}set points(t){this.np=!1,this.hc=t}get level(){return this.mr}set level(t){this.mr=t}get buildingID(){return this.Yv}set buildingID(t){this.Yv=t}get length(){return this.sp(this.$v.length)}get linePoints(){return this.Kv}get uvys(){return this.Qv}resize(){this.$v=[],this.Jv=!1}}Object.assign(__.prototype,{op(t,e){this.np||("number"!=typeof e&&(e=this.Zv),this.Kv=this.ap(t,e),this.Qv=this.hp(),this.np=!0)},ap(e,t){this.Xv?this.Jv||this.lp(t):(t=this.cp(this.hc),this.qv=t);var i=[];for(let t=0;t<this.qv.length;t++){var r=this.qv[t].x-e.x,n=this.qv[t].z,s=-this.qv[t].y+e.y;i.push(r,n,s),0!==t&&(r=new Lt(this.qv[t].x,this.qv[t].y,this.qv[t].z),n=new Lt(this.qv[t-1].x,this.qv[t-1].y,this.qv[t-1].z),this.$v.push(r.distanceTo(n)))}return i},cp(e){var i=[];for(let t=0;t<e.length-1;t++){var r=new Lt(e[t].x,e[t].y,e[t].z),n=new Lt(e[t+1].x,e[t+1].y,e[t+1].z);0===t&&i.push(r),i.push(s(r,n)),i.push(s(n,r)),i.push(n)}return i;function s(t,e){return new Lt(t.x+.001*(e.x-t.x),t.y+.001*(e.y-t.y),t.z+.001*(e.z-t.z))}},lp(e){var i,r,n=[],s=new g_;for(let t=0;t<this.hc.length;t++)0===t&&this.rp?(i=this.fp(e,this.rp,this.hc[t],this.hc[t+1]),this.isCross?n.push(...s.computerArcLineByPoints(this.rp,this.hc[t],this.hc[t+1],i,12)):n.push(s.calculatePoint(this.hc[t+1],i,this.hc[t]))):t===this.hc.length-1&&this.ip?(i=this.fp(e,n[n.length-1],this.hc[t],this.ip),this.isCross?n.push(...s.computerArcLineByPoints(n[n.length-1],this.hc[t],this.ip,i,12)):n.push(s.calculatePoint(n[n.length-1],i,this.hc[t]))):0<t&&t<this.hc.length-1?(r=this.fp(e,n[n.length-1],this.hc[t],this.hc[t+1]),n.push(...s.computerArcLineByPoints(n[n.length-1],this.hc[t],this.hc[t+1],r,12))):n.push(this.hc[t]);this.qv=n,this.Jv=!0},fp(t,e,i,r){return Math.min(.5*U.distanceOfTwoPoints(e,i),.5*U.distanceOfTwoPoints(i,r),t)},hp(){var e,i=[],r=this.sp(this.$v.length);for(let t=0;t<this.qv.length;t++)0===t?i.push(0):t===this.qv.length-1?i.push(1):(e=this.sp(t)/r,i.push(e),i.push(e));return i},sp(e){let i=0;for(let t=0;t<this.$v.length;t++)t<e&&(i+=this.$v[t]);return i}});let b_={FULL:0,DOTTED:2,DOT_DASH:4,CENTER:8,DASH:16,DOUBLE_DOT_DASH:32,TRI_DOT_DASH:64,FMARROW:128,ARROW:256};class y_ extends Qg{constructor(e){if(super(e),e=e||{},this.Ei=p.LINE_MARKER,this.Rf=e.url,this.dp=void 0!==e.width?e.width:6,this.E0=void 0!==e.color?e.color:"#33cc61",this.Xv=void 0===e.smooth||e.smooth,this.vp=void 0!==e.radius?e.radius:1,this.Dn=void 0===e.animate||e.animate,this.jf=void 0!==e.opacity?e.opacity:1,this.pp=void 0===e.depth||e.depth,this.mp=void 0!==e.type?e.type:b_.FMARROW,this.gp=void 0!==e.borderColor?e.borderColor:"#4a82d2",this._p=e.isGeneralize,void 0===this._p&&(this._p=!1),this.bp=void 0!==e.segments?e.segments:[],this.yp=[],this._p||(this.yp=this.bp),this.Pn=[],this.wp=60,this.xp=10,this.Mp="#aeaeae",this.Ep=void 0,this.Lp=!1,this.Tp=this.Tp.bind(this),this.Sp=this.Sp.bind(this),this.Ap=this.Ap.bind(this),this.Op=this.Op.bind(this),this.Uv=this.Uv.bind(this),this.Cp=this.Cp.bind(this),this.Rp=void 0!==e.zFighting?e.zFighting:void 0,this.Np=void 0===e.ignoreFloorSpace||e.ignoreFloorSpace,this.Dp=!1,this.kp=1,(this.Pp=!1)===this.Rp&&(this.mp=b_.FULL,this.E0="#aeaeae"),this.Rp&&(this.Ip=new y_(Object.assign(e,{zFighting:!1})),this.Dp=!0,this.kp=0),e.gradient){var i=Object.keys(e.gradient).map(parseFloat),r=(i.sort(function(t,e){return t-e}),[]);for(let t=0;t<i.length;t++){var n=e.gradient[i[t]],n=n.substring(n.indexOf("(")+1,n.indexOf(")")).split(","),s=parseFloat(n[0])/255,o=parseFloat(n[1])/255,n=parseFloat(n[2])/255;r.push(new At(s,o,n,0))}this.Fp={percent:i,color:r}}}get bound(){if(!0===this.needUpdateBound){this.mi.reset();var e=this.yp;for(let t=0;t<e.length;t++){var i=e[t];this.mi.expandByCoords(i.hc)}this.needUpdateBound=!1}return this.mi.clone()}get level(){return null}get width(){return this.dp}set width(t){0!==t&&t!==this.dp&&(this.dp=t,this.If(),this.Rp&&(this.Ip.width=t),this.Sp())}get color(){return this.E0}set color(t){this.E0!==t&&(this.E0=t,this.If())}get opacity(){return this.jf}set opacity(t){this.jf!==t&&(this.jf=t,this.If(),this.Rp)&&(this.Ip.opacity=t)}get passedColor(){return this.Mp}set passedColor(t){this.Mp!==t&&(this.Mp=t,this.If())}get segments(){return this.bp}set segments(t){this.bp=t,this._p||(this.yp=this.bp);var e=this.rr(_);e&&(this.jp(e),this.Xh(),this.Op(),this.Rp&&(this.Ip.segments=t),this.needUpdateBound=!1)}get visible(){return this.er}set visible(e){this.er=e;for(let t=0;t<this.Pn.length;t++)this.Pn[t].line.visible=e;var t=this.rr(_);t&&(t.enableUpdateRender(),this.Rp)&&(this.Ip.visible=e)}updatePosition(t){this.Uv(t)}update(){var t,e;this.Ji&&this.Ji.material&&(t=this.rr(_))&&(e=this.rr(u),this.Pp?this.Ji.material=t.Vt.qr.mh({color:this.E0,lineWidth:this.dp,opacity:this.jf*e.jf,needDepth:!1,gradient:this.Fp}):(this.Ji.material.dispose(),this.Ji.material=new s_({useMap:0,color:new ft(this.E0),opacity:this.jf*e.jf,resolution:new St(t.A.renderer.domElement.clientWidth,t.A.renderer.domElement.clientHeight),lineWidth:2*this.dp,sizeAttenuation:0,transparent:!0,depthTest:!1,passColor:new ft(this.Mp),isGradient:!1,gradientPercent:[0],gradientColor:[new At(0,0,0,0)]},1,t)),this.Rp)&&this.Ip.update()}moveProportion(i,r){let n=0;var s=[];for(let t=this.Pn.length-1;-1<t;t--)this.Pn[t].isCross&&!r||(n+=this.Pn[t].seg.length),s.push(this.Pn[t]);for(let e=0;e<s.length;e++){let t=0;t=0===e?0:s[e-1].line.material.endPercent,s[e].line.material.beginPercent=t,!s[e].isCross||r?s[e].line.material.endPercent=t+s[e].seg.length/n:s[e].line.material.endPercent=t,s[e].line.material.currentPercent=i,s[e].line.material.ispassed=!0}this.Ep=i,this.Lp=r;var t=this.rr(_);t&&(t.enableUpdateRender(),this.Rp)&&this.Ip.moveProportion(i,this.Lp)}getLineNodes(){return this.Pn}addTo(t){this.Gp(()=>{this._p&&this.Up(t),t.kn.add(this),this.Hp(),t.on("visibleLevelsLoaded",this.Op),t.on("levelChanged",this.Sp),t.on("zoom",this.Cp),this.Bp(t),this.Dn&&!1!==this.Rp&&t.lt.tr(this.Tp),this.Rp&&this.Ip.addTo(t)})}remove(){var t=this.rr(_);t&&(t.off("visibleLevelsLoaded",this.Op),t.off("levelChanged",this.Sp),t.off("zoom",this.Cp),this.zp(t),this.jp(t),this.Dn&&t.lt.Qi(this.Tp),t.kn.remove(this),t.enableUpdateRender(),this.Rp)&&this.Ip.remove(t)}dispose(){super.dispose();for(let t=0;t<this.yp.length;t++)this.yp[t].resize();this.Rp&&this.Ip.dispose()}getRenderNode(){return this.Pn}}Object.assign(y_.prototype,{Bp(t){t.on("resize",this.Ap)},zp(t){t.off("resize",this.Ap)},jp(e){for(let t=0;t<this.Pn.length;t++){var i=this.Pn[t].buildingID&&""+this.Pn[t].buildingID,r=this.Pn[t].isCross?Math.min(this.Pn[t].gid,this.Pn[t].gidAn):this.Pn[t].gid,i=this.Vi(i,r,e);i&&i.getOrCreateLayer(this.Ei).Fn.remove(this.Pn[t].line)}this.Pn=[]},Vp(t,e,i){let r=null;i?(this.Pp=!0,(r=new u_).setPositions(t),i=this.rr(u),i=e.Vt.qr.mh({color:this.E0,lineWidth:this.dp,opacity:this.opacity*i.jf,needDepth:!1,gradient:this.Fp}),this.Ji=new m_(r,i),this.Ji.computeLineDistances(),r.dispose(),r=null):(this.Pp=!1,(r=new i_).setPoints(t),i=new s_({useMap:0,color:new ft(this.E0),opacity:this.jf,resolution:new St(e.A.renderer.domElement.clientWidth,e.A.renderer.domElement.clientHeight),lineWidth:2*this.dp,sizeAttenuation:0,transparent:!0,depthTest:!1,passColor:new ft(this.Mp),isGradient:!1,gradientPercent:[0],gradientColor:[new At(0,0,0,0)]},1,e),this.Ji=new Q(r.geometry,i))},Wp(t){let e=new i_;e.setPoints(t),this.Ji.geometry=e.geometry,e.dispose(),e=null},Xh(){var n=this.rr(_);if(n){var e=this.Yp();let r=[];var s=new St(n.x,n.y);this.yp=(i=>{var r=[];for(let e=0;e<i.length;e++){var n=(r=>{var n=[],s=Math.ceil(r.length/300);for(let t=1;t<=s;t++){let e=300*(t-1),i=e+300;t===s&&(i=r.length),1<t&&(e-=1);var o=[];for(let t=e;t<i;t++)o.push(r[t]);n.push(o)}return n})(i[e].points),s=i[e].level;for(let t=0;t<n.length;t++){var o=new __;o.level=s,o.buildingID=i[e].buildingID,o.points=n[t],r.push(o)}}return r})(this.yp);for(let i=this.yp.length-1;-1<i;i--){var o,a=this.Vi(this.yp[i].buildingID,this.yp[i].mr,n);if(!a)return;let t,e;if(0<i&&this.yp[i].Yv===this.yp[i-1].Yv&&this.yp[i].mr!==this.yp[i-1].mr){if(!(t=this.Vi(this.yp[i-1].buildingID,this.yp[i-1].mr,n)))return;e=this.yp[i-1].points,this.yp[i].rp=Object.assign({},e[e.length-1]),this.yp[i].rp.z+=t.T-a.T}if(i<this.yp.length-1&&this.yp[i].Yv===this.yp[i+1].Yv&&this.yp[i].mr!==this.yp[i+1].mr){var h=this.Vi(this.yp[i+1].buildingID,this.yp[i+1].mr,n);if(!h)return;this.yp[i].ip=Object.assign({},this.yp[i+1].points[0]),this.yp[i].ip.z+=h.T-a.T}this.yp[i].Xv=this.Xv,this.yp[i].op(s,this.vp),r.push({seg:this.yp[i],buildingID:this.yp[i].Yv,gid:this.yp[i].mr,isCross:!1,floor:a}),0<i&&this.yp[i].Yv===this.yp[i-1].Yv&&this.yp[i].mr!==this.yp[i-1].mr&&((h=new __).mr=this.yp[i].mr,h.Yv=this.yp[i].Yv,h.isCross=!0,o=this.yp[i].points,this.Xp(h,e,o,t,a),h.Xv=this.Xv,h.op(s,this.vp),r.push({floor:t.level<a.level?t:a,seg:h,buildingID:h.Yv,gid:this.yp[i-1].mr,isCross:!0,gidAn:h.mr,levelRange:[this.yp[i-1].mr,this.yp[i].mr]}))}r=r.reverse();for(let t=0;t<r.length;t++){var{seg:i,buildingID:l,gid:u,isCross:c,gidAn:f,levelRange:d,floor:v}=r[t],p=t-r.length,p=this.Zp(i,e,p);this.Pn.push({line:p,buildingID:l,gid:u,seg:i,isCross:c,gidAn:f,levelRange:d}),v.getOrCreateLayer(this.Ei).Fn.add(p)}return this.ef=!0,this.Pn=this.Pn.reverse(),this.qp(),void 0!==this.Ep&&this.moveProportion(this.Ep,this.Lp),this.Sp(),n.enableUpdateRender(),this.ef}},qp(){if(void 0!==this.Fp){let i=0;var r=[];for(let t=this.Pn.length-1;-1<t;t--)this.Pn[t].isCross&&this.Np||(i+=this.Pn[t].seg.length),r.push(this.Pn[t]);for(let e=0;e<r.length;e++){let t=0;t=0===e?0:r[e-1].line.material.gradientEnd,r[e].line.material.gradientBegin=t,r[e].isCross&&this.Np?r[e].line.material.gradientEnd=t:r[e].line.material.gradientEnd=t+r[e].seg.length/i}}},Xp(t,e,i,r,n){var s=Object.assign({},e[e.length-1]),o=Object.assign({},i[0]);s.z+=r.T-n.T,t.points=[s,o],t.rp=Object.assign({},e[e.length-2]),t.rp.z+=r.T-n.T,t.ip=Object.assign({},i[1])},Zp(o,a,h){var l=this.rr(_);if(l){var u=new St(l.x,l.y),u=(o.Xv=this.Xv,o.op(u,this.vp),this.Vi(o.Yv,o.mr,l));if(u){var c=o.qv,f=[];for(let t=0;t<c.length;t++)f.push(new Lt(c[t].x-l.x,c[t].z,-c[t].y+l.y));let t=1,e=(a.useMap||(t=0),!1),i=[0],r=[new At(0,0,0,0)],n=(void 0!==this.Fp&&(e=!0,i=this.Fp.percent,r=this.Fp.color),!1),s=(this.mp!==b_.FMARROW&&this.mp!==b_.ARROW||(n=!0),!1);!1===this.Rp&&(s=!0);var a=new s_({useMap:t,map:a.texture,color:new ft(this.E0),opacity:this.jf,resolution:new St(l.A.renderer.domElement.clientWidth,l.A.renderer.domElement.clientHeight),lineWidth:2*this.dp,sizeAttenuation:0,transparent:!0,depthTest:this.pp,passColor:new ft(this.Mp),isGradient:e,gradientPercent:i,gradientColor:r,isArrow:n,usePassOpacity:this.Dp,passOpacity:this.kp,zFighting:s},i.length,l),d=new i_,d=(d.setPoints(f),new Q(d.geometry,a));return d.raycast=r_,this.Rp?d.renderOrder=h:!1===this.Rp&&(d.renderOrder=1),!this.Rp&&!1!==this.Rp||(a.stencilWrite=!0,a.stencilRef=2,a.stencilFunc=jr,a.stencilFail=Fr,a.stencilZFail=Fr,a.stencilZPass=Fr),d.position.set(0,u.T,0),d.mapNode=this,d.selfLevel=o.mr,d.selfBuildingID=o.Yv,d}}},Tp(e){for(let t=0;t<this.Pn.length;t++)this.Pn[t].line.material.uniforms.offset.value.x-=.001*e/this.Pn[t].line.material.uniforms.repeat.value.x;this.rr(_).enableUpdateRender()},Cp(){this._p?this.Up():this.Sp()},Up(e){e=e||this.rr(_);var i=this.bp,r=(this.yp=[],e.getZoomRange());for(let t=0;t<i.length;t++){var n=i[t].points,s=i[t].level,o=new __,s=(o.level=s,o.buildingID=i[t].buildingID,(r[1]-e.getZoom())/(r[1]-1)*7.5),n=e_(n,s);o.points=n,this.yp.push(o)}this.jp(e),this.Xh(),this.Op(),this.Rp&&(this.Ip.segments=this.yp)},Sp(){let e=5;this.Rf&&(e=2);for(let t=0;t<this.Pn.length;t++)this.Jp(this.Pn[t].line.material,this.Pn[t].seg,e*this.dp)},Jp(e,i,r){var n=this.rr(_);if(n){var s=i.length,i=this.Vi(i.Yv,i.mr,n);if(i){s=s*n.Vt.Kp(i.T);let t=Math.floor(s*ot.window.devicePixelRatio/r);this.Rf&&e.map&&e.map.image&&(i=e.map.image.height,r=e.map.image.width,i*=this.dp/r,t=Math.floor(s*ot.window.devicePixelRatio/i)),0===t&&(t=1),e.uniforms.repeat.value=new St(t,1),n.enableUpdateRender()}}},Ap(){var e=this.rr(_);if(e){for(let t=0;t<this.Pn.length;t++)this.Pn[t].line.material.resolution=new St(e.A.renderer.domElement.clientWidth,e.A.renderer.domElement.clientHeight);e.enableUpdateRender()}},Hp(){var t,e,i=this.rr(_);for(t of this.Pn)t.isCross?(e=this.da(t.buildingID,i).visibleLevels).indexOf(t.gid)<0||e.indexOf(t.gidAn)<0?t.line.visible=!1:(t.line.visible=!0,t.line.visible=this.er):-1<this.da(t.buildingID,i).visibleLevels.indexOf(t.gid)?(t.line.visible=!0,t.line.visible=this.er):t.line.visible=!1;i.enableUpdateRender()},Op(){this.rr(_)&&this.Hp()},Qp(){this.wp=this.dp*this.xp;var t={type:"normal",width:128,height:128,color:this.E0,arrowHeightPercent:.6,arrowWidthPercent:1,arrowPercent:.1,lineType:null,dashArray:[2,1],textureCommand:"createNormalLineTexture",godHeightPercent:1,godEdgePercent:.2,godArrowPercent:.15,arrowWidth:20,godColor:this.E0,godEdgeColor:this.gp,godArrowColor:"#F4FEFB",godArrowXScale:4,godArrowWidthPercent:.9,useMap:!0,gradient:this.Fp};switch(this.Fp&&(t.color="#fff",t.godEdgeColor="rgba(0,0,0,1)",t.godColor="rgba(0,0,0,1)"),this.mp){case b_.FULL:t.useMap=!1;break;case b_.DOTTED:t.dashArray=[.5,.5,.5,.5,.5,.5,.5,.5];break;case b_.DOT_DASH:t.dashArray=[2.5,1,.5,1];break;case b_.CENTER:t.dashArray=[3,1,1.5,1];break;case b_.DASH:t.dashArray=[2,1];break;case b_.DOUBLE_DOT_DASH:t.dashArray=[2.5,.5,.5,.5,.5,.5];break;case b_.TRI_DOT_DASH:t.dashArray=[2.5,.5,.5,.5,.5,.5,.5,.5];break;case b_.FMARROW:case b_.ARROW:ot.environment===q.BROWSER&&(t.width=5*this.dp,t.height=5*this.wp),t.arrowWidth=t.height/12,t.dashArray=[7,0],t.textureCommand="createArrowWidthBackTexture";break;default:t.useMap=!1}return t},Yp(){var e=this.rr(_);if(e){var i=this.Qp();let t=null;return this.Rf?{useMap:!0,texture:e.Vt.qr.Oh(this.Rf,t=>{t.needsUpdate=!0,t.rotation=Math.PI/2,t.flipY=!1,t.updateMatrix()})}:(i.useMap&&((t=e.Vt.qr[i.textureCommand](i)).minFilter=Qe,t.wrapS=Ye,t.wrapT=Ye,t.generateMipmaps=!1,t.anisotropy=4),{useMap:i.useMap,texture:t})}},Gp(t){this.Rf?av.Ta(this.Rf,()=>{t&&t()}):t&&t()},If(){if(0<this.Pn.length){var e=this.Yp();for(let t=0;t<this.Pn.length;t++)this.Pn[t].line.material.lineWidth=2*this.dp,this.Pn[t].line.material.color=new ft(this.E0),this.Pn[t].line.material.passColor=new ft(this.Mp),this.Pn[t].line.material.opacity=this.jf,e.useMap&&(this.Pn[t].line.material.map=e.texture)}var t=this.rr(_);t&&t.enableUpdateRender()},Vi(t,e,i){let r;return r=(t?this.da(t,i):i).getFloor(e)},da(t,e){return t=t||e.getMapOptions().buildingID,e.getBuilding(t)},Uv(){var t;0<this.Pn.length&&(t=this.rr(_))&&(this.jp(t),this.Xh(),void 0!==this.Ep&&this.moveProportion(this.Ep,this.Lp),this.Op(),t.enableUpdateRender())}});class w_ extends Ng{constructor(t){super(),this.Ki=t,void 0===this.Ki.baseheight&&(this.Ki.baseheight=0),this.T=Math.abs(this.Ki.height-this.Ki.baseheight),this.$p=this.Ki.baseheight,this.Ki.height<this.$p&&(this.$p=this.Ki.height),this.Ei=p.MODEL,this.Ji=null,this.hu=null,this.Ai=null,this.mi=null,this.t1="#FF0000",this.f0=null,this.Kr={top:null,left:null,right:null,front:null,back:null},this.e1=!1,this.Wc=null,this.E0=null,this.jf=null,this.i1=null,this.n1=null,this.s1=.01*this.o1(this.x+this.y),this.nv=null,this.a1=null,this.h1=[0,0],this.dv=null,this.rv=0,this.du=null,this.l1=0,this.u1=null,this.Nf=0}get FID(){return this.Ki.fid}get typeID(){return this.Ki.type}get name(){return this.Ki.name}get eName(){return this.Ki.ename}get pass(){return this.Ki.pass}get coordinates(){return this.Ki.Li}get x(){return this.Ki.wi?.x}get y(){return this.Ki.wi?.y}get height(){return this.Ki.height>=this.Ki.baseheight?this.Ki.height:this.Ki.baseheight}get baseHeight(){return this.Ki.baseheight<=this.Ki.height?this.Ki.baseheight:this.Ki.height}get extrudeHeight(){return this.T}getData(){var t=Object.assign(super.getData(),{pass:this.Ki.pass});return t.height=this.height,t.baseHeight=this.baseHeight,t.extrudeHeight=this.extrudeHeight,t}getArea(){return sg.area(this.Ki.Li[0])}setColor(t,e){this.e1=!0,void 0!==t&&(this.E0=t),void 0!==e&&(this.jf=e),this.If()}resetColor(){this.Wc&&!this.c1()||this.Bu(),this.setColor(this.Wc.color,this.Wc.alpha),this.e1=!1}setBorderColor(t,e){t&&(this.i1=t),null!=e&&(this.n1=e);t=this.rr(_);this.f1(t)}resetBorderColor(){this.Wc&&(this.c1()&&this.Bu(),this.setBorderColor(this.Wc.strokeColor,this.Wc.alpha))}setTopImage(t){this.l1=1,this.nv=t.image,this.dv=void 0!==t.coords?t.coords:this.Ki.wi,this.a1=void 0!==t.size?t.size:[5,5],this.h1=void 0!==t.offset?t.offset:[0,0],this.rv=void 0!==t.angle?t.angle:0,this.Ji&&this.d1()}clearTopImage(){this.l1=0,this.m1()}flash(t){this.g1(t);let e=this,i=this.rr(_),r=0;function n(){r%2==0?e.Ji&&(e.Ji.material.color=new ft(e.t1)):e.Ji&&(e.Ji.material.color=new ft(e.E0)),r++,i.enableUpdateRender()}e.f0&&clearTimeout(e.f0),function t(){e.Ji&&(e.Ji.userData.sourceMaterial||(e.Ji.userData.sourceMaterial=e.Ji.material,e.Ji.material=e.Ji.material.clone()),e.Ji.userData.sourceMaterial.canDispose=!1,n());e.f0=setTimeout(t,100)}()}stopFlash(){if(this.f0){clearTimeout(this.f0),this.f0=null;let t=this.Ji.material;this.Ji.material=this.Ji.userData.sourceMaterial,delete this.Ji.userData.sourceMaterial.canDispose,delete this.Ji.userData.sourceMaterial,t.dispose(),t=null,this.rr(_).enableUpdateRender()}}getOtherNode(){return{top:this.Kr.top,line:this.hu}}}Object.assign(w_.prototype,{Xh(){if(!this.Ji&&1!==this.Nf){var t=this.rr(u),e=t.U;let r=e.U,n=e.U.Vt;this.Bu(),this.E0&&this.e1||(this.E0=this.Wc.color),null!==this.jf&&this.e1||(this.jf=this.Wc.alpha),this.i1&&this.e1||(this.i1=this.Wc.strokeColor),this.dp&&this.e1||(this.dp=this.Wc.strokeWidth),null!==this.n1&&this.e1||(this.n1=this.Wc.alpha);e=t.getLayers(p.EXTENT_LAYER)[0]?.bound,t=r.P.Df?n.kf:n.Pf;this.Nf=1,t.bind(n)({type:this.type,data:this.Ki,amount:this.T,referenceBound:e,isUseReferenceBound:!0,createLineType:1<this.dp?"onlyData":"geometry",lineHeight:this.T+this.s1}).then(t=>{this.Nf=2;var e=this.jr(n.qr),i=(e.userData.opacity=e.opacity,this.Ki.getBound()),e=(this.Ji=new Q(t.geometry,e),new Lt(i.center.x-r.o,this.$p,r.u-i.center.y));this.Ji.position.copy(e),this.Ji.rotation.set(-Math.PI/2,0,0,"XYZ"),(this.Ji.mapNode=this).U.Fn.add(this.Ji),this._1=t.shape,this.b1(t.lineData),this.w1(),this.du&&this.du.Xh(this),r.enableUpdateRender()})}},M1(t){let e=[];t?e=t:this._1.getPoints().forEach(t=>{e.push(t.x,t.y,this.T+this.s1)});var t=new y_({color:this.i1,width:this.dp,smooth:!1,animate:!1,depth:!0}),i=(t.U=this).rr(_),r=(t.Vp(e,i,!0),t.Ji.material.depthWrite=!0,t.Ji.material.depthTest=!0,t.Ji.material.polygonOffset=!0,t.Ji.material.polygonOffsetFactor=-3*this.dp,t.Ji.material.polygonOffsetUnits=1,this.Ji.add(t.Ji),this.T&&-1!==this.T?this.T:2);t.Ji.position.setZ(.005*r),t.Ji.renderOrder=-1,t.Ji.isNoPick=!0,this.hu=t.Ji,this.E1=t,this.E1.Pn.push({line:t.Ji}),this.E1.Bp(i)},L1(t){var e=this.rr(u);let i=!0,r=(this.Gr&&(i=!1),t.hh({isline:i,color:this.i1,opacity:this.n1*e.jf,needDepth:!0}));return this.Gr&&(r=r.clone(),this.T1(r)),r},initGLLine(t){var e=this.rr(Es).U.Vt;let i=this.L1(e.qr),r=this.T&&-1!==this.T?this.T:2;if(!t){var n=(new Is).setFromPoints(this._1.getPoints()),s=(n&&0<n.vertices.length&&n.vertices.push(n.vertices[0]),[]),o=n.vertices.length;for(let t=0;t<o;t++)n.vertices[t].z=this.T+this.s1,0===t||t===o-1?s.push(n.vertices[t]):s.push(n.vertices[t],n.vertices[t]);n.vertices=s,t=n}var a=new zp(t,i);if(a.position.setZ(.005*r),a.castShadow=!1,a.geometry.computeBoundingSphere(),this.hu=a,this.hu.matrixAutoUpdate=!1,this.Ji.add(a),0===this.dp&&(this.hu.visible=!1),this._1?.holes)for(let t=0;t<this._1.holes.length;t++){u=l=h=void 0;var h=a,l=this._1.holes[t].curves;for(let t=0;t<l.length;t++){var u=[],u=(u.push(new Lt(l[t].v1.x,l[t].v1.y,r)),u.push(new Lt(l[t].v2.x,l[t].v2.y,r)),(new et).setFromPoints(u)),u=new zp(u,i);h.add(u)}}},b1(t){1<Math.floor(this.dp)?this.M1(t):this.initGLLine(t)},w1(){var t,e;this.nv&&this.a1&&(e=this.rr(_),t=new eo(1,1,1,1),e=this.S1(e,this.nv),this.Kr.top=new Q(t,e),this.Kr.top.renderOrder=10,this.A1(),this.Ji.add(this.Kr.top))},d1(){this.nv&&this.a1?this.Kr.top?(this.O1(),this.A1()):this.w1():this.m1()},m1(){var t;this.Kr.top&&this.Kr.top.parent&&(this.Kr.top.parent.remove(this.Kr.top),this.Kr.top.geometry.dispose(),this.Kr.top.material.map&&this.Kr.top.material.map.dispose(),this.Kr.top.material.dispose(),this.Kr.top=null,t=this.rr(_))&&t.enableUpdateRender()},g1(t){this.t1=t},Bc(){this.Bu(),this.E0=this.Wc.color,this.jf=this.Wc.alpha,this.i1=this.Wc.strokeColor,this.n1=this.Wc.alpha,this.dp=this.Wc.strokeWidth,this.hu&&(this.hu.visible=0!==this.dp),this.If(),this.Ji&&this.d1()},C1(t){var e=this.rr(u);return t.ah({isline:!0,color:this.i1,opacity:this.n1*e.jf,needDepth:!0})},c1(){return!!this.Ji&&this.Ji.material.userData.dirtyTheme},jr(t){var e=this.rr(u),i=this.rr(Es).U.Vt,r={themeUseDetail:this.Wc.themeUseDetail,level:e.level,buildingId:e.parent.buildingId},e={color:this.E0,alpha:this.jf*e.jf,type:this.Ei},t=(i.qr.callHook("getMaterialBefor",{material:this.Ji?.material,additionalInfo:r}),t.uh(e,r));return i.qr.callHook("getMaterialAfter",{createInfo:e,material:t,additionalInfo:r}),this.Gr?((i=t.clone()).uniforms.isMask.value=!0,i.uniforms.maskType.value=this.Hr,i.uniforms.maskTexture.value=this.Cf,void 0!==this.zr&&void 0!==this.Vr&&(i.uniforms.maskHeight.value=this.zr,i.uniforms.maskExtrudeHeight.value=this.Vr),i.uniformsNeedUpdate=!0,i):t},T1(t){t.uniforms.isMask.value=!0,t.uniforms.maskType.value=this.Hr,t.uniforms.maskTexture.value=this.u1,void 0!==this.zr&&void 0!==this.Vr&&(t.uniforms.maskHeight.value=this.zr,t.uniforms.maskExtrudeHeight.value=this.Vr),t.uniforms.boundCenter.value=this.Wr,t.uniforms.boundSize.value=this.Yr,t.uniformsNeedUpdate=!0},S1(e,t){var i=this.rr(u);let r=null,n=(this.Gr?((r=e.Vt.qr.hh({})).depthTest=!0,r.depthWrite=!1,r.visible=!1,this.T1(r)):r=new zv({transparent:!0,opacity:i.jf,depthWrite:!1,visible:!1}),!0);return"Safari"===sv&&(n=!1),e.Vt.qr.Oh(t,function(t){r.map=t,r.map.wrapS=Xe,r.map.wrapT=Xe,r.needsUpdate=!0,r.visible=!0,r.polygonOffset=!0,r.polygonOffsetFactor=-1,r.polygonOffsetUnits=-4,e.enableUpdateRender()},{generateMipmaps:n}),r},O1(){var t,e=this.Kr.top;e&&(e.material.map&&e.material.map.dispose(),e.material.map=null,e.material.dispose(),t=this.rr(_),e.material=this.S1(t,this.nv))},If(){var t,e;this.Ji&&(t=this.rr(_))&&(this.Ji.userData.sourceMaterial?this.Ji.userData.sourceMaterial=this.jr(t.Vt.qr):(e=this.Ji.material.userData,this.Ji.material=this.jr(t.Vt.qr),this.Ji.material.userData=e),this.f1(t),this.O1(),t.enableUpdateRender())},f1(t){if(this.hu&&Math.floor(this.dp)<2){var e=this.L1(t.Vt.qr);this.hu.material=e;for(let t=0;t<this.hu.children.length;t++)this.hu.children[t].material=e}else this.hu&&(this.Ji.remove(this.hu),this.hu.mapNode instanceof y_?(this.hu.mapNode.width=this.dp,this.hu.mapNode.color=this.i1):this.M1());t.enableUpdateRender()},A1(){var t=this.Kr.top,e=(t.scale.set(this.a1[0],this.a1[1],1),this.Ki.getBound());t.position.set(this.h1[0]+this.dv.x-e.center.x,this.h1[1]+this.dv.y-e.center.y,this.T+.1),t.rotation.z=-this.rv*Math.PI/180},Bu(){var t=this.rr(Es),e=t.U.Vt;this.Wc=e.zu.ol({fid:this.Ki.fid,typeID:this.Ki.type+"",bid:t.Ht}),0===this.l1&&(this.Wc.image?this.nv=e.wu(this.Wc,"logoPath",t.buildingID)+this.Wc.image:this.nv=null,this.Wc.coords&&(e=this.Wc.coords.split(","),this.dv=new St(parseFloat(e[0]),parseFloat(e[1]))),this.Wc.angle&&(this.rv=this.Wc.angle),this.Wc.sizes)&&(t=this.Wc.sizes.split(","),this.a1=[parseFloat(t[0]),parseFloat(t[1])]),this.Ji&&delete this.Ji.material.userData.dirtyTheme},Kc(){var t;this.Ji&&((t=this.rr(_))&&t.Vt.qr.callHook("removeMaterial",{material:this.Ji?.material,additionalInfo:{themeUseDetail:this.Wc.themeUseDetail}}),this.hu&&(this.Ji.remove(this.hu),this.hu.material.dispose(),this.hu.geometry.dispose(),this.hu=void 0,t&&this.E1&&this.E1.zp(t),this.E1=null),this.m1(),this.Ji.parent&&this.Ji.parent.remove(this.Ji),this.Ji.geometry.dispose(),this.Ji.geometry=void 0,this.Ji.material=void 0,this.Ji.mapNode=void 0,this.Ji=void 0)},o1(t){return(t=(9301*t+49297)%233280)/233280}});class x_ extends dg{constructor(){super()}get level(){return this.U.mr}get visible(){return this.er}set visible(t){super.visible=t,this.er=t,this.Fn.visible=!(!this.U.visible||!this.er);t=this.rr(_);t&&t.Vt.hs()}getFeatures(){return this.I}dispose(){this.Sf&&this.Sf(),super.dispose()}init(){super.init();var t=this.rr(_);this.visible=t.Vt.R1(this.Ei)}getBound(){var t=this.bound;return{maxY:t.max.y,maxX:t.max.x,minX:t.min.x,minY:t.min.y}}remove(t){this.Fn.remove(t.Ji),super.remove(t)}}Object.assign(x_.prototype,{ut(t){(t.U=this).I.push(t)},N1(t,e){var i,r,n={[p.EXTERNAL_MODEL_LAYER]:Xg,[p.MODEL_LAYER]:w_,[p.EXTENT_LAYER]:Dg,[p.FACILITY_LAYER]:Zg,[p.LABEL_LAYER]:Kg};for([i,r]of t.I){var s=new n[this.Ei](r,e.map);this.ut(s),this.type===p.MODEL_LAYER&&this.D1.set(s.FID,s),s.visible=e.map.Vt.$c(this.Ei,{typeID:s.typeID,FID:s.FID})}}});class M_ extends x_{constructor(){super()}init(){super.init(),this.xf(),this.Mf(),this.type===p.EXTERNAL_MODEL_LAYER&&Mg(this)}}Object.assign(M_.prototype,{xf(){var t={[p.EXTERNAL_MODEL_LAYER]:"FMExternalModelLayer",[p.MODEL_LAYER]:"FMModelLayer",[p.EXTENT_LAYER]:"FMExtentLayer"},e=this.rr(_),t=t[this.Ei],i=e.Vt.rl.get(e.getMapOptions().mapID).theme;e.getMapOptions().isuserLight||!i.Rh?this.Tf=new wg(e).createLight(this,t):(i=e.Vt.rl.get(e.getMapOptions().mapID).theme.Rh,this.Tf=new wg(e).createLightByTheme(this,t,i.extent))},Mf(){this.Fn.add(this.mf),this.Fn.add(this.vf),this.Fn.add(this.gf),this.Fn.add(this.pf),this.bf&&this.Fn.add(this.bf)},Sf(){this.Fn.remove(this.mf),this.Fn.remove(this.vf),this.Fn.remove(this.gf),this.Tf.Kt()}});class E_ extends M_{constructor(t,e){super(),this.lr=t.alias,this.P1=t.desc,this.T=t.height,this.Ei=p.EXTENT_LAYER,this.Fn.name="extent",this.Fn.userData.type="extent",this.I1={},this.N1(t,e)}}class L_ extends M_{constructor(t,e){super(),this.Ei=p.MODEL_LAYER,this.Fn.name="model",this.Fn.userData.type="model",this.lr="model",this.F1={},this.D1=new Map,this.N1(t,e)}get height(){return this.U.T}}class T_ extends x_{constructor(){super()}get collision(){return this.ns}set collision(t){this.ns!==t&&(this.ns=t,t=this.rr(_))&&t.Vt.hs()}}class S_ extends T_{constructor(t,e){super(),this.Ei=p.LABEL_LAYER,this.Fn.userData.type="label",this.Fn.name="label",(this.Fn.mapNode=this).lr="label",this.j1={},this.N1(t,e),this.ns=!0}get type(){return this.Ei}}class A_ extends T_{constructor(t,e){super(),this.Ei=p.FACILITY_LAYER,this.Fn.userData.type="facility",this.Fn.name="facility",this.lr="facility",this.U1={},this.ns=!0,(this.Fn.mapNode=this).N1(t,e)}}class O_ extends M_{constructor(t,e){super(),this.Ei=p.EXTERNAL_MODEL_LAYER,this.Fn.name="externalModel",this.Fn.userData.type="externalModel",this.lr="externalModel",this.F1={},this.N1(t,e)}get height(){return this.U.T}beforRemove(){this.traverse(t=>{t.beforRemove&&t.beforRemove()})}}class C_ extends vg{constructor(){super(),this.Ei=p.WALL_MARKER}}class R_ extends vg{constructor(){super(),this.Ei=p.TUBE_MARKER,this.xf()}}Object.assign(R_.prototype,{xf(){this.vf=new yg(7631988),this.pf=new Z,this.mf=new Op(8947848,1.2),this.mf.position.set(-1,1,1).normalize(),this.mf.castShadow=!1,this.mf.target=this.pf,this.gf=new Op(3355443),this.gf.position.set(-.5,1,-1).normalize(),this.gf.target=this.pf,this.Fn.add(this.mf),this.Fn.add(this.gf),this.Fn.add(this.vf),this.Fn.add(this.pf)}});class N_ extends vg{constructor(){super(),this.Ei=p.LINE3D_MARKER}}class D_ extends vg{constructor(){super(),this.Ei=p.SPHERE_MARKER}}let k_={};k_.LAYER_CLASS=new Map,k_.LAYER_CLASS.set(p.EXTENT_LAYER,E_),k_.LAYER_CLASS.set(p.MODEL_LAYER,L_),k_.LAYER_CLASS.set(p.LABEL_LAYER,S_),k_.LAYER_CLASS.set(p.FACILITY_LAYER,A_),k_.LAYER_CLASS.set(p.EXTERNAL_MODEL_LAYER,O_),k_.LAYER_CLASS.set(p.IMAGE_MARKER,pg),k_.LAYER_CLASS.set(p.TEXT_MARKER,mg),k_.LAYER_CLASS.set(p.POLYGON_MARKER,gg),k_.LAYER_CLASS.set(p.EXTRUDE_MARKER,_g),k_.LAYER_CLASS.set(p.HEAT_MAP_MARKER,bg),k_.LAYER_CLASS.set(p.DYNAMIC_MODEL_MARKER,Lg),k_.LAYER_CLASS.set(p.LINE_MARKER,Tg),k_.LAYER_CLASS.set(p.LOCATION_MARKER,Sg),k_.LAYER_CLASS.set(p.DOM_MARKER,Ag),k_.LAYER_CLASS.set(p.WALL_MARKER,C_),k_.LAYER_CLASS.set(p.TUBE_MARKER,R_),k_.LAYER_CLASS.set(p.LINE3D_MARKER,N_),k_.LAYER_CLASS.set(p.SPHERE_MARKER,D_);class P_ extends Ms{constructor(t){super(),this.Ri=t.mapOptions,this.P=t.states,this.Ki=t.data,this.mr=this.Ki.gid,this.H1=this.Ki.gname,this.B1=this.Ki.alias,this.z1=this.Ki.desc,this.T=0,this.V1=null,this.W1=[p.EXTENT_LAYER,p.EXTERNAL_MODEL_LAYER,p.MODEL_LAYER,p.LABEL_LAYER,p.FACILITY_LAYER],this.jf=1,this.Y1=!0,this.X1=new As,this.X1.isEffect=!0}get bound(){return fg(this)}get height(){return this.T}get type(){return this.Ki.Ei}get center(){var t=this.V1;return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}}get x(){return this.center.x}get y(){return this.center.y}get visible(){return this.er}set visible(t){this.er=t,this.traverse(t=>{t.Fn.visible=!(!t.visible||!this.er)});t=this.rr(_);t&&t.Vt.hs()}get level(){return this.mr}get name(){return this.H1}get ID(){return this.Ht}get alias(){return this.B1}get floorID(){return this.Ki.floorId}get effectScene(){return this.X1}getLayers(e,i){if(void 0===e)return this.I;var r=[];for(let t=0;t<this.I.length;t++)0==(this.I[t].type&e)==!!i&&r.push(this.I[t]);return r}getExtendMesh(){var t=this.getLayers(p.EXTENT_LAYER)[0];return t?t.I[0].Ji:null}getExtendByCoords(e){let i=null;var r=this.getLayers(p.EXTENT_LAYER)[0];for(let t=0;t<r.I.length;t++){var n=r.I[t],s=n.Ki.Li[0];if(U.Le(e,s,s.length)){i=n;break}}return i}getModelMeshs(){var e=this.getLayers(p.MODEL_LAYER)[0],i=[];for(let t=0;t<e.I.length;t++)i.push(e.I[t].Ji);return i}getBound(){return this.Ki.getBound().toObject()}setExtentImage(e){var i=this.getLayers(p.EXTENT_LAYER)[0];for(let t=0;t<i.I.length;t++)i.I[t].Ff(e)}clearExtentImage(){this.setExtentImage("")}getOrCreateLayer(t){var e=this.getLayers(t)[0];return void 0!==e||(e=new(k_.LAYER_CLASS.get(t)),this.ut(e),this.rr(_).A.Bt()),e}getMapCoordsRange(){return this.V1}opacity(){return this.jf}remove(t){t.beforRemove&&t.beforRemove(),super.remove(t);t=this.rr(_);t&&t.A&&t.A.Bt()}}Object.assign(P_.prototype,{Z1(){var t=this.P.Ut(this.U.Ht);t.nonFocusAlphaMode&&(this.U.level===this.mr?1!==this.jf&&(this.jf=1,this.Y1=!0):this.jf!==t.nonFocusAlpha&&(this.jf=t.nonFocusAlpha,this.Y1=!0))},ut(t){(t.U=this).I.push(t),this.needUpdateBound=!0,t.init(),this.q1(t)},q1(t){this.X1.add(t.Fn)},J1(){var t=this.U;if(this.U.constructor===eg)this.T=t.floorSpace*this.mr;else if(1===t.visibleLevels.length&&this.P.k!=t.buildingID){var e=t.parent.S;this.T=e.getFloor(e.level).height}else{let r=1/0,n=0;e=t.alignHeight;e.forEach((t,e,i)=>{Math.abs(this.mr-e)<r&&(r=Math.abs(this.mr-e),n=e)}),this.T=e.get(n)+t.floorSpace*(this.mr-n)}},K1(t){t.Ei===p.LOCATION_MARKER&&t.I.forEach(t=>{t.Uv()})},pr(t){var e=void 0===(t=t||{}).animate||t.animate,i=void 0!==t.duration?t.duration:.5;let r=this.rr(_);var n=this.T;this.J1();let s=()=>{r.kn.I.forEach(t=>{t.Ei===p.LINE_MARKER&&t.Uv({needUpdateCrossLine:1<this.parent.visibleLevels.length})}),r.enableUpdateNode()};e?(this.Q1||(this.Q1=new en),this.Q1.Nt([n]).Rt([this.T]).ot(i).st(e=>{this.traverse(t=>{t.Ei!==p.LINE_MARKER&&t.Ei!==p.LOCATION_MARKER&&(t.Fn.position.y=e.destination[0]),this.K1(t)}),s()}).nt(()=>{t.finish&&t.finish(),r.lt.ht(this.Q1)}),r.lt.ut(this.Q1.et())):(this.Q1&&this.Q1.stop(),this.traverse(t=>{t.Ei!==p.LINE_MARKER&&t.Ei!==p.LOCATION_MARKER&&(t.Fn.position.y=this.T),this.K1(t)}),s())},tm(i){for(let t=0;t<this.I.length;t++)if("externalModel"===this.I[t].lr)this.I[t].Fn.traverse(e=>{if("Mesh"===e.type&&e.material.length)for(let t=0;t<e.material.length;t++)e.material[t].userData.oldAlpha||(e.material[t].userData.oldAlpha=e.material[t].opacity),e.material[t].opacity=i});else for(var e=this.I[t].Fn.children,r=0;r<e.length;r++)e[r].material&&(e[r].material.userData.oldAlpha||(e[r].material=e[r].material.clone(),e[r].material.userData.oldAlpha=e[r].material.opacity),e[r].material.opacity=i)},im(){for(let t=0;t<this.I.length;t++)if("externalModel"===this.I[t].lr)this.I[t].Fn.traverse(e=>{if("Mesh"===e.type)if(e.material.length)for(let t=0;t<e.material.length;t++)e.material[t].userData.oldAlpha&&(e.material[t].opacity=e.material[t].userData.oldAlpha);else e.material.userData.oldAlpha&&(e.material.opacity=e.material.userData.oldAlpha)});else{var e=this.I[t].Fn.children;for(let t=0;t<e.length;t++)e[t].material&&e[t].material.userData.oldAlpha&&(e[t].material.opacity=e[t].material.userData.oldAlpha)}},rm(){this.U.U.Mr.wr.get(this.U.sr).I.forEach(t=>{t.gid===this.mr&&(t=t.I.get(p.EXTENT_LAYER).getBound(),this.V1={minX:t.ci.x,minY:t.ci.y,maxX:t.fi.x,maxY:t.fi.y})})},ku(){var t=this.Ki,r=null,n=this.rr(_);for(let[e,i]of t.I){var s=this.I.some(t=>t.type===e);if(!s){let t=Object.keys(this.Ri.hideList);(t=t.map(t=>+t)).includes(e)&&0===Object.keys(this.Ri.hideList[e]).length||(r=new(k_.LAYER_CLASS.get(e))(i,{map:n}),this.ut(r))}}},nm(e,i){let r=null;for(let t=0;t<e.length;t++)if(""+e[t].Ei==""+i){r=e[t];break}return r},sv(t){return this.I[2].D1.get(t)}});var u=P_;function I_(t){Object.assign(t.prototype,{R1(t){t=this.R.getMapOptions().hideList[t];return void 0===t||0!==Object.keys(t).length},Qu(e){var t=this.P.Ut(e.bid);let i=[];t.visibleLevels.forEach(t=>{-1<e.levels.indexOf(t)&&i.push(t)}),t.visibleLevels=i},sm(t,e){e=e||{};let i=this.P.Ut(t.Ht),r=()=>{this.R.A.Bt(),e.finish&&e.finish()};"animate"in e&&!e.animate?(t.traverse(t=>{t.pr({animate:!1})}),r()):t.traverse(t=>{t.mr===i.level?t.pr({finish:()=>{r()}}):t.pr({})})},Vi(t,e){t=this.R.getBuilding(t);return t?t.getFloor(e):null},om(t){t=this.R.getBuilding(t);return null!==t?t.I:[]},br(e,i){e.levels.sort(),this.P.Ut(e.building.Ht).visibleLevels=e.levels,this.Qu({bid:e.building.Ht,levels:e.building.ur}),this.Ru(e,()=>{this.Bt(),this.R.A.Mt();var t={type:"visibleLevelsLoaded"};e.building!==this.R.S&&(t.buildingID=e.building.Ht),this.R.Yt.Wt(t),i&&i()})},_r(e,i){this.R.Xt();let r=this.P.Ut(e.Ht);r.targetLevel=i.level,-1<r.visibleLevels.indexOf(i.level)?this.R.C.Gt(e,i):(r.visibleLevels.length<=1?r.visibleLevels=[i.level]:r.visibleLevels.push(i.level),e.setVisibleLevels(r.visibleLevels,()=>{var t;r.targetLevel===i.level?this.R.C.Gt(e,i):(t={type:"levelChanged",level:i.level},e!==this.R.S&&(t.buildingID=e.Ht),this.R.Yt.Wt(t),i.finish&&i.finish())}))},Du(t){let e=!1;return t.Ki.I.forEach(t=>{0<t.I.size&&(e=!0)}),e},Nu(t){let e=0;return t.traverse(t=>{this.qc(t)&&e++}),e},nc(t){var i=this.P.Ut(t.Ht),r=this.P.Iu(t.Ht);if(!i.visibleLevelsLoaded){let e=!0;var n=t.visibleLevels;for(let t=0;t<n.length;t++)r.get(n[t])||(e=!1);i.visibleLevelsLoaded=e}this.Ri.tile&&!this.Ri.preLoad?i.loaded=i.visibleLevelsLoaded:r.size===t.ur.length&&(i.loaded=!0),this.am()},am(){let i=!0;if(this.R.traverse(t=>{var e=this.P.Ut(t.Ht);e.visibleLevelsLoaded||(t.constructor===Km?this.vs(t)&&!e.visibleLevelsLoaded&&(i=!1):e.visibleLevelsLoaded||(i=!1))}),!this.P.us&&i&&(this.P.Vu=!0),this.P.us=i,!this.P.ls){let i=!0,r=!0;this.R.traverse(t=>{var e=this.P.Ut(t.Ht);e.sceneLoaded||(i=!1),(!this.vs(t)||e.loaded)&&i||(r=!1)}),!this.P.ls&&r&&(this.P.Wu=!0),this.P.ls=r}},zt(){this.P.hm=!0},lm(){this.P.hm&&(this.um=[],this.R.traverse(t=>{for(let e=0;e<t.I.length;e++){var i=t.I[e];i.Z1(),i.Y1&&i.traverse(t=>{t.traverse(t=>{t.type!==p.EXTENT&&t.type!==p.FACILITY&&t.type!==p.LABEL&&t.type!==p.MODEL&&t.type!==p.EXTERNAL_MODEL&&t.type!==p.TEXT_MARKER&&t.type!==p.DOM_MARKER&&t.type!==p.EXTRUDE_MARKER&&t.type!==p.IMAGE_MARKER&&t.type!==p.POLYGON_MARKER&&t.type!==p.DYNAMIC_MODEL_MARKER||t.Ji&&this.um.push([e,t])})}),i.Y1=!1}}),this.P.hm=!1)},fm(){if(0<this.um.length){let e=0;for(let t=0;t<this.um.length&&!(++e>this.Ri.maxMaterialCount);t++){var i=this.um[t][1];i.update?i.update():i.If(),this.um.splice(t,1),t--}this.R.enableUpdateRender()}},Uo(t,e,i){e=new u({mapOptions:this.Ri,states:this.P,data:e,key:i});return t.ut(e),e.Z1(),e.J1(),e},Fu(t){t.ku(),t.rm(),this.Pu(t)},dm(t,i){return t.reduce((t,e)=>t&&e!==i,!0)},vm(e,i,r){var n=[];n.push(e);for(let t=0;t<i.length;t++)i[t]!==e&&n.push(i[t]);if(r)for(let t=0;t<r.length;t++)this.dm(n,r[t])&&n.push(r[t]);return n}})}let o={isDestory:!1,textureCanvas:null,boundingClientRect:null,dispose:()=>{}};class F_{constructor(t,e,i,r){this.R=t,this.Ri=e,this.P=i,this.$=r,this.qr=new Sv(this),this.Ki=null,this.Tu=new p1(t),this.Tu.ql=this.Ri.ClassicMaterial,this.pm=new m1(t),this.zu=new Ov(this),this.rl=new Map,this.Jn=[],this.um=[],this.Eu=0,this.Qc=!1,this.K=this.K.bind(this),this.Uc=null,this.gm=this.gm.bind(this),this._m=new Ft(new Lt(0,1,0),0),this.Sr=new bs,this.Xc=!0,t.on("visibleLevelsLoaded",this.gm),t.on("loaded",this.gm),t.on("viewChanged",this.gm),t.on("viewModeChanged",this.gm),t.on("buildingEntered",this.gm),t.on("buildingExited",this.gm),t.on("zoom",this.gm),t.on("move",this.gm),t.on("mapLoaded",this.gm),t.on("levelChanged",this.gm),t.on("sceneLoaded",this.gm),t.on("firstViewLoaded",this.gm),t.on("beforeRender",this.K),this.sa=null,this.Gn=this.Gn.bind(this),this.po=new N0({disposeCallback:this.Gn,enable:!0,name:"NodeManager",mapCreateTime:this.R.Wa}),e.webWorker?.useWebWorker&&(this.ts=new ot.TaskProcessor("workerCore.js",e.webWorker),this.jv=new ot.TaskProcessor("workerCalculate.js",e.webWorker))}}Object.assign(F_.prototype,{gm(e){if("visibleLevelsLoaded"!==e.type&&"loaded"!==e.type&&"viewChanged"!==e.type||(this.P.Yc=!0,this.hs()),"viewModeChanged"===e.type&&this.R.C.O.updateCheck(),"mapLoaded"===e.type&&this.R.bm(t=>{this.Cc({bid:t.Ht})}),"move"===e.type&&this.R.Xt(),"buildingEntered"!==e.type&&"buildingExited"!==e.type||this.Cc({bid:e.buildingID}),"zoom"===e.type){if(this.R.Xt(),this.R.traverse(t=>{t!==this.R.S&&(this.Cc({bid:t.Ht}),t.sc())}),ot.environment===q.WX){if(void 0===o.lastHandleZoomTime&&(o.lastHandleZoomTime=Date.now()),Date.now()-o.lastHandleZoomTime<50)return void(o.lastHandleZoomTime=Date.now());o.lastHandleZoomTime=Date.now()}this.R.traverse(t=>{t.visible&&t.traverse(t=>{t.visible&&t.traverse(t=>{t.visible&&t.traverse(t=>{t.type===p.EXTERNAL_MODEL&&t.Ji&&(!(t.Ki&&(t.Ki.maxlevel<=e.zoom||t.Ki.minlevel>e.zoom))?t.fading&&t.F0():t.j0())})})})})}var t;"levelChanged"!==e.type&&"visibleLevelsLoaded"!==e.type||(e.buildingID&&e.buildingID!==this.R.Ri.buildingID?(t=this.R.getBuilding(e.buildingID))&&t.traverse(t=>{t.pr()}):this.R.traverse(t=>{"levelChanged"===e.type&&t.Ht!==this.R.Ri.buildingID&&t.oc(e.level),t.traverse(t=>{t.pr({animate:!1})})})),"sceneLoaded"!==e.type||e.buildingID||this.xu(e.type),"visibleLevelsLoaded"===e.type&&void 0===e.buildingID&&this.xu(e.type),"loaded"===e.type&&this.xu(e.type),"firstViewLoaded"===e.type&&this.xu(e.type)},Kp(t){var e=(new Lt).copy(this.R.C.O.target),i=new St(0,0);e.y=t+i.y;let r;return 10/(r="PerspectiveCamera"===this.R.ft.type?(t=this.R.ft.near,i=this.R.ft.fov,e=this.R.C.O.object.position.distanceTo(e),10*t*Math.tan(i/2*l.DEG2RAD)*2/this.R.A.renderer.domElement.clientHeight*e/t):(i=this.R.ft.top,e=this.R.ft.bottom,10*Math.abs(i-e)/this.R.A.renderer.domElement.clientHeight/this.R.ft.zoom))},K(){this.P.pl&&(this.lm(),this.fm(),this.qn(),this.Kn(),this.R.A.ds(),this.R.A.ym())},hs(){this.R.A.hs()},Bt(){this.R.A.Bt()},Jc(t,e){if(!t.getBound||!e)return!0;t=t.boundNoClone;if(!t)return!0;let i=!0;var{max:t,min:r}=t,{max:e,min:n}=e;return t.x<n.x||r.x>e.x||t.y<n.y||e.y<r.y?i=!1:i},Zc(e,t){var i=[],r=[],n=this.Ri.container.clientWidth,s=this.Ri.container.clientHeight,o=(i.push(st.coordsScreenToMap(this.R,{x:0,y:0,level:t,buildingID:e.Ht})),i.push(st.coordsScreenToMap(this.R,{x:n,y:0,level:t,buildingID:e.Ht})),i.push(st.coordsScreenToMap(this.R,{x:n,y:s,level:t,buildingID:e.Ht})),i.push(st.coordsScreenToMap(this.R,{x:0,y:s,level:t,buildingID:e.Ht})),e.visibleLevels),a=new $n;for(let t=0;t<o.length;t++){var h=e.getFloor(o[t]).getBound();a.vi([h.max,h.min])}r.push({x:a.min.x,y:a.min.y}),r.push({x:a.min.x,y:a.max.y}),r.push({x:a.max.x,y:a.max.y}),r.push({x:a.max.x,y:a.min.y});n=[],Rm.PolygonClip(i,r,n),s=new Cm;return s.setFromPoints(n),s},wm(i,r){var n=new V1;let e=i[0];if(0<e.length){U.ui(e)||(e=e.reverse()),n.moveTo(e[0].x-r.center.x,e[0].y-r.center.y);for(let t=1;t<e.length;t++)n.lineTo(e[t].x-r.center.x,e[t].y-r.center.y)}if(1<i.length)for(let t=1;t<i.length;t++){let e=i[t];var s=new z1;if(0<e.length){U.ui(e)||(e=e.reverse()),s.moveTo(e[0].x-r.center.x,e[0].y-r.center.y);for(let t=1;t<e.length;t++)s.lineTo(e[t].x-r.center.x,e[t].y-r.center.y)}n.holes.push(s)}return n},Hl(t,e,i,r){var n=t.Li,s=t.getBound(),t=this.wm(n,s);let o=null;o=0===e?new Mm(t):new Lm(t,{depth:e,bevelEnabled:!1});let a,h,l,u;u=r&&i?(a=i.min.x,h=i.min.y,l=i.max.x-a,i.max.y-h):(a=s.min.x,h=s.min.y,l=s.max.x-a,s.max.y-h);var c=o.faces,f=c.length;for(let t=0;t<f;t++){var d=o.vertices[c[t].a],v=o.vertices[c[t].b],p=o.vertices[c[t].c];o.faceVertexUvs[0][t][0].x=(d.x+s.center.x-a)/l,o.faceVertexUvs[0][t][0].y=(d.y+s.center.y-h)/u,o.faceVertexUvs[0][t][1].x=(v.x+s.center.x-a)/l,o.faceVertexUvs[0][t][1].y=(v.y+s.center.y-h)/u,o.faceVertexUvs[0][t][2].x=(p.x+s.center.x-a)/l,o.faceVertexUvs[0][t][2].y=(p.y+s.center.y-h)/u}return o.computeBoundingSphere(),{geometry:o,shape:t}},Pf(t){let{type:i,data:r,amount:n,referenceBound:s}=t;return new Promise((t,e)=>{t(this.Hl(r,n,s,i==p.MODEL))})},xm(t){let r=new et;return t.forEach(t=>{var{itemSize:t,array:e,key:i}=t,e=new Float32Array(e);r.setAttribute(i,new J(e,t))}),r},kf(t){let{data:h,amount:l,referenceBound:u,type:c,createLineType:f,lineHeight:d}=t;return new Promise((r,t)=>{let i=[];h.Li.forEach((t,e)=>{i[e]=[],t.forEach(t=>{i[e].push(t.x,t.y)})});var e=[];for(let t=0;t<i.length;t++){var n=i[t],s=new ArrayBuffer(8*n.length);new Float64Array(s).set(n),e.push(s)}let o=h.getBound(),a=null;u&&(a={max:{x:u.max.x,y:u.max.y},min:{x:u.min.x,y:u.min.y}}),this.ts.__addTask({type:c,coordGroup:e,bound:{max:{x:o.max.x,y:o.max.y},min:{x:o.min.x,y:o.min.y}},referenceBound:a,amount:l,lineHeight:d,createLineType:f},e).then(t=>{var{attributesInfo:t,lineAttributeInfo:e}=t.result,t=this.xm(t);t.computeBoundingBox(),t.computeBoundingSphere();let i;"geometry"===f?i=this.xm(e):"onlyData"===f&&(i=new Float32Array(e)),r({shape:1<h.Li.length?this.wm(h.Li,o):null,lineData:i,geometry:t})})})},bu(i){let r=this.P.Ut(i.bid);r.themeNeedLoad=!0,r.themeLoaded=!1,this.Hu({themeID:i.themeID},t=>{r.themeID=i.themeID;let e=this.rl.get(i.bid);e||(this.rl.set(i.bid,{theme:new Av}),e=this.rl.get(i.bid)),e.theme.Xh(t),r.themeLoaded=!0,i.bid===this.Ri.buildingID&&(this.P.Bu(this.zu),this.R.setBackgroundColor(this.P.backgroundColor,this.P.backgroundAlpha)),this.Hc()})},yu(t){let e=this.rl.get(t.bid);t.data?(e||(this.rl.set(t.bid,{themeExtension:new Nm}),e=this.rl.get(t.bid)),e.themeExtension||(e.themeExtension=new Nm),e.themeExtension.Xh(t.data)):e&&e.themeExtension&&(this.Ri.buildingID===t.bid?e.themeExtension.resize():(e.themeExtension.Kt(),e.themeExtension=null)),this.P.Bu(this.zu),this.R.setBackgroundColor(this.P.backgroundColor,this.P.backgroundAlpha),!1!==t.needUpdataNode&&this.Gc(t)},Kt(t){clearTimeout(this.Cu),this.R.off("visibleLevelsLoaded",this.gm),this.R.off("loaded",this.gm),this.R.off("viewChanged",this.gm),this.R.off("viewModeChanged",this.gm),this.R.off("buildingEntered",this.gm),this.R.off("zoom",this.gm),this.R.off("move",this.gm),this.R.off("buildingLoaded",this.gm),this.R.off("beforeRender",this.K),this.sa=t,this.qr.Kt(()=>{this.qr=null,this.po.co(!0)})},Gn(){for(var t in this.Jn=[],this.Tu.Kt(),this.Tu=null,this.rl.clear(),this.ts&&this.ts.__dispose(),this.jv&&this.jv.__dispose(),this.R=null,this)this[""+t]&&this[""+t].Kt&&this[""+t].Kt();for(var e in this.sa&&this.sa({name:"NodeManager"}),this)this[""+e]=null,delete this[""+e]}}),$m(F_),og(F_),I_(F_);class j_{constructor(){this.I=new Map,this.Mm=[],this.$t=(new Date).getTime(),this.Em=new Map,this.sa=null,this.Gn=this.Gn.bind(this),this.Un=0,this.Dn()}}Object.assign(j_.prototype,{ut(e){if(Array.isArray(e)){this.I.set(e[0].tt,e[0]),e[0].U=this;for(let t=1;t<e.length;t++)e[t].B=e[t-1].B+e[t-1].Y,e[t].V=e[t-1].V+e[t-1].Y,this.I.set(e[t].tt,e[t]),e[t].U=this}else this.I.has(e.tt)||(this.I.set(e.tt,e),e.U=this,e.B=this.$t)},ht(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.I.delete(e[t].tt);else this.I.delete(e.tt)},Z0(t){this.Mm.push(t)},tv(t){t=this.Mm.indexOf(t);-1<t&&this.Mm.splice(t,1)},tr(t){this.Em.set(t.tt=tn.generateUUID(),t)},Qi(t){this.Em.delete(t.tt)},K(e,i,r){var n=[],s=[];for(let t=0;t<e.j.length;t++)void 0===e.H[t]&&(e.H[t]=0),1<=i?(n.push(e.G[t]),s.push(e.G[t]-e.j[t]-e.H[t])):(n.push((e.G[t]-e.j[t])*i+e.j[t]),s.push((e.G[t]-e.j[t])*r),e.H[t]+=(e.G[t]-e.j[t])*r);e.K({destination:n,delta:s}),s.length=n.length=0},Dn(){this.Un=ot.window.requestAnimationFrame(this.Dn.bind(this));let r=(new Date).getTime(),n=r-this.$t;this.Em.forEach(t=>t(n));for(let t=0;t<this.Mm.length;t++)this.Mm[t].update(n/1e3);this.I.forEach(t=>{var e,i;t.J||(t.Z?t.W+=n:(e=(r-t.B)/t.Y,i=n/t.Y,this.K(t,e,i),e=r-t.B-t.V,t.Y<=e&&(t.H=[],t.X?(t.B=r,t.$&&t.$()):(i=t.J,t.J=!0,!i&&t.$&&t.$()))))}),this.$t=r},Kt(t){this.sa=t,this.Gn()},Gn(){this.Un&&(ot.window.cancelAnimationFrame(this.Un),this.Un=0),this.I.forEach(function(t){t.Kt()}),this.I.clear(),this.Mm=[],this.Em.clear(),this.sa&&this.sa({name:"Animator"})}});class G_{constructor(){this.M={}}}Object.assign(G_.prototype,{Lm(t,e){this.Tm(t,e)||(void 0===this.M[t]&&(this.M[t]=[]),this.M[t].push(e))},Tm(t,e){return e?void 0!==this.M[t]&&-1!==this.M[t].indexOf(e):void 0!==this.M[t]&&0<this.M[t].length},Sm(t,e){void 0!==this.M[t]&&-1!==(e=this.M[t].indexOf(e))&&this.M[t].splice(e,1)},Wt(i){if(void 0!==this.M[i.type]){var r=this.M[i.type].slice(0);for(let t=0,e=r.length;t<e;t++)r[t].call(this,i)}}});let U_={Entire:2,Individual:4},H_=(Object.freeze(U_),{RUNTIME:0,DIRTY:1});class B_{constructor(t){if(this.container=t.container,this.appName=t.appName,this.key=t.key,this.license=t.license,this.mapID=t.mapID,this.buildingID=t.mapID,this.mapURL=t.mapURL,this.mapURLAbsolute=void 0!==t.mapURLAbsolute&&t.mapURLAbsolute,this.themeTool=void 0!==t.themeTool?t.themeTool:null,this.merge=void 0!==t.merge?t.merge:null,this.userThemeURL=t.themeURL,this.themeURL=t.themeURL||M0.themeUrl,this.themeID=t.themeID||"2001",this.externalModelURL=t.externalModelURL,this.Wc=t.theme,this.themeExtension=void 0!==t.themeExtension?t.themeExtension:{},this.isPreview=void 0!==ot.KjWzhWlSj&&!!ot.KjWzhWlSj.ProtoDef,this.nonFocusAlpha=void 0!==t.nonFocusAlpha?t.nonFocusAlpha:.1,this.nonFocusAlphaMode=void 0!==t.nonFocusAlphaMode&&t.nonFocusAlphaMode,this.state=t.state||{},this.center=(void 0!==this.state.center?this.state:t).center,this.zoomRange=void 0!==this.state.zoomRange?this.state.zoomRange:void 0!==t.zoomRange?t.zoomRange:[16,23],this.mapZoom=void 0!==this.state.zoom?this.state.zoom:void 0!==t.mapZoom?t.mapZoom:20,this.rotation=void 0!==this.state.rotation?this.state.rotation:void 0!==t.rotation?t.rotation:0,this.maxTiltAngle=void 0!==t.maxTiltAngle?t.maxTiltAngle:90,this.minTiltAngle=void 0!==t.minTiltAngle?t.minTiltAngle:30,this.tiltAngle=void 0!==this.state.tiltAngle?this.state.tiltAngle:void 0!==t.tiltAngle?t.tiltAngle:30,this.viewMode=void 0!==this.state.viewMode?this.state.viewMode:void 0!==t.viewMode?t.viewMode:Vr.MODE_3D,this.floorSpace=void 0!==this.state.floorSpace?this.state.floorSpace:void 0!==t.floorSpace?t.floorSpace:50,this.level=void 0!==this.state.level?this.state.level:void 0!==t.level?t.level:1,this.visibleLevels=void 0!==this.state.visibleLevels?this.state.visibleLevels:void 0!==t.visibleLevels?t.visibleLevels:[1],this.buildingOptions=t.buildingOptions||{},this.navigationData=t.navigationData,this.buildings=t.buildings,this.backgroundColor=t.backgroundColor,this.backgroundAlpha=t.backgroundAlpha,this.Wh=t.highlightColor,this.Pr=void 0!==t.highlightPicker?t.highlightPicker:["click"],this.logarithmicDepthBuffer=t.logarithmicDepthBuffer||!1,this.tile=!1!==t.tile||t.tile,this.preLoad=!1!==t.preLoad||t.preLoad,this.followFocus=t.followFocus,void 0===this.followFocus&&(this.followFocus=!1),this.loadLayerWaitingTime=t.loadLayerWaitingTime||.002,this.renderOrder=t.renderOrder||[p.EXTENT,p.CAD_LAYER,p.EXTERNAL_MODEL,p.MODEL,p.DYNAMIC_MODEL_MARKER,p.EXTRUDE_MARKER,p.TUBE_MARKER,p.WALL_MARKER,p.SPHERE_MARKER,p.POLYGON_MARKER,p.HEAT_MAP_MARKER,p.LINE3D_MARKER,p.LINE_MARKER,p.FACILITY,p.LABEL,p.IMAGE_MARKER,p.TEXT_MARKER,p.LOCATION_MARKER],this.collisionOrder=t.collisionOrder?Xr.uniqWithArrayTwo(t.collisionOrder):[[p.TEXT_MARKER,p.IMAGE_MARKER]],this.fontFamily=t.fontFamily||'"Microsoft Yahei","",Tahoma,Arial',this.hdr=t.hdr,this.shadingMode=void 0!==t.shadingMode?t.shadingMode:xs.REAL,this.materialMode=this.shadingMode,this.maxMaterialCount=void 0!==t.maxMaterialCount?t.maxMaterialCount:1/0,this.lock=void 0!==t.lock&&t.lock,this.labelField=void 0!==t.labelField?t.labelField:tg.NAME,this.enabledPanRange=void 0!==t.enabledPanRange&&t.enabledPanRange,this.panRangeValue=void 0!==t.panRangeValue?t.panRangeValue:null,this.screenLockCoords=t.screenLockCoords,this.lightConfig={FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]},this.isuserLight=!1,void 0!==t.light&&(this.lightConfig=t.light.getConfig(),this.isuserLight=!0),this.lockedLight=void 0===t.lockedLight||t.lockedLight,this.hideList=void 0!==t.hideList?t.hideList:{},this.ClassicMaterial=void 0===t.ClassicMaterial||t.ClassicMaterial,this.isOutdoor=!0,this.enableDamping=void 0!==t.enableDamping&&t.enableDamping,this.enterTriggerMode=void 0!==t.enterTriggerMode?t.enterTriggerMode:U_.Entire,this.autoPlay=void 0===t.autoPlay||t.autoPlay,this.decoderURL=void 0!==t.decoderURL?t.decoderURL:null,this.HDText=void 0!==t.HDText&&t.HDText,this.depthPeeling=void 0!==t.depthPeeling?t.depthPeeling:null,this.depthPeeling&&(this.depthPeeling.mode=t.depthPeeling?.mode||H_.RUNTIME,this.depthPeeling.layers=t.depthPeeling?.layers||4,this.depthPeeling.types=t.depthPeeling?.types||[p.MODEL_LAYER,p.EXTERNAL_MODEL_LAYER,p.DYNAMIC_MODEL_MARKER]),this.mouseMode=void 0!==t.mouseMode?t.mouseMode:ls.NORMAL,this.labelFade=void 0!==t.labelFade?t.labelFade:ot.environment===q.BROWSER,this.preserveDrawingBuffer=!1,void 0!==t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),this.webWorker=void 0!==t.webWorker?t.webWorker:{useWebWorker:!1},this.webWorker.useWebWorker)try{var e=new Error,i=e.stack||e.sourceURL||e.stacktrace||"";let t=i.match(/(https?:\/\/[^\s]+\/)/);if(!t&&!(t=i.match(/(file?:\/\/[^\s]+\/)/)))return void console.error("worker path failed.");this.webWorker.baseURL=t[0]+"workers/"}catch(t){}ot.environment===q.WX&&(this.webWorker.useWebWorker=!1)}}class z_{constructor(t){this.Ri=t,this.zoomRange=this.Ri.zoomRange,this.zoom=this.Ri.mapZoom,this.Yi=this.Ri.rotation,this.Am=this.Ri.maxTiltAngle,this.Om=this.Ri.minTiltAngle,this.tiltAngle=this.Ri.tiltAngle,this.Ci=this.Ri.viewMode,this.Cm=new Map,this.Rm(),this.pl=!1,this.us=!1,this.ls=!1,this.Wu=!1,this.Vu=!1,this.Ic=this.Ri.labelField,this.wi=new Lt,this.Nm=this.ac,this.Rr=!1,this.Dm=!0,this.km=!1,this.Wh=void 0!==this.Ri.Wh?this.Ri.Wh:null,this.Pm=null,this.Im=void 0!==this.Ri.backgroundColor?this.Ri.backgroundColor:null,this.Fm=null,this.jm=void 0!==this.Ri.backgroundAlpha?this.Ri.backgroundAlpha:null,this.Gm=null,this.Um=null,this.Lu=!1,this.ps=!1,this.Yc=!1,this.hm=!0,this.Hm=this.Ri.collisionOrder,this.k=this.Ri.buildingID,this.Df=this.Ri.webWorker.useWebWorker}get zoom(){return this.ac}set zoom(t){this.ac=Math.min(Math.max(t,this.rt[0]),this.rt[1])}get zoomRange(){return this.rt}set zoomRange(t){t[0]=Math.min(Math.max(t[0],1),29),t[1]=Math.min(Math.max(t[1],1),29),this.rt=t}get tiltAngle(){return this.Wi}set tiltAngle(t){t=Math.min(Math.max(t,this.Om),this.Am),this.Wi=t}get highlightColor(){return null!==this.Wh?this.Wh:this.Pm}set highlightColor(t){this.Wh=t}get backgroundColor(){return null!==this.Im?this.Im:this.Fm}get backgroundAlpha(){return null!==this.jm?this.jm:this.Gm}}Object.assign(z_.prototype,{Rm(){this.Bm(this.Ri.buildingID);var e=this.Ri.buildingOptions.buildings;if(e)for(let t=0;t<e.length;t++)e[t].buildingID&&this.Bm(e[t].buildingID)},Bu(t){this.Pm=t.cl(this.Ri.buildingID);t=t.nl(this.Ri.buildingID);this.Fm=t.clearColor,this.Gm=t.clearAlpha,this.Um=t.alphaTest,null!==this.Um&&(io.alphaTest=this.Um)},zm(t,e){switch(t){case"click":this.Dm=e;break;case"move":this.km=e;break;case"hover":this.Rr=e}},Vm(t){this.Ri.center&&(this.wi.x=this.Ri.center.x-t.x,this.wi.z=-this.Ri.center.y+t.y)},Ut(t){return this.Cm.has(t)||this.Bm(t),this.Cm.get(t)},Bm(e){let i={};if(this.Ri.buildingID===e)i={themeID:this.Ri.themeID,visibleLevels:this.Ri.visibleLevels,level:this.Ri.level,targetLevel:this.Ri.level,floorSpace:this.Ri.floorSpace,nonFocusAlphaMode:this.Ri.nonFocusAlphaMode,nonFocusAlpha:this.Ri.nonFocusAlpha};else{var t=this.Ri.buildingOptions,r=t.buildings;if(i={themeID:t.themeID,themeExtension:t.themeExtension,visibleLevels:void 0!==t.visibleLevels?t.visibleLevels:[],level:t.level,targetLevel:t.level,floorSpace:(void 0!==t.floorSpace?t:this.Ri).floorSpace,overviewMode:void 0!==t.overviewMode?t.overviewMode:Pm.NORMAL,nonFocusAlphaMode:(void 0!==t.nonFocusAlphaMode?t:this.Ri).nonFocusAlphaMode,nonFocusAlpha:(void 0!==t.nonFocusAlpha?t:this.Ri).nonFocusAlpha,minLevel:t.minLevel,maxLevel:t.maxLevel,themeLoaded:!1,themeNeedLoad:!0},r)for(let t=0;t<r.length;t++)r[t].buildingID===e&&(void 0!==r[t].themeID&&(i.themeID=r[t].themeID),void 0!==r[t].themeExtension&&(i.themeExtension=r[t].themeExtension),void 0!==r[t].visibleLevels&&(i.visibleLevels=r[t].visibleLevels),void 0!==r[t].level&&(i.level=r[t].level),void 0!==r[t].targetLevel&&(i.targetLevel=r[t].targetLevel),void 0!==r[t].floorSpace&&(i.floorSpace=r[t].floorSpace),void 0!==r[t].overviewMode&&(i.overviewMode=r[t].overviewMode),void 0!==r[t].nonFocusAlphaMode&&(i.nonFocusAlphaMode=r[t].nonFocusAlphaMode),void 0!==r[t].nonFocusAlpha&&(i.nonFocusAlpha=r[t].nonFocusAlpha),void 0!==r[t].minLevel&&(i.minLevel=r[t].minLevel),void 0!==r[t].maxLevel)&&(i.maxLevel=r[t].maxLevel)}i.level&&-1===i.visibleLevels.indexOf(i.level)&&(1<i.visibleLevels.length?i.visibleLevels.push(i.level):i.visibleLevels=[i.level]),this.Cm.set(e,i)},Iu(t){t=this.Ut(t);return t.levelsLoaded||(t.levelsLoaded=new Map),t.levelsLoaded},ml(t){t=this.Cm.get(t);return!1===t.themeNeedLoad||!1!==t.themeLoaded}});class V_{constructor(t){this.loadManager=t,this.requests=new Map}add(t,e){this.requests.set(t,e)}abortAll(){this.requests.forEach((t,e)=>{t.abort(),this.loadManager.itemEnd(e)}),this.requests.clear(),this.loadManager=null}}let W_=(t,e,i,r)=>{t.Mr=new X0({mapCreateTime:t.Wa}),t.Vt=new F_(t,e,i,r),t.Vt.Vc()};class Y_ extends Ms{constructor(t){super(),t.uatEnvironment&&E0(),this.Xi={error:[]},this.Wa=(new Date).getTime(),this.Ri=new B_(t),this.P=new z_(this.Ri),this.o=null,this.u=null,ot.environment===q.WX&&(ot.initCanvas(this.Ri,this),o.isDestory=!1),this.S=null,this.dl=!1,this.Wm=new Lt,this.Zt=null!=t.followFocus&&t.followFocus,this.Ym=null,this.Xm=!1,this.Mn=[p.IMAGE_MARKER,p.TEXT_MARKER],this.Yt=new G_,this.lt=new j_,this.Mr=null,this.Vt=null,this.Pi=null,this.At=null,ot.environment==q.BROWSER?this.ft=this.Zm(this.Ri.container.clientWidth,this.Ri.container.clientHeight):this.ft=this.Zm(this.Ri.container.width,this.Ri.container.height),this.A=new jc(this,this.Ri,this.P),this.kn=new vg,(this.kn.U=this).C=new us(this,this.Ri.container,this.P),this.C.enableDragRange=this.Ri.enabledPanRange,this.Ri.panRangeValue&&(this.Ri.enabledPanRange=!0,this.C.enableDragRange=!0),this.Sr=new Ls(this,this.Ri,this.P),this.Gn=this.Gn.bind(this),this.qm=!1,this.Et=this.Et.bind(this),this.Jm=this.Jm.bind(this),this.Km=[],this.Qm=!1,this.$m=null,this.tg=null,this.eg=this.eg.bind(this),ot.environment==q.BROWSER&&(this.ig=new ot.DomMarkerManager(this)),this.rg(),this.z0=new V_(Rv),Rv.onLoad=()=>{this.enableUpdateRender()}}get requestDispose(){return this.qm}get focusBuilding(){return this.ng}get x(){return this.o}get y(){return this.u}get bound(){return!0===this.needUpdateBound&&0<this.I.length&&(this.mi.reset(),this.I.forEach(t=>{this.mi.expand(t.bound)}),this.mi.expand(this.kn.bound),this.needUpdateBound=!1),this.mi.clone()}get camera(){return this.ft}set camera(t){this.ft=t}get followFocus(){return this.Zt}set followFocus(t){this.Zt!==t&&(this.Zt=t,this.Zt||this.C.qt(this.S,{level:this.getLevel()}))}getScaleBarInfo(){let t;var e={x:(t=ot.environment===q.WX?{x:ot.document.body.clientWidth/2,y:ot.document.body.clientHeight/2}:{x:document.body.clientWidth/2,y:document.body.clientHeight/2}).x+100,y:t.y},i=st.coordsScreenToMap(this,t),e=st.coordsScreenToMap(this,e),i=Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y))/100;let r=[1e7,5e6,2e6,1e6,5e5,2e5,1e5,5e4,25e3,2e4,1e4,5e3,2e3,1e3,500,200,100,50,20,10,5,2,1,.5,.2,.1,.05,.02,.01][Math.floor(this.getZoom())-1],n="";return n=r<1e3&&1<=r?"":r<1?(r*=1e3,""):(r/=1e3,""),{screenDistance:r/i,actualDistance:r,unit:n}}setDevicePixalRatio(t){this.getRenderManager().renderer.setPixelRatio(t),this.Yt.Wt({type:"pixelRatioChanged"}),this.enableUpdateRender()}removeAnimator(t){this.lt.ht(t)}copyCamera(){let t=null;return(t=this.ft===this.Pi?new ht(l.FOV,1,l.CAMERA_NEAR,l.CAMERA_FAR):new lt(1,1,1,1,l.CAMERA_NEAR,l.CAMERA_FAR)).copy(this.ft),t}enableUpdateRender(){this.P.ps=!0}enableUpdateNode(){this.P.Yc=!0}getFloorInfos(){return this.getBuilding(this.Ri.buildingID).getFloorInfos()}setHighlightColor(t){this.P.highlightColor=t}setControlTarget(t){this.C.Zi(t)}resize(t,e){this.A.jn(t,e)}getMarkerGroup(){return this.kn}getVisibleLevels(){return this.S.visibleLevels}setTheme(t){this.Vt.bu({themeID:t,bid:this.Ri.buildingID})}setThemeExtension(t,e){this.Vt.yu({data:t,bid:this.Ri.buildingID,...e})}clearThemeExtension(){this.Vt.yu({bid:this.Ri.buildingID})}getRenderOrder(){return this.A.Mn}setRenderOrder(t){this.A.Vn(t)}getCollisionOrder(){return this.P.Hm}setCollisionOrder(t){this.P.Hm=Xr.uniqWithArrayTwo(t),this.Vt.hs()}adjustRenderOrder(t){this.A.zn(t)}setVisibleLevels(t,e){this.S.setVisibleLevels(t,e)}getRenderManager(){return this.A}setRenderManager(t){for(var e in this.A.render=t.render,this.A.getLayerType=t.getLayerType,t)this.A[e]=t[e];this.A.renderer=this.A.getRenderer()}getCenter(){return this.C.Ft()}setCenter(t){this.C.jt(t)}zoomIn(){this.C.it(1.02)}zoomOut(){this.C.it(.98)}getZoomRange(){return this.P.rt}setZoomRange(t){this.C.Lt(t)}getZoom(){return this.C.ct()}setZoom(t){this.C.bt(t)}getRotation(){return this.C.Dt()}setRotation(t){this.C.Pt(t)}autoRotate(t){return(t=t||{}).loop=!0,void 0===t.duration&&(t.duration=5),this.C.Pt(t)}getTilt(){return tn.round(90-this.C.O.getPolarAngle()*l.RAD2DEG)}setTilt(t){t.tilt=Et.clamp(t.tilt,this.Ri.minTiltAngle,this.Ri.maxTiltAngle),this.P.Wi=t.tilt,this.C.Ot(t)}getFloor(t){return null===this.S?null:this.S.getFloor(t)}getLevel(){return this.S?.level}getLevels(){return null!==this.S?this.S.ur:null}setLevel(t){this.Vt._r(this.S,t)}getFloorSpace(){return null!==this.S?this.S.floorSpace:null}setFloorSpace(e){if("number"==typeof e)this.sg(e,!0);else{if(!("animate"in e)||e.animate){this.yr||(this.yr=new en);var i=Number.isFinite(e.duration)?e.duration:.5;let t=e.finish;return this.yr.Nt([this.S.floorSpace]).Rt([e.floorSpace]).ot(i).st(t=>{this.sg(t.destination[0],!1)}).nt(()=>{this.lt.ht(this.yr),this.sg(e.floorSpace,!0),t&&t()}),this.lt.ut(this.yr.et()),this.yr}this.sg(e.floorSpace,!0)}}getViewMode(){return this.ft.isPerspectiveCamera?Vr.MODE_3D:Vr.MODE_2D}setViewMode(t){this.C.qi(t)}getInteractions(){return this.getInteracations()}getInteracations(){return this.C}getBound(){return this.S.bound.clone()}getState(){let t=null,e=(this.ng&&(t={buildingID:this.ng.buildingID,level:this.ng.level,visibleLevels:this.ng.getVisibleLevels()}),this.P.k);return e===this.getMapOptions().mapID&&(e=null),{center:this.getCenter(),zoom:this.getZoom(),rotation:this.getRotation(),tiltAngle:this.getTilt(),viewMode:this.getViewMode(),level:this.S.level,floorSpace:this.getFloorSpace(),visibleLevels:this.S.visibleLevels,viewBuildingID:e,focusBuildingState:t}}setState(n,s){s=s||{};var e,i=this.getState();let r=!1;for(e in i){if(void 0===n[e]&&(n[e]=i[e]),("floorSpace"===e||"level"===e||"rotation"===e||"tiltAngle"===e||"viewBuildingID"===e||"viewMode"===e||"zoom"===e)&&n[e]!==i[e]){r=!0;break}if("center"===e&&(n[e].x!==i[e].x||n[e].y!==i[e].y)){r=!0;break}if("visibleLevels"===e){if(n[e].length!==i[e].length){r=!0;break}for(let t=0;t<n[e].length;t++)if(n[e][t]!==i[e][t]){r=!0;break}if(r)break}if("focusBuildingState"===e)if(null!==n[e]&&null!==i[e]){var t=n[e],o=i[e];if(t.buildingID!==o.buildingID){r=!0;break}if(t.level!==o.level){r=!0;break}var a=t.visibleLevels,h=o.visibleLevels;if(a.length!==h.length){r=!0;break}for(let t=0;t<a.length;t++)if(a[t]!==h[t]){r=!0;break}if(r)break}else if(null===n[e]&&null!==i[e]||null!==n[e]&&null===i[e]){r=!0;break}}if(r){void 0===n.focusBuildingState&&(n.focusBuildingState=null),n.viewBuildingID||(n.viewBuildingID=this.getMapOptions().mapID);let r=!1!==s.animate,t=s.isParallel,e=(void 0===t&&(s.isParallel=!0,t=!0),s.duration);if(void 0===e&&(s.duration=3,e=3),t&&r&&0!==e)this.C.$i(n,s,i);else{let i=e/5;this.C.pauseDamping(),this.setFloorSpace(n.floorSpace),null!==n.focusBuildingState?(n.level!==this.getLevel()&&(i=e/6),(n.viewBuildingID===this.getMapOptions().mapID||this.P.k!==this.getMapOptions().mapID&&this.P.k!==n.focusBuildingState.buildingID)&&this.exitBuilding({buildingID:this.P.k,noCenter:!0,finish:()=>{this.setLevel({level:n.level,animate:!1})}})):this.P.k!==this.getMapOptions().mapID&&this.exitBuilding({buildingID:this.P.k,noCenter:!0,finish:()=>{this.setLevel({level:n.level,animate:!1})}}),this.Zt=!1,this.setCenter({animate:r,x:n.center.x,y:n.center.y,duration:i,finish:()=>{this.setRotation({animate:r,rotation:n.rotation,duration:i,finish:()=>{this.setTilt({animate:r,tilt:n.tiltAngle,duration:i,finish:()=>{this.setZoom({animate:r,zoom:n.zoom,duration:i,finish:()=>{this.setViewMode({animate:r,mode:n.viewMode,finish:()=>{this.setVisibleLevels(n.visibleLevels,()=>{this.setLevel({animate:r,level:n.level,duration:i,finish:()=>{if(null===n.focusBuildingState)this.Zt=this.getMapOptions().followFocus,this.C.resumeDamping(),s.finish&&s.finish();else{this.Zt=this.getMapOptions().followFocus;let t=n.focusBuildingState,e=this.getBuilding(t.buildingID);e.setVisibleLevels(t.visibleLevels,()=>{e.setLevel({level:t.level,animate:r,duration:i,finish:()=>{t.buildingID===n.viewBuildingID&&this.enterBuilding({buildingID:t.buildingID,noCenter:!0,finish:()=>{this.C.resumeDamping(),s.finish&&s.finish()}})}})})}}})})}})}})}})}})}})}}else s.finish&&s.finish()}getNodes(i,r){let s=this;var n=[];this.S;let e=[p.LABEL_LAYER,p.FACILITY_LAYER,p.MODEL_LAYER,p.EXTENT_LAYER,p.EXTERNAL_MODEL_LAYER];var t,o={};if(r)for(let e=0;e<r.length;e++){let t=r[e].buildingID;t=t||this.S.buildingID;var a=((t,e)=>{let i=[],r=t.buildingID;r=r||s.S.buildingID;var n=t.levels;for(let t=0;t<e.length;t++)e[t].buildingID!==r||n&&-1===n.indexOf(e[t].level)||i.push(e[t]);return i})(r[e],i);o[""+t]=a}else for(let e=0;e<i.length;e++){let t=i[e].buildingID;var h=o[""+(t=t||this.S.buildingID)];h?h.push(i[e]):o[""+t]=[i[e]]}for(t in o){var l=o[t],u=(e=>{let i=null;for(let t=0;t<s.I.length;t++)if(s.I[t].buildingID===e){i=s.I[t];break}return i})(""+t);for(let t=0;t<l.length;t++){var c=l[t].level,f=l[t].eid,d=l[t].type;t:for(let t=0;t<u.I.length;t++)if(u.I[t].mr===c){let i=u.I[t].getLayers();i=i.filter(t=>e.includes(t.type));for(let e=0;e<i.length;e++)for(let t=0;t<i[e].I.length;t++)if(i[e].I[t].Ki.Ht===f&&i[e].I[t].Ei===d){n.push(i[e].I[t]);break t}}}}return n}getDataManager(){return this.Mr}getMapOptions(){return this.Ri}getContainer(){return this.Ri.container}setFitView(t,e){let i=!1!==(e=e||{}).animate,r=this.getZoomRange(),n=this.copyCamera(),s=this.C.copyControls(n),o=this.C.O,a=this.ft;this.C.O=s,this.ft=n,this.setZoomRange([1,29]),s.enableDamping=!1,this.C.qt(this.S,{level:this.getLevel(),animate:!1}),this.setZoom({zoom:29,animate:!1,finish:()=>{this.setCenter({animate:!1,x:t.center.x,y:t.center.y,finish:()=>{this.og(t,5,0,t=>{this.C.O=o,this.ft=a,this.setZoomRange(r),s.dispose(),s=null,n=null,this.enableUpdateRender(),this.setZoom({animate:i,zoom:t.zoom,duration:.5}),this.setCenter({animate:i,x:t.center.x,y:t.center.y,duration:.5,finish:()=>{e.finish&&e.finish()}})})}})}})}setBackgroundColor(t,e){this.A&&(this.A.renderer.setClearColor("string"===t?parseInt(t.slice(1),16):t,e),this.enableUpdateRender())}setLabelField(t){this.P.Ic=t,this.Vt.Pc(),this.Vt.hs()}getLabelField(){return this.P.Ic}getBuilding(t){return this.da({bid:t})}getBuildings(){let e=[];return this.traverse(t=>{t!==this.S&&e.push(t)}),e}changeOverviewMode(e){for(let t=0;t<e.buildingIDs.length;t++){var i=this.getBuilding(e.buildingIDs[t]);i.su!==e.overviewMode&&(i.su=e.overviewMode,this.followFocus&&e.overviewMode!=Pm.OUTDOOR&&i.parent.focusBuilding&&i.parent.focusBuilding.buildingID==i.buildingID&&i.setLevel({level:i.level}),i.sc(e),this.Vt.Cc({bid:e.buildingIDs[t]}),this.Yt.Wt({type:"buildingOverviewModeChanged",buildingID:e.buildingIDs[t]}))}e.overviewMode==Pm.OUTDOOR&&this.followFocus&&this.S.setLevel({level:this.S.level})}enterBuilding(t){let e=this,i=this.getBuilding(t.buildingID);function r(){e.getBuildings().forEach(t=>{e.Km.push({buildingID:t.buildingID,visible:t.visible}),t.visible=!1}),i.visible=!0,e.P.k=t.buildingID,e.Vt._u(i),e.Vt.Bt(),e.Vt.sm(i,{}),e.Yt.Wt({type:"ViewBuildingChange",buildingID:e.P.k}),e.Yt.Wt({type:"buildingEntered",buildingID:e.P.k}),t.finish&&t.finish({buildingID:t.buildingID})}t.noCenter?r():this.C.jt({x:i.x,y:i.y,animate:!0,duration:.5,finish:()=>{r()}})}exitBuilding(t){let e=this,i=(this.Km.forEach(t=>{this.getBuilding(t.buildingID).visible=t.visible}),this.Km.length=0,this.getBuilding(this.P.k));function r(){e.P.k=e.Ri.buildingID,e.Vt.Bt(),e.Vt.sm(i,{}),e.Yt.Wt({type:"ViewBuildingChange",buildingID:e.P.k}),e.Yt.Wt({type:"buildingExited",noCenter:t.noCenter,buildingID:i.Ht}),t.finish&&t.finish({buildingID:i.Ht})}t.noCenter?r():this.C.jt({x:i.x,y:i.y,animate:!0,duration:.5,finish:()=>{r()}})}on(t,e){this.Yt&&(this.Yt.Lm(t,e),this.P.zm(t,!0))}off(t,e){this.Yt&&(this.Yt.Sm(t,e),this.Yt.Tm(t)||this.P&&this.P.zm(t,!1))}pickFilterFunction(){return!0}dispose(t){var e;this.qm||(this.qm=!0,this.ig&&this.ig.dispose(),this.z0&&this.z0.abortAll(),this.setBackgroundColor(16777215,1),this.A.renderer.clear(),this.A.Kt(),ot.environment==q.BROWSER&&this.Ri.container.removeChild(this.A.renderer.domElement),ot.environment===q.WX&&(o.textureCanvas=null,o.dispose(),o.isDestory=!0),e=()=>{this.Mr.Kt(()=>{this.lt.Kt(()=>{this.Vt.Kt(()=>{this.Gn(),this.kn.dispose(),super.dispose(),Rv.onLoad=()=>{},Rv.record.clear(),t&&t()})})})},Rv.isLoaded()?e():Rv.onLoad=e)}collisionCheck(){this.Vt.hs()}}Object.assign(Y_.prototype,{sg(t,e=!0){this.S.floorSpace=t,this.S.dr=e,this.Yt.Wt({type:"floorSpaceChanged"});var i=this.kn.I;for(let t=0;t<i.length;t++)i[t].Uv()},Gn(){let e=[this.Sr,this.C];for(let t=0;t<e.length;t++)e[t].Kt();for(var t in this.A.Gn(),this.A=null,this.Mr=null,this.Vt=null,this)-1<e.indexOf(this[""+t])&&delete this[""+t];e=null,this.S=null},Zm(t,e){return this.Pi=new ht(l.FOV,t/e,l.CAMERA_NEAR,l.CAMERA_FAR),this.At=new lt(-t/2,t/2,e/2,-e/2,l.CAMERA_NEAR,l.CAMERA_FAR),this.P.Ci===Vr.MODE_3D?this.Pi:this.At},ut(t){(t.U=this).I.push(t),this.needUpdateBound=!0},Zc(t){var e=[],i=(e.push({x:t.min.x,y:t.min.y}),e.push({x:t.min.x,y:t.max.y}),e.push({x:t.max.x,y:t.max.y}),e.push({x:t.max.x,y:t.min.y}),new $n);for(let t=0;t<e.length;t++){var r=st.coordsMapToScreen(this,{x:e[t].x,y:e[t].y,level:this.getLevel(),height:0});if(null===r)return null;i.vi([r])}return i},ag(t){var e=this.A.renderer.domElement.clientHeight,i=this.A.renderer.domElement.clientWidth,r=this.getZoom(),r=this.C.yt(r);let n=1;var t=this.Zc(t);return t?(t=t.size,r*(n=i/e>t.x/t.y?t.y/e:t.x/i)):null},hg(t){t=this.Zc(t);return t?st.coordsScreenToMap(this,{x:(t.max.x+t.min.x)/2,y:(t.max.y+t.min.y)/2,level:this.getLevel()}):null},og(e,i,r,n){let s=this.getZoom();var t=this.ag(e);t?s=this.C.gt(t):s-=1,this.setZoom({animate:!1,zoom:s,finish:()=>{let t=this.hg(e);t?this.setCenter({animate:!1,x:t.x,y:t.y,finish:()=>{++r===i?n({zoom:s,center:t}):this.og(e,i,r,n)}}):0<s?this.og(e,i,r,n):n({zoom:s,center:e.center})}})},Et(){var t=this.getZoom();Math.abs(t-this.P.Nm)>l.EPS&&(this.Yt.Wt({type:"zoom",zoom:t}),this.ft.isOrthographicCamera&&this.A.Mt(),this.P.Nm=t)},Jm(){if(this.P.km){let t=this.C.O.target;t.distanceToSquared(this.Wm)>l.EPS&&(this.Yt.Wt({type:"move",center:this.getCenter()}),this.Wm=t.clone(),t=null)}},rg(){let o=!0;W_(this,this.Ri,this.P,(t,e,i,r,n,s)=>{o&&(this.P.Vm(this.S),o=this.C.zi()),this.A.Bt(),this.ft.updateMatrixWorld(),i&&s&&this.C.ut([this.Et,this.Jm]),n&&s&&(this.Qm=!0,this.Yt.Wt({type:"loaded"}),this.Xt(),this.P.Wu=!1,void 0===this.Ri.mapURL)&&R0.io({appName:this.Ri.appName,key:this.Ri.key,gl:this.A.renderer.getContext()})})},da(e){let i=null;return this.traverse(t=>{t.Ht!==e.bid&&t.sr!==e.mid||(i=t)}),i},Rc(){var t=this.A.renderer.domElement,t={x:t.clientWidth/2,y:t.clientHeight/2,z:this.C.controls.target.y};return st.coordsScreenToMap(this,t)},Nc(i){if(i===this.S)return!1;if(!this.Qm)return!1;let r=!1;if(this.Ri.enterTriggerMode===U_.Individual)i.du.tu.forEach((t,e)=>{t.type===p.MODEL&&t.level===this.S.level&&sg.isContain(t.coordinates[0],this.Rc())&&(this.ng=i,r=!0)});else for(let t=0;t<i.levelChart.length;t+=2){var e;i.levelChart[t]===this.S.level&&(e=i.levelChart[t+1],e=i.kc.get(e),sg.isContain(e[0],this.Rc()))&&(this.ng=i,r=!0)}return r},bm(e){this.traverse(t=>{this.ng||(this.Nc(t),this.ng&&e(t))})},Xt(){if(this.Xm&&this.ng.Ht!=this.P.Ri.mapID){let t=this.lg(),e=this.ng.Ht;if(t||this.$m===e||(e=this.$m,t=!0),t){if(this.getState().viewBuildingID&&this.getState().viewBuildingID!==this.P.Ri.mapID)return;var i={type:"buildingExited",buildingID:e},r=(this.Xm=!1,this.ng=null,this.getBuilding(e));this.Vt.ml(e)&&r.vu&&(r.vu=!1,this.Yt.Wt(i)),this.followFocus&&this.setLevel({level:this.getLevel(),animate:!1})}}this.traverse(t=>{var e;this.Xm||(this.Nc(t)?(e=this.Dc(),this.$m=t.buildingID,!e||this.getState().viewBuildingID&&this.getState().viewBuildingID!==this.P.Ri.mapID||(this.Xm=!0,this.Vt.ml(t.Ht)&&0==t.vu?(t.vu=!0,this.Yt.Wt({type:"buildingEntered",buildingID:t.Ht})):(this.tg=t.Ht,this.on("update",this.eg)),this.followFocus&&t.setLevel({level:t.level,animate:!1}))):this.ng=null)})},eg(){var t,e;this.Vt.ml(this.tg)&&(this.ng&&this.ng.Ht===this.tg&&(t=this.Nc(this.ng),e=this.Dc(),t)&&e&&(this.ng.vu=!0,this.Yt.Wt({type:"buildingEntered",buildingID:this.tg})),this.off("update",this.eg),this.tg=null)},lg(){var t,e=this.ug();return this.ng.overviewMode==Pm.NORMAL?(t=(t=this.getZoom())<this.ng.lu||t>=this.ng.uu,!e||t):!e},Dc(){var t;return this.ng.overviewMode!=Pm.NORMAL||!((t=this.getZoom())<this.ng.lu||t>=this.ng.uu)},ug(){if(null==this.ng)return!1;if(this.Nc(this.ng))return!0;{var t=this.ng.getFloor(this.ng.level).getLayers(p.EXTENT_LAYER)[0];if(null==t)return!1;let e=!1;return t&&t.traverse(t=>{e=!sg.isContain(t.coordinates[0],this.Rc())}),!e}}});var _=Y_;class X_ extends Qg{constructor(t){super(t),this.Ai=new Map}moveTo(e){var t=void 0!==e.animate&&e.animate,i=e.duration||.5;let r=void 0!==e.height?e.height:this.T,n=this.rr(_);if(n){if(t){let t;return this.Ai.has("moveTo")?t=this.Ai.get("moveTo"):(t=new en,this.Ai.set("moveTo",t)),t.Nt([this.o,this.u,this.T]).Rt([e.x,e.y,r]).ot(i).st(t=>{this.o=t.destination[0],this.u=t.destination[1],this.T=t.destination[2],this.Uv(),e.update&&e.update({x:this.o,y:this.u,level:this.mr,height:this.T,buildingID:this.Yv}),n.enableUpdateRender()}).nt(()=>{this.o=e.x,this.u=e.y,this.T=r,this.Uv(),e.finish&&e.finish(),n.enableUpdateRender()}),n.lt.ut(t.et()),t}this.o=e.x,this.u=e.y,this.T=r,this.Uv(),e.finish&&e.finish(),n.enableUpdateRender()}}stop(){let e=this.rr(_);e&&this.Ai&&(this.Ai.forEach(t=>{e.lt.ht(t)}),this.Ai.clear())}}Object.assign(X_.prototype,{Uv(){if(this.Ji){var t=this.rr(_);if(!t)return!1;var e=this.Ei===p.DOM_MARKER?this.cg.height+this.T:this.T;this.Ji.position.set(this.o-t.x,e,-this.u+t.y),this.needUpdateBound=!0,t.enableUpdateRender()}}});class Z_ extends X_{constructor(t){super(t)}get collision(){return this.ns}set collision(t){this.ns!==t&&(this.ns=t,t=this.rr(_))&&t.Vt.hs()}addTo(t){super.addTo(t);t=this.rr(_);t&&(t.on("viewModeChanged",this.Zn),t.on("zoom",this.Zn),t.on("resize",this.Zn),t.Vt.hs())}remove(){this.stop();var t=this.rr(_);t&&(t.off("viewModeChanged",this.Zn),t.off("zoom",this.Zn),t.off("resize",this.Zn),super.remove(),t.Vt.hs(),t.enableUpdateRender())}}class q_ extends Z_{constructor(t){super(t),this.Ei=p.IMAGE_MARKER,this.Rf=t.url,this.Yn=void 0!==t.size?t.size:32,this.pp=void 0!==t.depth&&t.depth,this.jf=void 0!==t.opacity?t.opacity:1,this.ns=void 0===t.collision||t.collision,this.wi=Xr.getCenterByAnchor(t.anchor),this.Zn=this.Zn.bind(this),this.fg=this.fg.bind(this)}get url(){return this.Rf}set url(t){this.Rf=t,this.If()}get opacity(){return this.jf}set opacity(t){this.jf=t,this.If()}get size(){return this.Yn}set size(t){this.Yn=t,this.Zn()}jump(t){return lg(this,t)}stopJump(){return ug(this)}boost(t){return ag(this,t)}stopBoost(){return hg(this)}getRenderNode(){return this.Ji}}Object.assign(q_.prototype,{Xh(){var t;return!!this.Rf&&!!(t=this.rr(_))&&(t=this.jr(t),this.Ji=new Zm(t),this.Ji.center.set(this.wi.x,this.wi.y),this.Ji.visible=this.er,this.Uv(),this.Zn(),(this.Ji.mapNode=this).ef=!0)},Zn(){var t=this.rr(_);t&&(cg(t.Vt,this),t.Vt.hs(),t.enableUpdateRender())},If(){var t=this.rr(_);t&&(this.Ji.material=this.jr(t),this.Zn())},jr(t){var e=this.rr(u);return t.Vt.qr.Eh({url:this.Rf,needDepth:this.pp,opacity:this.jf*e.jf},()=>{this.Ji&&void 0!==this.Ji.material.userData.scaleRatio?this.Zn():t.on("update",this.fg),t.enableUpdateRender()})},fg(){this.Ji&&void 0!==this.Ji.material.userData.scaleRatio&&(this.Zn(),this.rr(_).off("update",this.fg))}});class J_ extends Z_{constructor(t){super(t),this.Ei=void 0!==t.type?t.type:p.TEXT_MARKER,this.fv=void 0!==t.text?t.text:"",this.dg=void 0!==t.fontsize?t.fontsize:20,void 0!==t.fontSize&&(this.dg=t.fontSize),this.vg=t.fontFamily,this.kv=void 0!==t.fillColor?t.fillColor:"0,0,0",this.pg=void 0!==t.strokeColor?t.strokeColor:"255,225,255",this.mg=void 0!==t.strokeWidth?t.strokeWidth:1,this.gg=t.plateColor,this._g=t.plateStrokeColor,this.pp=void 0!==t.depth&&t.depth,this.ns=void 0===t.collision||t.collision,this.jf=void 0!==t.opacity?t.opacity:1,this.bg=void 0!==t.textAlign?t.textAlign:hv.Center,this.yg=t.anchor,this.wi=Xr.getCenterByAnchor(t.anchor),this.Yn=0,this.Zn=this.Zn.bind(this)}set size(t){this.Yn=t}get size(){return this.Yn}get text(){return this.fv}set text(t){this.fv=t}get fillColor(){return this.kv}set fillColor(t){this.kv=t}get strokeColor(){return this.pg}set strokeColor(t){this.pg=t}get strokeWidth(){return this.mg}set strokeWidth(t){this.mg=t}get fontsize(){return this.dg}set fontsize(t){this.dg=t}get fontSize(){return this.dg}set fontSize(t){this.dg=t}get plateColor(){return this.gg}set plateColor(t){this.gg=t}get plateStrokeColor(){return this._g}set plateStrokeColor(t){this._g=t}update(){this.If()}setInitWriteRenderNodeFunction(t){this.wg=t}findParent(t){return this.rr(t)}updateSize(){this.Zn()}getRenderNode(){return this.Ji}getScreenSize(){var t=null;return t=this.Ji?{width:this.Ji.children[0].material.map.image.width/2,height:this.Ji.children[0].material.map.image.height/2}:t}}Object.assign(J_.prototype,{Xh(){var t=this.rr(_);if(!t)return!1;this.mv=!1;t=t.Vt,t=this.jr(t.qr).material,this.Ji=new mc,t=new Zm(t);return t.center.set(this.wi.x,this.wi.y),this.Ji.add(t),this.Zn(),this.Uv(),this.Ji.mapNode=this,(t.mapNode=this).ef=!0,this.wg&&(this.Ji=this.wg(this.Ji)),!0},xg(t,e){if(t&&t.material){var i=this.rr(_);if(!i)return!1;i=i.Vt.Fc(e);t.scale.set(i,i,i),t.scale.multiplyScalar(t.material.userData.mspriteScale||1),t.scale.setX(t.scale.x/t.material.userData.scaleRatio)}},Zn(){var t=this.rr(_);if(!t)return!1;var e=this.Ji.isGroup?this.Ji.children[0]:this.Ji;"Sprite"===e.type&&(this.xg(e,this.Yn),t.enableUpdateRender())},Hv(t){t&&t.material&&(t.material.map&&t.material.map.dispose(),t.material.dispose())},If(){var t,e=this.rr(_);e&&(t=this.Ji.isGroup?this.Ji.children[0]:this.Ji,e=(this.Hv(t),this.jr(e.Vt.qr)).material,t.material=e,this.Zn())},jr(t){var e=this.rr(u),t=t.gh(this.fv,{fontsize:this.mv?this.dg+2:this.dg,fillColor:tn.toRgba(this.kv),strokeColor:tn.toRgba(this.pg),plateColor:tn.toRgba(this.gg),plateStrokeColor:tn.toRgba(this._g),strokeWidth:this.mg},{family:this.vg,needSize:!0,opacity:this.jf*e.jf,textAlign:this.bg,drawText:!this.mv,callback:()=>{var t=this.rr(_);t&&t.enableUpdateRender()}});return this.Yn=t.size,{material:t}}});class K_{constructor(){}static createShape(e,i){var r=new V1;if(Array.isArray(e[0])){var n=e[0];r.moveTo(n[0].x-i.x,n[0].y-i.y);for(let t=1;t<n.length;t++)r.lineTo(n[t].x-i.x,n[t].y-i.y);if(1<e.length)for(let t=1;t<e.length;t++){var s=e[t],o=new z1;if(0<s.length){o.moveTo(s[0].x-i.x,s[0].y-i.y);for(let t=1;t<s.length;t++)o.lineTo(s[t].x-i.x,s[t].y-i.y)}r.holes.push(o)}}else{r.moveTo(e[0].x-i.x,e[0].y-i.y);for(let t=1;t<e.length;t++)r.lineTo(e[t].x-i.x,e[t].y-i.y)}return r}static createShapeBufferGeometryByCenter(t,e,i){t=new Em(this.createShape(t,e));if(i){var r=[Number.MAX_VALUE,Number.MAX_VALUE],n=[-Number.MAX_VALUE,-Number.MAX_VALUE],s=t.attributes.position.array;for(let t=0;t<s.length/3;t++){var o=s[3*t],a=s[3*t+1];o<r[0]&&(r[0]=o),a<r[1]&&(r[1]=a),n[0]<o&&(n[0]=o),n[1]<a&&(n[1]=a)}var h=t.attributes.uv.array,l=[n[0]-r[0],n[1]-r[1]];for(let t=0;t<s.length/3;t++){var u=s[3*t],c=s[3*t+1];h[2*t]=(u-r[0])/l[0],h[2*t+1]=(c-r[1])/l[1]}t.setAttribute("uv",new x(h,2))}return t}static createExtrudeBufferGeometry(t,e){return new Tm(t,{steps:1,depth:e.depth,bevelEnabled:!1,bevelThickness:0,bevelSize:0,bevelOffset:0,bevelSegments:1})}static closedPoints(t){return Rm.closedPoints(t)}static createReactShape(t,e){var i=new V1,e=e/2,t=t/2;return i.moveTo(-t,-e),i.lineTo(-t,e),i.lineTo(t,e),i.lineTo(t,-e),i}static createCircleShape(t,e){var i=new V1;return i.absarc(0,0,t,0,2*Math.PI,!1),i}static createReactExtrudeBufferGeometry(t,e,i){t=K_.createReactShape(t,e);return this.createExtrudeBufferGeometry(t,i)}static createCircleExtrudeBufferGeometry(t,e,i){t=K_.createCircleShape(t,e);return this.createExtrudeBufferGeometry(t,i)}static createCenterBufferGeometry(i,e){var r=[];for(let e=0;e<i.length-1;e++)for(let t=2;t<10;t+=2)r.push({x:i[e].x+(i[e+1].x-i[e].x)*t*.1,y:i[e].y+(i[e+1].y-i[e].y)*t*.1,z:i[e].z+(i[e+1].z-i[e].z)*t*.1});r.push({x:r[0].x,y:r[0].y,z:r[0].z});var t=new et,n=[],s=[];for(let t=0;t<r.length-1;t++)n.push(r[t].x),n.push(r[t].y),n.push(r[t].z),n.push(r[t+1].x),n.push(r[t+1].y),n.push(r[t+1].z),n.push(e.x),n.push(e.y),n.push(e.z),s.push(0,0,1);var o=new Float32Array(n);return t.setAttribute("position",new x(o,3)),t.setAttribute("gradientAlpha",new x(s,1)),t}static scalePoints(e,i,r){var n=[];for(let t=0;t<e.length;t++){var s=e[t].x,o=e[t].y,a=e[t].z;n.push({x:s+(s-i.x)*(r-1),y:o+(o-i.y)*(r-1),z:a})}return n}static scaleValuePoints(e,i,r){var n=[];for(let t=0;t<e.length;t++){var s={x:e[t].x,y:e[t].y,z:e[t].z};s.x-i.x<0?s.x-=r:s.x+=r,s.y-i.y<0?s.y-=r:s.y+=r,n.push(s)}return n}}class Q_ extends Qg{constructor(t){super(t),this.Ei=p.POLYGON_MARKER,this.Rf=void 0!==t.url?t.url:void 0,this.E0=void 0!==t.color?t.color:"#FF0000",this.jf=void 0!==t.opacity?t.opacity:1,this.i1=t.borderColor||"#00ff00",this.dp="number"==typeof t.borderWidth?t.borderWidth:2,this.T=void 0!==t.height?t.height:0,this.hc=void 0!==t.points?t.points:[],this.hu=null,this.Ap=this.Ap.bind(this)}get x(){return this.o}get y(){return this.u}get points(){return this.hc}set points(e){if(this.hc=e,this.Ji){e=this.rr(_);if(e){var i=new St(e.x,e.y),i=K_.createShapeBufferGeometryByCenter(this.hc,i,!!this.Rf);let t=this.Ji.geometry;this.Ji.geometry=i,t.dispose(),t=null;i=this.Mg(i);this.hu.Wp(i),e.enableUpdateRender(),this.ir=!0}}}get color(){return this.E0}set color(t){this.E0=t,this.Eg()}get borderColor(){return this.i1}set borderColor(t){this.i1=t,this.hu&&(this.hu.color=t,this.hu.update())}get borderWidth(){return this.dp}set borderWidth(t){this.dp=t,this.hu&&(this.hu.width=t,this.hu.update())}get opacity(){return this.jf}set opacity(t){this.jf=t,this.Eg()}getBound(){return sg.bound(this.hc)}getInsideCenter(){var t={};return sg.calculatorInsideCentroid(this.hc,t),t}getRenderNode(){return this.Ji}remove(){var t=this.rr(_);this.U&&this.U.remove(this),t&&(t.off("resize",this.Ap),t.enableUpdateRender())}}Object.assign(Q_.prototype,{Mg(e){var i=e.attributes.position.array.length,r=[];for(let t=0;t<i/3;t++)r.push(new Lt(e.attributes.position.array[3*t],e.attributes.position.array[3*t+1],e.attributes.position.array[3*t+2]));r.push(new Lt(e.attributes.position.array[0],e.attributes.position.array[1],e.attributes.position.array[2]));var n=[];for(let t=0;t<r.length-1;t++){var s=new Lt(r[t].x,r[t].y,r[t].z),o=new Lt(r[t+1].x,r[t+1].y,r[t+1].z);0===t&&n.push(s),n.push(a(s,o)),n.push(a(o,s)),n.push(o)}return n;function a(t,e){return new Lt(t.x+.001*(e.x-t.x),t.y+.001*(e.y-t.y),t.z+.001*(e.z-t.z))}},Xh(){if(!this.hc)return!1;var t=this.rr(_);if(!t)return!1;var e=this.rr(u);let i=t.Vt.qr.ah({url:this.Rf,color:this.E0,opacity:this.jf*e.jf,visible:!this.Rf},()=>{i.map.wrapS=Xe,i.map.wrapT=Xe,i.needsUpdate=!0,i.visible=!0});var e=new St(t.x,t.y),e=K_.createShapeBufferGeometryByCenter(this.hc,e,!!this.Rf),r=this.Mg(e),e=(xg(e,i,this),this.Ji.position.set(0,this.T,0),new y_({color:this.i1,width:this.dp}));return e.U=this,e.Vp(r,t),this.Kv=r,(this.hu=e).Ji.renderOrder=1,this.Ji.add(e.Ji),t.enableUpdateRender(),t.on("resize",this.Ap),!0},Ap(){var t=this.rr(_);t&&null!==this.hu&&this.hu.Ji&&(this.hu.Ji.material.resolution=new St(t.A.renderer.domElement.clientWidth,t.A.renderer.domElement.clientHeight),t.enableUpdateRender())},Uv(){this.Ji&&this.Ji.position.set(0,this.T,0),this.rr(_).enableUpdateRender()},Eg(){var t=this.rr(_);if(!t)return!1;var e=t.Vt,i=this.rr(u);this.Ji.material=e.qr.ah({url:this.Rf,color:this.E0,opacity:this.jf*i.jf,visible:!this.Rf},()=>{this.Ji.material.map.wrapS=Xe,this.Ji.material.map.wrapT=Xe,this.Ji.material.needsUpdate=!0,this.Ji.material.visible=!0}),t.enableUpdateRender()},If(){this.Eg(),this.hu.update()}});class $_ extends et{constructor(){super();var t=new wc(new Float32Array([-.5,0,-.5,0,0,.5,0,-.5,1,0,.5,0,.5,1,1,-.5,0,.5,0,1]),5);this.setIndex([0,1,2,0,2,3]),this.setAttribute("position",new Mc(t,3,0,!1)),this.setAttribute("uv",new Mc(t,2,3,!1))}}class tb extends X_{constructor(t){super(t),this.Ei=p.LOCATION_MARKER,this.Rf=t.url,this.Yn=void 0!==t.size?t.size:20,this.mr=void 0!==t.level?t.level:1,this.jf=void 0!==t.opacity?t.opacity:1,this.Yv=t.buildingID,this.Lg=0,this.Zn=this.Zn.bind(this),this.Uv=this.Uv.bind(this)}get buildingID(){return this.Yv}get level(){return this.mr}set level(t){this.mr!==t&&(this.mr=t,t=this.rr(_),this.remove(),this.addTo(t))}get opacity(){return this.jf}set opacity(t){this.jf=t,this.ef&&this.If()}get url(){return this.Rf}set url(t){this.Rf=t,this.If()}get size(){return this.Yn}set size(t){this.Yn=t,this.Zn()}moveTo(t){if(this.Yv!==t.buildingID){this.Yv=t.buildingID,this.mr=t.level;var e=this.rr(_);if(!e)return!1;this.remove(),this.addTo(e)}else t.level&&(this.level=t.level);return super.moveTo(t)}rotateTo(e){let i=this.rr(_);if(!i)return!1;var r=e.duration||.5,n=this.Ji.rotation.y,s=e.heading%360*l.DEG2RAD;let t=0;s=n+(t=s-n!=0?Math.sin(s-n)/Math.abs(Math.sin(s-n))*Math.acos(Math.cos(s-n)):t);if(e.animate){let t;this.Ai.has("rotation")?((t=this.Ai.get("rotation")).finish(),t.Nt([n]),t.Rt([s])):(t=new en({src:[n],dest:[s]}),this.Ai.set("rotation",t)),t.ot(r).st(t=>{this.Ji&&(this.Ji.rotation.y=t.destination[0],this.Lg=t.destination[0],i.enableUpdateRender())}).nt(()=>{i.lt.ht(t),i.enableUpdateRender(),e.finish&&e.finish()}),i.lt.ut(t.et())}else this.Ji&&(this.Ji.rotation.y=s,this.Lg=s,i.enableUpdateRender())}addTo(t){var e=this.Vi(t);e&&(super.addTo(e),t.on("zoom",this.Zn),t.on("resize",this.Zn),t.on("viewChanged",this.Zn))}remove(){this.stop();var t=this.rr(_);if(!t)return!1;t.off("zoom",this.Zn),t.off("resize",this.Zn),t.off("viewChanged",this.Zn),super.remove()}getRenderNode(){return this.Ji}}Object.assign(tb.prototype,{Xh(){var t,e,i=this.rr(_);return!!i&&(e=new $_,t=this.jr(i),this.Ji=new Q(e,t),this.Ji.renderOrder=1,(this.Ji.mapNode=this).Uv(),this.Ji.rotation.set(0,this.Lg,0,"XYZ"),t.side=Jt,this.Ji.updateMatrixWorld(!0),e=i.Vt.jc(this.Ji,this.Yn),this.Ji.scale.set(e,e,e),this.Ji.visible=this.er,this.U.Fn.add(this.Ji),this.ef=!0)},Zn(){var e=this.rr(_);if(e){var i=this.Ji.position;let t=!1;(t=!(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&"number"==typeof i.x&&"number"==typeof i.y&&"number"==typeof i.z?t:!0)||(i=e.Vt.jc(this.Ji,this.Yn),this.Ji.scale.set(i,i,i),e.enableUpdateRender())}},Uv(){var t,e=this.rr(_);e&&(t=this.Vi(e))&&(this.Ji.position.set(this.o-e.x,t.T+this.T,-this.u+e.y),this.needUpdateBound=!0,e.enableUpdateRender())},jr(e){return e.Vt.qr.hh({url:this.Rf,flipY:!1,opacity:this.jf},()=>{var t;this.Ji&&(t=e.Vt.jc(this.Ji,this.Yn),this.Ji.scale.set(t,t,t),e.enableUpdateRender())})},If(){var t=this.rr(_);if(!t)return!1;this.Ji.material.map&&this.Ji.material.map.dispose(),this.Ji.material.dispose(),this.Ji.material=this.jr(t),this.Ji.material.side=Jt,this.Ji.material.needsUpdate=!0,t.enableUpdateRender()},Vi(t){return(this.Yv?t.getBuilding(this.Yv):t).getFloor(this.mr)}});let eb={EDGES_LINES_TYPE:"EDGES_LINES_TYPE"},ib=(Object.freeze(eb),{NONE:0,ALL:1,TOP:2});function rb(t,e){et.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;for(var i,r,n,s,o=[],a=Math.cos(Et.DEG2RAD*e),h=[0,0],l={},u=["a","b","c"],c=(t.isBufferGeometry?(s=new Is).fromBufferGeometry(t):s=t.clone(),s.mergeVertices(),s.computeFaceNormals(),s.vertices),f=s.faces,d=0,v=f.length;d<v;d++)for(var p=f[d],m=0;m<3;m++)i=p[u[m]],r=p[u[(m+1)%3]],h[0]=Math.min(i,r),h[1]=Math.max(i,r),void 0===l[n=h[0]+","+h[1]]?l[n]={index1:h[0],index2:h[1],face1:d,face2:void 0}:l[n].face2=d;for(n in l){var g,_=l[n];(void 0===_.face2||f[_.face1].normal.dot(f[_.face2].normal)<=a)&&(g=c[_.index1],o.push(g.x,g.y,g.z),g=c[_.index2],o.push(g.x,g.y,g.z))}this.setAttribute("position",new x(o,3))}rb.prototype=Object.create(et.prototype),rb.prototype.constructor=rb;class nb extends Qg{constructor(t){super(t),this.Ei=eb.EDGES_LINES_TYPE,this.mp=void 0!==t.lineType?t.lineType:ib.TOP,this.Tg=void 0!==t.lineAlpha?t.lineAlpha:1,this.i1=void 0!==t.lineColor?t.lineColor:"#FF0000"}get lineColor(){return this.i1}set lineColor(t){this.i1!==t&&(this.i1=t,this.If())}get lineAlpha(){return this.Tg}set lineAlpha(t){this.Tg!==t&&(this.Tg=t,this.If())}}Object.assign(nb.prototype,{Zp(t){var t=new rb(t),e=this.rr(_);if(!e)return!1;var e=e.Vt,i=this.rr(u),e=e.qr.Sh(this.i1,this.Tg*i.jf);this.Ji=new zp(t,e),this.ef=!0},If(){var t,e=this.rr(_);e&&(t=this.rr(u),this.Ji.material=e.Vt.qr.Sh(this.i1,this.Tg*t.jf))}});class sb extends Qg{constructor(t){if(super(t),this.Ei=p.EXTRUDE_MARKER,this.jf=void 0!==t.opacity?t.opacity:1,this.E0=void 0!==t.color?t.color:"#FF0000",this.Sg=void 0!==t.extrudeHeight?t.extrudeHeight:1,this.pp=this.Sg,this.hc=void 0!==t.points?Object.assign(t.points):[],Array.isArray(this.hc[0]))for(let t=0;t<this.hc.length;t++)this.hc[t].constructor===Array&&(Rm.polygonArea(this.hc[t])<0&&this.hc[t].reverse(),Rm.closedPoints(this.hc[t]));else this.hc.constructor===Array&&(Rm.polygonArea(this.hc)<0&&this.hc.reverse(),Rm.closedPoints(this.hc));this.Ag=new nb({lineType:t.edgeMode,lineColor:void 0!==t.edgeColor?t.edgeColor:this.E0,lineAlpha:void 0!==t.edgeOpacity?t.edgeOpacity:this.jf}),this.Ag.U=this}get x(){return this.o}get y(){return this.u}get color(){return this.E0}set color(t){this.E0!==t&&(this.E0=t,this.Og())}get opacity(){return this.jf}set opacity(t){this.jf!==t&&(this.jf=t,this.Og())}get edgeColor(){return this.Ag.i1}set edgeColor(t){this.Ag.lineColor=t}get edgeOpacity(){return this.Ag.Tg}set edgeOpacity(t){this.Ag.lineAlpha=t}get extrudeHeight(){return this.Sg}set extrudeHeight(t){this.Sg!==t&&(this.Sg=t,this.Ji.scale.setZ(this.Sg/this.pp))}get points(){return this.hc}set points(t){this.hc=t,this.hc.constructor===Array&&(Rm.polygonArea(this.hc)<0&&this.hc.reverse(),Rm.closedPoints(this.hc)),this.Ji&&(t=this.rr(_))&&(this.Ji.parent.remove(this.Ji),this.Ji.traverse(function(t){t instanceof Q&&(t.geometry.dispose(),t.material=void 0,t.geometry=void 0)}),this.Ji.mapNode=void 0,this.Ji=void 0,this.Xh(),this.parent.scene.add(this.Ji),t.enableUpdateRender())}dispose(){this.Ag&&this.Ag.dispose(),super.dispose()}getRenderNode(){return this.Ji}setType(t){this.Ei=t}}Object.assign(sb.prototype,{Xh(){var t,e,i,r,n,s=this.rr(_);return!!s&&(t=s.Vt,e=this.rr(u),i=new St(s.x,s.y),n=K_.createShape(this.hc,i),r={depth:this.pp},xg(n=K_.createExtrudeBufferGeometry(n,r),t.qr.Sh(this.E0,this.jf*e.jf),this),this.Ji.position.set(0,this.T,0),this.Ag.mp===ib.TOP?this.Cg(i):this.Ag.mp===ib.ALL&&this.b1(n),this.ef=!0,s.enableUpdateRender(),this.ef)},Cg(t){t=new Em(K_.createShape(this.hc,t));this.b1(t),this.Ag.Ji.position.setZ(this.pp),t.dispose()},b1(t){this.Ag.Zp(t),this.Ji.add(this.Ag.Ji)},Og(){var t,e=this.rr(_);e&&(t=this.rr(u),this.Ji.material=e.Vt.qr.Sh(this.E0,this.jf*t.jf),e.enableUpdateRender())},If(){this.Og(),this.Ag.If()},Uv(){this.Ji.position.set(0,this.T,0),this.rr(_).enableUpdateRender()}});class ob extends X_{constructor(t){super(t),this.Ei=p.DYNAMIC_MODEL_MARKER,this.Ht=void 0!==t.id?t.id:Et.generateUUID(),this.Rg=Et.generateUUID(),this.A0=void 0!==t.fadeIn&&t.fadeIn,this.Ef=void 0!==t.fadeOut&&t.fadeOut,this.jf=void 0!==t.opacity?t.opacity:null,this.Ng=void 0!==t.scale?t.scale:1,this.Dg=t.tilt,this.Rf=t.url,this.rv=t.heading,this.$=t.callback,this.kg=new Map,this.kg.set(this.ROOT,t.color),this.Gf=null,this.Td=[],this.R0=null,this.N0=null,this.Yv=null,this.mr=null,this.T0=this.T0.bind(this)}get FID(){return this.Rg}get color(){return this.getModelColor()}set color(t){this.modifyModelColor(t)}get scale(){return this.Ng}set scale(t){this.Ng=t,this.Xn()}get tilt(){return this.Dg}get heading(){return this.rv}get opacity(){return this.jf}set opacity(t){this.jf=t,this.If()}addTo(t){super.addTo(t),this.mr=t.level,this.Yv=t.parent.buildingID,t.parent instanceof eg&&(this.Yv=null)}moveTo(t){if(this.Yv!=t.buildingID){this.Yv=t.buildingID,this.mr=t.level;var e=this.rr(_);if(!e)return!1;if(!this.Ji)return!1;this.remove();e=this.Vi(e);this.addTo(e)}else t.level&&this.Pg(t.level);return super.moveTo(t)}modifyModelColor(t,e){e=e||this.ROOT,this.kg.set(e,t),this.If()}getNodeNames(){let r=[];return this.Ji?(function e(t){"Mesh"!==t.type&&"SkinnedMesh"!==t.type||r.push(t.name);let i=t.children;for(let t=0;t<i.length;t++)e(i[t])}(this.Ji),r):[]}getModelColor(t){return t=t||this.ROOT,this.kg.get(t)}rotateTo(i){let r=this.rr(_);if(!r)return!1;var n=i.heading%360*l.DEG2RAD;if(this.Ig=i.heading,this.Ji){var s=this.Ji.rotation.y;let t=0,e=s+(t=n-s!=0?Math.sin(n-s)/Math.abs(Math.sin(n-s))*Math.acos(Math.cos(n-s)):t);if(i.animate){n=i.duration||.5;let t;this.Ai.has("rotation")?t=this.Ai.get("rotation"):(t=new en,this.Ai.set("rotation",t));var o=this.rv;t.Nt([s,o]).Rt([e,i.heading]).ot(n).st(t=>{this.Ji.rotation.y=t.destination[0],this.rv=t.destination[1],r.enableUpdateRender()}).nt(()=>{this.Ji.rotation.y=e,this.rv=i.heading,r.enableUpdateRender(),i.finish&&i.finish()}),r.lt.ut(t.et())}else this.Ji.rotation.y=e,this.rv=i.heading,r.enableUpdateRender(),i.finish&&i.finish();return this.Ai.get("rotation")}}startAction(t,e){var i=this.Td[t],e=(i&&(e&&(i.clampWhenFinished=!0,i.loop=dr),this.R0&&this.R0===t?(i.time=this.N0,i.paused=!1,i.play(),this.R0=null,this.N0=null):(this.R0!==t&&(this.R0=null,this.N0=null),i.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play())),this.rr(_));e&&e.on("beforeRender",this.T0)}getAction(){return this.Td}getClip(t){return this.Td[t].Uf}getMixer(){return this.Gf}stopAction(t){var e=this.rr(_),e=(e&&e.off("beforeRender",this.T0),this.Td[t]);e&&(e.paused=!0,this.R0=t,this.N0=e.time)}getActionNames(){return Object.keys(this.Td)}remove(){this.stop(),this.Ji&&this.Ji.bloom&&this.Ji.bloom.remove(this);let e=this.rr(_);var t;e&&this.Gf&&e.lt.tv(this.Gf),e&&(t=this.kg.get(this.ROOT),this.Fg(this.Ji,t,t=>{e.Vt.qr.oh(t,t.material)})),super.remove()}dispose(){super.dispose(),this.remove(),this.Ji&&(this.Ji.mapNode=void 0,this.Ji=void 0),this.ef=!1,this.jg()}getRenderNode(){return this.Ji}}Object.assign(ob.prototype,{ROOT:"root",Pg(t){this.mr!==t&&(this.mr=t,t=this.rr(_))&&(this.remove(),t=this.Vi(t),this.addTo(t))},Vi(t){return(this.Yv?t.getBuilding(this.Yv):t).getFloor(this.mr)},Xh(){if(!this.ef){let r=this.rr(_);if(!r)return!1;this.ef=!0;var s=this.Rf.split(".");let n=s[s.length-1].toLocaleLowerCase();this.fileExtension=n;s={gltf:{},glb:{},fbx:ot.window.fengmap?.FBXLoader};if(s[n]){let t,e,i=(t=("glb"===n||"gltf"===n?(e=r.Vt.pm).ia:(e=new s[n]).load).bind(e),{glb:t=>t.scene,fbx:t=>t});return i.gltf=i.glb,t(this.Rf,t=>{if(this.ef){if(this.Ji=i[n](t),this.Ji.visible=this.er,this.rv&&(this.Ji.rotation.y=this.rv%360*l.DEG2RAD),this.Dg&&(this.Ji.rotation.x=this.Dg%360*l.DEG2RAD),this.Xn(),(this.Ji.mapNode=this).U.Fn.add(this.Ji),0<t.animations.length){this.Gf=new jg(this.Ji);for(var e of t.animations)this.Td[e.name]=this.Gf.clipAction(e);r.lt.Z0(this.Gf)}this.If(),this.Uv(),this.A0&&this.Lf({src:[0],dest:[1],duration:1}),r.enableUpdateRender(),this.$&&this.$(this)}},null,function(t){console.error(t)}),!0}console.error(" "+n)}},Lf(e){let r=this.rr(_);if(r){let t=new en({src:e.src||[0],dest:e.dest||[1]});this.Ai.set("faceIn",t),t.ot(e.duration||1).st(t=>{let i=t.destination[0];this.Ji.traverse(t=>{var e;"Mesh"!==t.type&&"SkinnedMesh"!==t.type||("glb"===this.fileExtension||"gltf"===this.fileExtension?(t.material.transparent=!0,e=t.material.userData.sourceOpacity,t.material.opacity=e*i,r.enableUpdateRender()):Array.isArray(t.material)?(t.material.forEach(t=>{var e=t.userData.sourceOpacity;t.transparent=!0,t.opacity=e*i}),r.enableUpdateRender()):(e=t.material.userData.sourceOpacity,t.material.transparent=!0,t.material.opacity=e*i))})}).nt(()=>{e.callback&&e.callback(),r.lt.ht(t),r.enableUpdateNode()}).et(),r.lt.ut(t)}},Xn(){if(this.Ji){var t=this.rr(_);if(!t)return!1;var e=this.Ji?.userData?.sourceScale||new ig(1,1,1);this.Ji.scale.copy(e).multiplyScalar(this.Ng),t.enableUpdateRender()}},Gg(t){void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent)},Ug(t,e){e=null!==this.jf?this.jf*e.jf:void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity*e.jf:t.opacity*e.jf;return{opacity:e,transparent:t.userData.sourceTransparent||e<1}},If(){if(this.Ji){let a=this.rr(_),h=this.rr(u);var t=this.kg.get(this.ROOT);this.Fg(this.Ji,t,(e,t)=>{var i={color:t},r=this.Xr(e.material,h,i);if("glb"===this.fileExtension||"gltf"===this.fileExtension)if(Array.isArray(e.material.length))for(let t=0;t<e.material.length;t++)e.material[t].depthWrite=!0,e.material[t]=a.Vt.qr.Jr(e.material[t],r);else e.material.depthWrite=!0,e.material=a.Vt.qr.Jr(e.material,r);else if(Array.isArray(e.material))for(let t=0;t<e.material.length;t++){this.Gg(e.material[t]),e.material[t].depthWrite=!0;var{opacity:n,transparent:s}=this.Ug(e.material[t],h);e.material[t].color=new ft(i.color||16777215),e.material[t].opacity=n,e.material[t].transparent=s}else{this.Gg(e.material),e.material.depthWrite=!0;var{opacity:t,transparent:o}=this.Ug(e.material,h);e.material.color=new ft(i.color||16777215),e.material.opacity=t,e.material.transparent=o}}),a.enableUpdateRender()}},Fg(e,i,r){var t=this.kg.get(e.name);if(t&&(i=t),"Mesh"===e.type||"SkinnedMesh"===e.type)r(e,i);else for(let t=0;t<e.children.length;t++)this.Fg(e.children[t],i,r)},Xr(t,e,i){var r;if("glb"===this.fileExtension||"gltf"===this.fileExtension)return r={},void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent),i.color&&(r.color=i.color),r.opacity=null!==this.jf?this.jf*e.jf:void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity*e.jf:t.opacity*e.jf,r.transparent=t.userData.sourceTransparent||r.opacity<1,r},T0(){var t=this.rr(_);t&&t.enableUpdateRender()},Hg(e){if(e._interpolant&&(e._interpolant.length=0),e.zf){for(let t=0;t<e.zf.length;t++)e.zf[t].parameterPositions=null,e.zf[t].resultBuffer=null,e.zf[t].sampleValues=null,e.zf[t]=null;e.zf=null}if(e.Vf){for(let t=0;t<e.Vf.length;t++)e.Vf[t].binding=null,e.Vf[t].buffer=null,e.Vf[t]=null;e.Vf=null}if(e.Uf&&e.Uf.tracks){for(let t=0;t<e.Uf.tracks.length;t++)e.Uf.tracks[t].times=null,e.Uf.tracks[t].values=null,e.Uf.tracks[t]=null;e.Uf.tracks=null,e.Uf=null}},jg(){for(var t in this.Td)this.Hg(this.Td[t]),this.Td[t]=null;if(this.Td=[],this.Gf){for(let t=0;t<this.Gf.Dl.length;t++)this.Gf.Dl[t].buffer=null;this.Gf.Dl=null,this.Gf._d=null,this.Gf.ks=null,this.Gf.stats=null,this.Gf.yd=null,this.Gf.Td=null,this.Gf=null}}});let ab={Default:1,Legacy:2,Classic:4,Custom:8};class hb{constructor(t,e){this.Bg=t,this.zg=e,this.Vg={[ab.Default]:{FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]},[ab.Legacy]:{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]},[ab.Classic]:{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:.9,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.33,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}}}getConfig(){return this.Bg==ab.Custom?this.zg:this.Vg[this.Bg]}}class lb{constructor(t){this.Wg=t.origon,this.pf=t.target,this.Yg=null,this.Xg=null,this.Zg=null,this.qg=null,this.Jg=null,this.Kg=null,this.Qg=null,this.$g=null,this.Xh()}transform(t){let e=t.x-this.Yg.x,i=t.y-this.Yg.y;var t=this.Xg.x*e+this.Xg.y*i,r=this.Zg.x*e+this.Zg.y*i;let n=t/this.qg.x,s=r/this.qg.y,o=n*this.$g.x,a=s*this.$g.y;return{x:this.Jg.x+this.Kg.x*o+this.Qg.x*a,y:this.Jg.y+this.Kg.y*o+this.Qg.y*a}}}Object.assign(lb.prototype,{Xh(){!Array.isArray(this.Wg)||!Array.isArray(this.pf)||this.Wg.length<3||this.pf.length<3||(this.Yg=this.Wg[0],this.Xg={x:this.Wg[1].x-this.Wg[0].x,y:this.Wg[1].y-this.Wg[0].y},this.Zg={x:this.Wg[2].x-this.Wg[0].x,y:this.Wg[2].y-this.Wg[0].y},this.qg={x:U.ze(this.Xg),y:U.ze(this.Zg)},this.Jg=this.pf[0],this.Kg={x:this.pf[1].x-this.pf[0].x,y:this.pf[1].y-this.pf[0].y},this.Qg={x:this.pf[2].x-this.pf[0].x,y:this.pf[2].y-this.pf[0].y},this.$g={x:U.ze(this.Kg),y:U.ze(this.Qg)},this.Xg.x/=this.qg.x,this.Xg.y/=this.qg.x,this.Zg.x/=this.qg.y,this.Zg.y/=this.qg.y,this.Kg.x/=this.$g.x,this.Kg.y/=this.$g.x,this.Qg.x/=this.$g.y,this.Qg.y/=this.$g.y)}});let ub=new WeakMap;class cb{constructor(t){this.identifier=t.identifier,this.force=void 0===t.force?1:t.force,this.pageX=t.pageX||t.x,this.pageY=t.pageY||t.y,this.clientX=t.clientX||t.x,this.clientY=t.clientY||t.y,this.screenX=this.pageX,this.screenY=this.pageY}}class fb{constructor(){ub.set(this,{})}addEventListener(t,e,i={}){let r=ub.get(this);r||(r={},ub.set(this,r)),r[t]||(r[t]=[]),r[t].push(e),i.capture}removeEventListener(t,e){var i=ub.get(this);if(i){var r=i[t];if(r&&0<r.length)for(let t=r.length;t--;t)if(r[t]===e){r.splice(t,1);break}}}dispatchEvent(e={}){"function"!=typeof e.preventDefault&&(e.preventDefault=()=>{}),"function"!=typeof e.stopPropagation&&(e.stopPropagation=()=>{});var i=ub.get(this)[e.type];if(i)for(let t=0;t<i.length;t++)i[t](e)}dispatchTouchEvent(t={}){var e={...this},e={changedTouches:t.changedTouches.map(t=>new cb(t)),touches:t.touches.map(t=>new cb(t)),targetTouches:Array.prototype.slice.call(t.touches.map(t=>new cb(t))),timeStamp:t.timeStamp,target:e,currentTarget:e,type:t.type,cancelBubble:!1,cancelable:!1};this.dispatchEvent(e)}}function db(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=(e=""+e).replace(/[ \t\n\f\r]/g,"")).length%4==0?e.replace(/==?$/,""):e).length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let i="",r=0,n=0;for(let t=0;t<e.length;t++)r=(r<<=6)|pb(e[t]),24===(n+=6)&&(i=(i=(i+=String.fromCharCode((16711680&r)>>16))+String.fromCharCode((65280&r)>>8))+String.fromCharCode(255&r),r=n=0);return 12===n?(r>>=4,i+=String.fromCharCode(r)):18===n&&(r>>=2,i=(i+=String.fromCharCode((65280&r)>>8))+String.fromCharCode(255&r)),i}let vb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function pb(t){t=vb.indexOf(t);return t<0?void 0:t}var mb=db;function gb(t){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let e;for(t=""+t,e=0;e<t.length;e++)if(255<t.charCodeAt(e))return null;let i="";for(e=0;e<t.length;e+=3){var r=[void 0,void 0,void 0,void 0];r[0]=t.charCodeAt(e)>>2,r[1]=(3&t.charCodeAt(e))<<4,t.length>e+1&&(r[1]|=t.charCodeAt(e+1)>>4,r[2]=(15&t.charCodeAt(e+1))<<2),t.length>e+2&&(r[2]|=t.charCodeAt(e+2)>>6,r[3]=63&t.charCodeAt(e+2));for(let t=0;t<r.length;t++)void 0===r[t]?i+="=":i+=bb(r[t])}return i}let _b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function bb(t){if(0<=t&&t<64)return _b[t]}var yb=gb;let wb=mb,xb=yb;var Mb={atob:wb,btoa:xb},Eb=0,Lb=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-Eb)),r=setTimeout(function(){t(e+i)},i);return Eb=e+i,r},Tb=function(t){clearTimeout(t)};let Sb=wx.getSystemInfoSync(),Ab={AudioContext:function(){},URL:{},atob:Mb.atob,devicePixelRatio:Sb.pixelRatio,requestAnimationFrame:Lb,cancelAnimationFrame:Tb,screenWidth:Sb.screenWidth,screenHeight:Sb.screenHeight,systemInfo:Sb};function Ob(e){Object.defineProperty(e,"style",{configurable:!0,get(){return{width:e.width+"px",height:e.height+"px"}}}),Object.defineProperty(e,"clientHeight",{configurable:!0,get(){return e.height/Ab.devicePixelRatio}}),Object.defineProperty(e,"clientWidth",{configurable:!0,get(){return e.width/Ab.devicePixelRatio}}),Object.defineProperty(e,"parentElement",{configurable:!0,get(){return e}});var t=new fb;Object.defineProperties(e,{addEventListener:{value:t.addEventListener.bind(t)},removeEventListener:{value:t.removeEventListener.bind(t)},dispatchEvent:{value:t.dispatchEvent.bind(t)},dispatchTouchEvent:{value:t.dispatchTouchEvent.bind(t)}}),e.getBoundingClientRect=()=>{var t={left:0,top:0,right:0,bottom:0,width:e.clientWidth,height:e.clientHeight};return o.boundingClientRect&&(t.left=o.boundingClientRect.left,t.right=o.boundingClientRect.right,t.top=o.boundingClientRect.top,t.bottom=o.boundingClientRect.bottom,t.width=o.boundingClientRect.width,t.height=o.boundingClientRect.height),t}}let Cb=new WeakMap,Rb=new WeakMap;function Nb(t,e={}){e.target=e.target||this,"function"==typeof this["on"+t]&&this["on"+t].call(this,e)}function Db(t,e={}){this.readyState=t,e.readyState=t,Nb.call(this,"readystatechange",e)}function kb(t){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(t)}class Pb extends fb{constructor(){super(),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="text",this.dataType="string",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,Cb.set(this,{"content-type":"application/x-www-form-urlencoded"}),Rb.set(this,{})}abort(){this.isAbort=!0,this.request?.abort()}getAllResponseHeaders(){let e=Rb.get(this);return Object.keys(e).map(t=>t+": "+e[t]).join("\n")}getResponseHeader(t){return Rb.get(this)[t]}open(t,e){this.t_=t,this.Rf=e,Db.call(this,Pb.OPENED)}overrideMimeType(){}send(r=""){if(this.readyState!==Pb.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");{var n=this.Rf,s=Cb.get(this);let t=this.responseType.toLocaleLowerCase();"arraybuffer"!==t&&(t="text");var o=this.dataType;let e=kb(n),i;"arraybuffer"!==t&&(i="utf8"),delete this.response,this.response=null;var a,h,l=({data:e,statusCode:t,header:i})=>{if(!0!==this.isAbort){if(this.status=t=void 0===t?200:t,i&&Rb.set(this,i),Nb.call(this,"loadstart"),Db.call(this,Pb.HEADERS_RECEIVED),Db.call(this,Pb.LOADING),"json"==this.responseType)try{this.response=JSON.parse(e)}catch(t){this.response=e}else this.response=e;Db.call(this,Pb.DONE),Nb.call(this,"load"),Nb.call(this,"loadend")}},u=({errMsg:t})=>{!0!==this.isAbort&&(-1!==t.indexOf("abort")?Nb.call(this,"abort"):Nb.call(this,"error",{message:t}),Nb.call(this,"loadend"),e)&&console.warn(t)};e?(a=wx.getFileSystemManager(),h={filePath:n,success:l,fail:u},i&&(h.encoding=i),a.readFile(h)):this.request=wx.request({data:r,url:n,method:this.t_,header:s,dataType:o,responseType:t,success:l,fail:u})}}setRequestHeader(t,e){var i=Cb.get(this);i[t]=e,Cb.set(this,i)}addEventListener(t,e){"function"==typeof e&&(this["on"+t]=(t={})=>{t.target=t.target||this,e.call(this,t)})}removeEventListener(t,e){this["on"+t]===e&&(this["on"+t]=null)}}Pb.UNSEND=0,Pb.OPENED=1,Pb.HEADERS_RECEIVED=2,Pb.LOADING=3,Pb.DONE=4;class Ib{constructor(t,e,i){this.map=i,this.canvas=t,this.canvas.name="canvas",this.tempCanvas=e,this.tempCanvas.name="tempCanvas"}createImage(e={}){let{url:i,onload:r,needDraw:n=!1,onerror:s}=e;e=n?this.tempCanvas:this.canvas;if(e&&!o.isDestory){let t=e.createImage();if("data:,"===i)r&&r(t);else{if(r){if(this?.map?.requestDispose)return;if(t.crossOrigin="Anonymous",t.onload=()=>{this.map.requestDispose||r&&r(t)},t.onerror=t=>{this?.map?.requestDispose||s&&s(t)},this?.map?.requestDispose)return;t.src=i}t.needDraw=n}return t}}drawImage(t){var e=this.tempCanvas,i=e.getContext("2d"),r=t.width,n=t.height;return e.width=r,e.height=n,e.style.width=r+"px",e.style.height=n+"px",i.drawImage(t,0,0),e}}class Fb extends fb{constructor(t,e){super(),this.canvas=t,this.tempCanvas=e,this.body=this.canvas}createElement(t){if("canvas"===(t=t.toLowerCase()))return e=this.tempCanvas,e;if("img"===t){let t=this.canvas.createImage();var e=new fb;return Object.defineProperties(t,{addEventListener:{value:e.addEventListener.bind(e)},removeEventListener:{value:e.removeEventListener.bind(e)},dispatchEvent:{value:e.dispatchEvent.bind(e)},dispatchTouchEvent:{value:e.dispatchTouchEvent.bind(e)}}),t.onload=function(){console.error("createElement, img.onload",t.url),t.dispatchEvent({type:"load"})},t}console.error(`createElement ${t} failed.`)}createElementNS(t,e){var i;return"canvas"===(e=e.toLowerCase())?(i=this.tempCanvas,i):"img"===e?this.canvas.createImage():void console.error(`createElementNS ${e} failed.`)}}var jb={},Gb={},Ub,Hb,Bb;function zb(){var e,r,i;return Hb||(Hb=1,Ub=n,e=Vb(),(r=n.zero=new n(0,0)).toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1},n.zeroHash="\0\0\0\0\0\0\0\0",n.fromNumber=function(t){var e,i;return 0===t?r:(i=(t=(e=t<0)?-t:t)>>>0,t=(t-i)/4294967296>>>0,e&&(t=~t>>>0,i=~i>>>0,4294967295<++i)&&(i=0,4294967295<++t)&&(t=0),new n(i,t))},n.from=function(t){if("number"==typeof t)return n.fromNumber(t);if(e.isString(t)){if(!e.Long)return n.fromNumber(parseInt(t,10));t=e.Long.fromString(t)}return t.low||t.high?new n(t.low>>>0,t.high>>>0):r},n.prototype.toNumber=function(t){var e;return!t&&this.hi>>>31?(t=1+~this.lo>>>0,e=~this.hi>>>0,-(t+4294967296*(e=t?e:e+1>>>0))):this.lo+4294967296*this.hi},n.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}},i=String.prototype.charCodeAt,n.fromHash=function(t){return"\0\0\0\0\0\0\0\0"===t?r:new n((i.call(t,0)|i.call(t,1)<<8|i.call(t,2)<<16|i.call(t,3)<<24)>>>0,(i.call(t,4)|i.call(t,5)<<8|i.call(t,6)<<16|i.call(t,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},n.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},n.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0==i?0==e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10}),Ub;function n(t,e){this.lo=t>>>0,this.hi=e>>>0}}function Vb(){var r;return Bb||(Bb=1,(r=Gb).asPromise=Xc(),r.base64=rf(),r.EventEmitter=nf(),r.float=sf(),r.inquire=of(),r.utf8=vf(),r.pool=pf(),r.LongBits=zb(),r.isNode=Boolean(void 0!==is&&is&&is.process&&is.process.versions&&is.process.versions.node),r.global=r.isNode&&is||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||is,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,e){var i=t[e];return!(null==i||!t.hasOwnProperty(e))&&("object"!=typeof i||0<(Array.isArray(i)?i:Object.keys(i)).length)},r.Buffer=(()=>{try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}})(),r.ys=null,r.ws=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r.ws(t):new r.Array(t):r.Buffer?r.ys(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){t=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(t.lo,t.hi,e):t.toNumber(Boolean(e))},r.merge=n,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=t,r.ProtocolError=t("ProtocolError"),r.oneOfGetter=function(t){for(var i={},e=0;e<t.length;++e)i[t[e]]=1;return function(){for(var t=Object.keys(this),e=t.length-1;-1<e;--e)if(1===i[t[e]]&&null!=this[t[e]])return t[e]}},r.oneOfSetter=function(i){return function(t){for(var e=0;e<i.length;++e)i[e]!==t&&delete this[i[e]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r.xs=function(){var i=r.Buffer;i?(r.ys=i.from!==Uint8Array.from&&i.from||function(t,e){return new i(t,e)},r.ws=i.allocUnsafe||function(t){return new i(t)}):r.ys=r.ws=null}),Gb;function n(t,e,i){for(var r=Object.keys(e),n=0;n<r.length;++n)void 0!==t[r[n]]&&i||(t[r[n]]=e[r[n]]);return t}function t(t){function i(t,e){if(!(this instanceof i))return new i(t,e);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),e&&n(this,e)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return t}}),i.prototype.toString=function(){return this.name+": "+this.message},i}}var Wb=a,Yb=Vb(),Xb,Zb=Yb.LongBits,qb=Yb.base64,Jb=Yb.utf8;function Kb(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function Qb(){}function $b(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function a(){this.len=0,this.head=new Kb(Qb,0,0),this.tail=this.head,this.states=null}var ty=function(){return Yb.Buffer?function(){return(a.create=function(){return new Xb})()}:function(){return new a}};function ey(t,e,i){e[i]=255&t}function iy(t,e,i){for(;127<t;)e[i++]=127&t|128,t>>>=7;e[i]=t}function ry(t,e){this.len=t,this.next=void 0,this.val=e}function ny(t,e,i){for(;t.hi;)e[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)e[i++]=127&t.lo|128,t.lo=t.lo>>>7;e[i++]=t.lo}function sy(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}a.create=ty(),a.alloc=function(t){return new Yb.Array(t)},Yb.Array!==Array&&(a.alloc=Yb.pool(a.alloc,Yb.Array.prototype.subarray)),a.prototype.Ms=function(t,e,i){return this.tail=this.tail.next=new Kb(t,e,i),this.len+=e,this},ry.prototype=Object.create(Kb.prototype),ry.prototype.fn=iy,a.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new ry((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},a.prototype.int32=function(t){return t<0?this.Ms(ny,10,Zb.fromNumber(t)):this.uint32(t)},a.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},a.prototype.uint64=function(t){t=Zb.from(t);return this.Ms(ny,t.length(),t)},a.prototype.int64=a.prototype.uint64,a.prototype.sint64=function(t){t=Zb.from(t).zzEncode();return this.Ms(ny,t.length(),t)},a.prototype.bool=function(t){return this.Ms(ey,1,t?1:0)},a.prototype.fixed32=function(t){return this.Ms(sy,4,t>>>0)},a.prototype.sfixed32=a.prototype.fixed32,a.prototype.fixed64=function(t){t=Zb.from(t);return this.Ms(sy,4,t.lo).Ms(sy,4,t.hi)},a.prototype.sfixed64=a.prototype.fixed64,a.prototype.float=function(t){return this.Ms(Yb.float.writeFloatLE,4,t)},a.prototype.double=function(t){return this.Ms(Yb.float.writeDoubleLE,8,t)};var oy=Yb.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var r=0;r<t.length;++r)e[i+r]=t[r]},ay=(a.prototype.bytes=function(t){var e,i=t.length>>>0;return i?(Yb.isString(t)&&(e=a.alloc(i=qb.length(t)),qb.decode(t,e,0),t=e),this.uint32(i).Ms(oy,i,t)):this.Ms(ey,1,0)},a.prototype.string=function(t){var e=Jb.length(t);return e?this.uint32(e).Ms(Jb.write,e,t):this.Ms(ey,1,0)},a.prototype.fork=function(){return this.states=new $b(this),this.head=this.tail=new Kb(Qb,0,0),this.len=0,this},a.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Kb(Qb,0,0),this.len=0),this},a.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this},a.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e},a.xs=function(t){Xb=t,a.create=ty(),Xb.xs()},uy),hy=Wb,ly=((uy.prototype=Object.create(hy.prototype)).constructor=uy,Vb());function uy(){hy.call(this)}function cy(t,e,i){t.length<40?ly.utf8.write(t,e,i):e.utf8Write?e.utf8Write(t,i):e.write(t,i)}uy.xs=function(){uy.alloc=ly.ws,uy.writeBytesBuffer=ly.Buffer&&ly.Buffer.prototype instanceof Uint8Array&&"set"===ly.Buffer.prototype.set.name?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var r=0;r<t.length;)e[i++]=t[r++]}},uy.prototype.bytes=function(t){var e=(t=ly.isString(t)?ly.ys(t,"base64"):t).length>>>0;return this.uint32(e),e&&this.Ms(uy.writeBytesBuffer,e,t),this},uy.prototype.string=function(t){var e=ly.Buffer.byteLength(t);return this.uint32(e),e&&this.Ms(cy,e,t),this},uy.xs();var fy=by,dy=Vb(),vy,py=dy.LongBits,gy=dy.utf8;function _y(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function by(t){this.buf=t,this.pos=0,this.len=t.length}var yy="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new by(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new by(t);throw Error("illegal buffer")},wy=function(){return dy.Buffer?function(t){return(by.create=function(t){return dy.Buffer.isBuffer(t)?new vy(t):yy(t)})(t)}:yy};function xy(){var t=new py(0,0),e=0;if(!(4<this.len-this.pos)){for(;e<3;++e){if(this.pos>=this.len)throw _y(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,4<this.len-this.pos){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw _y(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function My(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function Ey(){if(this.pos+8>this.len)throw _y(this,8);return new py(My(this.buf,this.pos+=4),My(this.buf,this.pos+=4))}by.create=wy(),by.prototype.Es=dy.Array.prototype.subarray||dy.Array.prototype.slice,by.prototype.uint32=(()=>{var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)||!((this.pos+=5)>this.len))return t;throw this.pos=this.len,_y(this,10)}})(),by.prototype.int32=function(){return 0|this.uint32()},by.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},by.prototype.bool=function(){return 0!==this.uint32()},by.prototype.fixed32=function(){if(this.pos+4>this.len)throw _y(this,4);return My(this.buf,this.pos+=4)},by.prototype.sfixed32=function(){if(this.pos+4>this.len)throw _y(this,4);return 0|My(this.buf,this.pos+=4)},by.prototype.float=function(){if(this.pos+4>this.len)throw _y(this,4);var t=dy.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},by.prototype.double=function(){if(this.pos+8>this.len)throw _y(this,4);var t=dy.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},by.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw _y(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,i):e===i?new this.buf.constructor(0):this.Es.call(this.buf,e,i)},by.prototype.string=function(){var t=this.bytes();return gy.read(t,0,t.length)},by.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw _y(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw _y(this)}while(128&this.buf[this.pos++]);return this},by.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},by.xs=function(t){vy=t,by.create=wy(),vy.xs();var e=dy.Long?"toLong":"toNumber";dy.merge(by.prototype,{int64:function(){return xy.call(this)[e](!1)},uint64:function(){return xy.call(this)[e](!0)},sint64:function(){return xy.call(this).zzDecode()[e](!1)},fixed64:function(){return Ey.call(this)[e](!0)},sfixed64:function(){return Ey.call(this)[e](!1)}})};var Ly=Ay,Ty=fy,Sy=((Ay.prototype=Object.create(Ty.prototype)).constructor=Ay,Vb());function Ay(t){Ty.call(this,t)}Ay.xs=function(){Sy.Buffer&&(Ay.prototype.Es=Sy.Buffer.prototype.slice)},Ay.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},Ay.xs();var Oy={},Cy=Ny,Ry=Vb();function Ny(t,e,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");Ry.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(i)}(Ny.prototype=Object.create(Ry.EventEmitter.prototype)).constructor=Ny,Ny.prototype.rpcCall=function t(i,e,r,n,s){if(!n)throw TypeError("request must be specified");var o=this;if(!s)return Ry.asPromise(t,o,i,e,r,n);if(o.rpcImpl)try{return o.rpcImpl(i,e[o.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(t,e){if(t)return o.emit("error",t,i),s(t);if(null!==e){if(!(e instanceof r))try{e=r[o.responseDelimited?"decodeDelimited":"decode"](e)}catch(t){return o.emit("error",t,i),s(t)}return o.emit("data",e,i),s(null,e)}o.end(!0)})}catch(t){o.emit("error",t,i),setTimeout(function(){s(t)},0)}else setTimeout(function(){s(Error("already ended"))},0)},Ny.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},Oy.Service=Cy;var Dy={},P=((()=>{var t=jb;function e(){t.util.xs(),t.Writer.xs(t.BufferWriter),t.Reader.xs(t.BufferReader)}t.build="minimal",t.Writer=Wb,t.BufferWriter=ay,t.Reader=fy,t.BufferReader=Ly,t.util=Vb(),t.rpc=Oy,t.roots=Dy,t.configure=e,e()})(),jb);let I=P.Reader,F=P.Writer,j=P.util,G=P.roots.default||(P.roots.default={});G.protobuf=(()=>{var t,e,i={};function r(i){if(this.buffers=[],this.keys=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function n(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function s(i){if(this.layerGroups=[],this.buildings=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function o(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function a(i){if(this.layers=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function h(i){if(this.fids=[],this.idxs=[],this.pts=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function l(i){if(this.idxs=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function u(i){if(this.floors=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function c(i){if(this.floors=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function f(i){if(this.navi=[],this.drive=[],this.accessible=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function d(i){if(this.idxs=[],this.pts=[],this.toBid=[],this.toGid=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function v(i){if(this.idxs=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function p(i){if(this.extentLayer=[],this.modelLayer=[],this.labelLayer=[],this.poiLayer=[],this.polygonLayer=[],this.polygonLabelLayer=[],this.liftLayer=[],this.stairLayer=[],this.escalatorLayer=[],this.externalModelLayer=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function m(i){if(this.idxs=[],this.pts=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function g(i){if(this.idxs=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function _(i){if(this.extentLayer=[],this.modelLayer=[],this.labelLayer=[],this.poiLayer=[],this.polygonLayer=[],this.liftLayer=[],this.stairLayer=[],this.polygonLabelLayer=[],this.externalModelLayer=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function b(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function y(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function w(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function x(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function M(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function E(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function L(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function T(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function S(i){if(i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function A(i){if(this.naviNodes=[],this.naviSegments=[],this.naviZones=[],this.naviModels=[],this.nextFloors=[],this.naviExtents=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function O(i){if(this.idxs=[],this.pts=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function C(i){if(this.idxs=[],this.pts=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function R(i){if(this.rejects=[],this.idxs=[],this.pts=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function N(i){if(this.doorids=[],this.nodetypes=[],this.entrytypes=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function D(i){if(this.pts=[],this.idxs=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}function k(i){if(this.idxs=[],i)for(let t=Object.keys(i),e=0;e<t.length;++e)null!=i[t[e]]&&(this[t[e]]=i[t[e]])}return i.Map=(r.prototype.mid="",r.prototype.fileVer=0,r.prototype.dateVer=j.Long?j.Long.fromBits(0,0,!0):0,r.prototype.mname="",r.prototype.hashCode="",r.prototype.key="",r.prototype.fileDate="",r.prototype.desc="",r.prototype.readOnly=!1,r.prototype.buffers=j.emptyArray,r.prototype.keys=j.emptyArray,r.create=function(t){return new r(t)},r.encode=function(e,i){if((i=i||F.create()).uint32(10).string(e.mid),i.uint32(16).int32(e.fileVer),i.uint32(24).uint64(e.dateVer),i.uint32(34).string(e.mname),i.uint32(42).string(e.hashCode),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&i.uint32(50).string(e.key),null!=e.fileDate&&Object.hasOwnProperty.call(e,"fileDate")&&i.uint32(58).string(e.fileDate),null!=e.desc&&Object.hasOwnProperty.call(e,"desc")&&i.uint32(66).string(e.desc),null!=e.readOnly&&Object.hasOwnProperty.call(e,"readOnly")&&i.uint32(72).bool(e.readOnly),null!=e.buffers&&e.buffers.length)for(let t=0;t<e.buffers.length;++t)G.protobuf.Map.Buffer.encode(e.buffers[t],i.uint32(82).fork()).ldelim();if(null!=e.keys&&e.keys.length)for(let t=0;t<e.keys.length;++t)i.uint32(90).string(e.keys[t]);return i},r.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},r.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Map;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.mid=t.string();break;case 2:r.fileVer=t.int32();break;case 3:r.dateVer=t.uint64();break;case 4:r.mname=t.string();break;case 5:r.hashCode=t.string();break;case 6:r.key=t.string();break;case 7:r.fileDate=t.string();break;case 8:r.desc=t.string();break;case 9:r.readOnly=t.bool();break;case 10:r.buffers&&r.buffers.length||(r.buffers=[]),r.buffers.push(G.protobuf.Map.Buffer.decode(t,t.uint32()));break;case 11:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(t.string());break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("mid"))throw j.ProtocolError("missing required 'mid'",{instance:r});if(!r.hasOwnProperty("fileVer"))throw j.ProtocolError("missing required 'fileVer'",{instance:r});if(!r.hasOwnProperty("dateVer"))throw j.ProtocolError("missing required 'dateVer'",{instance:r});if(!r.hasOwnProperty("mname"))throw j.ProtocolError("missing required 'mname'",{instance:r});if(r.hasOwnProperty("hashCode"))return r;throw j.ProtocolError("missing required 'hashCode'",{instance:r})},r.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},r.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(!j.isInteger(e.fileVer))return"fileVer: integer expected";if(!(j.isInteger(e.dateVer)||e.dateVer&&j.isInteger(e.dateVer.low)&&j.isInteger(e.dateVer.high)))return"dateVer: integer|Long expected";if(!j.isString(e.mname))return"mname: string expected";if(!j.isString(e.hashCode))return"hashCode: string expected";if(null!=e.key&&e.hasOwnProperty("key")&&!j.isString(e.key))return"key: string expected";if(null!=e.fileDate&&e.hasOwnProperty("fileDate")&&!j.isString(e.fileDate))return"fileDate: string expected";if(null!=e.desc&&e.hasOwnProperty("desc")&&!j.isString(e.desc))return"desc: string expected";if(null!=e.readOnly&&e.hasOwnProperty("readOnly")&&"boolean"!=typeof e.readOnly)return"readOnly: boolean expected";if(null!=e.buffers&&e.hasOwnProperty("buffers")){if(!Array.isArray(e.buffers))return"buffers: array expected";for(let t=0;t<e.buffers.length;++t){var i=G.protobuf.Map.Buffer.verify(e.buffers[t]);if(i)return"buffers."+i}}if(null!=e.keys&&e.hasOwnProperty("keys")){if(!Array.isArray(e.keys))return"keys: array expected";for(let t=0;t<e.keys.length;++t)if(!j.isString(e.keys[t]))return"keys: string[] expected"}return null},r.fromObject=function(e){if(e instanceof G.protobuf.Map)return e;var i=new G.protobuf.Map;if(null!=e.mid&&(i.mid=String(e.mid)),null!=e.fileVer&&(i.fileVer=0|e.fileVer),null!=e.dateVer&&(j.Long?(i.dateVer=j.Long.fromValue(e.dateVer)).unsigned=!0:"string"==typeof e.dateVer?i.dateVer=parseInt(e.dateVer,10):"number"==typeof e.dateVer?i.dateVer=e.dateVer:"object"==typeof e.dateVer&&(i.dateVer=new j.LongBits(e.dateVer.low>>>0,e.dateVer.high>>>0).toNumber(!0))),null!=e.mname&&(i.mname=String(e.mname)),null!=e.hashCode&&(i.hashCode=String(e.hashCode)),null!=e.key&&(i.key=String(e.key)),null!=e.fileDate&&(i.fileDate=String(e.fileDate)),null!=e.desc&&(i.desc=String(e.desc)),null!=e.readOnly&&(i.readOnly=Boolean(e.readOnly)),e.buffers){if(!Array.isArray(e.buffers))throw TypeError(".protobuf.Map.buffers: array expected");i.buffers=[];for(let t=0;t<e.buffers.length;++t){if("object"!=typeof e.buffers[t])throw TypeError(".protobuf.Map.buffers: object expected");i.buffers[t]=G.protobuf.Map.Buffer.fromObject(e.buffers[t])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".protobuf.Map.keys: array expected");i.keys=[];for(let t=0;t<e.keys.length;++t)i.keys[t]=String(e.keys[t])}return i},r.toObject=function(e,i){var t,r={};if(((i=i||{}).arrays||i.defaults)&&(r.buffers=[],r.keys=[]),i.defaults&&(r.mid="",r.fileVer=0,j.Long?(t=new j.Long(0,0,!0),r.dateVer=i.longs===String?t.toString():i.longs===Number?t.toNumber():t):r.dateVer=i.longs===String?"0":0,r.mname="",r.hashCode="",r.key="",r.fileDate="",r.desc="",r.readOnly=!1),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.fileVer&&e.hasOwnProperty("fileVer")&&(r.fileVer=e.fileVer),null!=e.dateVer&&e.hasOwnProperty("dateVer")&&("number"==typeof e.dateVer?r.dateVer=i.longs===String?String(e.dateVer):e.dateVer:r.dateVer=i.longs===String?j.Long.prototype.toString.call(e.dateVer):i.longs===Number?new j.LongBits(e.dateVer.low>>>0,e.dateVer.high>>>0).toNumber(!0):e.dateVer),null!=e.mname&&e.hasOwnProperty("mname")&&(r.mname=e.mname),null!=e.hashCode&&e.hasOwnProperty("hashCode")&&(r.hashCode=e.hashCode),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.fileDate&&e.hasOwnProperty("fileDate")&&(r.fileDate=e.fileDate),null!=e.desc&&e.hasOwnProperty("desc")&&(r.desc=e.desc),null!=e.readOnly&&e.hasOwnProperty("readOnly")&&(r.readOnly=e.readOnly),e.buffers&&e.buffers.length){r.buffers=[];for(let t=0;t<e.buffers.length;++t)r.buffers[t]=G.protobuf.Map.Buffer.toObject(e.buffers[t],i)}if(e.keys&&e.keys.length){r.keys=[];for(let t=0;t<e.keys.length;++t)r.keys[t]=e.keys[t]}return r},r.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},r.Buffer=(n.prototype.gid=0,n.prototype.fileVer=0,n.prototype.btype=0,n.prototype.len=j.Long?j.Long.fromBits(0,0,!0):0,n.prototype.data=j.newBuffer([]),n.create=function(t){return new n(t)},n.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.gid),e.uint32(16).int32(t.fileVer),e.uint32(24).int32(t.btype),e.uint32(32).uint64(t.len),e.uint32(42).bytes(t.data),e},n.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},n.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Map.Buffer;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.gid=t.int32();break;case 2:r.fileVer=t.int32();break;case 3:r.btype=t.int32();break;case 4:r.len=t.uint64();break;case 5:r.data=t.bytes();break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("gid"))throw j.ProtocolError("missing required 'gid'",{instance:r});if(!r.hasOwnProperty("fileVer"))throw j.ProtocolError("missing required 'fileVer'",{instance:r});if(!r.hasOwnProperty("btype"))throw j.ProtocolError("missing required 'btype'",{instance:r});if(!r.hasOwnProperty("len"))throw j.ProtocolError("missing required 'len'",{instance:r});if(r.hasOwnProperty("data"))return r;throw j.ProtocolError("missing required 'data'",{instance:r})},n.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},n.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.gid)?j.isInteger(t.fileVer)?j.isInteger(t.btype)?j.isInteger(t.len)||t.len&&j.isInteger(t.len.low)&&j.isInteger(t.len.high)?t.data&&"number"==typeof t.data.length||j.isString(t.data)?null:"data: buffer expected":"len: integer|Long expected":"btype: integer expected":"fileVer: integer expected":"gid: integer expected"},n.fromObject=function(t){var e;return t instanceof G.protobuf.Map.Buffer?t:(e=new G.protobuf.Map.Buffer,null!=t.gid&&(e.gid=0|t.gid),null!=t.fileVer&&(e.fileVer=0|t.fileVer),null!=t.btype&&(e.btype=0|t.btype),null!=t.len&&(j.Long?(e.len=j.Long.fromValue(t.len)).unsigned=!0:"string"==typeof t.len?e.len=parseInt(t.len,10):"number"==typeof t.len?e.len=t.len:"object"==typeof t.len&&(e.len=new j.LongBits(t.len.low>>>0,t.len.high>>>0).toNumber(!0))),null!=t.data&&("string"==typeof t.data?j.base64.decode(t.data,e.data=j.newBuffer(j.base64.length(t.data)),0):t.data.length&&(e.data=t.data)),e)},n.toObject=function(t,e){var i,r={};return(e=e||{}).defaults&&(r.gid=0,r.fileVer=0,r.btype=0,j.Long?(i=new j.Long(0,0,!0),r.len=e.longs===String?i.toString():e.longs===Number?i.toNumber():i):r.len=e.longs===String?"0":0,e.bytes===String?r.data="":(r.data=[],e.bytes!==Array&&(r.data=j.newBuffer(r.data)))),null!=t.gid&&t.hasOwnProperty("gid")&&(r.gid=t.gid),null!=t.fileVer&&t.hasOwnProperty("fileVer")&&(r.fileVer=t.fileVer),null!=t.btype&&t.hasOwnProperty("btype")&&(r.btype=t.btype),null!=t.len&&t.hasOwnProperty("len")&&("number"==typeof t.len?r.len=e.longs===String?String(t.len):t.len:r.len=e.longs===String?j.Long.prototype.toString.call(t.len):e.longs===Number?new j.LongBits(t.len.low>>>0,t.len.high>>>0).toNumber(!0):t.len),null!=t.data&&t.hasOwnProperty("data")&&(r.data=e.bytes===String?j.base64.encode(t.data,0,t.data.length):e.bytes===Array?Array.prototype.slice.call(t.data):t.data),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},n),r),i.Scene=(s.prototype.mid="",s.prototype.fileVer=0,s.prototype.dateVer=j.Long?j.Long.fromBits(0,0,!0):0,s.prototype.mname="",s.prototype.hashCode="",s.prototype.key="",s.prototype.desc="",s.prototype.readOnly=!1,s.prototype.x=0,s.prototype.y=0,s.prototype.z=0,s.prototype.minX=0,s.prototype.minY=0,s.prototype.maxX=0,s.prototype.maxY=0,s.prototype.defGid="",s.prototype.defCenX=0,s.prototype.defCenY=0,s.prototype.defCenZ=0,s.prototype.height=0,s.prototype.rotateAngleX=0,s.prototype.rotateAngleY=0,s.prototype.rotateAngleZ=0,s.prototype.scale=0,s.prototype.scaleLevel="",s.prototype.naviType=0,s.prototype.layerGroups=j.emptyArray,s.prototype.buildings=j.emptyArray,s.create=function(t){return new s(t)},s.encode=function(e,i){if(i=i||F.create(),null!=e.x&&Object.hasOwnProperty.call(e,"x")&&i.uint32(13).float(e.x),null!=e.y&&Object.hasOwnProperty.call(e,"y")&&i.uint32(21).float(e.y),null!=e.z&&Object.hasOwnProperty.call(e,"z")&&i.uint32(29).float(e.z),null!=e.minX&&Object.hasOwnProperty.call(e,"minX")&&i.uint32(37).float(e.minX),null!=e.minY&&Object.hasOwnProperty.call(e,"minY")&&i.uint32(45).float(e.minY),null!=e.maxX&&Object.hasOwnProperty.call(e,"maxX")&&i.uint32(53).float(e.maxX),null!=e.maxY&&Object.hasOwnProperty.call(e,"maxY")&&i.uint32(61).float(e.maxY),null!=e.defGid&&Object.hasOwnProperty.call(e,"defGid")&&i.uint32(66).string(e.defGid),null!=e.defCenX&&Object.hasOwnProperty.call(e,"defCenX")&&i.uint32(77).float(e.defCenX),null!=e.defCenY&&Object.hasOwnProperty.call(e,"defCenY")&&i.uint32(85).float(e.defCenY),null!=e.defCenZ&&Object.hasOwnProperty.call(e,"defCenZ")&&i.uint32(93).float(e.defCenZ),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&i.uint32(101).float(e.height),null!=e.rotateAngleX&&Object.hasOwnProperty.call(e,"rotateAngleX")&&i.uint32(109).float(e.rotateAngleX),null!=e.rotateAngleY&&Object.hasOwnProperty.call(e,"rotateAngleY")&&i.uint32(117).float(e.rotateAngleY),null!=e.rotateAngleZ&&Object.hasOwnProperty.call(e,"rotateAngleZ")&&i.uint32(125).float(e.rotateAngleZ),null!=e.scale&&Object.hasOwnProperty.call(e,"scale")&&i.uint32(133).float(e.scale),null!=e.scaleLevel&&Object.hasOwnProperty.call(e,"scaleLevel")&&i.uint32(138).string(e.scaleLevel),null!=e.layerGroups&&e.layerGroups.length)for(let t=0;t<e.layerGroups.length;++t)G.protobuf.Scene.LayerGroup.encode(e.layerGroups[t],i.uint32(146).fork()).ldelim();if(i.uint32(154).string(e.mid),i.uint32(160).int32(e.fileVer),i.uint32(168).uint64(e.dateVer),i.uint32(178).string(e.mname),i.uint32(186).string(e.hashCode),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&i.uint32(194).string(e.key),null!=e.desc&&Object.hasOwnProperty.call(e,"desc")&&i.uint32(202).string(e.desc),null!=e.readOnly&&Object.hasOwnProperty.call(e,"readOnly")&&i.uint32(208).bool(e.readOnly),null!=e.buildings&&e.buildings.length)for(let t=0;t<e.buildings.length;++t)G.protobuf.Scene.Building.encode(e.buildings[t],i.uint32(218).fork()).ldelim();return null!=e.naviType&&Object.hasOwnProperty.call(e,"naviType")&&i.uint32(224).int32(e.naviType),i},s.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},s.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene;t.pos<i;){var n=t.uint32();switch(n>>>3){case 19:r.mid=t.string();break;case 20:r.fileVer=t.int32();break;case 21:r.dateVer=t.uint64();break;case 22:r.mname=t.string();break;case 23:r.hashCode=t.string();break;case 24:r.key=t.string();break;case 25:r.desc=t.string();break;case 26:r.readOnly=t.bool();break;case 1:r.x=t.float();break;case 2:r.y=t.float();break;case 3:r.z=t.float();break;case 4:r.minX=t.float();break;case 5:r.minY=t.float();break;case 6:r.maxX=t.float();break;case 7:r.maxY=t.float();break;case 8:r.defGid=t.string();break;case 9:r.defCenX=t.float();break;case 10:r.defCenY=t.float();break;case 11:r.defCenZ=t.float();break;case 12:r.height=t.float();break;case 13:r.rotateAngleX=t.float();break;case 14:r.rotateAngleY=t.float();break;case 15:r.rotateAngleZ=t.float();break;case 16:r.scale=t.float();break;case 17:r.scaleLevel=t.string();break;case 28:r.naviType=t.int32();break;case 18:r.layerGroups&&r.layerGroups.length||(r.layerGroups=[]),r.layerGroups.push(G.protobuf.Scene.LayerGroup.decode(t,t.uint32()));break;case 27:r.buildings&&r.buildings.length||(r.buildings=[]),r.buildings.push(G.protobuf.Scene.Building.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("mid"))throw j.ProtocolError("missing required 'mid'",{instance:r});if(!r.hasOwnProperty("fileVer"))throw j.ProtocolError("missing required 'fileVer'",{instance:r});if(!r.hasOwnProperty("dateVer"))throw j.ProtocolError("missing required 'dateVer'",{instance:r});if(!r.hasOwnProperty("mname"))throw j.ProtocolError("missing required 'mname'",{instance:r});if(r.hasOwnProperty("hashCode"))return r;throw j.ProtocolError("missing required 'hashCode'",{instance:r})},s.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},s.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(!j.isInteger(e.fileVer))return"fileVer: integer expected";if(!(j.isInteger(e.dateVer)||e.dateVer&&j.isInteger(e.dateVer.low)&&j.isInteger(e.dateVer.high)))return"dateVer: integer|Long expected";if(!j.isString(e.mname))return"mname: string expected";if(!j.isString(e.hashCode))return"hashCode: string expected";if(null!=e.key&&e.hasOwnProperty("key")&&!j.isString(e.key))return"key: string expected";if(null!=e.desc&&e.hasOwnProperty("desc")&&!j.isString(e.desc))return"desc: string expected";if(null!=e.readOnly&&e.hasOwnProperty("readOnly")&&"boolean"!=typeof e.readOnly)return"readOnly: boolean expected";if(null!=e.x&&e.hasOwnProperty("x")&&"number"!=typeof e.x)return"x: number expected";if(null!=e.y&&e.hasOwnProperty("y")&&"number"!=typeof e.y)return"y: number expected";if(null!=e.z&&e.hasOwnProperty("z")&&"number"!=typeof e.z)return"z: number expected";if(null!=e.minX&&e.hasOwnProperty("minX")&&"number"!=typeof e.minX)return"minX: number expected";if(null!=e.minY&&e.hasOwnProperty("minY")&&"number"!=typeof e.minY)return"minY: number expected";if(null!=e.maxX&&e.hasOwnProperty("maxX")&&"number"!=typeof e.maxX)return"maxX: number expected";if(null!=e.maxY&&e.hasOwnProperty("maxY")&&"number"!=typeof e.maxY)return"maxY: number expected";if(null!=e.defGid&&e.hasOwnProperty("defGid")&&!j.isString(e.defGid))return"defGid: string expected";if(null!=e.defCenX&&e.hasOwnProperty("defCenX")&&"number"!=typeof e.defCenX)return"defCenX: number expected";if(null!=e.defCenY&&e.hasOwnProperty("defCenY")&&"number"!=typeof e.defCenY)return"defCenY: number expected";if(null!=e.defCenZ&&e.hasOwnProperty("defCenZ")&&"number"!=typeof e.defCenZ)return"defCenZ: number expected";if(null!=e.height&&e.hasOwnProperty("height")&&"number"!=typeof e.height)return"height: number expected";if(null!=e.rotateAngleX&&e.hasOwnProperty("rotateAngleX")&&"number"!=typeof e.rotateAngleX)return"rotateAngleX: number expected";if(null!=e.rotateAngleY&&e.hasOwnProperty("rotateAngleY")&&"number"!=typeof e.rotateAngleY)return"rotateAngleY: number expected";if(null!=e.rotateAngleZ&&e.hasOwnProperty("rotateAngleZ")&&"number"!=typeof e.rotateAngleZ)return"rotateAngleZ: number expected";if(null!=e.scale&&e.hasOwnProperty("scale")&&"number"!=typeof e.scale)return"scale: number expected";if(null!=e.scaleLevel&&e.hasOwnProperty("scaleLevel")&&!j.isString(e.scaleLevel))return"scaleLevel: string expected";if(null!=e.naviType&&e.hasOwnProperty("naviType")&&!j.isInteger(e.naviType))return"naviType: integer expected";if(null!=e.layerGroups&&e.hasOwnProperty("layerGroups")){if(!Array.isArray(e.layerGroups))return"layerGroups: array expected";for(let t=0;t<e.layerGroups.length;++t){var i=G.protobuf.Scene.LayerGroup.verify(e.layerGroups[t]);if(i)return"layerGroups."+i}}if(null!=e.buildings&&e.hasOwnProperty("buildings")){if(!Array.isArray(e.buildings))return"buildings: array expected";for(let t=0;t<e.buildings.length;++t){var r=G.protobuf.Scene.Building.verify(e.buildings[t]);if(r)return"buildings."+r}}return null},s.fromObject=function(e){if(e instanceof G.protobuf.Scene)return e;var i=new G.protobuf.Scene;if(null!=e.mid&&(i.mid=String(e.mid)),null!=e.fileVer&&(i.fileVer=0|e.fileVer),null!=e.dateVer&&(j.Long?(i.dateVer=j.Long.fromValue(e.dateVer)).unsigned=!0:"string"==typeof e.dateVer?i.dateVer=parseInt(e.dateVer,10):"number"==typeof e.dateVer?i.dateVer=e.dateVer:"object"==typeof e.dateVer&&(i.dateVer=new j.LongBits(e.dateVer.low>>>0,e.dateVer.high>>>0).toNumber(!0))),null!=e.mname&&(i.mname=String(e.mname)),null!=e.hashCode&&(i.hashCode=String(e.hashCode)),null!=e.key&&(i.key=String(e.key)),null!=e.desc&&(i.desc=String(e.desc)),null!=e.readOnly&&(i.readOnly=Boolean(e.readOnly)),null!=e.x&&(i.x=Number(e.x)),null!=e.y&&(i.y=Number(e.y)),null!=e.z&&(i.z=Number(e.z)),null!=e.minX&&(i.minX=Number(e.minX)),null!=e.minY&&(i.minY=Number(e.minY)),null!=e.maxX&&(i.maxX=Number(e.maxX)),null!=e.maxY&&(i.maxY=Number(e.maxY)),null!=e.defGid&&(i.defGid=String(e.defGid)),null!=e.defCenX&&(i.defCenX=Number(e.defCenX)),null!=e.defCenY&&(i.defCenY=Number(e.defCenY)),null!=e.defCenZ&&(i.defCenZ=Number(e.defCenZ)),null!=e.height&&(i.height=Number(e.height)),null!=e.rotateAngleX&&(i.rotateAngleX=Number(e.rotateAngleX)),null!=e.rotateAngleY&&(i.rotateAngleY=Number(e.rotateAngleY)),null!=e.rotateAngleZ&&(i.rotateAngleZ=Number(e.rotateAngleZ)),null!=e.scale&&(i.scale=Number(e.scale)),null!=e.scaleLevel&&(i.scaleLevel=String(e.scaleLevel)),null!=e.naviType&&(i.naviType=0|e.naviType),e.layerGroups){if(!Array.isArray(e.layerGroups))throw TypeError(".protobuf.Scene.layerGroups: array expected");i.layerGroups=[];for(let t=0;t<e.layerGroups.length;++t){if("object"!=typeof e.layerGroups[t])throw TypeError(".protobuf.Scene.layerGroups: object expected");i.layerGroups[t]=G.protobuf.Scene.LayerGroup.fromObject(e.layerGroups[t])}}if(e.buildings){if(!Array.isArray(e.buildings))throw TypeError(".protobuf.Scene.buildings: array expected");i.buildings=[];for(let t=0;t<e.buildings.length;++t){if("object"!=typeof e.buildings[t])throw TypeError(".protobuf.Scene.buildings: object expected");i.buildings[t]=G.protobuf.Scene.Building.fromObject(e.buildings[t])}}return i},s.toObject=function(e,i){var t,r={};if(((i=i||{}).arrays||i.defaults)&&(r.layerGroups=[],r.buildings=[]),i.defaults&&(r.x=0,r.y=0,r.z=0,r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r.defGid="",r.defCenX=0,r.defCenY=0,r.defCenZ=0,r.height=0,r.rotateAngleX=0,r.rotateAngleY=0,r.rotateAngleZ=0,r.scale=0,r.scaleLevel="",r.mid="",r.fileVer=0,j.Long?(t=new j.Long(0,0,!0),r.dateVer=i.longs===String?t.toString():i.longs===Number?t.toNumber():t):r.dateVer=i.longs===String?"0":0,r.mname="",r.hashCode="",r.key="",r.desc="",r.readOnly=!1,r.naviType=0),null!=e.x&&e.hasOwnProperty("x")&&(r.x=i.json&&!isFinite(e.x)?String(e.x):e.x),null!=e.y&&e.hasOwnProperty("y")&&(r.y=i.json&&!isFinite(e.y)?String(e.y):e.y),null!=e.z&&e.hasOwnProperty("z")&&(r.z=i.json&&!isFinite(e.z)?String(e.z):e.z),null!=e.minX&&e.hasOwnProperty("minX")&&(r.minX=i.json&&!isFinite(e.minX)?String(e.minX):e.minX),null!=e.minY&&e.hasOwnProperty("minY")&&(r.minY=i.json&&!isFinite(e.minY)?String(e.minY):e.minY),null!=e.maxX&&e.hasOwnProperty("maxX")&&(r.maxX=i.json&&!isFinite(e.maxX)?String(e.maxX):e.maxX),null!=e.maxY&&e.hasOwnProperty("maxY")&&(r.maxY=i.json&&!isFinite(e.maxY)?String(e.maxY):e.maxY),null!=e.defGid&&e.hasOwnProperty("defGid")&&(r.defGid=e.defGid),null!=e.defCenX&&e.hasOwnProperty("defCenX")&&(r.defCenX=i.json&&!isFinite(e.defCenX)?String(e.defCenX):e.defCenX),null!=e.defCenY&&e.hasOwnProperty("defCenY")&&(r.defCenY=i.json&&!isFinite(e.defCenY)?String(e.defCenY):e.defCenY),null!=e.defCenZ&&e.hasOwnProperty("defCenZ")&&(r.defCenZ=i.json&&!isFinite(e.defCenZ)?String(e.defCenZ):e.defCenZ),null!=e.height&&e.hasOwnProperty("height")&&(r.height=i.json&&!isFinite(e.height)?String(e.height):e.height),null!=e.rotateAngleX&&e.hasOwnProperty("rotateAngleX")&&(r.rotateAngleX=i.json&&!isFinite(e.rotateAngleX)?String(e.rotateAngleX):e.rotateAngleX),null!=e.rotateAngleY&&e.hasOwnProperty("rotateAngleY")&&(r.rotateAngleY=i.json&&!isFinite(e.rotateAngleY)?String(e.rotateAngleY):e.rotateAngleY),null!=e.rotateAngleZ&&e.hasOwnProperty("rotateAngleZ")&&(r.rotateAngleZ=i.json&&!isFinite(e.rotateAngleZ)?String(e.rotateAngleZ):e.rotateAngleZ),null!=e.scale&&e.hasOwnProperty("scale")&&(r.scale=i.json&&!isFinite(e.scale)?String(e.scale):e.scale),null!=e.scaleLevel&&e.hasOwnProperty("scaleLevel")&&(r.scaleLevel=e.scaleLevel),e.layerGroups&&e.layerGroups.length){r.layerGroups=[];for(let t=0;t<e.layerGroups.length;++t)r.layerGroups[t]=G.protobuf.Scene.LayerGroup.toObject(e.layerGroups[t],i)}if(null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.fileVer&&e.hasOwnProperty("fileVer")&&(r.fileVer=e.fileVer),null!=e.dateVer&&e.hasOwnProperty("dateVer")&&("number"==typeof e.dateVer?r.dateVer=i.longs===String?String(e.dateVer):e.dateVer:r.dateVer=i.longs===String?j.Long.prototype.toString.call(e.dateVer):i.longs===Number?new j.LongBits(e.dateVer.low>>>0,e.dateVer.high>>>0).toNumber(!0):e.dateVer),null!=e.mname&&e.hasOwnProperty("mname")&&(r.mname=e.mname),null!=e.hashCode&&e.hasOwnProperty("hashCode")&&(r.hashCode=e.hashCode),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.desc&&e.hasOwnProperty("desc")&&(r.desc=e.desc),null!=e.readOnly&&e.hasOwnProperty("readOnly")&&(r.readOnly=e.readOnly),e.buildings&&e.buildings.length){r.buildings=[];for(let t=0;t<e.buildings.length;++t)r.buildings[t]=G.protobuf.Scene.Building.toObject(e.buildings[t],i)}return null!=e.naviType&&e.hasOwnProperty("naviType")&&(r.naviType=e.naviType),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},s.Layer=(o.prototype.lid=0,o.prototype.lname="",o.prototype.alias="",o.prototype.ltype=1,o.prototype.offsetX=0,o.prototype.offsetY=0,o.prototype.height=0,o.prototype.rotateAngleX=0,o.prototype.rotateAngleY=0,o.prototype.rotateAngleZ=0,o.prototype.minScaleLevel=0,o.prototype.maxScaleLevel=0,o.prototype.isVisible=!1,o.prototype.isSelectable=!1,o.prototype.isEditable=!1,o.prototype.desc="",o.create=function(t){return new o(t)},o.encode=function(t,e){return e=e||F.create(),null!=t.lid&&Object.hasOwnProperty.call(t,"lid")&&e.uint32(8).int32(t.lid),null!=t.lname&&Object.hasOwnProperty.call(t,"lname")&&e.uint32(18).string(t.lname),null!=t.alias&&Object.hasOwnProperty.call(t,"alias")&&e.uint32(26).string(t.alias),null!=t.ltype&&Object.hasOwnProperty.call(t,"ltype")&&e.uint32(32).int32(t.ltype),null!=t.offsetX&&Object.hasOwnProperty.call(t,"offsetX")&&e.uint32(45).float(t.offsetX),null!=t.offsetY&&Object.hasOwnProperty.call(t,"offsetY")&&e.uint32(53).float(t.offsetY),null!=t.height&&Object.hasOwnProperty.call(t,"height")&&e.uint32(61).float(t.height),null!=t.rotateAngleX&&Object.hasOwnProperty.call(t,"rotateAngleX")&&e.uint32(69).float(t.rotateAngleX),null!=t.rotateAngleY&&Object.hasOwnProperty.call(t,"rotateAngleY")&&e.uint32(77).float(t.rotateAngleY),null!=t.rotateAngleZ&&Object.hasOwnProperty.call(t,"rotateAngleZ")&&e.uint32(85).float(t.rotateAngleZ),null!=t.minScaleLevel&&Object.hasOwnProperty.call(t,"minScaleLevel")&&e.uint32(93).float(t.minScaleLevel),null!=t.maxScaleLevel&&Object.hasOwnProperty.call(t,"maxScaleLevel")&&e.uint32(101).float(t.maxScaleLevel),null!=t.isVisible&&Object.hasOwnProperty.call(t,"isVisible")&&e.uint32(104).bool(t.isVisible),null!=t.isSelectable&&Object.hasOwnProperty.call(t,"isSelectable")&&e.uint32(112).bool(t.isSelectable),null!=t.isEditable&&Object.hasOwnProperty.call(t,"isEditable")&&e.uint32(120).bool(t.isEditable),null!=t.desc&&Object.hasOwnProperty.call(t,"desc")&&e.uint32(130).string(t.desc),e},o.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},o.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene.Layer;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.lid=t.int32();break;case 2:r.lname=t.string();break;case 3:r.alias=t.string();break;case 4:r.ltype=t.int32();break;case 5:r.offsetX=t.float();break;case 6:r.offsetY=t.float();break;case 7:r.height=t.float();break;case 8:r.rotateAngleX=t.float();break;case 9:r.rotateAngleY=t.float();break;case 10:r.rotateAngleZ=t.float();break;case 11:r.minScaleLevel=t.float();break;case 12:r.maxScaleLevel=t.float();break;case 13:r.isVisible=t.bool();break;case 14:r.isSelectable=t.bool();break;case 15:r.isEditable=t.bool();break;case 16:r.desc=t.string();break;default:t.skipType(7&n)}}return r},o.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},o.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.lid&&t.hasOwnProperty("lid")&&!j.isInteger(t.lid))return"lid: integer expected";if(null!=t.lname&&t.hasOwnProperty("lname")&&!j.isString(t.lname))return"lname: string expected";if(null!=t.alias&&t.hasOwnProperty("alias")&&!j.isString(t.alias))return"alias: string expected";if(null!=t.ltype&&t.hasOwnProperty("ltype"))switch(t.ltype){default:return"ltype: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 20:case 21:case 22:case 30:case 31:case 32:case 33:case 40:case 50:}return null!=t.offsetX&&t.hasOwnProperty("offsetX")&&"number"!=typeof t.offsetX?"offsetX: number expected":null!=t.offsetY&&t.hasOwnProperty("offsetY")&&"number"!=typeof t.offsetY?"offsetY: number expected":null!=t.height&&t.hasOwnProperty("height")&&"number"!=typeof t.height?"height: number expected":null!=t.rotateAngleX&&t.hasOwnProperty("rotateAngleX")&&"number"!=typeof t.rotateAngleX?"rotateAngleX: number expected":null!=t.rotateAngleY&&t.hasOwnProperty("rotateAngleY")&&"number"!=typeof t.rotateAngleY?"rotateAngleY: number expected":null!=t.rotateAngleZ&&t.hasOwnProperty("rotateAngleZ")&&"number"!=typeof t.rotateAngleZ?"rotateAngleZ: number expected":null!=t.minScaleLevel&&t.hasOwnProperty("minScaleLevel")&&"number"!=typeof t.minScaleLevel?"minScaleLevel: number expected":null!=t.maxScaleLevel&&t.hasOwnProperty("maxScaleLevel")&&"number"!=typeof t.maxScaleLevel?"maxScaleLevel: number expected":null!=t.isVisible&&t.hasOwnProperty("isVisible")&&"boolean"!=typeof t.isVisible?"isVisible: boolean expected":null!=t.isSelectable&&t.hasOwnProperty("isSelectable")&&"boolean"!=typeof t.isSelectable?"isSelectable: boolean expected":null!=t.isEditable&&t.hasOwnProperty("isEditable")&&"boolean"!=typeof t.isEditable?"isEditable: boolean expected":null!=t.desc&&t.hasOwnProperty("desc")&&!j.isString(t.desc)?"desc: string expected":null},o.fromObject=function(t){if(t instanceof G.protobuf.Scene.Layer)return t;var e=new G.protobuf.Scene.Layer;switch(null!=t.lid&&(e.lid=0|t.lid),null!=t.lname&&(e.lname=String(t.lname)),null!=t.alias&&(e.alias=String(t.alias)),t.ltype){case"GEOPOINT":case 1:e.ltype=1;break;case"GEOPOINT_ESCALATOR":case 2:e.ltype=2;break;case"GEOPOINT_LIFT":case 3:e.ltype=3;break;case"GEOPOINT_STAIR":case 4:e.ltype=4;break;case"GEOPOINT_PANORAMA":case 5:e.ltype=5;break;case"GEOPOINT_POI":case 6:e.ltype=6;break;case"GEOPOINT_STORELABEL":case 7:e.ltype=7;break;case"GEOPOINT_NAVINODE":case 8:e.ltype=8;break;case"GEOPOINT_MODEL":case 9:e.ltype=9;break;case"GEOLINE":case 20:e.ltype=20;break;case"GEOLINE_NAVISEGMENT":case 21:e.ltype=21;break;case"GEOLINE_BORDER":case 22:e.ltype=22;break;case"GEOPOLYGON":case 30:e.ltype=30;break;case"GEOPOLYGON_EXTENT":case 31:e.ltype=31;break;case"GEOPOLYGON_STORE":case 32:e.ltype=32;break;case"GEOPOLYGON_LABEL":case 33:e.ltype=33;break;case"RASTERATA":case 40:e.ltype=40;break;case"OVERLAYDATA":case 50:e.ltype=50}return null!=t.offsetX&&(e.offsetX=Number(t.offsetX)),null!=t.offsetY&&(e.offsetY=Number(t.offsetY)),null!=t.height&&(e.height=Number(t.height)),null!=t.rotateAngleX&&(e.rotateAngleX=Number(t.rotateAngleX)),null!=t.rotateAngleY&&(e.rotateAngleY=Number(t.rotateAngleY)),null!=t.rotateAngleZ&&(e.rotateAngleZ=Number(t.rotateAngleZ)),null!=t.minScaleLevel&&(e.minScaleLevel=Number(t.minScaleLevel)),null!=t.maxScaleLevel&&(e.maxScaleLevel=Number(t.maxScaleLevel)),null!=t.isVisible&&(e.isVisible=Boolean(t.isVisible)),null!=t.isSelectable&&(e.isSelectable=Boolean(t.isSelectable)),null!=t.isEditable&&(e.isEditable=Boolean(t.isEditable)),null!=t.desc&&(e.desc=String(t.desc)),e},o.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.lid=0,i.lname="",i.alias="",i.ltype=e.enums===String?"GEOPOINT":1,i.offsetX=0,i.offsetY=0,i.height=0,i.rotateAngleX=0,i.rotateAngleY=0,i.rotateAngleZ=0,i.minScaleLevel=0,i.maxScaleLevel=0,i.isVisible=!1,i.isSelectable=!1,i.isEditable=!1,i.desc=""),null!=t.lid&&t.hasOwnProperty("lid")&&(i.lid=t.lid),null!=t.lname&&t.hasOwnProperty("lname")&&(i.lname=t.lname),null!=t.alias&&t.hasOwnProperty("alias")&&(i.alias=t.alias),null!=t.ltype&&t.hasOwnProperty("ltype")&&(i.ltype=e.enums===String?G.protobuf.Scene.Layer.Type[t.ltype]:t.ltype),null!=t.offsetX&&t.hasOwnProperty("offsetX")&&(i.offsetX=e.json&&!isFinite(t.offsetX)?String(t.offsetX):t.offsetX),null!=t.offsetY&&t.hasOwnProperty("offsetY")&&(i.offsetY=e.json&&!isFinite(t.offsetY)?String(t.offsetY):t.offsetY),null!=t.height&&t.hasOwnProperty("height")&&(i.height=e.json&&!isFinite(t.height)?String(t.height):t.height),null!=t.rotateAngleX&&t.hasOwnProperty("rotateAngleX")&&(i.rotateAngleX=e.json&&!isFinite(t.rotateAngleX)?String(t.rotateAngleX):t.rotateAngleX),null!=t.rotateAngleY&&t.hasOwnProperty("rotateAngleY")&&(i.rotateAngleY=e.json&&!isFinite(t.rotateAngleY)?String(t.rotateAngleY):t.rotateAngleY),null!=t.rotateAngleZ&&t.hasOwnProperty("rotateAngleZ")&&(i.rotateAngleZ=e.json&&!isFinite(t.rotateAngleZ)?String(t.rotateAngleZ):t.rotateAngleZ),null!=t.minScaleLevel&&t.hasOwnProperty("minScaleLevel")&&(i.minScaleLevel=e.json&&!isFinite(t.minScaleLevel)?String(t.minScaleLevel):t.minScaleLevel),null!=t.maxScaleLevel&&t.hasOwnProperty("maxScaleLevel")&&(i.maxScaleLevel=e.json&&!isFinite(t.maxScaleLevel)?String(t.maxScaleLevel):t.maxScaleLevel),null!=t.isVisible&&t.hasOwnProperty("isVisible")&&(i.isVisible=t.isVisible),null!=t.isSelectable&&t.hasOwnProperty("isSelectable")&&(i.isSelectable=t.isSelectable),null!=t.isEditable&&t.hasOwnProperty("isEditable")&&(i.isEditable=t.isEditable),null!=t.desc&&t.hasOwnProperty("desc")&&(i.desc=t.desc),i},o.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},o.Type=(t={},(e=Object.create(t))[t[1]="GEOPOINT"]=1,e[t[2]="GEOPOINT_ESCALATOR"]=2,e[t[3]="GEOPOINT_LIFT"]=3,e[t[4]="GEOPOINT_STAIR"]=4,e[t[5]="GEOPOINT_PANORAMA"]=5,e[t[6]="GEOPOINT_POI"]=6,e[t[7]="GEOPOINT_STORELABEL"]=7,e[t[8]="GEOPOINT_NAVINODE"]=8,e[t[9]="GEOPOINT_MODEL"]=9,e[t[20]="GEOLINE"]=20,e[t[21]="GEOLINE_NAVISEGMENT"]=21,e[t[22]="GEOLINE_BORDER"]=22,e[t[30]="GEOPOLYGON"]=30,e[t[31]="GEOPOLYGON_EXTENT"]=31,e[t[32]="GEOPOLYGON_STORE"]=32,e[t[33]="GEOPOLYGON_LABEL"]=33,e[t[40]="RASTERATA"]=40,e[t[50]="OVERLAYDATA"]=50,e),o),s.LayerGroup=(a.prototype.gid=0,a.prototype.gname="",a.prototype.alias="",a.prototype.height=0,a.prototype.desc="",a.prototype.layers=j.emptyArray,a.prototype.floorId="",a.prototype.naviType=0,a.create=function(t){return new a(t)},a.encode=function(e,i){if(i=i||F.create(),null!=e.gid&&Object.hasOwnProperty.call(e,"gid")&&i.uint32(8).int32(e.gid),null!=e.gname&&Object.hasOwnProperty.call(e,"gname")&&i.uint32(18).string(e.gname),null!=e.alias&&Object.hasOwnProperty.call(e,"alias")&&i.uint32(26).string(e.alias),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&i.uint32(37).float(e.height),null!=e.desc&&Object.hasOwnProperty.call(e,"desc")&&i.uint32(42).string(e.desc),null!=e.layers&&e.layers.length)for(let t=0;t<e.layers.length;++t)G.protobuf.Scene.Layer.encode(e.layers[t],i.uint32(50).fork()).ldelim();return null!=e.floorId&&Object.hasOwnProperty.call(e,"floorId")&&i.uint32(58).string(e.floorId),null!=e.naviType&&Object.hasOwnProperty.call(e,"naviType")&&i.uint32(64).int32(e.naviType),i},a.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},a.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene.LayerGroup;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.gid=t.int32();break;case 2:r.gname=t.string();break;case 3:r.alias=t.string();break;case 4:r.height=t.float();break;case 5:r.desc=t.string();break;case 6:r.layers&&r.layers.length||(r.layers=[]),r.layers.push(G.protobuf.Scene.Layer.decode(t,t.uint32()));break;case 7:r.floorId=t.string();break;case 8:r.naviType=t.int32();break;default:t.skipType(7&n)}}return r},a.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},a.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.gid&&e.hasOwnProperty("gid")&&!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.gname&&e.hasOwnProperty("gname")&&!j.isString(e.gname))return"gname: string expected";if(null!=e.alias&&e.hasOwnProperty("alias")&&!j.isString(e.alias))return"alias: string expected";if(null!=e.height&&e.hasOwnProperty("height")&&"number"!=typeof e.height)return"height: number expected";if(null!=e.desc&&e.hasOwnProperty("desc")&&!j.isString(e.desc))return"desc: string expected";if(null!=e.layers&&e.hasOwnProperty("layers")){if(!Array.isArray(e.layers))return"layers: array expected";for(let t=0;t<e.layers.length;++t){var i=G.protobuf.Scene.Layer.verify(e.layers[t]);if(i)return"layers."+i}}return null!=e.floorId&&e.hasOwnProperty("floorId")&&!j.isString(e.floorId)?"floorId: string expected":null!=e.naviType&&e.hasOwnProperty("naviType")&&!j.isInteger(e.naviType)?"naviType: integer expected":null},a.fromObject=function(e){if(e instanceof G.protobuf.Scene.LayerGroup)return e;var i=new G.protobuf.Scene.LayerGroup;if(null!=e.gid&&(i.gid=0|e.gid),null!=e.gname&&(i.gname=String(e.gname)),null!=e.alias&&(i.alias=String(e.alias)),null!=e.height&&(i.height=Number(e.height)),null!=e.desc&&(i.desc=String(e.desc)),e.layers){if(!Array.isArray(e.layers))throw TypeError(".protobuf.Scene.LayerGroup.layers: array expected");i.layers=[];for(let t=0;t<e.layers.length;++t){if("object"!=typeof e.layers[t])throw TypeError(".protobuf.Scene.LayerGroup.layers: object expected");i.layers[t]=G.protobuf.Scene.Layer.fromObject(e.layers[t])}}return null!=e.floorId&&(i.floorId=String(e.floorId)),null!=e.naviType&&(i.naviType=0|e.naviType),i},a.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.layers=[]),i.defaults&&(r.gid=0,r.gname="",r.alias="",r.height=0,r.desc="",r.floorId="",r.naviType=0),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),null!=e.gname&&e.hasOwnProperty("gname")&&(r.gname=e.gname),null!=e.alias&&e.hasOwnProperty("alias")&&(r.alias=e.alias),null!=e.height&&e.hasOwnProperty("height")&&(r.height=i.json&&!isFinite(e.height)?String(e.height):e.height),null!=e.desc&&e.hasOwnProperty("desc")&&(r.desc=e.desc),e.layers&&e.layers.length){r.layers=[];for(let t=0;t<e.layers.length;++t)r.layers[t]=G.protobuf.Scene.Layer.toObject(e.layers[t],i)}return null!=e.floorId&&e.hasOwnProperty("floorId")&&(r.floorId=e.floorId),null!=e.naviType&&e.hasOwnProperty("naviType")&&(r.naviType=e.naviType),r},a.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},a),s.Floor=(h.prototype.gid=0,h.prototype.x=0,h.prototype.y=0,h.prototype.offsetX=0,h.prototype.offsetY=0,h.prototype.angle=0,h.prototype.scale=0,h.prototype.fids=j.emptyArray,h.prototype.pgid=0,h.prototype.baseLevel=!1,h.prototype.minlevel=0,h.prototype.maxlevel=0,h.prototype.floorId="",h.prototype.idxs=j.emptyArray,h.prototype.pts=j.emptyArray,h.create=function(t){return new h(t)},h.encode=function(e,i){if(i=i||F.create(),null!=e.gid&&Object.hasOwnProperty.call(e,"gid")&&i.uint32(8).int32(e.gid),null!=e.x&&Object.hasOwnProperty.call(e,"x")&&i.uint32(21).float(e.x),null!=e.y&&Object.hasOwnProperty.call(e,"y")&&i.uint32(29).float(e.y),null!=e.offsetX&&Object.hasOwnProperty.call(e,"offsetX")&&i.uint32(37).float(e.offsetX),null!=e.offsetY&&Object.hasOwnProperty.call(e,"offsetY")&&i.uint32(45).float(e.offsetY),null!=e.angle&&Object.hasOwnProperty.call(e,"angle")&&i.uint32(53).float(e.angle),null!=e.scale&&Object.hasOwnProperty.call(e,"scale")&&i.uint32(61).float(e.scale),null!=e.fids&&e.fids.length)for(let t=0;t<e.fids.length;++t)i.uint32(66).string(e.fids[t]);if(null!=e.pgid&&Object.hasOwnProperty.call(e,"pgid")&&i.uint32(72).int32(e.pgid),null!=e.baseLevel&&Object.hasOwnProperty.call(e,"baseLevel")&&i.uint32(80).bool(e.baseLevel),null!=e.minlevel&&Object.hasOwnProperty.call(e,"minlevel")&&i.uint32(88).int32(e.minlevel),null!=e.maxlevel&&Object.hasOwnProperty.call(e,"maxlevel")&&i.uint32(96).int32(e.maxlevel),null!=e.floorId&&Object.hasOwnProperty.call(e,"floorId")&&i.uint32(106).string(e.floorId),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)G.protobuf.Scene.Floor.IndexInfo.encode(e.idxs[t],i.uint32(114).fork()).ldelim();if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(121).double(e.pts[t]);return i},h.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},h.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene.Floor;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.gid=t.int32();break;case 2:r.x=t.float();break;case 3:r.y=t.float();break;case 4:r.offsetX=t.float();break;case 5:r.offsetY=t.float();break;case 6:r.angle=t.float();break;case 7:r.scale=t.float();break;case 8:r.fids&&r.fids.length||(r.fids=[]),r.fids.push(t.string());break;case 9:r.pgid=t.int32();break;case 10:r.baseLevel=t.bool();break;case 11:r.minlevel=t.int32();break;case 12:r.maxlevel=t.int32();break;case 13:r.floorId=t.string();break;case 14:r.idxs&&r.idxs.length||(r.idxs=[]),r.idxs.push(G.protobuf.Scene.Floor.IndexInfo.decode(t,t.uint32()));break;case 15:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.pts.push(t.double());else r.pts.push(t.double());break;default:t.skipType(7&n)}}return r},h.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},h.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.gid&&e.hasOwnProperty("gid")&&!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.x&&e.hasOwnProperty("x")&&"number"!=typeof e.x)return"x: number expected";if(null!=e.y&&e.hasOwnProperty("y")&&"number"!=typeof e.y)return"y: number expected";if(null!=e.offsetX&&e.hasOwnProperty("offsetX")&&"number"!=typeof e.offsetX)return"offsetX: number expected";if(null!=e.offsetY&&e.hasOwnProperty("offsetY")&&"number"!=typeof e.offsetY)return"offsetY: number expected";if(null!=e.angle&&e.hasOwnProperty("angle")&&"number"!=typeof e.angle)return"angle: number expected";if(null!=e.scale&&e.hasOwnProperty("scale")&&"number"!=typeof e.scale)return"scale: number expected";if(null!=e.fids&&e.hasOwnProperty("fids")){if(!Array.isArray(e.fids))return"fids: array expected";for(let t=0;t<e.fids.length;++t)if(!j.isString(e.fids[t]))return"fids: string[] expected"}if(null!=e.pgid&&e.hasOwnProperty("pgid")&&!j.isInteger(e.pgid))return"pgid: integer expected";if(null!=e.baseLevel&&e.hasOwnProperty("baseLevel")&&"boolean"!=typeof e.baseLevel)return"baseLevel: boolean expected";if(null!=e.minlevel&&e.hasOwnProperty("minlevel")&&!j.isInteger(e.minlevel))return"minlevel: integer expected";if(null!=e.maxlevel&&e.hasOwnProperty("maxlevel")&&!j.isInteger(e.maxlevel))return"maxlevel: integer expected";if(null!=e.floorId&&e.hasOwnProperty("floorId")&&!j.isString(e.floorId))return"floorId: string expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t){var i=G.protobuf.Scene.Floor.IndexInfo.verify(e.idxs[t]);if(i)return"idxs."+i}}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}return null},h.fromObject=function(e){if(e instanceof G.protobuf.Scene.Floor)return e;var i=new G.protobuf.Scene.Floor;if(null!=e.gid&&(i.gid=0|e.gid),null!=e.x&&(i.x=Number(e.x)),null!=e.y&&(i.y=Number(e.y)),null!=e.offsetX&&(i.offsetX=Number(e.offsetX)),null!=e.offsetY&&(i.offsetY=Number(e.offsetY)),null!=e.angle&&(i.angle=Number(e.angle)),null!=e.scale&&(i.scale=Number(e.scale)),e.fids){if(!Array.isArray(e.fids))throw TypeError(".protobuf.Scene.Floor.fids: array expected");i.fids=[];for(let t=0;t<e.fids.length;++t)i.fids[t]=String(e.fids[t])}if(null!=e.pgid&&(i.pgid=0|e.pgid),null!=e.baseLevel&&(i.baseLevel=Boolean(e.baseLevel)),null!=e.minlevel&&(i.minlevel=0|e.minlevel),null!=e.maxlevel&&(i.maxlevel=0|e.maxlevel),null!=e.floorId&&(i.floorId=String(e.floorId)),e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.Scene.Floor.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t){if("object"!=typeof e.idxs[t])throw TypeError(".protobuf.Scene.Floor.idxs: object expected");i.idxs[t]=G.protobuf.Scene.Floor.IndexInfo.fromObject(e.idxs[t])}}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.Scene.Floor.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}return i},h.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.fids=[],r.idxs=[],r.pts=[]),i.defaults&&(r.gid=0,r.x=0,r.y=0,r.offsetX=0,r.offsetY=0,r.angle=0,r.scale=0,r.pgid=0,r.baseLevel=!1,r.minlevel=0,r.maxlevel=0,r.floorId=""),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),null!=e.x&&e.hasOwnProperty("x")&&(r.x=i.json&&!isFinite(e.x)?String(e.x):e.x),null!=e.y&&e.hasOwnProperty("y")&&(r.y=i.json&&!isFinite(e.y)?String(e.y):e.y),null!=e.offsetX&&e.hasOwnProperty("offsetX")&&(r.offsetX=i.json&&!isFinite(e.offsetX)?String(e.offsetX):e.offsetX),null!=e.offsetY&&e.hasOwnProperty("offsetY")&&(r.offsetY=i.json&&!isFinite(e.offsetY)?String(e.offsetY):e.offsetY),null!=e.angle&&e.hasOwnProperty("angle")&&(r.angle=i.json&&!isFinite(e.angle)?String(e.angle):e.angle),null!=e.scale&&e.hasOwnProperty("scale")&&(r.scale=i.json&&!isFinite(e.scale)?String(e.scale):e.scale),e.fids&&e.fids.length){r.fids=[];for(let t=0;t<e.fids.length;++t)r.fids[t]=e.fids[t]}if(null!=e.pgid&&e.hasOwnProperty("pgid")&&(r.pgid=e.pgid),null!=e.baseLevel&&e.hasOwnProperty("baseLevel")&&(r.baseLevel=e.baseLevel),null!=e.minlevel&&e.hasOwnProperty("minlevel")&&(r.minlevel=e.minlevel),null!=e.maxlevel&&e.hasOwnProperty("maxlevel")&&(r.maxlevel=e.maxlevel),null!=e.floorId&&e.hasOwnProperty("floorId")&&(r.floorId=e.floorId),e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=G.protobuf.Scene.Floor.IndexInfo.toObject(e.idxs[t],i)}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}return r},h.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},h.IndexInfo=(l.prototype.idxs=j.emptyArray,l.create=function(t){return new l(t)},l.encode=function(e,i){if(i=i||F.create(),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(8).int32(e.idxs[t]);return i},l.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},l.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene.Floor.IndexInfo;t.pos<i;){var n=t.uint32();if(n>>>3==1)if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());else t.skipType(7&n)}return r},l.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},l.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}return null},l.fromObject=function(e){if(e instanceof G.protobuf.Scene.Floor.IndexInfo)return e;var i=new G.protobuf.Scene.Floor.IndexInfo;if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.Scene.Floor.IndexInfo.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}return i},l.toObject=function(e,t){var i={};if(((t=t||{}).arrays||t.defaults)&&(i.idxs=[]),e.idxs&&e.idxs.length){i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=e.idxs[t]}return i},l.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},l),h),s.Building=(u.prototype.bid="",u.prototype.name="",u.prototype.ename="",u.prototype.alias="",u.prototype.x=0,u.prototype.y=0,u.prototype.mid="",u.prototype.version=0,u.prototype.floors=j.emptyArray,u.prototype.bcode=0,u.create=function(t){return new u(t)},u.encode=function(e,i){if(i=i||F.create(),null!=e.bid&&Object.hasOwnProperty.call(e,"bid")&&i.uint32(10).string(e.bid),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&i.uint32(18).string(e.name),null!=e.ename&&Object.hasOwnProperty.call(e,"ename")&&i.uint32(26).string(e.ename),null!=e.alias&&Object.hasOwnProperty.call(e,"alias")&&i.uint32(34).string(e.alias),null!=e.x&&Object.hasOwnProperty.call(e,"x")&&i.uint32(45).float(e.x),null!=e.y&&Object.hasOwnProperty.call(e,"y")&&i.uint32(53).float(e.y),null!=e.mid&&Object.hasOwnProperty.call(e,"mid")&&i.uint32(58).string(e.mid),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&i.uint32(64).int32(e.version),null!=e.floors&&e.floors.length)for(let t=0;t<e.floors.length;++t)G.protobuf.Scene.Floor.encode(e.floors[t],i.uint32(74).fork()).ldelim();return null!=e.bcode&&Object.hasOwnProperty.call(e,"bcode")&&i.uint32(80).int32(e.bcode),i},u.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},u.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Scene.Building;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.bid=t.string();break;case 2:r.name=t.string();break;case 3:r.ename=t.string();break;case 4:r.alias=t.string();break;case 5:r.x=t.float();break;case 6:r.y=t.float();break;case 7:r.mid=t.string();break;case 8:r.version=t.int32();break;case 9:r.floors&&r.floors.length||(r.floors=[]),r.floors.push(G.protobuf.Scene.Floor.decode(t,t.uint32()));break;case 10:r.bcode=t.int32();break;default:t.skipType(7&n)}}return r},u.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},u.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.bid&&e.hasOwnProperty("bid")&&!j.isString(e.bid))return"bid: string expected";if(null!=e.name&&e.hasOwnProperty("name")&&!j.isString(e.name))return"name: string expected";if(null!=e.ename&&e.hasOwnProperty("ename")&&!j.isString(e.ename))return"ename: string expected";if(null!=e.alias&&e.hasOwnProperty("alias")&&!j.isString(e.alias))return"alias: string expected";if(null!=e.x&&e.hasOwnProperty("x")&&"number"!=typeof e.x)return"x: number expected";if(null!=e.y&&e.hasOwnProperty("y")&&"number"!=typeof e.y)return"y: number expected";if(null!=e.mid&&e.hasOwnProperty("mid")&&!j.isString(e.mid))return"mid: string expected";if(null!=e.version&&e.hasOwnProperty("version")&&!j.isInteger(e.version))return"version: integer expected";if(null!=e.floors&&e.hasOwnProperty("floors")){if(!Array.isArray(e.floors))return"floors: array expected";for(let t=0;t<e.floors.length;++t){var i=G.protobuf.Scene.Floor.verify(e.floors[t]);if(i)return"floors."+i}}return null!=e.bcode&&e.hasOwnProperty("bcode")&&!j.isInteger(e.bcode)?"bcode: integer expected":null},u.fromObject=function(e){if(e instanceof G.protobuf.Scene.Building)return e;var i=new G.protobuf.Scene.Building;if(null!=e.bid&&(i.bid=String(e.bid)),null!=e.name&&(i.name=String(e.name)),null!=e.ename&&(i.ename=String(e.ename)),null!=e.alias&&(i.alias=String(e.alias)),null!=e.x&&(i.x=Number(e.x)),null!=e.y&&(i.y=Number(e.y)),null!=e.mid&&(i.mid=String(e.mid)),null!=e.version&&(i.version=0|e.version),e.floors){if(!Array.isArray(e.floors))throw TypeError(".protobuf.Scene.Building.floors: array expected");i.floors=[];for(let t=0;t<e.floors.length;++t){if("object"!=typeof e.floors[t])throw TypeError(".protobuf.Scene.Building.floors: object expected");i.floors[t]=G.protobuf.Scene.Floor.fromObject(e.floors[t])}}return null!=e.bcode&&(i.bcode=0|e.bcode),i},u.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.floors=[]),i.defaults&&(r.bid="",r.name="",r.ename="",r.alias="",r.x=0,r.y=0,r.mid="",r.version=0,r.bcode=0),null!=e.bid&&e.hasOwnProperty("bid")&&(r.bid=e.bid),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),null!=e.ename&&e.hasOwnProperty("ename")&&(r.ename=e.ename),null!=e.alias&&e.hasOwnProperty("alias")&&(r.alias=e.alias),null!=e.x&&e.hasOwnProperty("x")&&(r.x=i.json&&!isFinite(e.x)?String(e.x):e.x),null!=e.y&&e.hasOwnProperty("y")&&(r.y=i.json&&!isFinite(e.y)?String(e.y):e.y),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),e.floors&&e.floors.length){r.floors=[];for(let t=0;t<e.floors.length;++t)r.floors[t]=G.protobuf.Scene.Floor.toObject(e.floors[t],i)}return null!=e.bcode&&e.hasOwnProperty("bcode")&&(r.bcode=e.bcode),r},u.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},u),s),i.Gate=(c.prototype.mid="",c.prototype.floors=j.emptyArray,c.create=function(t){return new c(t)},c.encode=function(e,i){if((i=i||F.create()).uint32(10).string(e.mid),null!=e.floors&&e.floors.length)for(let t=0;t<e.floors.length;++t)G.protobuf.Gate.NaviFloor.encode(e.floors[t],i.uint32(18).fork()).ldelim();return i},c.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},c.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Gate;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.mid=t.string();break;case 2:r.floors&&r.floors.length||(r.floors=[]),r.floors.push(G.protobuf.Gate.NaviFloor.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(r.hasOwnProperty("mid"))return r;throw j.ProtocolError("missing required 'mid'",{instance:r})},c.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},c.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(null!=e.floors&&e.hasOwnProperty("floors")){if(!Array.isArray(e.floors))return"floors: array expected";for(let t=0;t<e.floors.length;++t){var i=G.protobuf.Gate.NaviFloor.verify(e.floors[t]);if(i)return"floors."+i}}return null},c.fromObject=function(e){if(e instanceof G.protobuf.Gate)return e;var i=new G.protobuf.Gate;if(null!=e.mid&&(i.mid=String(e.mid)),e.floors){if(!Array.isArray(e.floors))throw TypeError(".protobuf.Gate.floors: array expected");i.floors=[];for(let t=0;t<e.floors.length;++t){if("object"!=typeof e.floors[t])throw TypeError(".protobuf.Gate.floors: object expected");i.floors[t]=G.protobuf.Gate.NaviFloor.fromObject(e.floors[t])}}return i},c.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.floors=[]),i.defaults&&(r.mid=""),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),e.floors&&e.floors.length){r.floors=[];for(let t=0;t<e.floors.length;++t)r.floors[t]=G.protobuf.Gate.NaviFloor.toObject(e.floors[t],i)}return r},c.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},c.NaviFloor=(f.prototype.gid=0,f.prototype.floorId="",f.prototype.bid="",f.prototype.mid="",f.prototype.navi=j.emptyArray,f.prototype.drive=j.emptyArray,f.prototype.accessible=j.emptyArray,f.create=function(t){return new f(t)},f.encode=function(e,i){if(i=i||F.create(),null!=e.gid&&Object.hasOwnProperty.call(e,"gid")&&i.uint32(8).int32(e.gid),null!=e.floorId&&Object.hasOwnProperty.call(e,"floorId")&&i.uint32(18).string(e.floorId),null!=e.bid&&Object.hasOwnProperty.call(e,"bid")&&i.uint32(26).string(e.bid),null!=e.mid&&Object.hasOwnProperty.call(e,"mid")&&i.uint32(34).string(e.mid),null!=e.navi&&e.navi.length)for(let t=0;t<e.navi.length;++t)G.protobuf.Gate.NaviRelationship.encode(e.navi[t],i.uint32(42).fork()).ldelim();if(null!=e.drive&&e.drive.length)for(let t=0;t<e.drive.length;++t)G.protobuf.Gate.NaviRelationship.encode(e.drive[t],i.uint32(50).fork()).ldelim();if(null!=e.accessible&&e.accessible.length)for(let t=0;t<e.accessible.length;++t)G.protobuf.Gate.NaviRelationship.encode(e.accessible[t],i.uint32(58).fork()).ldelim();return i},f.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},f.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Gate.NaviFloor;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.gid=t.int32();break;case 2:r.floorId=t.string();break;case 3:r.bid=t.string();break;case 4:r.mid=t.string();break;case 5:r.navi&&r.navi.length||(r.navi=[]),r.navi.push(G.protobuf.Gate.NaviRelationship.decode(t,t.uint32()));break;case 6:r.drive&&r.drive.length||(r.drive=[]),r.drive.push(G.protobuf.Gate.NaviRelationship.decode(t,t.uint32()));break;case 7:r.accessible&&r.accessible.length||(r.accessible=[]),r.accessible.push(G.protobuf.Gate.NaviRelationship.decode(t,t.uint32()));break;default:t.skipType(7&n)}}return r},f.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},f.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.gid&&e.hasOwnProperty("gid")&&!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.floorId&&e.hasOwnProperty("floorId")&&!j.isString(e.floorId))return"floorId: string expected";if(null!=e.bid&&e.hasOwnProperty("bid")&&!j.isString(e.bid))return"bid: string expected";if(null!=e.mid&&e.hasOwnProperty("mid")&&!j.isString(e.mid))return"mid: string expected";if(null!=e.navi&&e.hasOwnProperty("navi")){if(!Array.isArray(e.navi))return"navi: array expected";for(let t=0;t<e.navi.length;++t){var i=G.protobuf.Gate.NaviRelationship.verify(e.navi[t]);if(i)return"navi."+i}}if(null!=e.drive&&e.hasOwnProperty("drive")){if(!Array.isArray(e.drive))return"drive: array expected";for(let t=0;t<e.drive.length;++t){var r=G.protobuf.Gate.NaviRelationship.verify(e.drive[t]);if(r)return"drive."+r}}if(null!=e.accessible&&e.hasOwnProperty("accessible")){if(!Array.isArray(e.accessible))return"accessible: array expected";for(let t=0;t<e.accessible.length;++t){var n=G.protobuf.Gate.NaviRelationship.verify(e.accessible[t]);if(n)return"accessible."+n}}return null},f.fromObject=function(e){if(e instanceof G.protobuf.Gate.NaviFloor)return e;var i=new G.protobuf.Gate.NaviFloor;if(null!=e.gid&&(i.gid=0|e.gid),null!=e.floorId&&(i.floorId=String(e.floorId)),null!=e.bid&&(i.bid=String(e.bid)),null!=e.mid&&(i.mid=String(e.mid)),e.navi){if(!Array.isArray(e.navi))throw TypeError(".protobuf.Gate.NaviFloor.navi: array expected");i.navi=[];for(let t=0;t<e.navi.length;++t){if("object"!=typeof e.navi[t])throw TypeError(".protobuf.Gate.NaviFloor.navi: object expected");i.navi[t]=G.protobuf.Gate.NaviRelationship.fromObject(e.navi[t])}}if(e.drive){if(!Array.isArray(e.drive))throw TypeError(".protobuf.Gate.NaviFloor.drive: array expected");i.drive=[];for(let t=0;t<e.drive.length;++t){if("object"!=typeof e.drive[t])throw TypeError(".protobuf.Gate.NaviFloor.drive: object expected");i.drive[t]=G.protobuf.Gate.NaviRelationship.fromObject(e.drive[t])}}if(e.accessible){if(!Array.isArray(e.accessible))throw TypeError(".protobuf.Gate.NaviFloor.accessible: array expected");i.accessible=[];for(let t=0;t<e.accessible.length;++t){if("object"!=typeof e.accessible[t])throw TypeError(".protobuf.Gate.NaviFloor.accessible: object expected");i.accessible[t]=G.protobuf.Gate.NaviRelationship.fromObject(e.accessible[t])}}return i},f.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.navi=[],r.drive=[],r.accessible=[]),i.defaults&&(r.gid=0,r.floorId="",r.bid="",r.mid=""),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),null!=e.floorId&&e.hasOwnProperty("floorId")&&(r.floorId=e.floorId),null!=e.bid&&e.hasOwnProperty("bid")&&(r.bid=e.bid),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),e.navi&&e.navi.length){r.navi=[];for(let t=0;t<e.navi.length;++t)r.navi[t]=G.protobuf.Gate.NaviRelationship.toObject(e.navi[t],i)}if(e.drive&&e.drive.length){r.drive=[];for(let t=0;t<e.drive.length;++t)r.drive[t]=G.protobuf.Gate.NaviRelationship.toObject(e.drive[t],i)}if(e.accessible&&e.accessible.length){r.accessible=[];for(let t=0;t<e.accessible.length;++t)r.accessible[t]=G.protobuf.Gate.NaviRelationship.toObject(e.accessible[t],i)}return r},f.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},f),c.NaviRelationship=(d.prototype.eid=0,d.prototype.type=0,d.prototype.accessible=0,d.prototype.idxs=j.emptyArray,d.prototype.pts=j.emptyArray,d.prototype.flag=0,d.prototype.toBid=j.emptyArray,d.prototype.toGid=j.emptyArray,d.create=function(t){return new d(t)},d.encode=function(e,i){if((i=i||F.create()).uint32(8).int32(e.eid),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&i.uint32(16).int32(e.type),null!=e.accessible&&Object.hasOwnProperty.call(e,"accessible")&&i.uint32(24).int32(e.accessible),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)G.protobuf.Gate.NaviRelationship.IndexInfo.encode(e.idxs[t],i.uint32(34).fork()).ldelim();if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(41).double(e.pts[t]);if(null!=e.flag&&Object.hasOwnProperty.call(e,"flag")&&i.uint32(48).int32(e.flag),null!=e.toBid&&e.toBid.length)for(let t=0;t<e.toBid.length;++t)i.uint32(58).string(e.toBid[t]);if(null!=e.toGid&&e.toGid.length)for(let t=0;t<e.toGid.length;++t)i.uint32(66).string(e.toGid[t]);return i},d.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},d.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Gate.NaviRelationship;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.type=t.int32();break;case 3:r.accessible=t.int32();break;case 4:r.idxs&&r.idxs.length||(r.idxs=[]),r.idxs.push(G.protobuf.Gate.NaviRelationship.IndexInfo.decode(t,t.uint32()));break;case 5:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.pts.push(t.double());else r.pts.push(t.double());break;case 6:r.flag=t.int32();break;case 7:r.toBid&&r.toBid.length||(r.toBid=[]),r.toBid.push(t.string());break;case 8:r.toGid&&r.toGid.length||(r.toGid=[]),r.toGid.push(t.string());break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},d.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},d.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isInteger(e.eid))return"eid: integer expected";if(null!=e.type&&e.hasOwnProperty("type")&&!j.isInteger(e.type))return"type: integer expected";if(null!=e.accessible&&e.hasOwnProperty("accessible")&&!j.isInteger(e.accessible))return"accessible: integer expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t){var i=G.protobuf.Gate.NaviRelationship.IndexInfo.verify(e.idxs[t]);if(i)return"idxs."+i}}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}if(null!=e.flag&&e.hasOwnProperty("flag")&&!j.isInteger(e.flag))return"flag: integer expected";if(null!=e.toBid&&e.hasOwnProperty("toBid")){if(!Array.isArray(e.toBid))return"toBid: array expected";for(let t=0;t<e.toBid.length;++t)if(!j.isString(e.toBid[t]))return"toBid: string[] expected"}if(null!=e.toGid&&e.hasOwnProperty("toGid")){if(!Array.isArray(e.toGid))return"toGid: array expected";for(let t=0;t<e.toGid.length;++t)if(!j.isString(e.toGid[t]))return"toGid: string[] expected"}return null},d.fromObject=function(e){if(e instanceof G.protobuf.Gate.NaviRelationship)return e;var i=new G.protobuf.Gate.NaviRelationship;if(null!=e.eid&&(i.eid=0|e.eid),null!=e.type&&(i.type=0|e.type),null!=e.accessible&&(i.accessible=0|e.accessible),e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.Gate.NaviRelationship.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t){if("object"!=typeof e.idxs[t])throw TypeError(".protobuf.Gate.NaviRelationship.idxs: object expected");i.idxs[t]=G.protobuf.Gate.NaviRelationship.IndexInfo.fromObject(e.idxs[t])}}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.Gate.NaviRelationship.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}if(null!=e.flag&&(i.flag=0|e.flag),e.toBid){if(!Array.isArray(e.toBid))throw TypeError(".protobuf.Gate.NaviRelationship.toBid: array expected");i.toBid=[];for(let t=0;t<e.toBid.length;++t)i.toBid[t]=String(e.toBid[t])}if(e.toGid){if(!Array.isArray(e.toGid))throw TypeError(".protobuf.Gate.NaviRelationship.toGid: array expected");i.toGid=[];for(let t=0;t<e.toGid.length;++t)i.toGid[t]=String(e.toGid[t])}return i},d.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.idxs=[],r.pts=[],r.toBid=[],r.toGid=[]),i.defaults&&(r.eid=0,r.type=0,r.accessible=0,r.flag=0),null!=e.eid&&e.hasOwnProperty("eid")&&(r.eid=e.eid),null!=e.type&&e.hasOwnProperty("type")&&(r.type=e.type),null!=e.accessible&&e.hasOwnProperty("accessible")&&(r.accessible=e.accessible),e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=G.protobuf.Gate.NaviRelationship.IndexInfo.toObject(e.idxs[t],i)}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}if(null!=e.flag&&e.hasOwnProperty("flag")&&(r.flag=e.flag),e.toBid&&e.toBid.length){r.toBid=[];for(let t=0;t<e.toBid.length;++t)r.toBid[t]=e.toBid[t]}if(e.toGid&&e.toGid.length){r.toGid=[];for(let t=0;t<e.toGid.length;++t)r.toGid[t]=e.toGid[t]}return r},d.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},d.IndexInfo=(v.prototype.idxs=j.emptyArray,v.create=function(t){return new v(t)},v.encode=function(e,i){if(i=i||F.create(),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(8).int32(e.idxs[t]);return i},v.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},v.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.Gate.NaviRelationship.IndexInfo;t.pos<i;){var n=t.uint32();if(n>>>3==1)if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());else t.skipType(7&n)}return r},v.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},v.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}return null},v.fromObject=function(e){if(e instanceof G.protobuf.Gate.NaviRelationship.IndexInfo)return e;var i=new G.protobuf.Gate.NaviRelationship.IndexInfo;if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.Gate.NaviRelationship.IndexInfo.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}return i},v.toObject=function(e,t){var i={};if(((t=t||{}).arrays||t.defaults)&&(i.idxs=[]),e.idxs&&e.idxs.length){i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=e.idxs[t]}return i},v.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},v),d),c),i.FloorGeo=(p.prototype.mid="",p.prototype.gid=0,p.prototype.height=0,p.prototype.extentLayer=j.emptyArray,p.prototype.modelLayer=j.emptyArray,p.prototype.labelLayer=j.emptyArray,p.prototype.poiLayer=j.emptyArray,p.prototype.polygonLayer=j.emptyArray,p.prototype.polygonLabelLayer=j.emptyArray,p.prototype.liftLayer=j.emptyArray,p.prototype.stairLayer=j.emptyArray,p.prototype.escalatorLayer=j.emptyArray,p.prototype.externalModelLayer=j.emptyArray,p.create=function(t){return new p(t)},p.encode=function(e,i){if((i=i||F.create()).uint32(10).string(e.mid),i.uint32(16).int32(e.gid),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&i.uint32(29).float(e.height),null!=e.extentLayer&&e.extentLayer.length)for(let t=0;t<e.extentLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.extentLayer[t],i.uint32(34).fork()).ldelim();if(null!=e.modelLayer&&e.modelLayer.length)for(let t=0;t<e.modelLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.modelLayer[t],i.uint32(42).fork()).ldelim();if(null!=e.labelLayer&&e.labelLayer.length)for(let t=0;t<e.labelLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.labelLayer[t],i.uint32(50).fork()).ldelim();if(null!=e.poiLayer&&e.poiLayer.length)for(let t=0;t<e.poiLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.poiLayer[t],i.uint32(58).fork()).ldelim();if(null!=e.polygonLayer&&e.polygonLayer.length)for(let t=0;t<e.polygonLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.polygonLayer[t],i.uint32(66).fork()).ldelim();if(null!=e.polygonLabelLayer&&e.polygonLabelLayer.length)for(let t=0;t<e.polygonLabelLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.polygonLabelLayer[t],i.uint32(74).fork()).ldelim();if(null!=e.liftLayer&&e.liftLayer.length)for(let t=0;t<e.liftLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.liftLayer[t],i.uint32(82).fork()).ldelim();if(null!=e.stairLayer&&e.stairLayer.length)for(let t=0;t<e.stairLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.stairLayer[t],i.uint32(90).fork()).ldelim();if(null!=e.escalatorLayer&&e.escalatorLayer.length)for(let t=0;t<e.escalatorLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.escalatorLayer[t],i.uint32(98).fork()).ldelim();if(null!=e.externalModelLayer&&e.externalModelLayer.length)for(let t=0;t<e.externalModelLayer.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.encode(e.externalModelLayer[t],i.uint32(106).fork()).ldelim();return i},p.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},p.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorGeo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.mid=t.string();break;case 2:r.gid=t.int32();break;case 3:r.height=t.float();break;case 4:r.extentLayer&&r.extentLayer.length||(r.extentLayer=[]),r.extentLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 5:r.modelLayer&&r.modelLayer.length||(r.modelLayer=[]),r.modelLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 6:r.labelLayer&&r.labelLayer.length||(r.labelLayer=[]),r.labelLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 7:r.poiLayer&&r.poiLayer.length||(r.poiLayer=[]),r.poiLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 8:r.polygonLayer&&r.polygonLayer.length||(r.polygonLayer=[]),r.polygonLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 9:r.polygonLabelLayer&&r.polygonLabelLayer.length||(r.polygonLabelLayer=[]),r.polygonLabelLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 10:r.liftLayer&&r.liftLayer.length||(r.liftLayer=[]),r.liftLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 11:r.stairLayer&&r.stairLayer.length||(r.stairLayer=[]),r.stairLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 12:r.escalatorLayer&&r.escalatorLayer.length||(r.escalatorLayer=[]),r.escalatorLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;case 13:r.externalModelLayer&&r.externalModelLayer.length||(r.externalModelLayer=[]),r.externalModelLayer.push(G.protobuf.FloorGeo.GeneralGeoInfo.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("mid"))throw j.ProtocolError("missing required 'mid'",{instance:r});if(r.hasOwnProperty("gid"))return r;throw j.ProtocolError("missing required 'gid'",{instance:r})},p.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},p.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.height&&e.hasOwnProperty("height")&&"number"!=typeof e.height)return"height: number expected";if(null!=e.extentLayer&&e.hasOwnProperty("extentLayer")){if(!Array.isArray(e.extentLayer))return"extentLayer: array expected";for(let t=0;t<e.extentLayer.length;++t){var i=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.extentLayer[t]);if(i)return"extentLayer."+i}}if(null!=e.modelLayer&&e.hasOwnProperty("modelLayer")){if(!Array.isArray(e.modelLayer))return"modelLayer: array expected";for(let t=0;t<e.modelLayer.length;++t){var r=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.modelLayer[t]);if(r)return"modelLayer."+r}}if(null!=e.labelLayer&&e.hasOwnProperty("labelLayer")){if(!Array.isArray(e.labelLayer))return"labelLayer: array expected";for(let t=0;t<e.labelLayer.length;++t){var n=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.labelLayer[t]);if(n)return"labelLayer."+n}}if(null!=e.poiLayer&&e.hasOwnProperty("poiLayer")){if(!Array.isArray(e.poiLayer))return"poiLayer: array expected";for(let t=0;t<e.poiLayer.length;++t){var s=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.poiLayer[t]);if(s)return"poiLayer."+s}}if(null!=e.polygonLayer&&e.hasOwnProperty("polygonLayer")){if(!Array.isArray(e.polygonLayer))return"polygonLayer: array expected";for(let t=0;t<e.polygonLayer.length;++t){var o=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.polygonLayer[t]);if(o)return"polygonLayer."+o}}if(null!=e.polygonLabelLayer&&e.hasOwnProperty("polygonLabelLayer")){if(!Array.isArray(e.polygonLabelLayer))return"polygonLabelLayer: array expected";for(let t=0;t<e.polygonLabelLayer.length;++t){var a=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.polygonLabelLayer[t]);if(a)return"polygonLabelLayer."+a}}if(null!=e.liftLayer&&e.hasOwnProperty("liftLayer")){if(!Array.isArray(e.liftLayer))return"liftLayer: array expected";for(let t=0;t<e.liftLayer.length;++t){var h=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.liftLayer[t]);if(h)return"liftLayer."+h}}if(null!=e.stairLayer&&e.hasOwnProperty("stairLayer")){if(!Array.isArray(e.stairLayer))return"stairLayer: array expected";for(let t=0;t<e.stairLayer.length;++t){var l=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.stairLayer[t]);if(l)return"stairLayer."+l}}if(null!=e.escalatorLayer&&e.hasOwnProperty("escalatorLayer")){if(!Array.isArray(e.escalatorLayer))return"escalatorLayer: array expected";for(let t=0;t<e.escalatorLayer.length;++t){var u=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.escalatorLayer[t]);if(u)return"escalatorLayer."+u}}if(null!=e.externalModelLayer&&e.hasOwnProperty("externalModelLayer")){if(!Array.isArray(e.externalModelLayer))return"externalModelLayer: array expected";for(let t=0;t<e.externalModelLayer.length;++t){var c=G.protobuf.FloorGeo.GeneralGeoInfo.verify(e.externalModelLayer[t]);if(c)return"externalModelLayer."+c}}return null},p.fromObject=function(e){if(e instanceof G.protobuf.FloorGeo)return e;var i=new G.protobuf.FloorGeo;if(null!=e.mid&&(i.mid=String(e.mid)),null!=e.gid&&(i.gid=0|e.gid),null!=e.height&&(i.height=Number(e.height)),e.extentLayer){if(!Array.isArray(e.extentLayer))throw TypeError(".protobuf.FloorGeo.extentLayer: array expected");i.extentLayer=[];for(let t=0;t<e.extentLayer.length;++t){if("object"!=typeof e.extentLayer[t])throw TypeError(".protobuf.FloorGeo.extentLayer: object expected");i.extentLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.extentLayer[t])}}if(e.modelLayer){if(!Array.isArray(e.modelLayer))throw TypeError(".protobuf.FloorGeo.modelLayer: array expected");i.modelLayer=[];for(let t=0;t<e.modelLayer.length;++t){if("object"!=typeof e.modelLayer[t])throw TypeError(".protobuf.FloorGeo.modelLayer: object expected");i.modelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.modelLayer[t])}}if(e.labelLayer){if(!Array.isArray(e.labelLayer))throw TypeError(".protobuf.FloorGeo.labelLayer: array expected");i.labelLayer=[];for(let t=0;t<e.labelLayer.length;++t){if("object"!=typeof e.labelLayer[t])throw TypeError(".protobuf.FloorGeo.labelLayer: object expected");i.labelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.labelLayer[t])}}if(e.poiLayer){if(!Array.isArray(e.poiLayer))throw TypeError(".protobuf.FloorGeo.poiLayer: array expected");i.poiLayer=[];for(let t=0;t<e.poiLayer.length;++t){if("object"!=typeof e.poiLayer[t])throw TypeError(".protobuf.FloorGeo.poiLayer: object expected");i.poiLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.poiLayer[t])}}if(e.polygonLayer){if(!Array.isArray(e.polygonLayer))throw TypeError(".protobuf.FloorGeo.polygonLayer: array expected");i.polygonLayer=[];for(let t=0;t<e.polygonLayer.length;++t){if("object"!=typeof e.polygonLayer[t])throw TypeError(".protobuf.FloorGeo.polygonLayer: object expected");i.polygonLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.polygonLayer[t])}}if(e.polygonLabelLayer){if(!Array.isArray(e.polygonLabelLayer))throw TypeError(".protobuf.FloorGeo.polygonLabelLayer: array expected");i.polygonLabelLayer=[];for(let t=0;t<e.polygonLabelLayer.length;++t){if("object"!=typeof e.polygonLabelLayer[t])throw TypeError(".protobuf.FloorGeo.polygonLabelLayer: object expected");i.polygonLabelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.polygonLabelLayer[t])}}if(e.liftLayer){if(!Array.isArray(e.liftLayer))throw TypeError(".protobuf.FloorGeo.liftLayer: array expected");i.liftLayer=[];for(let t=0;t<e.liftLayer.length;++t){if("object"!=typeof e.liftLayer[t])throw TypeError(".protobuf.FloorGeo.liftLayer: object expected");i.liftLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.liftLayer[t])}}if(e.stairLayer){if(!Array.isArray(e.stairLayer))throw TypeError(".protobuf.FloorGeo.stairLayer: array expected");i.stairLayer=[];for(let t=0;t<e.stairLayer.length;++t){if("object"!=typeof e.stairLayer[t])throw TypeError(".protobuf.FloorGeo.stairLayer: object expected");i.stairLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.stairLayer[t])}}if(e.escalatorLayer){if(!Array.isArray(e.escalatorLayer))throw TypeError(".protobuf.FloorGeo.escalatorLayer: array expected");i.escalatorLayer=[];for(let t=0;t<e.escalatorLayer.length;++t){if("object"!=typeof e.escalatorLayer[t])throw TypeError(".protobuf.FloorGeo.escalatorLayer: object expected");i.escalatorLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.escalatorLayer[t])}}if(e.externalModelLayer){if(!Array.isArray(e.externalModelLayer))throw TypeError(".protobuf.FloorGeo.externalModelLayer: array expected");i.externalModelLayer=[];for(let t=0;t<e.externalModelLayer.length;++t){if("object"!=typeof e.externalModelLayer[t])throw TypeError(".protobuf.FloorGeo.externalModelLayer: object expected");i.externalModelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.fromObject(e.externalModelLayer[t])}}return i},p.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.extentLayer=[],r.modelLayer=[],r.labelLayer=[],r.poiLayer=[],r.polygonLayer=[],r.polygonLabelLayer=[],r.liftLayer=[],r.stairLayer=[],r.escalatorLayer=[],r.externalModelLayer=[]),i.defaults&&(r.mid="",r.gid=0,r.height=0),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),null!=e.height&&e.hasOwnProperty("height")&&(r.height=i.json&&!isFinite(e.height)?String(e.height):e.height),e.extentLayer&&e.extentLayer.length){r.extentLayer=[];for(let t=0;t<e.extentLayer.length;++t)r.extentLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.extentLayer[t],i)}if(e.modelLayer&&e.modelLayer.length){r.modelLayer=[];for(let t=0;t<e.modelLayer.length;++t)r.modelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.modelLayer[t],i)}if(e.labelLayer&&e.labelLayer.length){r.labelLayer=[];for(let t=0;t<e.labelLayer.length;++t)r.labelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.labelLayer[t],i)}if(e.poiLayer&&e.poiLayer.length){r.poiLayer=[];for(let t=0;t<e.poiLayer.length;++t)r.poiLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.poiLayer[t],i)}if(e.polygonLayer&&e.polygonLayer.length){r.polygonLayer=[];for(let t=0;t<e.polygonLayer.length;++t)r.polygonLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.polygonLayer[t],i)}if(e.polygonLabelLayer&&e.polygonLabelLayer.length){r.polygonLabelLayer=[];for(let t=0;t<e.polygonLabelLayer.length;++t)r.polygonLabelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.polygonLabelLayer[t],i)}if(e.liftLayer&&e.liftLayer.length){r.liftLayer=[];for(let t=0;t<e.liftLayer.length;++t)r.liftLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.liftLayer[t],i)}if(e.stairLayer&&e.stairLayer.length){r.stairLayer=[];for(let t=0;t<e.stairLayer.length;++t)r.stairLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.stairLayer[t],i)}if(e.escalatorLayer&&e.escalatorLayer.length){r.escalatorLayer=[];for(let t=0;t<e.escalatorLayer.length;++t)r.escalatorLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.escalatorLayer[t],i)}if(e.externalModelLayer&&e.externalModelLayer.length){r.externalModelLayer=[];for(let t=0;t<e.externalModelLayer.length;++t)r.externalModelLayer[t]=G.protobuf.FloorGeo.GeneralGeoInfo.toObject(e.externalModelLayer[t],i)}return r},p.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},p.GeneralGeoInfo=(m.prototype.eid=0,m.prototype.geo="",m.prototype.height=0,m.prototype.area=0,m.prototype.idxs=j.emptyArray,m.prototype.pts=j.emptyArray,m.create=function(t){return new m(t)},m.encode=function(e,i){if((i=i||F.create()).uint32(8).int32(e.eid),null!=e.geo&&Object.hasOwnProperty.call(e,"geo")&&i.uint32(18).string(e.geo),null!=e.height&&Object.hasOwnProperty.call(e,"height")&&i.uint32(29).float(e.height),null!=e.area&&Object.hasOwnProperty.call(e,"area")&&i.uint32(37).float(e.area),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.encode(e.idxs[t],i.uint32(42).fork()).ldelim();if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(49).double(e.pts[t]);return i},m.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},m.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorGeo.GeneralGeoInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.geo=t.string();break;case 3:r.height=t.float();break;case 4:r.area=t.float();break;case 5:r.idxs&&r.idxs.length||(r.idxs=[]),r.idxs.push(G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.decode(t,t.uint32()));break;case 6:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.pts.push(t.double());else r.pts.push(t.double());break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},m.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},m.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isInteger(e.eid))return"eid: integer expected";if(null!=e.geo&&e.hasOwnProperty("geo")&&!j.isString(e.geo))return"geo: string expected";if(null!=e.height&&e.hasOwnProperty("height")&&"number"!=typeof e.height)return"height: number expected";if(null!=e.area&&e.hasOwnProperty("area")&&"number"!=typeof e.area)return"area: number expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t){var i=G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.verify(e.idxs[t]);if(i)return"idxs."+i}}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}return null},m.fromObject=function(e){if(e instanceof G.protobuf.FloorGeo.GeneralGeoInfo)return e;var i=new G.protobuf.FloorGeo.GeneralGeoInfo;if(null!=e.eid&&(i.eid=0|e.eid),null!=e.geo&&(i.geo=String(e.geo)),null!=e.height&&(i.height=Number(e.height)),null!=e.area&&(i.area=Number(e.area)),e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorGeo.GeneralGeoInfo.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t){if("object"!=typeof e.idxs[t])throw TypeError(".protobuf.FloorGeo.GeneralGeoInfo.idxs: object expected");i.idxs[t]=G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.fromObject(e.idxs[t])}}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.FloorGeo.GeneralGeoInfo.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}return i},m.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.idxs=[],r.pts=[]),i.defaults&&(r.eid=0,r.geo="",r.height=0,r.area=0),null!=e.eid&&e.hasOwnProperty("eid")&&(r.eid=e.eid),null!=e.geo&&e.hasOwnProperty("geo")&&(r.geo=e.geo),null!=e.height&&e.hasOwnProperty("height")&&(r.height=i.json&&!isFinite(e.height)?String(e.height):e.height),null!=e.area&&e.hasOwnProperty("area")&&(r.area=i.json&&!isFinite(e.area)?String(e.area):e.area),e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.toObject(e.idxs[t],i)}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}return r},m.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},m.IndexInfo=(g.prototype.idxs=j.emptyArray,g.create=function(t){return new g(t)},g.encode=function(e,i){if(i=i||F.create(),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(8).int32(e.idxs[t]);return i},g.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},g.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo;t.pos<i;){var n=t.uint32();if(n>>>3==1)if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());else t.skipType(7&n)}return r},g.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},g.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}return null},g.fromObject=function(e){if(e instanceof G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo)return e;var i=new G.protobuf.FloorGeo.GeneralGeoInfo.IndexInfo;if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorGeo.GeneralGeoInfo.IndexInfo.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}return i},g.toObject=function(e,t){var i={};if(((t=t||{}).arrays||t.defaults)&&(i.idxs=[]),e.idxs&&e.idxs.length){i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=e.idxs[t]}return i},g.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},g),m),p),i.FloorBiz=(_.prototype.mid="",_.prototype.gid=0,_.prototype.extentLayer=j.emptyArray,_.prototype.modelLayer=j.emptyArray,_.prototype.labelLayer=j.emptyArray,_.prototype.poiLayer=j.emptyArray,_.prototype.polygonLayer=j.emptyArray,_.prototype.liftLayer=j.emptyArray,_.prototype.stairLayer=j.emptyArray,_.prototype.polygonLabelLayer=j.emptyArray,_.prototype.externalModelLayer=j.emptyArray,_.create=function(t){return new _(t)},_.encode=function(e,i){if((i=i||F.create()).uint32(10).string(e.mid),i.uint32(16).int32(e.gid),null!=e.extentLayer&&e.extentLayer.length)for(let t=0;t<e.extentLayer.length;++t)G.protobuf.FloorBiz.ExtentBizInfo.encode(e.extentLayer[t],i.uint32(26).fork()).ldelim();if(null!=e.modelLayer&&e.modelLayer.length)for(let t=0;t<e.modelLayer.length;++t)G.protobuf.FloorBiz.ModelBizInfo.encode(e.modelLayer[t],i.uint32(34).fork()).ldelim();if(null!=e.labelLayer&&e.labelLayer.length)for(let t=0;t<e.labelLayer.length;++t)G.protobuf.FloorBiz.LabelBizInfo.encode(e.labelLayer[t],i.uint32(42).fork()).ldelim();if(null!=e.poiLayer&&e.poiLayer.length)for(let t=0;t<e.poiLayer.length;++t)G.protobuf.FloorBiz.POIBizInfo.encode(e.poiLayer[t],i.uint32(50).fork()).ldelim();if(null!=e.polygonLayer&&e.polygonLayer.length)for(let t=0;t<e.polygonLayer.length;++t)G.protobuf.FloorBiz.PolygonBizInfo.encode(e.polygonLayer[t],i.uint32(58).fork()).ldelim();if(null!=e.liftLayer&&e.liftLayer.length)for(let t=0;t<e.liftLayer.length;++t)G.protobuf.FloorBiz.LiftBizInfo.encode(e.liftLayer[t],i.uint32(66).fork()).ldelim();if(null!=e.stairLayer&&e.stairLayer.length)for(let t=0;t<e.stairLayer.length;++t)G.protobuf.FloorBiz.StairBizInfo.encode(e.stairLayer[t],i.uint32(74).fork()).ldelim();if(null!=e.polygonLabelLayer&&e.polygonLabelLayer.length)for(let t=0;t<e.polygonLabelLayer.length;++t)G.protobuf.FloorBiz.PolygonLabelBizInfo.encode(e.polygonLabelLayer[t],i.uint32(82).fork()).ldelim();if(null!=e.externalModelLayer&&e.externalModelLayer.length)for(let t=0;t<e.externalModelLayer.length;++t)G.protobuf.FloorBiz.ExternalModelBizInfo.encode(e.externalModelLayer[t],i.uint32(90).fork()).ldelim();return i},_.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},_.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.mid=t.string();break;case 2:r.gid=t.int32();break;case 3:r.extentLayer&&r.extentLayer.length||(r.extentLayer=[]),r.extentLayer.push(G.protobuf.FloorBiz.ExtentBizInfo.decode(t,t.uint32()));break;case 4:r.modelLayer&&r.modelLayer.length||(r.modelLayer=[]),r.modelLayer.push(G.protobuf.FloorBiz.ModelBizInfo.decode(t,t.uint32()));break;case 5:r.labelLayer&&r.labelLayer.length||(r.labelLayer=[]),r.labelLayer.push(G.protobuf.FloorBiz.LabelBizInfo.decode(t,t.uint32()));break;case 6:r.poiLayer&&r.poiLayer.length||(r.poiLayer=[]),r.poiLayer.push(G.protobuf.FloorBiz.POIBizInfo.decode(t,t.uint32()));break;case 7:r.polygonLayer&&r.polygonLayer.length||(r.polygonLayer=[]),r.polygonLayer.push(G.protobuf.FloorBiz.PolygonBizInfo.decode(t,t.uint32()));break;case 8:r.liftLayer&&r.liftLayer.length||(r.liftLayer=[]),r.liftLayer.push(G.protobuf.FloorBiz.LiftBizInfo.decode(t,t.uint32()));break;case 9:r.stairLayer&&r.stairLayer.length||(r.stairLayer=[]),r.stairLayer.push(G.protobuf.FloorBiz.StairBizInfo.decode(t,t.uint32()));break;case 10:r.polygonLabelLayer&&r.polygonLabelLayer.length||(r.polygonLabelLayer=[]),r.polygonLabelLayer.push(G.protobuf.FloorBiz.PolygonLabelBizInfo.decode(t,t.uint32()));break;case 11:r.externalModelLayer&&r.externalModelLayer.length||(r.externalModelLayer=[]),r.externalModelLayer.push(G.protobuf.FloorBiz.ExternalModelBizInfo.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("mid"))throw j.ProtocolError("missing required 'mid'",{instance:r});if(r.hasOwnProperty("gid"))return r;throw j.ProtocolError("missing required 'gid'",{instance:r})},_.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},_.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.extentLayer&&e.hasOwnProperty("extentLayer")){if(!Array.isArray(e.extentLayer))return"extentLayer: array expected";for(let t=0;t<e.extentLayer.length;++t){var i=G.protobuf.FloorBiz.ExtentBizInfo.verify(e.extentLayer[t]);if(i)return"extentLayer."+i}}if(null!=e.modelLayer&&e.hasOwnProperty("modelLayer")){if(!Array.isArray(e.modelLayer))return"modelLayer: array expected";for(let t=0;t<e.modelLayer.length;++t){var r=G.protobuf.FloorBiz.ModelBizInfo.verify(e.modelLayer[t]);if(r)return"modelLayer."+r}}if(null!=e.labelLayer&&e.hasOwnProperty("labelLayer")){if(!Array.isArray(e.labelLayer))return"labelLayer: array expected";for(let t=0;t<e.labelLayer.length;++t){var n=G.protobuf.FloorBiz.LabelBizInfo.verify(e.labelLayer[t]);if(n)return"labelLayer."+n}}if(null!=e.poiLayer&&e.hasOwnProperty("poiLayer")){if(!Array.isArray(e.poiLayer))return"poiLayer: array expected";for(let t=0;t<e.poiLayer.length;++t){var s=G.protobuf.FloorBiz.POIBizInfo.verify(e.poiLayer[t]);if(s)return"poiLayer."+s}}if(null!=e.polygonLayer&&e.hasOwnProperty("polygonLayer")){if(!Array.isArray(e.polygonLayer))return"polygonLayer: array expected";for(let t=0;t<e.polygonLayer.length;++t){var o=G.protobuf.FloorBiz.PolygonBizInfo.verify(e.polygonLayer[t]);if(o)return"polygonLayer."+o}}if(null!=e.liftLayer&&e.hasOwnProperty("liftLayer")){if(!Array.isArray(e.liftLayer))return"liftLayer: array expected";for(let t=0;t<e.liftLayer.length;++t){var a=G.protobuf.FloorBiz.LiftBizInfo.verify(e.liftLayer[t]);if(a)return"liftLayer."+a}}if(null!=e.stairLayer&&e.hasOwnProperty("stairLayer")){if(!Array.isArray(e.stairLayer))return"stairLayer: array expected";for(let t=0;t<e.stairLayer.length;++t){var h=G.protobuf.FloorBiz.StairBizInfo.verify(e.stairLayer[t]);if(h)return"stairLayer."+h}}if(null!=e.polygonLabelLayer&&e.hasOwnProperty("polygonLabelLayer")){if(!Array.isArray(e.polygonLabelLayer))return"polygonLabelLayer: array expected";for(let t=0;t<e.polygonLabelLayer.length;++t){var l=G.protobuf.FloorBiz.PolygonLabelBizInfo.verify(e.polygonLabelLayer[t]);if(l)return"polygonLabelLayer."+l}}if(null!=e.externalModelLayer&&e.hasOwnProperty("externalModelLayer")){if(!Array.isArray(e.externalModelLayer))return"externalModelLayer: array expected";for(let t=0;t<e.externalModelLayer.length;++t){var u=G.protobuf.FloorBiz.ExternalModelBizInfo.verify(e.externalModelLayer[t]);if(u)return"externalModelLayer."+u}}return null},_.fromObject=function(e){if(e instanceof G.protobuf.FloorBiz)return e;var i=new G.protobuf.FloorBiz;if(null!=e.mid&&(i.mid=String(e.mid)),null!=e.gid&&(i.gid=0|e.gid),e.extentLayer){if(!Array.isArray(e.extentLayer))throw TypeError(".protobuf.FloorBiz.extentLayer: array expected");i.extentLayer=[];for(let t=0;t<e.extentLayer.length;++t){if("object"!=typeof e.extentLayer[t])throw TypeError(".protobuf.FloorBiz.extentLayer: object expected");i.extentLayer[t]=G.protobuf.FloorBiz.ExtentBizInfo.fromObject(e.extentLayer[t])}}if(e.modelLayer){if(!Array.isArray(e.modelLayer))throw TypeError(".protobuf.FloorBiz.modelLayer: array expected");i.modelLayer=[];for(let t=0;t<e.modelLayer.length;++t){if("object"!=typeof e.modelLayer[t])throw TypeError(".protobuf.FloorBiz.modelLayer: object expected");i.modelLayer[t]=G.protobuf.FloorBiz.ModelBizInfo.fromObject(e.modelLayer[t])}}if(e.labelLayer){if(!Array.isArray(e.labelLayer))throw TypeError(".protobuf.FloorBiz.labelLayer: array expected");i.labelLayer=[];for(let t=0;t<e.labelLayer.length;++t){if("object"!=typeof e.labelLayer[t])throw TypeError(".protobuf.FloorBiz.labelLayer: object expected");i.labelLayer[t]=G.protobuf.FloorBiz.LabelBizInfo.fromObject(e.labelLayer[t])}}if(e.poiLayer){if(!Array.isArray(e.poiLayer))throw TypeError(".protobuf.FloorBiz.poiLayer: array expected");i.poiLayer=[];for(let t=0;t<e.poiLayer.length;++t){if("object"!=typeof e.poiLayer[t])throw TypeError(".protobuf.FloorBiz.poiLayer: object expected");i.poiLayer[t]=G.protobuf.FloorBiz.POIBizInfo.fromObject(e.poiLayer[t])}}if(e.polygonLayer){if(!Array.isArray(e.polygonLayer))throw TypeError(".protobuf.FloorBiz.polygonLayer: array expected");i.polygonLayer=[];for(let t=0;t<e.polygonLayer.length;++t){if("object"!=typeof e.polygonLayer[t])throw TypeError(".protobuf.FloorBiz.polygonLayer: object expected");i.polygonLayer[t]=G.protobuf.FloorBiz.PolygonBizInfo.fromObject(e.polygonLayer[t])}}if(e.liftLayer){if(!Array.isArray(e.liftLayer))throw TypeError(".protobuf.FloorBiz.liftLayer: array expected");i.liftLayer=[];for(let t=0;t<e.liftLayer.length;++t){if("object"!=typeof e.liftLayer[t])throw TypeError(".protobuf.FloorBiz.liftLayer: object expected");i.liftLayer[t]=G.protobuf.FloorBiz.LiftBizInfo.fromObject(e.liftLayer[t])}}if(e.stairLayer){if(!Array.isArray(e.stairLayer))throw TypeError(".protobuf.FloorBiz.stairLayer: array expected");i.stairLayer=[];for(let t=0;t<e.stairLayer.length;++t){if("object"!=typeof e.stairLayer[t])throw TypeError(".protobuf.FloorBiz.stairLayer: object expected");i.stairLayer[t]=G.protobuf.FloorBiz.StairBizInfo.fromObject(e.stairLayer[t])}}if(e.polygonLabelLayer){if(!Array.isArray(e.polygonLabelLayer))throw TypeError(".protobuf.FloorBiz.polygonLabelLayer: array expected");i.polygonLabelLayer=[];for(let t=0;t<e.polygonLabelLayer.length;++t){if("object"!=typeof e.polygonLabelLayer[t])throw TypeError(".protobuf.FloorBiz.polygonLabelLayer: object expected");i.polygonLabelLayer[t]=G.protobuf.FloorBiz.PolygonLabelBizInfo.fromObject(e.polygonLabelLayer[t])}}if(e.externalModelLayer){if(!Array.isArray(e.externalModelLayer))throw TypeError(".protobuf.FloorBiz.externalModelLayer: array expected");i.externalModelLayer=[];for(let t=0;t<e.externalModelLayer.length;++t){if("object"!=typeof e.externalModelLayer[t])throw TypeError(".protobuf.FloorBiz.externalModelLayer: object expected");i.externalModelLayer[t]=G.protobuf.FloorBiz.ExternalModelBizInfo.fromObject(e.externalModelLayer[t])}}return i},_.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.extentLayer=[],r.modelLayer=[],r.labelLayer=[],r.poiLayer=[],r.polygonLayer=[],r.liftLayer=[],r.stairLayer=[],r.polygonLabelLayer=[],r.externalModelLayer=[]),i.defaults&&(r.mid="",r.gid=0),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),e.extentLayer&&e.extentLayer.length){r.extentLayer=[];for(let t=0;t<e.extentLayer.length;++t)r.extentLayer[t]=G.protobuf.FloorBiz.ExtentBizInfo.toObject(e.extentLayer[t],i)}if(e.modelLayer&&e.modelLayer.length){r.modelLayer=[];for(let t=0;t<e.modelLayer.length;++t)r.modelLayer[t]=G.protobuf.FloorBiz.ModelBizInfo.toObject(e.modelLayer[t],i)}if(e.labelLayer&&e.labelLayer.length){r.labelLayer=[];for(let t=0;t<e.labelLayer.length;++t)r.labelLayer[t]=G.protobuf.FloorBiz.LabelBizInfo.toObject(e.labelLayer[t],i)}if(e.poiLayer&&e.poiLayer.length){r.poiLayer=[];for(let t=0;t<e.poiLayer.length;++t)r.poiLayer[t]=G.protobuf.FloorBiz.POIBizInfo.toObject(e.poiLayer[t],i)}if(e.polygonLayer&&e.polygonLayer.length){r.polygonLayer=[];for(let t=0;t<e.polygonLayer.length;++t)r.polygonLayer[t]=G.protobuf.FloorBiz.PolygonBizInfo.toObject(e.polygonLayer[t],i)}if(e.liftLayer&&e.liftLayer.length){r.liftLayer=[];for(let t=0;t<e.liftLayer.length;++t)r.liftLayer[t]=G.protobuf.FloorBiz.LiftBizInfo.toObject(e.liftLayer[t],i)}if(e.stairLayer&&e.stairLayer.length){r.stairLayer=[];for(let t=0;t<e.stairLayer.length;++t)r.stairLayer[t]=G.protobuf.FloorBiz.StairBizInfo.toObject(e.stairLayer[t],i)}if(e.polygonLabelLayer&&e.polygonLabelLayer.length){r.polygonLabelLayer=[];for(let t=0;t<e.polygonLabelLayer.length;++t)r.polygonLabelLayer[t]=G.protobuf.FloorBiz.PolygonLabelBizInfo.toObject(e.polygonLabelLayer[t],i)}if(e.externalModelLayer&&e.externalModelLayer.length){r.externalModelLayer=[];for(let t=0;t<e.externalModelLayer.length;++t)r.externalModelLayer[t]=G.protobuf.FloorBiz.ExternalModelBizInfo.toObject(e.externalModelLayer[t],i)}return r},_.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},_.ExtentBizInfo=(b.prototype.eid=0,b.prototype.fid="",b.prototype.type=0,b.prototype.name="",b.prototype.ename="",b.prototype.minlevel=0,b.prototype.maxlevel=0,b.create=function(t){return new b(t)},b.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},b.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},b.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.ExtentBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},b.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},b.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},b.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.ExtentBizInfo?t:(e=new G.protobuf.FloorBiz.ExtentBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},b.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},b.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},b),_.ModelBizInfo=(y.prototype.eid=0,y.prototype.fid="",y.prototype.type=0,y.prototype.name="",y.prototype.ename="",y.prototype.minlevel=0,y.prototype.maxlevel=0,y.prototype.pass=0,y.create=function(t){return new y(t)},y.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),null!=t.pass&&Object.hasOwnProperty.call(t,"pass")&&e.uint32(64).int32(t.pass),e},y.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},y.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.ModelBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;case 8:r.pass=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},y.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},y.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null!=t.pass&&t.hasOwnProperty("pass")&&!j.isInteger(t.pass)?"pass: integer expected":null:"eid: integer expected"},y.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.ModelBizInfo?t:(e=new G.protobuf.FloorBiz.ModelBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),null!=t.pass&&(e.pass=0|t.pass),e)},y.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0,i.pass=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),null!=t.pass&&t.hasOwnProperty("pass")&&(i.pass=t.pass),i},y.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},y),_.LabelBizInfo=(w.prototype.eid=0,w.prototype.fid="",w.prototype.type=0,w.prototype.name="",w.prototype.ename="",w.prototype.minlevel=0,w.prototype.maxlevel=0,w.create=function(t){return new w(t)},w.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},w.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},w.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.LabelBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},w.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},w.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},w.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.LabelBizInfo?t:(e=new G.protobuf.FloorBiz.LabelBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},w.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},w.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},w),_.PolygonBizInfo=(x.prototype.eid=0,x.prototype.fid="",x.prototype.type=0,x.prototype.name="",x.prototype.ename="",x.prototype.minlevel=0,x.prototype.maxlevel=0,x.create=function(t){return new x(t)},x.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},x.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},x.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.PolygonBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},x.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},x.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},x.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.PolygonBizInfo?t:(e=new G.protobuf.FloorBiz.PolygonBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},x.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},x.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},x),_.POIBizInfo=(M.prototype.eid=0,M.prototype.fid="",M.prototype.type=0,M.prototype.name="",M.prototype.ename="",M.prototype.minlevel=0,M.prototype.maxlevel=0,M.create=function(t){return new M(t)},M.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},M.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},M.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.POIBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},M.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},M.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},M.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.POIBizInfo?t:(e=new G.protobuf.FloorBiz.POIBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},M.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},M.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},M),_.LiftBizInfo=(E.prototype.eid=0,E.prototype.fid="",E.prototype.type=0,E.prototype.flag=0,E.prototype.floor="",E.prototype.minlevel=0,E.prototype.maxlevel=0,E.create=function(t){return new E(t)},E.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.flag&&Object.hasOwnProperty.call(t,"flag")&&e.uint32(32).int32(t.flag),null!=t.floor&&Object.hasOwnProperty.call(t,"floor")&&e.uint32(42).string(t.floor),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},E.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},E.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.LiftBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.flag=t.int32();break;case 5:r.floor=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},E.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},E.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.flag&&t.hasOwnProperty("flag")&&!j.isInteger(t.flag)?"flag: integer expected":null!=t.floor&&t.hasOwnProperty("floor")&&!j.isString(t.floor)?"floor: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},E.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.LiftBizInfo?t:(e=new G.protobuf.FloorBiz.LiftBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.flag&&(e.flag=0|t.flag),null!=t.floor&&(e.floor=String(t.floor)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},E.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.flag=0,i.floor="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.flag&&t.hasOwnProperty("flag")&&(i.flag=t.flag),null!=t.floor&&t.hasOwnProperty("floor")&&(i.floor=t.floor),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},E.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},E),_.StairBizInfo=(L.prototype.eid=0,L.prototype.fid="",L.prototype.type=0,L.prototype.flag=0,L.prototype.minlevel=0,L.prototype.maxlevel=0,L.create=function(t){return new L(t)},L.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.flag&&Object.hasOwnProperty.call(t,"flag")&&e.uint32(32).int32(t.flag),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(40).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(48).int32(t.maxlevel),e},L.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},L.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.StairBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.flag=t.int32();break;case 5:r.minlevel=t.int32();break;case 6:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},L.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},L.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.flag&&t.hasOwnProperty("flag")&&!j.isInteger(t.flag)?"flag: integer expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},L.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.StairBizInfo?t:(e=new G.protobuf.FloorBiz.StairBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.flag&&(e.flag=0|t.flag),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},L.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.flag=0,i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.flag&&t.hasOwnProperty("flag")&&(i.flag=t.flag),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},L.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},L),_.PolygonLabelBizInfo=(T.prototype.eid=0,T.prototype.fid="",T.prototype.type=0,T.prototype.width=0,T.prototype.name="",T.prototype.ename="",T.prototype.angle=0,T.create=function(t){return new T(t)},T.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.width&&Object.hasOwnProperty.call(t,"width")&&e.uint32(37).float(t.width),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(42).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(50).string(t.ename),null!=t.angle&&Object.hasOwnProperty.call(t,"angle")&&e.uint32(61).float(t.angle),e},T.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},T.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.PolygonLabelBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.width=t.float();break;case 5:r.name=t.string();break;case 6:r.ename=t.string();break;case 7:r.angle=t.float();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},T.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},T.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.width&&t.hasOwnProperty("width")&&"number"!=typeof t.width?"width: number expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.angle&&t.hasOwnProperty("angle")&&"number"!=typeof t.angle?"angle: number expected":null:"eid: integer expected"},T.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.PolygonLabelBizInfo?t:(e=new G.protobuf.FloorBiz.PolygonLabelBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.width&&(e.width=Number(t.width)),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.angle&&(e.angle=Number(t.angle)),e)},T.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.width=0,i.name="",i.ename="",i.angle=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.width&&t.hasOwnProperty("width")&&(i.width=e.json&&!isFinite(t.width)?String(t.width):t.width),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.angle&&t.hasOwnProperty("angle")&&(i.angle=e.json&&!isFinite(t.angle)?String(t.angle):t.angle),i},T.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},T),_.ExternalModelBizInfo=(S.prototype.eid=0,S.prototype.fid="",S.prototype.type=0,S.prototype.name="",S.prototype.ename="",S.prototype.minlevel=0,S.prototype.maxlevel=0,S.create=function(t){return new S(t)},S.encode=function(t,e){return(e=e||F.create()).uint32(8).int32(t.eid),null!=t.fid&&Object.hasOwnProperty.call(t,"fid")&&e.uint32(18).string(t.fid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(24).int32(t.type),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(34).string(t.name),null!=t.ename&&Object.hasOwnProperty.call(t,"ename")&&e.uint32(42).string(t.ename),null!=t.minlevel&&Object.hasOwnProperty.call(t,"minlevel")&&e.uint32(48).int32(t.minlevel),null!=t.maxlevel&&Object.hasOwnProperty.call(t,"maxlevel")&&e.uint32(56).int32(t.maxlevel),e},S.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},S.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorBiz.ExternalModelBizInfo;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.eid=t.int32();break;case 2:r.fid=t.string();break;case 3:r.type=t.int32();break;case 4:r.name=t.string();break;case 5:r.ename=t.string();break;case 6:r.minlevel=t.int32();break;case 7:r.maxlevel=t.int32();break;default:t.skipType(7&n)}}if(r.hasOwnProperty("eid"))return r;throw j.ProtocolError("missing required 'eid'",{instance:r})},S.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},S.verify=function(t){return"object"!=typeof t||null===t?"object expected":j.isInteger(t.eid)?null!=t.fid&&t.hasOwnProperty("fid")&&!j.isString(t.fid)?"fid: string expected":null!=t.type&&t.hasOwnProperty("type")&&!j.isInteger(t.type)?"type: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!j.isString(t.name)?"name: string expected":null!=t.ename&&t.hasOwnProperty("ename")&&!j.isString(t.ename)?"ename: string expected":null!=t.minlevel&&t.hasOwnProperty("minlevel")&&!j.isInteger(t.minlevel)?"minlevel: integer expected":null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&!j.isInteger(t.maxlevel)?"maxlevel: integer expected":null:"eid: integer expected"},S.fromObject=function(t){var e;return t instanceof G.protobuf.FloorBiz.ExternalModelBizInfo?t:(e=new G.protobuf.FloorBiz.ExternalModelBizInfo,null!=t.eid&&(e.eid=0|t.eid),null!=t.fid&&(e.fid=String(t.fid)),null!=t.type&&(e.type=0|t.type),null!=t.name&&(e.name=String(t.name)),null!=t.ename&&(e.ename=String(t.ename)),null!=t.minlevel&&(e.minlevel=0|t.minlevel),null!=t.maxlevel&&(e.maxlevel=0|t.maxlevel),e)},S.toObject=function(t,e){var i={};return(e=e||{}).defaults&&(i.eid=0,i.fid="",i.type=0,i.name="",i.ename="",i.minlevel=0,i.maxlevel=0),null!=t.eid&&t.hasOwnProperty("eid")&&(i.eid=t.eid),null!=t.fid&&t.hasOwnProperty("fid")&&(i.fid=t.fid),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.ename&&t.hasOwnProperty("ename")&&(i.ename=t.ename),null!=t.minlevel&&t.hasOwnProperty("minlevel")&&(i.minlevel=t.minlevel),null!=t.maxlevel&&t.hasOwnProperty("maxlevel")&&(i.maxlevel=t.maxlevel),i},S.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},S),_),i.FloorNavi=(A.prototype.mid="",A.prototype.gid=0,A.prototype.naviNodes=j.emptyArray,A.prototype.naviSegments=j.emptyArray,A.prototype.naviZones=j.emptyArray,A.prototype.naviModels=j.emptyArray,A.prototype.nextFloors=j.emptyArray,A.prototype.naviExtents=j.emptyArray,A.create=function(t){return new A(t)},A.encode=function(e,i){if((i=i||F.create()).uint32(10).string(e.mid),i.uint32(16).int32(e.gid),null!=e.naviNodes&&e.naviNodes.length)for(let t=0;t<e.naviNodes.length;++t)G.protobuf.FloorNavi.NaviNode.encode(e.naviNodes[t],i.uint32(26).fork()).ldelim();if(null!=e.naviSegments&&e.naviSegments.length)for(let t=0;t<e.naviSegments.length;++t)G.protobuf.FloorNavi.NaviSegment.encode(e.naviSegments[t],i.uint32(34).fork()).ldelim();if(null!=e.naviZones&&e.naviZones.length)for(let t=0;t<e.naviZones.length;++t)G.protobuf.FloorNavi.NaviZone.encode(e.naviZones[t],i.uint32(42).fork()).ldelim();if(null!=e.naviModels&&e.naviModels.length)for(let t=0;t<e.naviModels.length;++t)G.protobuf.FloorNavi.NaviModel.encode(e.naviModels[t],i.uint32(50).fork()).ldelim();if(null!=e.nextFloors&&e.nextFloors.length)for(let t=0;t<e.nextFloors.length;++t)i.uint32(56).int32(e.nextFloors[t]);if(null!=e.naviExtents&&e.naviExtents.length)for(let t=0;t<e.naviExtents.length;++t)G.protobuf.FloorNavi.NaviExtent.encode(e.naviExtents[t],i.uint32(66).fork()).ldelim();return i},A.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},A.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.mid=t.string();break;case 2:r.gid=t.int32();break;case 3:r.naviNodes&&r.naviNodes.length||(r.naviNodes=[]),r.naviNodes.push(G.protobuf.FloorNavi.NaviNode.decode(t,t.uint32()));break;case 4:r.naviSegments&&r.naviSegments.length||(r.naviSegments=[]),r.naviSegments.push(G.protobuf.FloorNavi.NaviSegment.decode(t,t.uint32()));break;case 5:r.naviZones&&r.naviZones.length||(r.naviZones=[]),r.naviZones.push(G.protobuf.FloorNavi.NaviZone.decode(t,t.uint32()));break;case 6:r.naviModels&&r.naviModels.length||(r.naviModels=[]),r.naviModels.push(G.protobuf.FloorNavi.NaviModel.decode(t,t.uint32()));break;case 7:if(r.nextFloors&&r.nextFloors.length||(r.nextFloors=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.nextFloors.push(t.int32());else r.nextFloors.push(t.int32());break;case 8:r.naviExtents&&r.naviExtents.length||(r.naviExtents=[]),r.naviExtents.push(G.protobuf.FloorNavi.NaviExtent.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("mid"))throw j.ProtocolError("missing required 'mid'",{instance:r});if(r.hasOwnProperty("gid"))return r;throw j.ProtocolError("missing required 'gid'",{instance:r})},A.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},A.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isString(e.mid))return"mid: string expected";if(!j.isInteger(e.gid))return"gid: integer expected";if(null!=e.naviNodes&&e.hasOwnProperty("naviNodes")){if(!Array.isArray(e.naviNodes))return"naviNodes: array expected";for(let t=0;t<e.naviNodes.length;++t){var i=G.protobuf.FloorNavi.NaviNode.verify(e.naviNodes[t]);if(i)return"naviNodes."+i}}if(null!=e.naviSegments&&e.hasOwnProperty("naviSegments")){if(!Array.isArray(e.naviSegments))return"naviSegments: array expected";for(let t=0;t<e.naviSegments.length;++t){var r=G.protobuf.FloorNavi.NaviSegment.verify(e.naviSegments[t]);if(r)return"naviSegments."+r}}if(null!=e.naviZones&&e.hasOwnProperty("naviZones")){if(!Array.isArray(e.naviZones))return"naviZones: array expected";for(let t=0;t<e.naviZones.length;++t){var n=G.protobuf.FloorNavi.NaviZone.verify(e.naviZones[t]);if(n)return"naviZones."+n}}if(null!=e.naviModels&&e.hasOwnProperty("naviModels")){if(!Array.isArray(e.naviModels))return"naviModels: array expected";for(let t=0;t<e.naviModels.length;++t){var s=G.protobuf.FloorNavi.NaviModel.verify(e.naviModels[t]);if(s)return"naviModels."+s}}if(null!=e.nextFloors&&e.hasOwnProperty("nextFloors")){if(!Array.isArray(e.nextFloors))return"nextFloors: array expected";for(let t=0;t<e.nextFloors.length;++t)if(!j.isInteger(e.nextFloors[t]))return"nextFloors: integer[] expected"}if(null!=e.naviExtents&&e.hasOwnProperty("naviExtents")){if(!Array.isArray(e.naviExtents))return"naviExtents: array expected";for(let t=0;t<e.naviExtents.length;++t){var o=G.protobuf.FloorNavi.NaviExtent.verify(e.naviExtents[t]);if(o)return"naviExtents."+o}}return null},A.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi)return e;var i=new G.protobuf.FloorNavi;if(null!=e.mid&&(i.mid=String(e.mid)),null!=e.gid&&(i.gid=0|e.gid),e.naviNodes){if(!Array.isArray(e.naviNodes))throw TypeError(".protobuf.FloorNavi.naviNodes: array expected");i.naviNodes=[];for(let t=0;t<e.naviNodes.length;++t){if("object"!=typeof e.naviNodes[t])throw TypeError(".protobuf.FloorNavi.naviNodes: object expected");i.naviNodes[t]=G.protobuf.FloorNavi.NaviNode.fromObject(e.naviNodes[t])}}if(e.naviSegments){if(!Array.isArray(e.naviSegments))throw TypeError(".protobuf.FloorNavi.naviSegments: array expected");i.naviSegments=[];for(let t=0;t<e.naviSegments.length;++t){if("object"!=typeof e.naviSegments[t])throw TypeError(".protobuf.FloorNavi.naviSegments: object expected");i.naviSegments[t]=G.protobuf.FloorNavi.NaviSegment.fromObject(e.naviSegments[t])}}if(e.naviZones){if(!Array.isArray(e.naviZones))throw TypeError(".protobuf.FloorNavi.naviZones: array expected");i.naviZones=[];for(let t=0;t<e.naviZones.length;++t){if("object"!=typeof e.naviZones[t])throw TypeError(".protobuf.FloorNavi.naviZones: object expected");i.naviZones[t]=G.protobuf.FloorNavi.NaviZone.fromObject(e.naviZones[t])}}if(e.naviModels){if(!Array.isArray(e.naviModels))throw TypeError(".protobuf.FloorNavi.naviModels: array expected");i.naviModels=[];for(let t=0;t<e.naviModels.length;++t){if("object"!=typeof e.naviModels[t])throw TypeError(".protobuf.FloorNavi.naviModels: object expected");i.naviModels[t]=G.protobuf.FloorNavi.NaviModel.fromObject(e.naviModels[t])}}if(e.nextFloors){if(!Array.isArray(e.nextFloors))throw TypeError(".protobuf.FloorNavi.nextFloors: array expected");i.nextFloors=[];for(let t=0;t<e.nextFloors.length;++t)i.nextFloors[t]=0|e.nextFloors[t]}if(e.naviExtents){if(!Array.isArray(e.naviExtents))throw TypeError(".protobuf.FloorNavi.naviExtents: array expected");i.naviExtents=[];for(let t=0;t<e.naviExtents.length;++t){if("object"!=typeof e.naviExtents[t])throw TypeError(".protobuf.FloorNavi.naviExtents: object expected");i.naviExtents[t]=G.protobuf.FloorNavi.NaviExtent.fromObject(e.naviExtents[t])}}return i},A.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.naviNodes=[],r.naviSegments=[],r.naviZones=[],r.naviModels=[],r.nextFloors=[],r.naviExtents=[]),i.defaults&&(r.mid="",r.gid=0),null!=e.mid&&e.hasOwnProperty("mid")&&(r.mid=e.mid),null!=e.gid&&e.hasOwnProperty("gid")&&(r.gid=e.gid),e.naviNodes&&e.naviNodes.length){r.naviNodes=[];for(let t=0;t<e.naviNodes.length;++t)r.naviNodes[t]=G.protobuf.FloorNavi.NaviNode.toObject(e.naviNodes[t],i)}if(e.naviSegments&&e.naviSegments.length){r.naviSegments=[];for(let t=0;t<e.naviSegments.length;++t)r.naviSegments[t]=G.protobuf.FloorNavi.NaviSegment.toObject(e.naviSegments[t],i)}if(e.naviZones&&e.naviZones.length){r.naviZones=[];for(let t=0;t<e.naviZones.length;++t)r.naviZones[t]=G.protobuf.FloorNavi.NaviZone.toObject(e.naviZones[t],i)}if(e.naviModels&&e.naviModels.length){r.naviModels=[];for(let t=0;t<e.naviModels.length;++t)r.naviModels[t]=G.protobuf.FloorNavi.NaviModel.toObject(e.naviModels[t],i)}if(e.nextFloors&&e.nextFloors.length){r.nextFloors=[];for(let t=0;t<e.nextFloors.length;++t)r.nextFloors[t]=e.nextFloors[t]}if(e.naviExtents&&e.naviExtents.length){r.naviExtents=[];for(let t=0;t<e.naviExtents.length;++t)r.naviExtents[t]=G.protobuf.FloorNavi.NaviExtent.toObject(e.naviExtents[t],i)}return r},A.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},A.NaviNode=(O.prototype.nodeId=0,O.prototype.nodeType=0,O.prototype.liftType=0,O.prototype.liftFlag=0,O.prototype.liftEntry=0,O.prototype.liftFloor="",O.prototype.linkSeg="",O.prototype.geo="",O.prototype.entranceType=0,O.prototype.entranceFloor="",O.prototype.doortype=0,O.prototype.idxs=j.emptyArray,O.prototype.pts=j.emptyArray,O.prototype.accessible=0,O.create=function(t){return new O(t)},O.encode=function(e,i){if(i=i||F.create(),null!=e.nodeId&&Object.hasOwnProperty.call(e,"nodeId")&&i.uint32(8).int32(e.nodeId),null!=e.nodeType&&Object.hasOwnProperty.call(e,"nodeType")&&i.uint32(16).int32(e.nodeType),null!=e.liftType&&Object.hasOwnProperty.call(e,"liftType")&&i.uint32(24).int32(e.liftType),null!=e.liftFlag&&Object.hasOwnProperty.call(e,"liftFlag")&&i.uint32(32).int32(e.liftFlag),null!=e.liftEntry&&Object.hasOwnProperty.call(e,"liftEntry")&&i.uint32(40).int32(e.liftEntry),null!=e.liftFloor&&Object.hasOwnProperty.call(e,"liftFloor")&&i.uint32(50).string(e.liftFloor),null!=e.linkSeg&&Object.hasOwnProperty.call(e,"linkSeg")&&i.uint32(58).string(e.linkSeg),null!=e.geo&&Object.hasOwnProperty.call(e,"geo")&&i.uint32(66).string(e.geo),null!=e.entranceType&&Object.hasOwnProperty.call(e,"entranceType")&&i.uint32(72).int32(e.entranceType),null!=e.entranceFloor&&Object.hasOwnProperty.call(e,"entranceFloor")&&i.uint32(82).string(e.entranceFloor),null!=e.doortype&&Object.hasOwnProperty.call(e,"doortype")&&i.uint32(88).int32(e.doortype),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(96).int32(e.idxs[t]);if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(105).double(e.pts[t]);return null!=e.accessible&&Object.hasOwnProperty.call(e,"accessible")&&i.uint32(112).int32(e.accessible),i},O.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},O.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviNode;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.nodeId=t.int32();break;case 2:r.nodeType=t.int32();break;case 3:r.liftType=t.int32();break;case 4:r.liftFlag=t.int32();break;case 5:r.liftEntry=t.int32();break;case 6:r.liftFloor=t.string();break;case 7:r.linkSeg=t.string();break;case 8:r.geo=t.string();break;case 9:r.entranceType=t.int32();break;case 10:r.entranceFloor=t.string();break;case 11:r.doortype=t.int32();break;case 12:if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());break;case 13:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var o=t.uint32()+t.pos;t.pos<o;)r.pts.push(t.double());else r.pts.push(t.double());break;case 14:r.accessible=t.int32();break;default:t.skipType(7&n)}}return r},O.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},O.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.nodeId&&e.hasOwnProperty("nodeId")&&!j.isInteger(e.nodeId))return"nodeId: integer expected";if(null!=e.nodeType&&e.hasOwnProperty("nodeType")&&!j.isInteger(e.nodeType))return"nodeType: integer expected";if(null!=e.liftType&&e.hasOwnProperty("liftType")&&!j.isInteger(e.liftType))return"liftType: integer expected";if(null!=e.liftFlag&&e.hasOwnProperty("liftFlag")&&!j.isInteger(e.liftFlag))return"liftFlag: integer expected";if(null!=e.liftEntry&&e.hasOwnProperty("liftEntry")&&!j.isInteger(e.liftEntry))return"liftEntry: integer expected";if(null!=e.liftFloor&&e.hasOwnProperty("liftFloor")&&!j.isString(e.liftFloor))return"liftFloor: string expected";if(null!=e.linkSeg&&e.hasOwnProperty("linkSeg")&&!j.isString(e.linkSeg))return"linkSeg: string expected";if(null!=e.geo&&e.hasOwnProperty("geo")&&!j.isString(e.geo))return"geo: string expected";if(null!=e.entranceType&&e.hasOwnProperty("entranceType")&&!j.isInteger(e.entranceType))return"entranceType: integer expected";if(null!=e.entranceFloor&&e.hasOwnProperty("entranceFloor")&&!j.isString(e.entranceFloor))return"entranceFloor: string expected";if(null!=e.doortype&&e.hasOwnProperty("doortype")&&!j.isInteger(e.doortype))return"doortype: integer expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}return null!=e.accessible&&e.hasOwnProperty("accessible")&&!j.isInteger(e.accessible)?"accessible: integer expected":null},O.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviNode)return e;var i=new G.protobuf.FloorNavi.NaviNode;if(null!=e.nodeId&&(i.nodeId=0|e.nodeId),null!=e.nodeType&&(i.nodeType=0|e.nodeType),null!=e.liftType&&(i.liftType=0|e.liftType),null!=e.liftFlag&&(i.liftFlag=0|e.liftFlag),null!=e.liftEntry&&(i.liftEntry=0|e.liftEntry),null!=e.liftFloor&&(i.liftFloor=String(e.liftFloor)),null!=e.linkSeg&&(i.linkSeg=String(e.linkSeg)),null!=e.geo&&(i.geo=String(e.geo)),null!=e.entranceType&&(i.entranceType=0|e.entranceType),null!=e.entranceFloor&&(i.entranceFloor=String(e.entranceFloor)),null!=e.doortype&&(i.doortype=0|e.doortype),e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorNavi.NaviNode.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.FloorNavi.NaviNode.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}return null!=e.accessible&&(i.accessible=0|e.accessible),i},O.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.idxs=[],r.pts=[]),i.defaults&&(r.nodeId=0,r.nodeType=0,r.liftType=0,r.liftFlag=0,r.liftEntry=0,r.liftFloor="",r.linkSeg="",r.geo="",r.entranceType=0,r.entranceFloor="",r.doortype=0,r.accessible=0),null!=e.nodeId&&e.hasOwnProperty("nodeId")&&(r.nodeId=e.nodeId),null!=e.nodeType&&e.hasOwnProperty("nodeType")&&(r.nodeType=e.nodeType),null!=e.liftType&&e.hasOwnProperty("liftType")&&(r.liftType=e.liftType),null!=e.liftFlag&&e.hasOwnProperty("liftFlag")&&(r.liftFlag=e.liftFlag),null!=e.liftEntry&&e.hasOwnProperty("liftEntry")&&(r.liftEntry=e.liftEntry),null!=e.liftFloor&&e.hasOwnProperty("liftFloor")&&(r.liftFloor=e.liftFloor),null!=e.linkSeg&&e.hasOwnProperty("linkSeg")&&(r.linkSeg=e.linkSeg),null!=e.geo&&e.hasOwnProperty("geo")&&(r.geo=e.geo),null!=e.entranceType&&e.hasOwnProperty("entranceType")&&(r.entranceType=e.entranceType),null!=e.entranceFloor&&e.hasOwnProperty("entranceFloor")&&(r.entranceFloor=e.entranceFloor),null!=e.doortype&&e.hasOwnProperty("doortype")&&(r.doortype=e.doortype),e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=e.idxs[t]}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}return null!=e.accessible&&e.hasOwnProperty("accessible")&&(r.accessible=e.accessible),r},O.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},O),A.NaviSegment=(C.prototype.segmentId=0,C.prototype.snode=0,C.prototype.enode=0,C.prototype.length=0,C.prototype.rank=0,C.prototype.name="",C.prototype.entry=0,C.prototype.desc="",C.prototype.geo="",C.prototype.through=0,C.prototype.idxs=j.emptyArray,C.prototype.pts=j.emptyArray,C.create=function(t){return new C(t)},C.encode=function(e,i){if(i=i||F.create(),null!=e.segmentId&&Object.hasOwnProperty.call(e,"segmentId")&&i.uint32(8).int32(e.segmentId),null!=e.snode&&Object.hasOwnProperty.call(e,"snode")&&i.uint32(16).int32(e.snode),null!=e.enode&&Object.hasOwnProperty.call(e,"enode")&&i.uint32(24).int32(e.enode),null!=e.length&&Object.hasOwnProperty.call(e,"length")&&i.uint32(33).double(e.length),null!=e.rank&&Object.hasOwnProperty.call(e,"rank")&&i.uint32(40).int32(e.rank),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&i.uint32(50).string(e.name),null!=e.entry&&Object.hasOwnProperty.call(e,"entry")&&i.uint32(56).int32(e.entry),null!=e.desc&&Object.hasOwnProperty.call(e,"desc")&&i.uint32(66).string(e.desc),null!=e.geo&&Object.hasOwnProperty.call(e,"geo")&&i.uint32(74).string(e.geo),null!=e.through&&Object.hasOwnProperty.call(e,"through")&&i.uint32(80).int32(e.through),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(88).int32(e.idxs[t]);if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(97).double(e.pts[t]);return i},C.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},C.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviSegment;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.segmentId=t.int32();break;case 2:r.snode=t.int32();break;case 3:r.enode=t.int32();break;case 4:r.length=t.double();break;case 5:r.rank=t.int32();break;case 6:r.name=t.string();break;case 7:r.entry=t.int32();break;case 8:r.desc=t.string();break;case 9:r.geo=t.string();break;case 10:r.through=t.int32();break;case 11:if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());break;case 12:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var o=t.uint32()+t.pos;t.pos<o;)r.pts.push(t.double());else r.pts.push(t.double());break;default:t.skipType(7&n)}}return r},C.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},C.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.segmentId&&e.hasOwnProperty("segmentId")&&!j.isInteger(e.segmentId))return"segmentId: integer expected";if(null!=e.snode&&e.hasOwnProperty("snode")&&!j.isInteger(e.snode))return"snode: integer expected";if(null!=e.enode&&e.hasOwnProperty("enode")&&!j.isInteger(e.enode))return"enode: integer expected";if(null!=e.length&&e.hasOwnProperty("length")&&"number"!=typeof e.length)return"length: number expected";if(null!=e.rank&&e.hasOwnProperty("rank")&&!j.isInteger(e.rank))return"rank: integer expected";if(null!=e.name&&e.hasOwnProperty("name")&&!j.isString(e.name))return"name: string expected";if(null!=e.entry&&e.hasOwnProperty("entry")&&!j.isInteger(e.entry))return"entry: integer expected";if(null!=e.desc&&e.hasOwnProperty("desc")&&!j.isString(e.desc))return"desc: string expected";if(null!=e.geo&&e.hasOwnProperty("geo")&&!j.isString(e.geo))return"geo: string expected";if(null!=e.through&&e.hasOwnProperty("through")&&!j.isInteger(e.through))return"through: integer expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}return null},C.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviSegment)return e;var i=new G.protobuf.FloorNavi.NaviSegment;if(null!=e.segmentId&&(i.segmentId=0|e.segmentId),null!=e.snode&&(i.snode=0|e.snode),null!=e.enode&&(i.enode=0|e.enode),null!=e.length&&(i.length=Number(e.length)),null!=e.rank&&(i.rank=0|e.rank),null!=e.name&&(i.name=String(e.name)),null!=e.entry&&(i.entry=0|e.entry),null!=e.desc&&(i.desc=String(e.desc)),null!=e.geo&&(i.geo=String(e.geo)),null!=e.through&&(i.through=0|e.through),e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorNavi.NaviSegment.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.FloorNavi.NaviSegment.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}return i},C.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.idxs=[],r.pts=[]),i.defaults&&(r.segmentId=0,r.snode=0,r.enode=0,r.length=0,r.rank=0,r.name="",r.entry=0,r.desc="",r.geo="",r.through=0),null!=e.segmentId&&e.hasOwnProperty("segmentId")&&(r.segmentId=e.segmentId),null!=e.snode&&e.hasOwnProperty("snode")&&(r.snode=e.snode),null!=e.enode&&e.hasOwnProperty("enode")&&(r.enode=e.enode),null!=e.length&&e.hasOwnProperty("length")&&(r.length=i.json&&!isFinite(e.length)?String(e.length):e.length),null!=e.rank&&e.hasOwnProperty("rank")&&(r.rank=e.rank),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),null!=e.entry&&e.hasOwnProperty("entry")&&(r.entry=e.entry),null!=e.desc&&e.hasOwnProperty("desc")&&(r.desc=e.desc),null!=e.geo&&e.hasOwnProperty("geo")&&(r.geo=e.geo),null!=e.through&&e.hasOwnProperty("through")&&(r.through=e.through),e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=e.idxs[t]}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}return r},C.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},C),A.NaviZone=(R.prototype.id=0,R.prototype.type=0,R.prototype.geo="",R.prototype.rejects=j.emptyArray,R.prototype.idxs=j.emptyArray,R.prototype.pts=j.emptyArray,R.create=function(t){return new R(t)},R.encode=function(e,i){if((i=i||F.create()).uint32(8).int32(e.id),i.uint32(16).int32(e.type),null!=e.geo&&Object.hasOwnProperty.call(e,"geo")&&i.uint32(26).string(e.geo),null!=e.rejects&&e.rejects.length)for(let t=0;t<e.rejects.length;++t)i.uint32(34).string(e.rejects[t]);if(null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(40).int32(e.idxs[t]);if(null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(49).double(e.pts[t]);return i},R.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},R.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviZone;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.id=t.int32();break;case 2:r.type=t.int32();break;case 3:r.geo=t.string();break;case 4:r.rejects&&r.rejects.length||(r.rejects=[]),r.rejects.push(t.string());break;case 5:if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());break;case 6:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var o=t.uint32()+t.pos;t.pos<o;)r.pts.push(t.double());else r.pts.push(t.double());break;default:t.skipType(7&n)}}if(!r.hasOwnProperty("id"))throw j.ProtocolError("missing required 'id'",{instance:r});if(r.hasOwnProperty("type"))return r;throw j.ProtocolError("missing required 'type'",{instance:r})},R.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},R.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isInteger(e.id))return"id: integer expected";if(!j.isInteger(e.type))return"type: integer expected";if(null!=e.geo&&e.hasOwnProperty("geo")&&!j.isString(e.geo))return"geo: string expected";if(null!=e.rejects&&e.hasOwnProperty("rejects")){if(!Array.isArray(e.rejects))return"rejects: array expected";for(let t=0;t<e.rejects.length;++t)if(!j.isString(e.rejects[t]))return"rejects: string[] expected"}if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}return null},R.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviZone)return e;var i=new G.protobuf.FloorNavi.NaviZone;if(null!=e.id&&(i.id=0|e.id),null!=e.type&&(i.type=0|e.type),null!=e.geo&&(i.geo=String(e.geo)),e.rejects){if(!Array.isArray(e.rejects))throw TypeError(".protobuf.FloorNavi.NaviZone.rejects: array expected");i.rejects=[];for(let t=0;t<e.rejects.length;++t)i.rejects[t]=String(e.rejects[t])}if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorNavi.NaviZone.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}if(e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.FloorNavi.NaviZone.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}return i},R.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.rejects=[],r.idxs=[],r.pts=[]),i.defaults&&(r.id=0,r.type=0,r.geo=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.type&&e.hasOwnProperty("type")&&(r.type=e.type),null!=e.geo&&e.hasOwnProperty("geo")&&(r.geo=e.geo),e.rejects&&e.rejects.length){r.rejects=[];for(let t=0;t<e.rejects.length;++t)r.rejects[t]=e.rejects[t]}if(e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=e.idxs[t]}if(e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}return r},R.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},R),A.NaviModel=(N.prototype.modelid=0,N.prototype.doorids=j.emptyArray,N.prototype.nodetypes=j.emptyArray,N.prototype.entrytypes=j.emptyArray,N.create=function(t){return new N(t)},N.encode=function(e,i){if((i=i||F.create()).uint32(8).int32(e.modelid),null!=e.doorids&&e.doorids.length)for(let t=0;t<e.doorids.length;++t)i.uint32(16).int32(e.doorids[t]);if(null!=e.nodetypes&&e.nodetypes.length)for(let t=0;t<e.nodetypes.length;++t)i.uint32(24).int32(e.nodetypes[t]);if(null!=e.entrytypes&&e.entrytypes.length)for(let t=0;t<e.entrytypes.length;++t)i.uint32(32).int32(e.entrytypes[t]);return i},N.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},N.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviModel;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.modelid=t.int32();break;case 2:if(r.doorids&&r.doorids.length||(r.doorids=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.doorids.push(t.int32());else r.doorids.push(t.int32());break;case 3:if(r.nodetypes&&r.nodetypes.length||(r.nodetypes=[]),2==(7&n))for(var o=t.uint32()+t.pos;t.pos<o;)r.nodetypes.push(t.int32());else r.nodetypes.push(t.int32());break;case 4:if(r.entrytypes&&r.entrytypes.length||(r.entrytypes=[]),2==(7&n))for(var a=t.uint32()+t.pos;t.pos<a;)r.entrytypes.push(t.int32());else r.entrytypes.push(t.int32());break;default:t.skipType(7&n)}}if(r.hasOwnProperty("modelid"))return r;throw j.ProtocolError("missing required 'modelid'",{instance:r})},N.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},N.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isInteger(e.modelid))return"modelid: integer expected";if(null!=e.doorids&&e.hasOwnProperty("doorids")){if(!Array.isArray(e.doorids))return"doorids: array expected";for(let t=0;t<e.doorids.length;++t)if(!j.isInteger(e.doorids[t]))return"doorids: integer[] expected"}if(null!=e.nodetypes&&e.hasOwnProperty("nodetypes")){if(!Array.isArray(e.nodetypes))return"nodetypes: array expected";for(let t=0;t<e.nodetypes.length;++t)if(!j.isInteger(e.nodetypes[t]))return"nodetypes: integer[] expected"}if(null!=e.entrytypes&&e.hasOwnProperty("entrytypes")){if(!Array.isArray(e.entrytypes))return"entrytypes: array expected";for(let t=0;t<e.entrytypes.length;++t)if(!j.isInteger(e.entrytypes[t]))return"entrytypes: integer[] expected"}return null},N.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviModel)return e;var i=new G.protobuf.FloorNavi.NaviModel;if(null!=e.modelid&&(i.modelid=0|e.modelid),e.doorids){if(!Array.isArray(e.doorids))throw TypeError(".protobuf.FloorNavi.NaviModel.doorids: array expected");i.doorids=[];for(let t=0;t<e.doorids.length;++t)i.doorids[t]=0|e.doorids[t]}if(e.nodetypes){if(!Array.isArray(e.nodetypes))throw TypeError(".protobuf.FloorNavi.NaviModel.nodetypes: array expected");i.nodetypes=[];for(let t=0;t<e.nodetypes.length;++t)i.nodetypes[t]=0|e.nodetypes[t]}if(e.entrytypes){if(!Array.isArray(e.entrytypes))throw TypeError(".protobuf.FloorNavi.NaviModel.entrytypes: array expected");i.entrytypes=[];for(let t=0;t<e.entrytypes.length;++t)i.entrytypes[t]=0|e.entrytypes[t]}return i},N.toObject=function(e,t){var i={};if(((t=t||{}).arrays||t.defaults)&&(i.doorids=[],i.nodetypes=[],i.entrytypes=[]),t.defaults&&(i.modelid=0),null!=e.modelid&&e.hasOwnProperty("modelid")&&(i.modelid=e.modelid),e.doorids&&e.doorids.length){i.doorids=[];for(let t=0;t<e.doorids.length;++t)i.doorids[t]=e.doorids[t]}if(e.nodetypes&&e.nodetypes.length){i.nodetypes=[];for(let t=0;t<e.nodetypes.length;++t)i.nodetypes[t]=e.nodetypes[t]}if(e.entrytypes&&e.entrytypes.length){i.entrytypes=[];for(let t=0;t<e.entrytypes.length;++t)i.entrytypes[t]=e.entrytypes[t]}return i},N.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},N),A.NaviExtent=(D.prototype.id=0,D.prototype.pts=j.emptyArray,D.prototype.idxs=j.emptyArray,D.create=function(t){return new D(t)},D.encode=function(e,i){if((i=i||F.create()).uint32(8).int32(e.id),null!=e.pts&&e.pts.length)for(let t=0;t<e.pts.length;++t)i.uint32(17).double(e.pts[t]);if(null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)G.protobuf.FloorNavi.NaviExtent.IndexInfo.encode(e.idxs[t],i.uint32(26).fork()).ldelim();return i},D.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},D.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviExtent;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:r.id=t.int32();break;case 2:if(r.pts&&r.pts.length||(r.pts=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.pts.push(t.double());else r.pts.push(t.double());break;case 3:r.idxs&&r.idxs.length||(r.idxs=[]),r.idxs.push(G.protobuf.FloorNavi.NaviExtent.IndexInfo.decode(t,t.uint32()));break;default:t.skipType(7&n)}}if(r.hasOwnProperty("id"))return r;throw j.ProtocolError("missing required 'id'",{instance:r})},D.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},D.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!j.isInteger(e.id))return"id: integer expected";if(null!=e.pts&&e.hasOwnProperty("pts")){if(!Array.isArray(e.pts))return"pts: array expected";for(let t=0;t<e.pts.length;++t)if("number"!=typeof e.pts[t])return"pts: number[] expected"}if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t){var i=G.protobuf.FloorNavi.NaviExtent.IndexInfo.verify(e.idxs[t]);if(i)return"idxs."+i}}return null},D.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviExtent)return e;var i=new G.protobuf.FloorNavi.NaviExtent;if(null!=e.id&&(i.id=0|e.id),e.pts){if(!Array.isArray(e.pts))throw TypeError(".protobuf.FloorNavi.NaviExtent.pts: array expected");i.pts=[];for(let t=0;t<e.pts.length;++t)i.pts[t]=Number(e.pts[t])}if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorNavi.NaviExtent.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t){if("object"!=typeof e.idxs[t])throw TypeError(".protobuf.FloorNavi.NaviExtent.idxs: object expected");i.idxs[t]=G.protobuf.FloorNavi.NaviExtent.IndexInfo.fromObject(e.idxs[t])}}return i},D.toObject=function(e,i){var r={};if(((i=i||{}).arrays||i.defaults)&&(r.pts=[],r.idxs=[]),i.defaults&&(r.id=0),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),e.pts&&e.pts.length){r.pts=[];for(let t=0;t<e.pts.length;++t)r.pts[t]=i.json&&!isFinite(e.pts[t])?String(e.pts[t]):e.pts[t]}if(e.idxs&&e.idxs.length){r.idxs=[];for(let t=0;t<e.idxs.length;++t)r.idxs[t]=G.protobuf.FloorNavi.NaviExtent.IndexInfo.toObject(e.idxs[t],i)}return r},D.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},D.IndexInfo=(k.prototype.idxs=j.emptyArray,k.create=function(t){return new k(t)},k.encode=function(e,i){if(i=i||F.create(),null!=e.idxs&&e.idxs.length)for(let t=0;t<e.idxs.length;++t)i.uint32(8).int32(e.idxs[t]);return i},k.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},k.decode=function(t,e){t instanceof I||(t=I.create(t));for(var i=void 0===e?t.len:t.pos+e,r=new G.protobuf.FloorNavi.NaviExtent.IndexInfo;t.pos<i;){var n=t.uint32();if(n>>>3==1)if(r.idxs&&r.idxs.length||(r.idxs=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)r.idxs.push(t.int32());else r.idxs.push(t.int32());else t.skipType(7&n)}return r},k.decodeDelimited=function(t){return t instanceof I||(t=new I(t)),this.decode(t,t.uint32())},k.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.idxs&&e.hasOwnProperty("idxs")){if(!Array.isArray(e.idxs))return"idxs: array expected";for(let t=0;t<e.idxs.length;++t)if(!j.isInteger(e.idxs[t]))return"idxs: integer[] expected"}return null},k.fromObject=function(e){if(e instanceof G.protobuf.FloorNavi.NaviExtent.IndexInfo)return e;var i=new G.protobuf.FloorNavi.NaviExtent.IndexInfo;if(e.idxs){if(!Array.isArray(e.idxs))throw TypeError(".protobuf.FloorNavi.NaviExtent.IndexInfo.idxs: array expected");i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=0|e.idxs[t]}return i},k.toObject=function(e,t){var i={};if(((t=t||{}).arrays||t.defaults)&&(i.idxs=[]),e.idxs&&e.idxs.length){i.idxs=[];for(let t=0;t<e.idxs.length;++t)i.idxs[t]=e.idxs[t]}return i},k.prototype.toJSON=function(){return this.constructor.toObject(this,P.util.toJSONOptions)},k),D),A),i})();class ky{constructor(){this.ks=null}}Object.assign(ky.prototype,{Ps(){this.ks||(this.ks=G.protobuf)},Is(t){return this.Ps(),this.ks.Map.decode(t)},Fs(e){for(let t=0;t<e.buffers.length;t++){var i=e.buffers[t];if(1==i.btype)return this.js(i.data)}return null},Gs(e){for(let t=0;t<e.buffers.length;t++){var i=e.buffers[t];if(7==i.btype)return this.Us(i.data)}return null},Hs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(2==r.btype&&r.gid==i)return this.Bs(r.data)}return null},zs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(3==r.btype&&r.gid==i)return this.Vs(r.data)}return null},Ws(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(4==r.btype&&r.gid==i)return this.Ys(r.data)}return null},Xs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(5===r.btype&&r.gid===i)return this.Ys(r.data)}return null},Zs(e,i){for(let t=0;t<e.buffers.length;t++){var r=e.buffers[t];if(6===r.btype&&r.gid===i)return this.Ys(r.data)}return null},js(t){this.Ps();let e=this.ks.Scene.decode(t);return e.levels=[],e.layerGroups.forEach(t=>{e.levels.push(t.gid)}),e},Us(t){return this.Ps(),this.ks.Gate.decode(t)},Bs(t){return this.Ps(),this.ks.FloorGeo.decode(t)},Vs(t){return this.Ps(),this.ks.FloorBiz.decode(t)},Ys(t){return this.Ps(),this.ks.FloorNavi.decode(t)}});class Py{constructor(t,e){this.options=e,this.extendDataMap=new Map,this.floor=null,this.map=t}setExtendDataMap(t){this.floor=t;let e=null;if(0===this.extendDataMap.size){var i=t.getLayers(p.EXTENT_LAYER)[0];for(let t=0;t<i.children.length;t++)this.extendDataMap.set(""+i.children[t].ID,{extend:i.children[t],datas:[]}),0===t&&(e=""+i.children[t].ID)}return e}dataAnalyser(e,i){if(i)for(let t=0;t<i.length;t++){var r=e.getExtendByCoords(i[t]);r&&this.extendDataMap.get(""+r.ID).datas.push(i[t])}else for(var[t,n]of this.extendDataMap)n.datas=[]}createHeatMap(t){for(var[e,i]of this.extendDataMap)if(""+e!=""+t){var r,n={};for(r in this.options)n[r]=this.options[r];n.extend=i.extend;e=new Iy(this.map,n);e.addDataSource(i.datas),e.addTo(this.floor),i.heatMap=e}}}class Iy extends Qg{constructor(t,e){super(e=e||{}),this.gs=e,this.e_=null,this.i_=e.extend,this.Ei=p.HEAT_MAP_MARKER,this.R=t,this.Im=e.backgroundColor,this.jf=e.opacity,this.vp=void 0!==e.radius?e.radius:30,this.r_=void 0!==e.valueRange?void 0!==e.valueRange.max?void 0!==e.valueRange.min?e.valueRange:{max:e.valueRange.max,min:0}:void 0!==e.valueRange.min?{max:100,min:e.valueRange.min}:{max:100,min:0}:{max:100,min:0},this.r_.min>=this.r_.max&&(this.r_={max:100,min:0}),this.n_=void 0!==e.quality?e.quality:1024,this.af=void 0===e.isPlane||e.isPlane,this.s_=this.af,this.Fp=void 0!==e.gradient?e.gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"},this.o_=e.maxOpacity,void 0===this.o_&&(this.o_=1),void 0!==this.jf&&(this.o_=this.jf),this.a_=e.minOpacity,void 0===this.a_&&(this.a_=0),this.h_=e.blur,void 0===this.h_&&(this.h_=.85),this.l_=e.scaleRadius,void 0===this.l_&&(this.l_=!0),this.T=e.height,void 0===this.T&&(this.T=1),this.af||(this.l_=!0),this.hc=[],this.u_=null,this.Ki=null,this.c_=null,this.f_=0,this.cg=null,this.lf=null,this.d_=void 0,this.v_=null,this.p_=null,this.m_=null,this.g_=null,this.__=null,this.b_=null,this.y_=this.y_.bind(this),this.w_=11,this.x_=22,this.M_=null}get bound(){var t,e;return!0===this.needUpdateBound&&null!==this.cg&&(this.mi.reset(),t=this.cg.getLayers(p.MODEL_LAYER)[0],!1===this.af?(e=this.cg.getLayers(p.EXTENT_LAYER)[0],t&&this.mi.expand(t.bound),e&&this.mi.expand(e.bound)):t&&this.mi.expand(t.bound),this.needUpdateBound=!1),this.mi.clone()}get x(){return this.o}get y(){return this.u}get height(){return this.T}set height(t){if(this.s_&&(this.T=t,this.Uv(),null!==this.e_))for(var[e,i]of this.e_.extendDataMap)""+e!=""+this.m_.ID&&(i.heatMap.height=t)}get opacity(){return this.jf}set opacity(t){if(this.jf=t,this.o_=this.jf,this.v_&&(this.v_.configure({radius:this.vp,valueRange:this.r_,maxOpacity:this.o_,minOpacity:this.a_,gradient:this.Fp,blur:this.h_}),null!==this.e_))for(var[e,i]of this.e_.extendDataMap)""+e!=""+this.m_.ID&&(i.heatMap.opacity=t)}set valueRange(t){if(void 0!==t.max&&(this.r_.max=t.max),void 0!==t.min&&(this.r_.min=t.min),this.r_.min>=this.r_.max&&(this.r_={max:100,min:0}),null!==this.e_)for(var[e,i]of this.e_.extendDataMap)""+e!=""+this.m_.ID&&(i.heatMap.valueRange=t)}get valueRange(){return this.r_}get level(){return this.cg.level}get visible(){return super.visible}set visible(t){if(this.er!==t)if(super.visible=t,this.af){if(this.Ji.visible=t,this.R.enableUpdateRender(),null!==this.e_)for(var[e,i]of this.e_.extendDataMap)""+e!=""+this.m_.ID&&(i.heatMap.visible=t)}else t?this.U.hf(this.lf):this.U.hf(null),this.R.enableUpdateRender()}simulate(t){this.f_=t}clearDataSource(){this.Ki=null,this.hc=[],null!==this.e_&&this.e_.dataAnalyser(this.cg,null)}addPoint(t,e,i){var r;t&&e&&i&&(null===this.e_?(r=this.cg.getLayers(p.EXTENT_LAYER)[0].bound,(r=this.E_(t,e,r))&&(r.x=Math.round(r.x),r.y=Math.round(r.y),r.value=i,r.radius=this.vp,this.hc.push(r))):this.e_.dataAnalyser(this.cg,[{x:t,y:e,value:i}]))}addDataSource(t){this.Ki=t,this.hc=[],null!==this.e_&&(this.e_.dataAnalyser(this.cg,null),this.e_.dataAnalyser(this.cg,t))}update(){if(null!==this.e_){var t,e,i=this.e_.extendDataMap.get(""+this.m_.ID);this.Ki=i.datas,this.hc=[];for([t,e]of this.e_.extendDataMap)""+t!=""+this.m_.ID&&(e.heatMap.addDataSource(e.datas),e.heatMap.update())}0===this.hc.length&&null!=this.Ki&&(i=this.m_,this.l_?this.L_(i.bound):this.T_()),ot.environment===q.WX&&(this.c_.width=this.u_.width,this.c_.height=this.u_.height),this.v_.setData({max:this.r_.max,min:this.r_.min,data:this.hc}),this.S_(),this.af?this.l_?(i=this.Ji.material.map,this.Ji.material.map=this.lf,this.Ji.material.map.needsUpdate=!0,this.Ji.material.needsUpdate=!0,i.dispose()):this.A_():this.U.hf(this.lf),this.R.enableUpdateRender()}addTo(i){this.cg=i;let r=null;if(this.af){let t=null,e=null;r=void 0===this.i_?(this.e_=new Py(this.R,this.gs),e=this.e_.setExtendDataMap(i),(t=this.e_.extendDataMap.get(e)).heatMap=this,t.extend):this.i_,null!==this.e_&&(this.e_.dataAnalyser(i,this.Ki),this.Ki=t.datas,this.e_.createHeatMap(e))}else if(null===this.Ki)r=this.cg.getLayers(p.EXTENT_LAYER)[0].I[0];else{var e=[],n=(r=(r=this.cg.getExtendByCoords(this.Ki[0]))||this.cg.getLayers(p.EXTENT_LAYER)[0].I[0]).Ki.Li[0];for(let t=0;t<this.Ki.length;t++)U.Le(this.Ki[t],n,n.length)&&e.push(this.Ki[t]);this.Ki=e}var t=r.bound,t=(this.p_=r.bound,this.m_=r,ot.environment===q.WX?this.c_=o.textureCanvas[0]:this.c_=document.createElement("canvas"),0!=this.f_&&this.O_(this.f_),null!=this.Ki&&(this.l_?(this.u_=this.C_(t),this.c_.width=this.u_.width,this.c_.height=this.u_.height,this.L_(t)):(t=this.R_(),this.N_(t),this.b_=this.C_(this.g_),ot.environment===q.WX?this.__=o.textureCanvas[0]:this.__=document.createElement("canvas"),this.__.width=this.b_.width,this.__.height=this.b_.height,this.L_(this.g_,t))),{radius:this.vp,valueRange:this.r_,maxOpacity:this.o_,minOpacity:this.a_,gradient:this.Fp,blur:this.h_});this.l_?t.canvas=this.c_:t.canvas=this.__,this.v_=ot.heatmap.create(t),null!==this.Ki&&this.v_.setData({max:this.r_.max,min:this.r_.min,data:this.hc}),super.addTo(i),this.needUpdateBound=!0}remove(){if(this.l_||(this.R.off("zoom",this.y_),this.R.off("levelChanged",this.y_),this.R.off("visibleLevelsLoaded",this.y_),this.R.off("move",this.y_),this.R.off("viewChanged",this.y_),this.R.off("resize",this.y_)),super.remove(),null!==this.e_){for(var[t,e]of this.e_.extendDataMap)""+t!=""+this.m_.ID&&e.heatMap.remove();this.e_.extendDataMap.clear()}}dispose(){if(super.dispose(),this.cg=null,this.lf&&this.lf.dispose(),(this.lf=null)!==this.e_){for(var[t,e]of this.e_.extendDataMap)e.heatMap.cg=null,e.heatMap.lf=null;this.e_.extendDataMap.clear()}}}Object.assign(Iy.prototype,{S_(){var t,e;ot.environment===q.WX?(this.l_||this.D_(),t=this.c_.toDataURL("image/png"),this.lf?this.image&&(this.image.crossOrigin="Anonymous",this.image.onload=()=>{this.lf.image=this.image,this.Ji.material.map=this.lf,this.Ji.material.map.needsUpdate=!0,this.Ji.material.needsUpdate=!0,this.R.enableUpdateRender()},this.image.src=t):(e=new f,(this.lf=e).minFilter=qe,ot.textureHelper.createImage({url:t,onload:t=>{this.lf.image=t,this.lf.needsUpdate=!0,this.image=t,this.Ji.material.map=this.lf,this.Ji.material.map.needsUpdate=!0,this.Ji.material.needsUpdate=!0,this.R.enableUpdateRender()}}))):(this.l_||this.D_(),this.lf=new f(this.k_(this.c_)))},P_(){var t=new wo(16777215);return t.opacity=1,t.transparent=!0,t.map=this.lf,t.map&&(t.map.needsUpdate=!0),t.depthTest=!1,t.needsUpdate=!0,t},Xh(){if(!this.ef){var t,e,i=this.m_.Ji;if(i)if(this.lf=null,this.S_(),this.af)this.l_?(t=i.userData,i.userData={},e=i.clone(),i.userData=t,e.name="heatMap",e.scale.z=.001,e.position.y+=this.T,i=this.P_(),e.material=i,this.Ji=e,this.Ji.mapNode=this):this.A_(),this.ef=!0;else{this.ef=!0;var r=this.cg.getModelMeshs();for(let t=0;t<r.length;t++)if(r[t]){this.ef=!0;break}}this.rr(_).enableUpdateRender(),this.l_||(this.R.on("zoom",this.y_),this.R.on("levelChanged",this.y_),this.R.on("visibleLevelsLoaded",this.y_),this.R.on("move",this.y_),this.R.on("viewChanged",this.y_),this.R.on("resize",this.y_))}return this.ef},D_(){var t,e,i;this.af?this.c_=this.__:(this.u_=this.C_(this.p_),e=this.u_.width,i=this.u_.height,this.c_.width=e,this.c_.height=i,(t=this.c_.getContext("2d")).clearRect(0,0,e,i),e=(this.g_.min.x-this.p_.min.x)/(this.p_.max.x-this.p_.min.x)*e,i=(this.p_.max.y-this.g_.max.y)/(this.p_.max.y-this.p_.min.y)*i,t.drawImage(this.__,e,i,+this.__.width,+this.__.height))},Uv(){this.Ji.position.y=this.T,this.rr(_).enableUpdateRender()},E_(t,e,i){t={x:(t-i.min.x)/(i.max.x-i.min.x),y:(i.max.y-e)/(i.max.y-i.min.y)};return this.l_?(t.x=t.x*this.u_.width,t.y=t.y*this.u_.height):(t.x=t.x*this.b_.width,t.y=t.y*this.b_.height),t},I_(){var t,e;return ot.environment===q.WX?[t=ot.window.screenWidth/2.54,t]:(t=[],void 0!==window.screen.deviceXDPI?(t[0]=window.screen.deviceXDPI,t[1]=window.screen.deviceYDPI):((e=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(e),t[0]=parseInt(e.offsetWidth),t[1]=parseInt(e.offsetHeight),e.parentNode.removeChild(e)),t)},C_(e){let i=e.max.x-e.min.x,r=e.max.y-e.min.y,n=(i<1&&(i=1),r<1&&(r=1),null);if(this.l_){n={width:Math.round(i),height:Math.round(r)};e=this.I_();n.width=parseInt(n.width*e[0]/25.4),n.height=parseInt(n.height*e[1]/25.4);let t=1;(n.width>=this.n_||n.height>=this.n_)&&(n.width>=n.height?(t=n.height/n.width,n.width=this.n_,n.height=parseInt(this.n_*t)):(t=n.width/n.height,n.height=this.n_,n.width=parseInt(this.n_*t)))}else{var e=this.F_(),t=Math.round(i/e),e=Math.round(r/e);n={width:t,height:e}}return n},k_(t){let e=Et.floorPowerOfTwo(t.width),i=Et.floorPowerOfTwo(t.height);this.l_||(e>i?4096<e&&(r=e/4096,e=4096,i/=r):4096<i&&(r=i/4096,i=4096,e/=r)),void 0===this.d_&&(this.d_=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this.d_.width=e,this.d_.height=i;var r=this.d_.getContext("2d");return void 0!==this.Im&&(r.fillStyle=this.Im,r.fillRect(0,0,e,i)),r.drawImage(t,0,0,e,i),this.d_},L_(e,t){let i=null;i=t||this.Ki;for(let t=0;t<i.length;t++){var r,n=this.E_(i[t].x,i[t].y,e);if(!n)return!0;n.x=Math.round(n.x),n.y=Math.round(n.y),n.value=i[t].value,this.l_?(r=this.u_.width/this.p_.size.x,n.radius=this.vp*r):n.radius=this.vp,this.hc.push(n)}},O_(t){this.Ki=[];for(var e=this.m_.Ki.Li[0];this.Ki.length<t;){var i=Math.floor(this.p_.min.x+Math.random()*this.p_.size.x+1),r=Math.floor(this.p_.min.y+Math.random()*this.p_.size.y+1),n=this.r_.min+Math.floor(Math.random()*(this.r_.max-this.r_.min)+1);U.Le({x:i,y:r},e,e.length)&&this.Ki.push({x:i,y:r,value:n})}},y_(){this.ef&&null!==this.Ki&&this.er&&this.j_()&&(this.hc.length=0,this.T_(),this.update())},j_(){let e=!1;var i=Array.from(this.R.getRenderManager().getRenderList().keys()),r=this.cg.parent;for(let t=0;t<i.length;t++){var n=i[t].split("%A%B%C%D");if(""+n[0]==""+r.buildingID&&""+n[1]==""+this.cg.level){e=!0;break}}return e},T_(){var t=this.R_();this.N_(t),this.b_=this.C_(this.g_),this.L_(this.g_,t),this.v_.G_.setDimensions(this.b_.width,this.b_.height)},N_(e){this.g_=new $n;let i=null,r=null,n=null,s=null;var t=this.F_()*this.vp;for(let t=0;t<e.length;t++)(null===i||i>e[t].x)&&(i=e[t].x),(null===r||r>e[t].y)&&(r=e[t].y),(null===n||n<e[t].x)&&(n=e[t].x),(null===s||s<e[t].y)&&(s=e[t].y);t=[{x:i-t,y:r-t},{x:i-t,y:s+t},{x:n+t,y:s+t},{x:n+t,y:r-t}];this.g_.expandByCoords(t)},R_(){var i=[],r=this.Ki,t=this.F_()*this.vp;for(let e=0;e<r.length;e++){var n=sg.circleBuilder(t,r[e],32);for(let t=0;t<n.length;t++)if(this.U_(n[t])){i.push(r[e]);break}}return i},U_(t){var t=new Lt(t.x-this.R.x,this.cg.height,this.R.y-t.y),e=this.R.camera,t=t.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix);return!(1<Math.abs(t.x)||1<Math.abs(t.y)||1<Math.abs(t.z))},F_(){var t={x:ot.document.body.clientWidth/2,y:ot.document.body.clientHeight/2,z:this.cg.height+this.T,buildingID:this.cg.parent.buildingID},e={x:t.x+1,y:t.y,z:this.cg.height+this.T,buildingID:this.cg.parent.buildingID},t=st.coordsScreenToMap(this.R,t),e=st.coordsScreenToMap(this.R,e),t=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y));return this.R.getZoom()<this.w_?76.43745851702988:t},A_(t){this.Ji&&this.Ji.parent&&(this.Ji.parent.remove(this.Ji),this.Ji.material.map?.dispose(),this.Ji.geometry.dispose(),this.Ji.geometry=void 0,this.Ji.material.dispose(),this.Ji.material=void 0,this.Ji=void 0);let e=!1;t||(t=this.g_,e=!0);var i=new eo(t.size.x,t.size.y,1,1),r=this.P_(),i=new Q(i,r);i.name="heatMap",i.position.y=this.T,i.position.x=t.center.x-this.R.x,i.position.z=-t.center.y+this.R.y,i.rotation.set(-Math.PI/2,0,0,"XYZ"),null!==this.M_&&(r.clippingPlanes=this.M_,r.clipping=!0),i.material=r,this.Ji=i,this.Ji.mapNode=this,e&&this.U.scene.add(this.Ji)},H_(e){let i=[];var r=[];for(let t=0;t<e.length;t++)i.push({x:e[t].x,y:e[t].y});U.isClockwise(i[0],i[1],i[2])||(i=i.reverse());for(let t=0;t<i.length-1;t++){var n=i[t],s=i[t+1],o=(n.x+s.x)/2-this.R.x,a=-(n.y+s.y)/2+this.R.y,n=Eg(U.getAngle({p1:n,p2:s}),{x:o,y:0,z:a},this),s=new Ft,o=new Lt,a=new Lt;o.set(0,0,1).applyQuaternion(n.quaternion),a.copy(n.position),s.setFromNormalAndCoplanarPoint(o,a),r.push(s),n.parent.remove(n)}return r}});class Fy{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}contains(t){return t.x>=this.x&&t.y>=this.y&&t.x<this.x+this.width&&t.y<this.y+this.height}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}class jy{constructor(t,e=1,i=8,r=0){this.bound=t,this.maxPoints=e,this.maxDepth=i,this.depth=r,this.points=[],this.nodes=[]}insert(t){if(this.bound.contains(t)){if(this.points.length<this.maxPoints||this.depth>=this.maxDepth)return this.points.push(t),!0;0===this.nodes.length&&this.split();for(var e of this.nodes)if(e.insert(t))return!0}return!1}split(){var t,e=this.bound.x,i=this.bound.y,r=this.bound.width/2,n=this.bound.height/2;this.nodes.push(new jy(new Fy(e,i,r,n),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new jy(new Fy(e+r,i,r,n),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new jy(new Fy(e,i+n,r,n),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new jy(new Fy(e+r,i+n,r,n),this.maxPoints,this.maxDepth,this.depth+1));for(t of this.points)for(var s of this.nodes)s.insert(t);this.points=[]}query(t){let e=[];if(this.bound.intersects(t)){for(var i of this.points)t.contains(i)&&e.push(i);for(var r of this.nodes)e=e.concat(r.query(t))}return e}}class Gy{constructor(){}scatterPoints(e,t){var i=t.min.x,r=t.min.y,n=t.max.x-t.min.x,t=t.max.y-t.min.y,i=new Fy(i,r,n,t),s=new jy(i);for(let t=0;t<e.length;t++)s.insert(e[t]);return s}clusterPoints(e,i,r,t){var n=[];t&&e.sort(function(t,e){return e.weight-t.weight});for(let t=0;t<e.length;t++){var s=e[t];if(!s.clustered){let t=i.query(new Fy(s.x-r/2,s.y-r/2,r,r));if(0!=(t=t.filter(function(t){return!0!==t.clustered})).length){for(var o of t)o.clustered=!0;n.push(t)}}}return n}getClusterCenter(i,r=!1){var n=[];for(let e=0;e<i.length;e++){var s,o,a=i[e].length;let t={};a<=0||(s=i[e][0].level,o=i[e][0].buildingID,(t=r?this.get_centroid(i[e],r):this.get_centroid(i[e])).level=s,t.buildingID=o,t.num=a,n.push(t))}return n}get_centroid(n,t=!1){var s={};if(0!=n.length){let e=0,i=0,r=0;if(t){for(let t=0;t<n.length;t++){var o=n[t];e+=o.x*o.weight,i+=o.y*o.weight,r+=o.weight}if(0==r)return s;e/=r,i/=r}else{for(let t=0;t<n.length;t++){var a=n[t];e+=a.x,i+=a.y}e/=n.length,i/=n.length}s={x:e,y:i}}return s}}class Uy{constructor(t){this.B_=t.render,this.R=t.map,this.z_=t.gridSize,void 0===this.z_&&(this.z_=100),this.hc=t.points,this.x_=t.maxZoom,void 0===this.x_&&(this.x_=20),this.V_=t.renderClusterMarker,this.W_=t.renderMarker,this.Y_=t.content,this.X_=t.clusterMarkerUserDefine,void 0===this.X_&&(this.X_=!1),this.Z_=new Map,this.q_=null,this.J_=new Gy,this.K_=null,this.Yv=t.buildingID,void 0===this.Yv&&(this.Yv=this.R.getMapOptions().buildingID),this.mr=t.level,this.mi=null,this.y_=this.y_.bind(this),this.K=this.K.bind(this),this.Q_=this.Q_.bind(this),this.tb=[],this.eb=[],this.B=0,this.ib="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAACDFJREFUeF7Fmw2MXFUVx3/nzczOdrtt3LZaSYFEDdBqMFKgIUESqhVaxS4xYIJBRVZaMKxktYvT7XZ3ust+0G3aKrVAaJvYBqM0JkitfIjWmDUW6xeU+AFVI2CBCrSpbdmZ2feOuW936n5137vvvdk9yWQ+3vmf8z//e+/7uPeOMFW2Rc9DWYLwMeCjwAeBuUDtMIVTwNvAP4DDwJ+A52iS1ytJUSoZnIc1wylWIHwJ+Dgw3zLfm0A/ym5qeZLVUrLEB7pXToBNeiMO3wKuCmQRzuEgHvezRh4P5x7OK3kBNutH8NiKsCwcBUsv5VmUJprlRUvkhO7JCtCnDQgbgTlJkJskxnGUZpplZ9w8yQnQpx0I6+MSssIrnTRLmxVmjHMyAvTpduCuOERiYB+kWb4WFR9fgE3ag0cuKoFEcA69rJG1UWLFE6BHb8ch9jiMQnwcRvkyOdltGyu6AN26EIfngSrbpBXyH8DjMlrkrzbxowvQqz8HPmGTbAp8D5ATK07RBOjVepREb0gSE0e4kZz8OGw8ewEe0xRH+CNwadgkAX7l29tMQvEOU2QxeRkME89egPu0Hond+r8G9iH04/GaT9ThfNR/XvgscHUY8uf0EeppkSfCxIgiwE+BFWGCT+DzEg7NgeS6dSUefcDFkfIIT7BO6sNg7QTo0vkoLwGzwwQf43OYNDeQk1dCYXv1Qgb5ScShdpJBLiIvx4Jy2QnQqZ8DfhQUdILj/yTFlbSIed4Pb906F5dDwAfCg4Y9hZW0yr4gnJ0AHdoJtAYFHXdcWMF6ecoaZwCduhzlSWuseU5oD35OsBNgg5pLX6ixdZaw8Axtcr11ASMBHfo0ynWWMfbRLiuDMLYCmMufmdKysa/SHvOxdYM2ADtskgLP0y6BXO0EyKu5ZC2wIPIuKS5nvfzFAjPetVMX4fJ7YIZFnKPkJZCrnQDtehx4jwWJNxD/bGwmPKNbXmtRXgbebxHkBBukLsjfToA2fWt4Jjcobvn4URw+RF4GwgIm9GvULHX83bL3vUOHmFnnSc1WgH8BFwYFHXH8BIN8mO6YU9steh5p/mzZ+16lQwK52gnQqr8FrrQQwNziLqdDnrbCjHVu1eVgfSn8HfdJIFdbAX6I8nnLYrbRJY2WmNHu6/QB4G7LGHvpkkCudgKs1VYEczNkY2+hLKTH8i6wnCGv8yhiriLzbJICbXRLIFc7AVr0UyjPWBIx7nvoEbM6ZG853YNwqzVQuI5u+VkQzk6AnNYh/uUo8Ow6LrHSQq/0BBEadTynaxG6rTBDzv8hy8Xk5UQQ1k4AE22tPoryhaDAEx5XNjODdYGXxbxW8y5dCN+IlAe+R6/cFgZrL0BOl6EEdq1Jkv8B+DZpDtAlr47yu1fPR/x5xnuAxWEKOIfPNdwv/WHw9gKYqPfqr4BrwiSYxMc8Gr/gd9che+/wsrn98Bqd5Ck2SugJm6gCfBJ4NqYAlYE7XEGvmOeGUBZNABN6je4FbgqVZeqctrHJ7p4jugBmvHr+Tg6bh6NKSvEyBa7gATlpkyS6AEO94DOoP2833ebisIQ+MSdYK4sngEn1Td3or9VPpymNbJFtUSjEF8BkvUf34/DpKARiY5QdbJU7osZJRoAmnYOHWexYGJVIRFw/dSwNuwo0UY5kBBjqBZcI/rTVzIjF2MJe1xKL2S5v2AJH+icngIn6dV0uYFaOko07vsKCOixlq/wmTvEGmzjRVKPerlR204QIt7jfkR/ELb4iApigzt26WaEpCYJjYwhs9LaJ2X+YiCXeA8qspFEfRy0XUYJKUvbpd4MXO4LCVO4cMDLyKq1xMpgxavYFJ2F/82ZwOZvkdBLBzjZUksHGxbpLL0kJBxO4XS44cFVpu5gN1IlaxYZAmWX6Tr1WHQ7EYu1xk/uQRFmVDkxbcQH8k+KdmhOwmw77fx99yH1QKrYJc0oEMLVkVuv3FW4JbJLRDs8NPixJ7TafMPWUCUCjzs4UeVHhgpAiuE6KS4vbYy6sBiSbOgGA9CpdqvCLMAKo0uw9IpvC+MbxmVIB/KFwhz6mcPNkpBWOuAtYFOchJ6woUy9Ag16mwqQTFyrc6j4ij4YtIo7flAtgyKYbdD+cc/7ghcGdZheKaJzCwmKnS4CrxfwZagJzlPrCrnCbHMMWOZnftAhgCGUbtN8bsyNUlEPFXbIkicLCxpg+Ab6iN6gwah+fwPWFXRJl8TVsveP8KitAXh3eJoNLhjOk8UhRQ6rMoqrAL4FFw98PFYssYxbV/vczmJlelxoGSVFiLiXy4kWu9BzABAVQ4YvUkKamOstMz/MLyaiSQnAw7x7if3bQlMcxz+U2XNrMtIymaUwJ+93ynysVz0cJLoon5h1KjsPAQIHTDHKGPZyJe7KML8DNmmIW86tS1KnHzHKBfrGmAEPf2MjP5muKk54yS4ocRDjqZLjWc6jVQbJnG8tIZ+IYK382ccxvRhSH00WX4/yXN9krRiBriy1AdrVe5LoswKMgUPILDWMeUkpzrKpAHod/Fx12ZBze55cXxjz/OpnBIZtSXivslCNhYGN9YgvAKp2XcbmAFFWmu8tQ+7h+y08mxtBwMOM8jUvRfw8ygzE9QUmp4PjDwqVYKvEKu6NtwYkvgCFthkEtc7IZZqtSrUIWjypD0gghRoiRYpSHxVAxBf/8MCTEUO8xv5fNtPRw4b64DkVRCiIMFEqc5BTvRO3+JkUyAoxqORWaqOY0VZSoQsiYV9Z0V9NyptjM8AkR8EUyRMpd3whVwvVbV3ALZliZX8wrQ5GZFNnCQNyTX5ny/wAFqGhfpVfGKAAAAABJRU5ErkJggg==",this.Xh(),this.Yt=new G_}dispose(){for(let t=0;t<this.tb.length;t++)this.tb[t].marker?.remove(),delete this.tb[t];if(0<this.Z_.size)for(var[t,e]of this.Z_)for(let t=0;t<e.length;t++)e[t].marker.parent&&e[t].marker.remove();this.Z_.clear(),this.tb.length=0,this.eb.length=0,this.rb(),this.hc.length=0,this.K_=void 0,this.R.off("zoom",this.y_),this.R.off("move",this.y_),this.R.off("viewChanged",this.y_),this.R.off("resize",this.y_),this.X_&&this.R.off("click",this.Q_)}on(t,e){this.Yt.Lm(t,e)}}Object.assign(Uy.prototype,{Xh(){this.Vi().getLayers(p.EXTENT_LAYER)[0]?(this.mi=this.Vi().getLayers(p.EXTENT_LAYER)[0].bound,this.nb(),this.sb(!0),this.R.on("zoom",this.y_),this.R.on("move",this.y_),this.R.on("viewChanged",this.y_),this.R.on("resize",this.y_),this.X_&&this.R.on("click",this.Q_)):this.R.on("update",this.K)},nb(){this.K_=this.J_.scatterPoints(this.hc,this.mi)},sb(t){let e=this;if(this.R.getZoom()<this.x_){if(t){for(let t=0;t<this.hc.length;t++)this.hc[t].clustered=null;var i=this.ob();this.q_=this.ab(this.hb(this.hc,this.K_,i))}null!==this.q_&&(!r()||this.B_?(i=this.R_(this.q_),this.lb(i)):this.ub(this.R.getZoom(),t))}else!r()||this.B_?(i=this.R_(this.hc),this.lb(i)):this.ub("other",t);if(this.B_){let e=[],i=this.Yv;i===this.R.getMapOptions().buildingID&&(i=null),this.tb.forEach(t=>{e.push({x:t.marker.x,y:t.marker.y,level:this.mr,buildingID:i,isCluster:"multiple"===t.type,points:t.points||[]})}),Xr.compareArrays(this.eb,e)||(this.eb=e,this.B_(e))}function r(){return e.X_&&e.V_}},ub(t){for(var[e,i]of this.Z_)if(""+t!=""+e)for(let t=0;t<i.length;t++)null!==i[t].marker&&(i[t].marker.visible=!1);let r=this.Z_.get(""+t);if(!r){r=[];let i=this.q_;""+t=="other"&&(i=this.hc);for(let e=0;e<i.length;e++){let t=i[e].num;void 0===t&&(t=1),r.push({markers:i[e].markers,num:t,marker:null,x:i[e].x,y:i[e].y})}this.Z_.set(""+t,r)}this.cb(r)},R_(e){var i=[];for(let t=0;t<e.length;t++)this.U_(e[t])&&i.push(e[t]);return i},cb(i){for(let e=0;e<i.length;e++)if(this.U_(i[e]))if(null===i[e].marker)if(1<i[e].num){var r={marker:null,count:i[e].num,x:i[e].x,y:i[e].y};this.V_(r),null!==r.marker?(i[e].marker=r.marker,i[e].marker.clusterPoints=i[e].markers,i[e].marker.parent||(r=this.Vi(i[e].marker.type),i[e].marker.addTo(r))):((r=this.fb(i[e],this.vb(i[e].num))).getRenderNode().point=i[e],i[e].marker=r,n=this.Vi(r.type),r.addTo(n))}else{let t=null;t=this.W_&&(r={x:i[e].x,y:i[e].y},this.W_(r),t=r.marker)||new q_({url:this.ib,collision:!1,x:i[e].x,y:i[e].y}),i[e].marker=t;var n=this.Vi(t.type);t.addTo(n)}else i[e].marker.visible=!0;else null!==i[e].marker&&(i[e].marker.visible=!1)},lb(r){let n=this;if(0===this.tb.length)for(let t=0;t<r.length;t++)this.pb(r[t]);else{var e=[],i=[];for(let t=0;t<r.length;t++){var s,o=l(r[t]);null!==o&&((s=this.tb[o]).marker.moveTo({x:r[t].x,y:r[t].y}),s.marker.getRenderNode().point=r[t],s.points=r[t].markers,e.push(s),this.tb.splice(o,1),i.push(t),"multiple"===s.type)&&this.V_&&(o={marker:s.marker,count:r[t].num},this.V_(o))}r=t(i);for(let t=i.length=0;t<r.length&&0!==this.tb.length;t++){var a,h=l(r[t],!0);null!==h&&((h=this.tb.splice(h,1)[0]).marker.moveTo({x:r[t].x,y:r[t].y}),"multiple"===h.type&&(h.marker.getRenderNode().point=r[t],h.points=r[t].markers,h.num=r[t].num,this.V_?(h.marker.content="<div></div>",a={marker:h.marker,count:r[t].num},this.V_(a)):h.marker.content=this.vb(r[t].num)),i.push(t),e.push(h))}r=t(i);for(let t=i.length=0;t<r.length;t++)this.pb(r[t],e);for(let t=0;t<this.tb.length;t++)this.tb[t].marker.remove();this.tb.length=0,this.tb=e}function l(e,i){let r=null;for(let t=0;t<n.tb.length;t++)if(void 0===e.num||1===e.num){if("single"===n.tb[t].type){if(!n.W_){r=t;break}if(n.tb[t].marker.x===e.x&&n.tb[t].marker.y===e.y){r=t;break}}}else if(i){if("multiple"===n.tb[t].type){r=t;break}}else if(n.tb[t].num===e.num){r=t;break}return r}function t(e){var i=[];for(let t=0;t<r.length;t++)((e,i)=>{let r=!0;for(let t=0;t<e.length;t++)if(e[t]===i){r=!1;break}return r})(e,t)&&i.push(r[t]);return i}},vb(t){let e=null;return e=void 0===this.Y_?'<div style="background: rgba(73,102,245,0.8);height: 50px;width: 50px;border: 2px solid #3F5BC0;border-radius: 25px;box-shadow: rgb(255, 204, 204) 0px 0px 5px;line-height: 50px;color: rgb(255, 255, 255);font-size: 14px;text-align: center;">'+t+"</div>":this.Y_.replace("${num}",""+t)},pb(e,i){if(1<e.num)this.V_?(n={marker:r=this.fb(e,"<div></div>"),count:e.num},this.V_(n),(i||this.tb).push({points:e.markers,type:"multiple",num:e.num,marker:r})):(n=this.fb(e,this.vb(e.num)),(i||this.tb).push({points:e.markers,type:"multiple",num:e.num,marker:n}));else{let t=null;t=this.W_&&(r={x:e.x,y:e.y},this.W_(r),t=r.marker)||new q_({url:this.ib,collision:!1,x:e.x,y:e.y});var r,n=this.Vi(t.type);t.addTo(n),(i||this.tb).push({type:"single",num:e.num,marker:t})}},fb(t,e){let i=new ot.FMDomMarker({map:this.R,x:t.x,y:t.y,collision:!1,anchor:Yr.BOTTOM,content:e});e=this.Vi(i.type);return i.addTo(e),i.getRenderNode().point=t,ot.environment==q.BROWSER&&(i.getRenderNode().element.addEventListener("mousedown",t=>{this.B=(new Date).getTime()}),i.getRenderNode().element.addEventListener("mouseup",t=>{if(!(200<(new Date).getTime()-this.B)){let t=this.Yv;t===this.R.getMapOptions().buildingID&&(t=null);var e=i.getRenderNode().point;this.Yt.Wt({type:"click",buildingID:t,coords:{x:e.x,y:e.y},level:this.mr,target:i,markers:r(e.markers)})}}),i.getRenderNode().element.addEventListener("touchstart",t=>{this.B=(new Date).getTime()}),i.getRenderNode().element.addEventListener("touchend",t=>{if(!(200<(new Date).getTime()-this.B)){let t=this.Yv;t===this.R.getMapOptions().buildingID&&(t=null);var e=i.getRenderNode().point;this.Yt.Wt({type:"click",buildingID:t,coords:{x:e.x,y:e.y},level:this.mr,target:i,markers:r(e.markers)})}})),i;function r(e){var i=[];for(let t=0;t<e.length;t++)i.push({x:e[t].x,y:e[t].y});return i}},ob(){var t={x:ot.document.body.clientWidth/2,y:ot.document.body.clientHeight/2},e={x:t.x+this.z_,y:t.y},t=st.coordsScreenToMap(this.R,t),e=st.coordsScreenToMap(this.R,e);return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},hb(e,i,r){var n=[];for(let t=0;t<e.length;t++){var s=e[t];if(!s.clustered){let t=i.query(new Fy(s.x-r/2,s.y-r/2,r,r));if(0!=(t=t.filter(function(t){return!0!==t.clustered})).length){for(var o of t)o.clustered=!0;n.push(t)}}}return n},ab(n){var t=[];for(let r=0;r<n.length;r++){let e=0,i=0;var s=n[r].length;if(!(s<=0)){var o=n[r][0].level,a=n[r][0].buildingID;for(let t=0;t<s;t++)e+=n[r][t].x,i+=n[r][t].y;t.push({x:e/s,y:i/s,level:o,buildingID:a,num:s,markers:n[r]})}}return t},Q_(t){var e=t.targets;let i=null;for(let t=0;t<e.length;t++)if(e[t].clusterPoints){i=e[t];break}if(null!==i){let t=this.Yv;t===this.R.getMapOptions().buildingID&&(t=null),this.Yt.Wt({type:"click",buildingID:t,coords:{x:i.x,y:i.y},level:this.mr,target:i,markers:(e=>{var i=[];for(let t=0;t<e.length;t++)i.push({x:e[t].x,y:e[t].y});return i})(i.clusterPoints)})}},y_(e){if(this.j_()){let t=!1;"zoom"===e.type&&(t=!0),this.sb(t)}},j_(){let e=!1;var i=Array.from(this.R.getRenderManager().getRenderList().keys());for(let t=0;t<i.length;t++){var r=i[t].split("%A%B%C%D");if(""+r[0]==""+this.Yv&&""+r[1]==""+this.mr){e=!0;break}}return e},U_(t){var e=this.Vi(),e=new Lt(t.x-this.R.x,e.height,this.R.y-t.y),t=this.R.camera,e=e.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);return!(1<Math.abs(e.x)||1<Math.abs(e.y))},rb(){!function e(i){i.points.length=0;for(let t=0;t<i.nodes.length;t++)e(i.nodes[t]),delete i.nodes[t];i.nodes.length=0}(this.K_)},Vi(t){return""+t==""+p.LOCATION_MARKER?this.R:this.R.getBuilding(this.Yv).getFloor(this.mr)},K(){this.Vi().getLayers(p.EXTENT_LAYER)[0]&&(this.Xh(),this.R.off("update",this.K))}});var Hy={exports:{}},By=(Hy.exports,(t=>{var e,i;e=is,i=function(){var l,n={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},s=(l=n.defaultRadius,t.prototype={mb:function(t,e){var i=t[this.gb],r=t[this._b],n=this.bb,s=this.Ki,o=this.fi,a=this.ci,h=t[this.yb]||1,t=t.radius||this.wb||l,n=(s[i]||(s[i]=[],n[i]=[]),s[i][r]?s[i][r]+=h:(s[i][r]=h,n[i][r]=t),s[i][r]);return o<n?(e?this.setDataMax(n):this.fi=n,!1):n<a?(e?this.setDataMin(n):this.ci=n,!1):{x:i,y:r,value:h,radius:t,min:a,max:o}},xb:function(){var t,e=[],i=this.Ki,r=this.bb;for(t in i)for(var n in i[t])e.push({x:t,y:n,radius:r[t][n],value:i[t][n]});return{min:this.ci,max:this.fi,data:e}},Mb:function(){this.Eb.emit("extremachange",{min:this.ci,max:this.fi})},addData:function(){if(0<arguments[0].length)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var i=this.mb(arguments[0],!0);i&&(0===this.Ki.length&&(this.ci=this.fi=i.value),this.Eb.emit("renderpartial",{min:this.ci,max:this.fi,data:[i]}))}return this},setData:function(t){var e=t.data,i=e.length;this.Ki=[],this.bb=[];for(var r=0;r<i;r++)this.mb(e[r],!1);return this.fi=t.max,this.ci=t.min||0,this.Mb(),this.Eb.emit("renderall",this.Lb()),this},removeData:function(){},setDataMax:function(t){return this.fi=t,this.Mb(),this.Eb.emit("renderall",this.Lb()),this},setDataMin:function(t){return this.ci=t,this.Mb(),this.Eb.emit("renderall",this.Lb()),this},setCoordinator:function(t){this.Eb=t},Lb:function(){return{max:this.fi,min:this.ci,data:this.Ki,radi:this.bb}},getData:function(){return this.xb()}},t);function t(t){this.Eb={},this.Ki=[],this.bb=[],this.ci=10,this.fi=1,this.gb=t.xField||t.defaultXField,this._b=t.yField||t.defaultYField,this.yb=t.valueField||t.defaultValueField,t.radius&&(this.wb=t.radius)}function r(t){var e=t.gradient||t.defaultGradient,i=(t=t.canvas).getContext("2d"),r=(t.width=256,t.height=1,i.createLinearGradient(0,0,256,1)),n=Object.keys(e).map(parseFloat),s=(n.sort(function(t,e){return t-e}),[]);for(let t=0;t<n.length;t++)s.push(e[n[t]]);for(let t=0;t<n.length;t++)r.addColorStop(n[t],s[t]);return i.fillStyle=r,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data}function e(t){var e=this.shadowCanvas=t.canvas,i=this.canvas=t.canvas;this.Tb=[1e4,1e4,0,0],e.width=i.width,e.height=i.height,this.Gd=i.width,this.T=i.height,this.ctx=i.getContext("2d"),this.shadowCtx=e.getContext("2d"),this.Sb=r(t),this.Ab={},this.Ob(t)}i=!(e.prototype={renderPartial:function(t){0<t.data.length&&(this.Cb(t),this.Rb())},renderAll:function(t){this.cs(),0<t?.data?.length&&(this.Cb((t=>{for(var e=[],i=t.min,r=t.max,n=t.radi,t=t.data,s=Object.keys(t),o=s.length;o--;)for(var a=s[o],h=Object.keys(t[a]),l=h.length;l--;){var u=h[l],c=t[a][u],f=n[a][u];e.push({x:a,y:u,value:c,radius:f})}return{min:i,max:r,data:e}})(t)),this.Rb())},Nb:function(t){this.Sb=r(t)},updateConfig:function(t){t.gradient&&this.Nb(t),this.Ob(t)},setDimensions:function(t,e){this.Gd=t,this.T=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},cs:function(){this.shadowCtx.clearRect(0,0,this.Gd,this.T),this.ctx.clearRect(0,0,this.Gd,this.T)},Ob:function(t){this.h_=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this.Gd=this.canvas.width=this.shadowCanvas.width=t.width||this.Gd,this.T=this.canvas.height=this.shadowCanvas.height=t.height||this.T,this.jf=255*(t.opacity||0),this.o_=255*(t.maxOpacity||t.defaultMaxOpacity),this.a_=255*(t.minOpacity||t.defaultMinOpacity),this.Db=!!t.useGradientOpacity},Cb:function(t){for(var e,i,r,n,s,o,a=this.ci=t.min,h=this.fi=t.max,l=(t=t.data||[]).length,u=1-this.h_;l--;){var c=t[l],f=c.x,d=c.y,v=c.radius,c=Math.min(c.value,h),f=f-v,d=d-v,c=(c-a)/(h-a);this.ctx.globalAlpha=c<.01?.01:c,c=this.ctx,r=f,n=d,o=s=void 0,o=s=e=v,1==(i=u)?(c.beginPath(),c.arc(r,n,e,0,2*Math.PI,!1),c.fillStyle="rgba(0,0,0,1)",c.fill()):((i=c.createRadialGradient(r+s,n+o,e*i,r+s,n+o,e)).addColorStop(0,"rgba(0,0,0,1)"),i.addColorStop(1,"rgba(0,0,0,0)"),c.fillStyle=i,c.fillRect(r,n,2*e,2*e)),f<this.Tb[0]&&(this.Tb[0]=f),d<this.Tb[1]&&(this.Tb[1]=d),f+2*v>this.Tb[2]&&(this.Tb[2]=f+2*v),d+2*v>this.Tb[3]&&(this.Tb[3]=d+2*v)}},Rb:function(){for(var t=this.Tb[0],e=this.Tb[1],i=this.Tb[2]-t,r=this.Tb[3]-e,n=this.Gd,s=this.T,o=this.jf,a=this.o_,h=this.a_,l=this.Db,n=this.shadowCtx.getImageData(t=t<0?0:t,e=e<0?0:e,i=n<t+i?n-t:i,r=s<e+r?s-e:r),u=n.data,c=u.length,f=this.Sb,d=3;d<c;d+=4){var v=u[d],p=4*v;p&&(v=0<o?o:v<a?v<h?h:v:a,u[d-3]=f[p],u[d-2]=f[1+p],u[d-1]=f[2+p],u[d]=l?f[3+p]:v)}this.ctx.putImageData(n,t,e),this.Tb=[1e3,1e3,0,0]},getValueAt:function(t){var t=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],e=this.fi,i=this.ci;return Math.abs(e-i)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}});var i,o,a=i="canvas2d"===n.defaultRenderer?e:i,h=function(){for(var t={},e=arguments.length,i=0;i<e;i++){var r,n=arguments[i];for(r in n)t[r]=n[r]}return t},u=(c.prototype={on:function(t,e,i){var r=this.cStore;r[t]||(r[t]=[]),r[t].push(function(t){return e.call(i,t)})},emit:function(t,e){var i=this.cStore;if(i[t])for(var r=i[t].length,n=0;n<r;n++)(0,i[t][n])(e)}},o=c,f.prototype={addData:function(){return this.kb.addData.apply(this.kb,arguments),this},removeData:function(){return this.kb.removeData&&this.kb.removeData.apply(this.kb,arguments),this},setData:function(){return this.kb.setData.apply(this.kb,arguments),this},setDataMax:function(){return this.kb.setDataMax.apply(this.kb,arguments),this},setDataMin:function(){return this.kb.setDataMin.apply(this.kb,arguments),this},configure:function(t){return this.Pb=h(this.Pb,t),this.G_.updateConfig(this.Pb),this.Eb.emit("renderall",this.kb.Lb()),this},repaint:function(){return this.Eb.emit("renderall",this.kb.Lb()),this},getData:function(){return this.kb.getData()},getDataURL:function(){return this.G_.getDataURL()},getValueAt:function(t){return this.kb.getValueAt?this.kb.getValueAt(t):this.G_.getValueAt?this.G_.getValueAt(t):null}},f);function c(){this.cStore={}}function f(){var e,t,i=this.Pb=h(n,arguments[0]||{});if(this.Eb=new o,i.plugin){var r=i.plugin;if(!n.plugins[r])throw new Error("Plugin '"+r+"' not found. Maybe it was not registered.");var r=n.plugins[r];this.G_=new r.renderer(i),this.kb=new r.store(i)}else this.G_=new a(i),this.kb=new s(i);r=(e=this).G_,i=e.Eb,t=e.kb,i.on("renderpartial",r.renderPartial,r),i.on("renderall",r.renderAll,r),i.on("extremachange",function(t){e.Pb.onExtremaChange&&e.Pb.onExtremaChange({min:t.min,max:t.max,gradient:e.Pb.gradient||e.Pb.defaultGradient})}),t.setCoordinator(i)}return{create:function(t){return new u(t)},register:function(t,e){n.plugins[t]=e}}},t.exports?t.exports=i():e.h337=i()})(Hy),Hy.exports),zy=rs(By);class Vy{constructor(t){this.x=t.x,this.y=t.y}addTo(){}remove(){}dispose(){}moveTo(t){this.x=t.x,this.y=t.y}getRenderNode(){return{}}}Object.assign(jc.prototype,{ym(t){this.On&&(this.R.traverse(e=>{if(this.R.Vt.vs(e)){var i=e.visibleLevels,n=[],s=t??this.R.getZoom(),r=this.P.Hm;for(let t=0;t<i.length;t++){var o=e.getFloor(i[t]);if(o){var a=o.getLayers(p.LABEL_LAYER);let t;0<a.length&&(t=a[0].scene);a=o.getLayers(p.FACILITY_LAYER);let e;0<a.length&&(e=a[0].scene);a=[];t&&a.push(...t.children),e&&a.push(...e.children),n.length=0,t&&this.es(n,t.children,!0,s,t.mapNode.ns),e&&this.es(n,e.children,!1,s,e.mapNode.ns);for(let t=0;t<r.length;t++){var h=r[t];for(let r=n.length=0;r<h.length;r++){var l=h[r],l=o.getLayers(l);let t,e,i=!1;0<l.length&&(t=l[0],e=t.scene,i=!0===t.isHasText),e&&void 0!==t.collision&&(e.children.forEach(t=>{t.mapNode&&t.mapNode.avoidAfter&&t.mapNode.avoidBefor()}),this.es(n,e.children,i,s,t.collision))}}}}}}),this.On=!1,this.R.enableUpdateRender())}}),ot.XMLHttpRequest=Pb,ot.environment=q.WX,ot.window=Ab,ot.ProtoReaderStatic=ky,ot.WX_USER_DATA_PATH=/^(wxfile:)?\/\//i,ot.heatmap=zy,ot.FMDomMarker=Vy;let Wy={FMMarkerCluster:Uy,FMUtil:st,FMHeatMap:Iy,FMWXSetting:o,FMMap:_,FMType:p,FMImageMarker:q_,FMTextMarker:J_,FMPolygonMarker:Q_,FMLocationMarker:tb,FMExtrudeMarker:sb,FMLineMarker:y_,FMLineType:b_,FMSegment:__,FMDynamicModel:ob,VERSION:c.VERSION,BUILD:c.BUILD,FMLight:hb,FMLightMode:ab,FMBound:$n,FMViewMode:Vr,FMShadingMode:xs,FMLabelField:tg,FMMarkerAnchor:Yr,FMTextAlign:hv,FMEdgeMode:ib,FMInfoMode:Wr,FMOverviewMode:Pm,FMEnterTriggerMode:U_,FMCalculator:sg,FMCoordsTransformer:lb},{VERSION:Yy,BUILD:Xy}=(ot.initCanvas=(t,e)=>{t=t.container;Ob(t),Ob(o.textureCanvas[0]),ot.document=new Fb(t,o.textureCanvas[0]),ot.textureHelper=new Ib(t,o.textureCanvas[0],e)},c);exports.BUILD=Xy,exports.FMBound=$n,exports.FMCalculator=sg,exports.FMCoordsTransformer=lb,exports.FMDynamicModel=ob,exports.FMEdgeMode=ib,exports.FMEnterTriggerMode=U_,exports.FMExtrudeMarker=sb,exports.FMHeatMap=Iy,exports.FMImageMarker=q_,exports.FMInfoMode=Wr,exports.FMLabelField=tg,exports.FMLight=hb,exports.FMLightMode=ab,exports.FMLineMarker=y_,exports.FMLineType=b_,exports.FMLocationMarker=tb,exports.FMMap=_,exports.FMMarkerAnchor=Yr,exports.FMMarkerCluster=Uy,exports.FMOverviewMode=Pm,exports.FMPolygonMarker=Q_,exports.FMSegment=__,exports.FMShadingMode=xs,exports.FMTextAlign=hv,exports.FMTextMarker=J_,exports.FMType=p,exports.FMUtil=st,exports.FMViewMode=Vr,exports.FMWXSetting=o,exports.VERSION=Yy,exports.default=Wy;
